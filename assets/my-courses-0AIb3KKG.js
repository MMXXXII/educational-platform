import{w as K}from"./with-props-CdbLO-WJ.js";import{a as r,o as e,s as d}from"./chunk-AYJ5UCUI-B1579ApN.js";import{c as u}from"./coursesService-DenKHoiM.js";import{u as Q}from"./AuthContext-8jqzhkGD.js";import{L as U,P as F,a as E}from"./PageSizeSelector-B7uZMnD3.js";import"./config-GGwLlXRi.js";import{F as $}from"./AcademicCapIcon-DuzTDbhn.js";import{F as b,a as V}from"./PlayIcon-BMWOxeBl.js";import{F as W}from"./PlusIcon-DynyqxMJ.js";import{F as X}from"./TrashIcon-DeKKRKWf.js";import"./indexedDB-DhaisdTJ.js";function Y(){const{hasRole:y}=Q(),[l,j]=r.useState("enrolled"),[f,z]=r.useState([]),[x,p]=r.useState([]),[T,n]=r.useState(!0),[N,v]=r.useState(null),[i,k]=r.useState(1),[R,M]=r.useState(1),[w,A]=r.useState(0),[m,L]=r.useState(12),[c,C]=r.useState(1),[I,_]=r.useState(1),[P,S]=r.useState(0),[g,B]=r.useState(12),o=y(["admin","teacher"]);r.useEffect(()=>{(async()=>{try{n(!0);const s=await u.getMyCourses(i,m);z(s.items||[]),A(s.total||0),M(s.pages||1)}catch(s){console.error("Failed to fetch enrolled courses:",s),v("Не удалось загрузить курсы")}finally{n(!1)}})()},[i,m]),r.useEffect(()=>{if(!o)return;(async()=>{try{l==="created"&&n(!0);const s=await u.getMyCreatedCourses(c,g);p(s.items||[]),S(s.total||0),_(s.pages||1)}catch(s){console.error("Failed to fetch created courses:",s),l==="created"&&v("Не удалось загрузить созданные курсы")}finally{l==="created"&&n(!1)}})()},[c,g,o]);const D=async(t,s)=>{if(window.confirm(`Вы уверены, что хотите удалить курс "${s}"?`))try{n(!0),await u.deleteCourse(t);const a=x.filter(h=>h.id!==t);p(a),S(h=>h-1)}catch(a){console.error("Failed to delete course:",a),alert(`Не удалось удалить курс: ${a.message||"Неизвестная ошибка"}`)}finally{n(!1)}},O=t=>{const s=parseInt(t.target.value);L(s),k(1)},q=t=>{const s=parseInt(t.target.value);B(s),C(1)},G=({progress:t})=>e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5",children:e.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full transition-all duration-300",style:{width:`${t||0}%`}})}),H=({course:t})=>{const s=t.enrollments&&t.enrollments.length>0?t.enrollments[0]:null,a=s?s.progress:0;return s&&s.completed,e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-14 mb-2",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-gray-100 line-clamp-2",children:t.title})}),e.jsx("div",{className:"h-10 mb-3",children:e.jsx("p",{className:"text-gray-600 dark:text-gray-300 text-sm line-clamp-2",children:t.description})}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500 dark:text-gray-400 mb-3",children:[e.jsxs("span",{children:["Автор: ",t.author]}),e.jsx("span",{className:"mx-2",children:"•"}),e.jsxs("span",{children:[t.lessons_count||0," уроков"]})]}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-300",children:"Прогресс"}),e.jsxs("span",{className:"text-xs font-medium text-gray-700 dark:text-gray-200",children:[Math.round(a),"%"]})]}),e.jsx(G,{progress:a})]})]}),e.jsx($,{className:"h-8 w-8 text-blue-500 flex-shrink-0 ml-4"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(d,{to:`/courses/${t.id}`,className:"text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 text-sm font-medium",children:"Подробнее о курсе"}),e.jsxs(d,{to:"/node-editor",className:"flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),a>0?"Продолжить":"Начать"]})]})]})},J=({course:t})=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-14 mb-2",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-gray-100 line-clamp-2",children:t.title})}),e.jsx("div",{className:"h-10 mb-3",children:e.jsx("p",{className:"text-gray-600 dark:text-gray-300 text-sm line-clamp-2",children:t.description})}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{children:[t.students_count||0," студентов"]}),e.jsx("span",{className:"mx-2",children:"•"}),e.jsxs("span",{children:[t.lessons_count||0," уроков"]})]})]}),e.jsx(b,{className:"h-8 w-8 text-green-500 flex-shrink-0 ml-4"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(d,{to:`/courses/${t.id}`,className:"text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 text-sm font-medium",children:"Просмотреть"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(d,{to:`/edit-course/${t.id}`,className:"flex items-center px-3 py-2 bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-200 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",title:"Редактировать курс",children:e.jsx(b,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>D(t.id,t.title),className:"flex items-center px-3 py-2 bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400 rounded-lg hover:bg-red-200 dark:hover:bg-red-900/50 transition-colors",title:"Удалить курс",children:e.jsx(X,{className:"h-4 w-4"})})]})]})]});return e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 py-8",children:[e.jsxs("div",{className:"mb-8 text-center md:text-left",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800 dark:text-white mb-2",children:"Мои курсы"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:o?"Управляйте своими курсами и продолжайте обучение":"Продолжайте обучение с того места, где остановились"})]}),o&&e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700 mb-6",children:e.jsxs("nav",{className:"-mb-px flex space-x-8",children:[e.jsxs("button",{onClick:()=>j("enrolled"),className:`py-2 px-1 border-b-2 font-medium text-sm ${l==="enrolled"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600"}`,children:["Изучаемые курсы (",w,")"]}),e.jsxs("button",{onClick:()=>j("created"),className:`py-2 px-1 border-b-2 font-medium text-sm ${l==="created"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600"}`,children:["Созданные курсы (",P,")"]})]})}),T?e.jsx(U,{}):N?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-red-600 dark:text-red-400",children:N})}):e.jsxs(e.Fragment,{children:[l==="enrolled"&&e.jsx(e.Fragment,{children:f.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx($,{className:"mx-auto h-12 w-12 text-gray-400 dark:text-gray-500 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2",children:"Вы еще не записаны ни на один курс"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Начните свое обучение прямо сейчас"}),e.jsx(d,{to:"/courses",className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Перейти к каталогу курсов"})]}):e.jsxs(e.Fragment,{children:[e.jsx(F,{pageSize:m,onChange:O,currentPage:i,totalItems:w,itemName:"курсов"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8",children:f.map(t=>e.jsx(H,{course:t},t.id))}),e.jsx(E,{currentPage:i,totalPages:R,onPageChange:k})]})}),l==="created"&&o&&e.jsx(e.Fragment,{children:x.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(b,{className:"mx-auto h-12 w-12 text-gray-400 dark:text-gray-500 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2",children:"Вы еще не создали ни одного курса"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Создайте свой первый курс и поделитесь знаниями"}),e.jsxs(d,{to:"/create-course",className:"inline-flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[e.jsx(W,{className:"h-5 w-5 mr-2"}),"Создать курс"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(F,{pageSize:g,onChange:q,currentPage:c,totalItems:P,itemName:"курсов"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8",children:x.map(t=>e.jsx(J,{course:t},t.id))}),e.jsx(E,{currentPage:c,totalPages:I,onPageChange:C})]})})]})]})}function ce({}){return[{title:"Ваши курсы"},{name:"description",content:"Здесь вы можете просматривать и управлять своими курсами"}]}const xe=K(function(){return e.jsx(Y,{})});export{xe as default,ce as meta};
