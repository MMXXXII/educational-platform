import{w as ge}from"./with-props-CdbLO-WJ.js";import{a as s,o as e,s as ue}from"./chunk-AYJ5UCUI-B1579ApN.js";import{u as z,N as he,R as fe,a as ye,b as A,F as be,E as pe}from"./FlowCanvas-jW2CS78L.js";import{F as H,a as je,b as we}from"./FolderIcon-3kgVsAiG.js";import{F as Z}from"./ArrowPathIcon-CYqLai-V.js";import{F as q}from"./CheckCircleIcon-UDH-7wKd.js";import{F as B}from"./TrashIcon-DeKKRKWf.js";import{F as ke}from"./XMarkIcon-D64FOle9.js";import{F as Ne}from"./Bars3Icon-BkkQTm41.js";import{F as U}from"./CheckIcon-7azco_cl.js";import"./ExclamationTriangleIcon-LoCsT_0_.js";import"./ChevronDownIcon-BxZwbkus.js";import"./index-BHLz7_dj.js";import"./RocketLaunchIcon-B-1hGzc_.js";import"./UserIcon-CGgSBpiG.js";import"./DocumentTextIcon-Bx8j1DmN.js";import"./CodeBracketIcon-TE7D0uFq.js";function ve({title:a,titleId:r,...l},d){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:d,"aria-labelledby":r},l),a?s.createElement("title",{id:r},a):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"}))}const $e=s.forwardRef(ve);function Ce({title:a,titleId:r,...l},d){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:d,"aria-labelledby":r},l),a?s.createElement("title",{id:r},a):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v6m3-3H9m12 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))}const X=s.forwardRef(Ce),Ee=({onClick:a,isMobile:r=!1})=>r?e.jsx("button",{onClick:a,className:"p-2 rounded-full bg-indigo-600 hover:bg-indigo-700 text-white shadow-sm",title:"Управление проектами",children:e.jsx(H,{className:"w-5 h-5"})}):e.jsxs("button",{onClick:a,className:"px-3 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded flex items-center shadow-sm hover:shadow transition-all duration-200",title:"Управление проектами",children:[e.jsx(H,{className:"w-5 h-5 mr-1.5"}),e.jsx("span",{children:"Проекты"})]}),Pe=(a,r="info")=>{b&&b.notify&&b.notify(a,r)},Se=({onClose:a,isMobile:r=!1})=>{const{projectName:l,projectsList:d,projectVersions:k,saveProject:p,loadProject:j,deleteProject:N,exportProject:E,refreshProjectsList:i,createProjectVersion:P,loadProjectVersion:v,refreshVersionsList:g,createNewProject:L,importProject:F,deleteProjectVersion:h}=z(),[x,w]=s.useState("projects"),[u,o]=s.useState([]),[$,Y]=s.useState(""),[D,M]=s.useState("name"),[T,ee]=s.useState("asc"),[V,J]=s.useState(""),[W,_]=s.useState(""),[R,te]=s.useState(null),[f,G]=s.useState(""),[S,K]=s.useState(null),I=s.useRef(null),O=s.useCallback(()=>{if(l)try{const t=`nodeEditor_project_${l.trim()}`,n=localStorage.getItem(t);if(n){const m=JSON.parse(n);K(m),console.log("Загружена информация о проекте:",m)}}catch(t){console.error("Ошибка при загрузке информации о текущем проекте:",t),K(null)}},[l]);s.useEffect(()=>{x==="versions"&&l&&(g(),O())},[x,l,g,O]),s.useEffect(()=>{i()},[i]);const re=()=>{if(!V.trim()){c("Название версии не может быть пустым","warning");return}P(V.trim(),W.trim())?(c(`Версия "${V}" успешно создана`,"success"),J(""),_(""),g(),O()):c("Ошибка при создании версии","error")},se=t=>{if(!t)return;v(t)?(c(`Версия "${t}" успешно загружена`,"success"),O(),a&&a()):c(`Ошибка при загрузке версии "${t}"`,"error")},ae=t=>{t&&window.confirm(`Вы уверены, что хотите удалить версию "${t}"?`)&&(h(t)?(c(`Версия "${t}" успешно удалена`,"success"),g(),O()):c(`Ошибка при удалении версии "${t}"`,"error"))},ne=()=>{E()?c("Проект успешно экспортирован в формате JSON","success"):c("Ошибка при экспорте проекта","error")},le=t=>{o(n=>n.includes(t)?n.filter(m=>m!==t):[...n,t])},ce=t=>{j(t)?(c(`Проект "${t}" успешно загружен`,"success"),i(),a&&a()):c(`Ошибка при загрузке проекта "${t}"`,"error")},de=t=>{window.confirm(`Вы уверены, что хотите удалить проект "${t}"?`)&&(N(t)?(c(`Проект "${t}" успешно удален`,"success"),o(m=>m.filter(y=>y!==t)),i()):c(`Ошибка при удалении проекта "${t}"`,"error"))},c=(t,n="info")=>{te({message:t,type:n}),Pe(t,n)},oe=()=>{I.current&&I.current.click()},ie=async t=>{const n=t.target.files[0];if(!n)return;if(n.name.split(".").pop().toLowerCase()!=="json"){c("Поддерживается только формат JSON","error");return}try{await F(n)?(c(`Проект "${n.name}" успешно импортирован`,"success"),i(),a&&a()):c("Ошибка при импорте проекта","error")}catch(y){c(`Ошибка при импорте проекта: ${y.message}`,"error")}t.target.value=null},xe=()=>d.filter(n=>n.toLowerCase().includes($.toLowerCase())).sort((n,m)=>{let y=0;return(D==="name"||D==="date")&&(y=n.localeCompare(m)),T==="asc"?y:-y}),me=t=>{try{return new Date(t).toLocaleString()}catch{return t||"Неизвестная дата"}},Q=()=>{if(!f||!f.trim()){c("Имя проекта не может быть пустым","warning");return}if(d.includes(f.trim())){c(`Проект с именем "${f}" уже существует`,"warning");return}L(f.trim(),!0)?(c(`Создан новый проект: ${f}`,"success"),G(""),setTimeout(()=>{p(f.trim())?(c("Проект успешно сохранен","success"),i(),a&&setTimeout(()=>a(),500)):(c("Проект создан, но не удалось сохранить его. Попробуйте сохранить вручную.","warning"),i())},100)):c("Ошибка при создании проекта","error")},C=xe();return e.jsxs("div",{className:"project-manager bg-white dark:bg-gray-800 w-full",children:[R&&e.jsx("div",{className:`mx-4 mt-2 p-3 rounded ${R.type==="success"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":R.type==="error"?"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200":R.type==="warning"?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200":"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200"}`,children:R.message}),e.jsxs("div",{className:"flex border-b border-gray-200 dark:border-gray-700",children:[e.jsx("button",{className:`px-4 py-2 ${x==="projects"?"text-blue-600 border-b-2 border-blue-600 dark:text-blue-400 dark:border-blue-400":"text-gray-600 dark:text-gray-400"}`,onClick:()=>w("projects"),children:"Проекты"}),l&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:`px-4 py-2 ${x==="versions"?"text-blue-600 border-b-2 border-blue-600 dark:text-blue-400 dark:border-blue-400":"text-gray-600 dark:text-gray-400"}`,onClick:()=>w("versions"),children:"Версии"}),e.jsx("button",{className:`px-4 py-2 ${x==="export"?"text-blue-600 border-b-2 border-blue-600 dark:text-blue-400 dark:border-blue-400":"text-gray-600 dark:text-gray-400"}`,onClick:()=>w("export"),children:"Экспорт/Импорт"})]})]}),e.jsxs("div",{className:"p-4",children:[x==="projects"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4 p-4 bg-gray-50 dark:bg-gray-700 rounded border border-gray-200 dark:border-gray-600",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-800 dark:text-white mb-3",children:"Создать новый проект"}),e.jsxs("div",{className:`flex ${r?"flex-col":""} gap-2`,children:[e.jsx("input",{type:"text",placeholder:"Введите имя нового проекта...",value:f,onChange:t=>G(t.target.value),className:`${r?"w-full mb-2":"flex-1"} p-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200`,onKeyDown:t=>t.key==="Enter"&&Q()}),e.jsxs("button",{onClick:Q,className:`${r?"w-full":"px-4"} py-2 ${f.trim()?"bg-indigo-500 hover:bg-indigo-600 text-white cursor-pointer":"bg-gray-300 text-gray-500 cursor-not-allowed dark:bg-gray-600 dark:text-gray-400"} rounded-lg transition-all duration-200 flex items-center ${r?"justify-center":""} shadow-sm hover:shadow`,disabled:!f.trim(),children:[e.jsx(X,{className:"h-5 w-5 mr-1.5"}),"Создать"]})]})]}),e.jsxs("div",{className:`${r?"flex flex-col":"flex flex-wrap"} gap-2 mb-4`,children:[e.jsx("div",{className:`${r?"w-full mb-2":"flex-1"}`,children:e.jsx("input",{type:"text",placeholder:"Поиск проектов...",value:$,onChange:t=>Y(t.target.value),className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200"})}),e.jsxs("div",{className:`${r?"flex w-full":"flex"} gap-2`,children:[e.jsxs("select",{value:D,onChange:t=>M(t.target.value),className:`p-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 ${r?"flex-1":""}`,children:[e.jsx("option",{value:"name",children:"Сортировать по имени"}),e.jsx("option",{value:"date",children:"Сортировать по дате"})]}),e.jsx("button",{onClick:()=>ee(t=>t==="asc"?"desc":"asc"),className:`p-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 ${r?"flex-1":""}`,title:T==="asc"?"По возрастанию":"По убыванию",children:T==="asc"?"↑":"↓"}),e.jsx("button",{onClick:()=>{i(),c("Список проектов обновлен","info")},className:`p-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 ${r?"flex-1":""}`,title:"Обновить список",children:e.jsx(Z,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"overflow-y-auto max-h-96 border border-gray-200 dark:border-gray-700 rounded",children:C.length===0?e.jsx("div",{className:"p-4 text-center text-gray-500 dark:text-gray-400",children:$?"Нет проектов, соответствующих запросу":"Нет доступных проектов"}):e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsxs("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[e.jsx("input",{type:"checkbox",checked:u.length===C.length&&C.length>0,onChange:()=>{u.length===C.length?o([]):o([...C])},className:"mr-2"}),"Название"]}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Действия"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:C.map(t=>e.jsxs("tr",{className:`hover:bg-gray-50 dark:hover:bg-gray-700 ${t===l?"bg-blue-50 dark:bg-blue-900/30":""}`,children:[e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:u.includes(t),onChange:()=>le(t),className:"mr-2"}),e.jsx(H,{className:"w-5 h-5 mr-2 text-yellow-500 dark:text-yellow-400"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:t})]})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>ce(t),className:"p-1 text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",title:"Открыть проект",children:e.jsx(q,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>de(t),className:"p-1 text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300",title:"Удалить проект",children:e.jsx(B,{className:"w-5 h-5"})})]})})]},t))})]})}),e.jsxs("div",{className:`${r?"flex flex-col":"flex justify-between"} mt-4`,children:[e.jsx("div",{className:`${r?"mb-2":""}`,children:e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Выбрано: ",u.length," из ",C.length]})}),e.jsx("div",{className:`${r?"w-full":"flex space-x-2"}`,children:e.jsxs("button",{disabled:u.length===0,onClick:()=>{if(window.confirm(`Вы уверены, что хотите удалить ${u.length} выбранных проектов?`)){let t=0;u.forEach(n=>{N(n)&&t++}),c(`Удалено проектов: ${t} из ${u.length}`,"info"),o([])}},className:`${r?"w-full":"px-4"} py-2 rounded ${u.length===0?"bg-gray-300 text-gray-500 dark:bg-gray-700 dark:text-gray-400 cursor-not-allowed":"bg-red-600 text-white hover:bg-red-700 dark:hover:bg-red-700"}`,children:[e.jsx(B,{className:"w-5 h-5 inline mr-1"}),"Удалить выбранные"]})})]})]}),x==="versions"&&l&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-800 dark:text-white mb-2",children:"Управление версиями"}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded p-4 mb-4",children:[e.jsx("h4",{className:"font-medium text-gray-800 dark:text-gray-200 mb-2",children:"Создать новую версию"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Название версии"}),e.jsx("input",{type:"text",value:V,onChange:t=>J(t.target.value),className:`w-full p-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 ${r?"text-sm":""}`,placeholder:"например: v1.0.0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Комментарий (необязательно)"}),e.jsx("textarea",{value:W,onChange:t=>_(t.target.value),className:`w-full p-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 ${r?"text-sm":""}`,rows:"2",placeholder:"Описание изменений в этой версии..."})]}),e.jsxs("button",{onClick:re,className:`${r?"w-full":"px-4"} py-2 bg-blue-600 text-white rounded hover:bg-blue-700 flex items-center ${r?"justify-center text-sm":""}`,children:[e.jsx(X,{className:`${r?"w-4 h-4":"w-5 h-5"} mr-1`}),"Создать версию"]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h4",{className:"font-medium text-gray-800 dark:text-gray-200",children:"История версий"}),e.jsx("button",{onClick:()=>{g(),c("Список версий обновлен","info")},className:"p-1 rounded hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-400",title:"Обновить список версий",children:e.jsx(Z,{className:"w-5 h-5"})})]}),k.length===0?e.jsx("div",{className:"bg-gray-50 dark:bg-gray-700 rounded p-4 text-center text-gray-500 dark:text-gray-400",children:"Нет сохраненных версий"}):e.jsx("div",{className:"overflow-y-auto max-h-64 border border-gray-200 dark:border-gray-700 rounded",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Версия"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Дата"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Комментарий"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Действия"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:k.map((t,n)=>e.jsxs("tr",{className:`hover:bg-gray-50 dark:hover:bg-gray-700 ${S&&S.metadata&&S.metadata.lastLoadedVersion===t.name?"bg-blue-50 dark:bg-blue-900/20":""}`,children:[e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx($e,{className:"w-5 h-5 mr-2 text-green-500 dark:text-green-400"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:t.name}),S&&S.metadata&&S.metadata.lastLoadedVersion===t.name&&e.jsx("span",{className:"ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",children:"Текущая"})]})]})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:me(t.date)}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:t.comment||e.jsx("span",{className:"italic text-gray-400 dark:text-gray-500",children:"Нет комментария"})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>se(t.name),className:"p-1 text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",title:"Загрузить версию",children:e.jsx(q,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>ae(t.name),className:"p-1 text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300",title:"Удалить версию",children:e.jsx(B,{className:"w-5 h-5"})})]})})]},n))})]})})]})]})}),x==="export"&&l&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded p-4 mb-4",children:[e.jsx("h4",{className:"font-medium text-gray-800 dark:text-gray-200 mb-2",children:"Экспорт проекта"}),e.jsx("div",{className:"flex flex-col space-y-2",children:e.jsxs("button",{onClick:ne,className:`${r?"w-full text-sm":"px-4"} py-2 bg-blue-600 text-white rounded hover:bg-blue-700 flex items-center ${r?"justify-center":""}`,children:[e.jsx(je,{className:`${r?"w-4 h-4":"w-5 h-5"} mr-1`}),"Экспортировать проект в JSON"]})})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded p-4 mb-4",children:[e.jsx("h4",{className:"font-medium text-gray-800 dark:text-gray-200 mb-2",children:"Импорт проекта"}),e.jsx("input",{type:"file",ref:I,onChange:ie,style:{display:"none"},accept:".json"}),e.jsxs("button",{onClick:oe,className:`${r?"text-sm":"px-4"} py-2 bg-purple-600 text-white rounded hover:bg-purple-700 w-full flex items-center ${r?"justify-center":""}`,children:[e.jsx(we,{className:`${r?"w-4 h-4":"w-5 h-5"} mr-1`}),"Выбрать JSON файл для импорта"]})]})]})})]})]})},Le=({isOpen:a,onClose:r,isMobile:l=!1})=>a?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",onClick:d=>{d.target===d.currentTarget&&r()},children:[e.jsx("div",{className:"absolute inset-0 bg-gray-900/75"}),e.jsx("div",{className:`bg-white dark:bg-gray-800 rounded-lg overflow-hidden shadow-xl w-full ${l?"max-w-sm mx-2":"max-w-6xl mx-4"} z-50 relative`,onClick:d=>d.stopPropagation(),children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:`${l?"text-lg":"text-xl"} font-medium text-gray-900 dark:text-gray-100`,children:"Менеджер проектов"}),e.jsx("button",{className:"p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-500 dark:text-gray-400",onClick:r,children:e.jsx(ke,{className:`${l?"h-5 w-5":"h-6 w-6"}`})})]}),e.jsx("div",{className:`mt-4 max-h-[calc(90vh-8rem)] overflow-y-auto ${l?"px-1":""}`,children:e.jsx(Se,{onClose:r,isMobile:l})})]})})]}):null,Fe=({projectName:a,isModified:r,onSave:l,isMobile:d=!1})=>{const{refreshProjectsList:k}=z(),[p,j]=s.useState(!1),[N,E]=s.useState(!1),[i,P]=s.useState(!1);s.useEffect(()=>{const h=window.matchMedia("(prefers-color-scheme: dark)");P(h.matches);const x=w=>{P(w.matches)};return h.addEventListener("change",x),()=>{h.removeEventListener("change",x)}},[]);const v=()=>{j(!p)},g=s.useCallback(()=>{j(!1),k()},[k]),L=()=>{E(!N)},F=()=>{l(),E(!1)};return e.jsxs(e.Fragment,{children:[e.jsx("nav",{className:"bg-white dark:bg-gray-800 shadow-md h-16",children:e.jsx("div",{className:"w-full px-2 sm:px-6 lg:px-8 h-full",children:e.jsxs("div",{className:"flex items-center justify-between h-full",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs(ue,{to:"/",className:"flex-shrink-0",children:[e.jsx("img",{src:"/logo.png",alt:"Logo",className:"h-10 w-auto light-mode-logo"}),e.jsx("img",{src:"/dark logo.png",alt:"Logo",className:"h-10 w-auto dark-mode-logo"})]}),!d&&e.jsx("div",{className:"ml-4",children:e.jsxs("div",{className:"text-lg font-medium text-gray-800 dark:text-gray-200",children:["Редактор нодов",a&&e.jsxs("span",{className:"ml-2 text-gray-600 dark:text-gray-400",children:["- ",a,r&&e.jsx("span",{className:"ml-1 text-amber-500",children:"*"})]})]})})]}),d?e.jsxs("div",{className:"flex items-center",children:[a&&e.jsxs("div",{className:"mr-4 text-sm font-medium text-gray-600 dark:text-gray-400 truncate max-w-[120px]",children:[a,r&&e.jsx("span",{className:"ml-1 text-amber-500",children:"*"})]}),e.jsx("button",{className:"p-2 rounded-md text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-white focus:outline-none",onClick:L,children:e.jsx(Ne,{className:"h-6 w-6"})}),N&&e.jsx("div",{className:"absolute top-16 right-0 left-0 bg-white dark:bg-gray-800 shadow-lg z-50 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"px-4 py-2 space-y-2",children:[e.jsxs("button",{onClick:F,className:"w-full flex items-center justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none",children:[e.jsx(U,{className:"h-5 w-5 mr-2"}),"Сохранить"]}),e.jsx("button",{onClick:()=>{v(),E(!1)},className:"w-full flex items-center justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none",children:"Проекты"})]})})]}):e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("button",{onClick:l,className:"px-3 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none flex items-center",children:[e.jsx(U,{className:"h-5 w-5 mr-1.5"}),e.jsx("span",{children:"Сохранить"})]}),e.jsx(Ee,{onClick:v})]})]})})}),e.jsx(Le,{isOpen:p,onClose:g,isMobile:d})]})},b={listeners:[],addListener:a=>(b.listeners.push(a),()=>{b.listeners=b.listeners.filter(r=>r!==a)}),notify:(a,r)=>{b.listeners.forEach(l=>l(a,r))}};function Re(){const[a,r]=s.useState(!1),{projectName:l,isModified:d,saveProject:k,saveError:p,loadError:j,refreshProjectsList:N,setNodes:E}=z(),i=s.useRef(null),[P,v]=s.useState(null),[g,L]=s.useState(!1);s.useEffect(()=>{r(!0)},[]),s.useEffect(()=>{const o=()=>{L(window.innerWidth<768)};return o(),window.addEventListener("resize",o),()=>{window.removeEventListener("resize",o)}},[]),s.useEffect(()=>{const o=b.addListener(h);return()=>o()},[]),s.useEffect(()=>{p&&h(p,"error")},[p]),s.useEffect(()=>{j&&h(j,"error")},[j]);const F=()=>{if(!l){b.notify("Сначала создайте новый проект через менеджер проектов","info");return}k()&&(h(`Проект "${l}" успешно сохранен`,"success"),N())},h=s.useCallback((o,$="error")=>{v({message:o,type:$})},[]),x=()=>{v(null)},w=s.useCallback((o,$)=>{g&&setTimeout(()=>{i.current&&i.current.addNode(o,$)},50)},[g]),u=[A.VARIABLES,A.CONTROL,A.OPERATIONS];return e.jsxs("div",{className:"w-full h-screen bg-gray-50 dark:bg-gray-900 flex flex-col",children:[e.jsx(Fe,{projectName:l,isModified:d,onSave:F,isMobile:g}),e.jsx(he,{notification:P,onClose:x,autoHideTime:5e3}),e.jsx("div",{className:"flex w-full h-[calc(100vh-4rem)]",children:a&&e.jsxs(fe,{children:[e.jsx(ye,{allowedCategories:u,onNodeSelect:w}),e.jsx(be,{ref:i,onNodeSelect:w})]})})]})}function Ue({}){return[{title:"Визуальная среда программирования"},{name:"description",content:"Редактор логических структур"}]}const Xe=ge(function(){return e.jsx(pe,{children:e.jsx(Re,{})})});export{Xe as default,Ue as meta};
