import{a as l,c as u}from"./config-GGwLlXRi.js";const n=l.create({baseURL:u.apiUrl,headers:{"Content-Type":"application/json"}}),y=r=>{const e=localStorage.getItem("access_token");return e&&(r.headers.Authorization=`Bearer ${e}`),r};n.interceptors.request.use(y);const m={getCourses:async(r={})=>{try{const e=new URLSearchParams;for(const t in r){const a=r[t];Array.isArray(a)?a.forEach(i=>{e.append(t,i)}):e.append(t,a)}return(await n.get(`/courses?${e.toString()}`)).data}catch(e){o(e)}},createCourse:async(r,e={})=>{try{const s=new FormData;s.append("title",r.title),s.append("description",r.description),s.append("longdescription",r.longDescription),s.append("difficulty",r.difficulty),r.category_ids&&r.category_ids.length>0&&r.category_ids.forEach(i=>{s.append("category_ids",Number(i))}),r.image&&s.append("image",r.image),r.lessons&&r.lessons.length>0&&s.append("lessons",JSON.stringify(r.lessons));const t={headers:{"Content-Type":"multipart/form-data"}};return e.token&&(t.headers.Authorization=`Bearer ${e.token}`),(await n.post("/courses/form",s,t)).data}catch(s){o(s)}},getCourseById:async r=>{try{return(await n.get(`/courses/${r}`)).data}catch(e){o(e)}},getCourseWithLessons:async r=>{try{return(await n.get(`/courses/${r}/with-lessons`)).data}catch(e){o(e)}},getMyCreatedCourses:async(r=1,e=10)=>{try{return(await n.get("/courses/created-by-me",{params:{page:r,size:e}})).data}catch(s){o(s)}},getCourseForEdit:async r=>{try{return(await n.get(`/courses/${r}/edit`)).data}catch(e){o(e)}},updateCourse:async(r,e,s={})=>{try{if(e.image instanceof File){const t=new FormData;e.title!==void 0&&t.append("title",e.title),e.description!==void 0&&t.append("description",e.description),e.longDescription!==void 0&&t.append("longdescription",e.longDescription),e.difficulty!==void 0&&t.append("difficulty",e.difficulty),e.category_ids!==void 0&&e.category_ids.length>0&&e.category_ids.forEach(d=>{t.append("category_ids",Number(d))}),t.append("image",e.image);const a={headers:{"Content-Type":"multipart/form-data"}};s.token&&(a.headers.Authorization=`Bearer ${s.token}`);const i=await n.post(`/courses/${r}/upload-image`,t,a),p={title:e.title,description:e.description,longdescription:e.longDescription,difficulty:e.difficulty,category_ids:e.category_ids},c=await n.put(`/courses/${r}`,p);return i&&i.data&&i.data.image_url&&(c.data.image_url=i.data.image_url),c.data}else{const t={...e,remove_image:e.remove_image===!0};return(await n.put(`/courses/${r}`,t)).data}}catch(t){o(t)}},deleteCourse:async r=>{try{return(await n.delete(`/courses/${r}`)).data||!0}catch(e){console.error("Error in deleteCourse:",e),o(e)}},getPopularCourses:async(r=5)=>{try{return(await n.get("/courses/popular",{params:{limit:r}})).data}catch(e){o(e)}},getRecentCourses:async(r=5)=>{try{return(await n.get("/courses/recent",{params:{limit:r}})).data}catch(e){o(e)}},getRecommendedCourses:async(r=5)=>{try{return(await n.get("/courses/recommended",{params:{limit:r}})).data}catch(e){o(e)}},enrollInCourse:async r=>{try{return(await n.post("/courses/enroll",{course_id:r})).data}catch(e){o(e)}},getUserEnrollments:async()=>{try{return(await n.get("/courses/enrollments")).data}catch(r){o(r)}},getMyCourses:async(r=1,e=10)=>{try{return(await n.get("/courses/my-courses",{params:{page:r,size:e}})).data}catch(s){o(s)}},updateEnrollment:async(r,e)=>{try{return(await n.put(`/courses/enrollments/${r}`,e)).data}catch(s){o(s)}},unenrollFromCourse:async r=>{try{return await n.delete(`/courses/enrollments/${r}`),!0}catch(e){o(e)}},getCourseProgress:async r=>{try{return(await n.get(`/courses/${r}/progress`)).data}catch(e){o(e)}},createLesson:async(r,e)=>{try{return(await n.post(`/courses/${r}/lessons`,e)).data}catch(s){o(s)}},updateLesson:async(r,e,s)=>{try{return(await n.put(`/courses/${r}/lessons/${e}`,s)).data}catch(t){o(t)}},deleteLesson:async(r,e)=>{try{return await n.delete(`/courses/${r}/lessons/${e}`),!0}catch(s){o(s)}},createManyLessons:async(r,e)=>{try{const s=e.map(a=>n.post(`/courses/${r}/lessons`,a));return(await Promise.all(s)).map(a=>a.data)}catch(s){o(s)}}},f={getCategories:async()=>{try{return(await n.get("/courses/categories")).data}catch(r){o(r)}},getCategoryById:async r=>{try{return(await n.get(`/courses/categories/${r}`)).data}catch(e){o(e)}}},o=r=>{let e="Произошла ошибка при обращении к API";if(r.response){const{status:t,data:a}=r.response;t===422&&a.detail?Array.isArray(a.detail)?e=a.detail.map(i=>`${i.loc.join(".")}: ${i.msg}`).join("; "):e=a.detail:e=a.detail||`Ошибка сервера: ${t}`,t===401?e="Требуется авторизация. Пожалуйста, войдите в систему.":t===403&&(e="Недостаточно прав для выполнения этой операции."),console.error("API Error Response:",t,a)}else r.request&&(e="Нет ответа от сервера. Проверьте подключение к интернету.");const s=new Error(e);throw s.originalError=r,s};export{f as a,m as c};
