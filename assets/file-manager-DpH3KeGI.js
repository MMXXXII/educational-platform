import{w as ue}from"./with-props-CdbLO-WJ.js";import{a as s,t as me,o as e}from"./chunk-AYJ5UCUI-B1579ApN.js";import{F as ge,a as fe,b as pe}from"./FolderIcon-3kgVsAiG.js";import{F as z}from"./DocumentTextIcon-Bx8j1DmN.js";import{F as he}from"./CodeBracketIcon-TE7D0uFq.js";import{F as I}from"./PencilIcon-DVEFDLXn.js";import{F as xe}from"./TrashIcon-DeKKRKWf.js";import{F as T}from"./XMarkIcon-D64FOle9.js";import{F as be,a as ye}from"./ExclamationTriangleIcon-LoCsT_0_.js";import{b as y}from"./AuthContext-8jqzhkGD.js";import{F as we}from"./MagnifyingGlassIcon-GD0hpaCd.js";import{P as ve}from"./ProtectedRoute-CNKgV1SH.js";import"./config-GGwLlXRi.js";import"./indexedDB-DhaisdTJ.js";const w={getFolders:async(r=null)=>(await y.get("/folders",{params:{parent:r}})).data,createFolder:async(r,a=null)=>(await y.post("/folders",{name:r,parent:a})).data,renameFolder:async(r,a)=>(await y.put(`/folders/${r}/rename`,null,{params:{new_name:a}})).data,deleteFolder:async r=>{await y.delete(`/folders/${r}`)},getFiles:async(r=null)=>(await y.get("/files",{params:{folder:r}})).data,uploadFile:async(r,a=null)=>{const n=new FormData;return n.append("file",r),a&&n.append("folder",a),(await y.post("/files",n,{headers:{"Content-Type":"multipart/form-data"}})).data},renameFile:async(r,a)=>(await y.put(`/files/${r}/rename`,null,{params:{new_name:a}})).data,deleteFile:async r=>{await y.delete(`/files/${r}`)},downloadFile:async r=>(await y.get(`/files/${r}/download`,{responseType:"blob"})).data};function ke({title:r,titleId:a,...n},t){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},n),r?s.createElement("title",{id:a},r):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m20.25 7.5-.625 10.632a2.25 2.25 0 0 1-2.247 2.118H6.622a2.25 2.25 0 0 1-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125Z"}))}const je=s.forwardRef(ke);function Ne({title:r,titleId:a,...n},t){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},n),r?s.createElement("title",{id:a},r):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z"}),s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}))}const Fe=s.forwardRef(Ne);function Ce({title:r,titleId:a,...n},t){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},n),r?s.createElement("title",{id:a},r):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m6.75 7.5 3 2.25-3 2.25m4.5 0h3m-9 8.25h13.5A2.25 2.25 0 0 0 21 18V6a2.25 2.25 0 0 0-2.25-2.25H5.25A2.25 2.25 0 0 0 3 6v12a2.25 2.25 0 0 0 2.25 2.25Z"}))}const Re=s.forwardRef(Ce);function Ee({title:r,titleId:a,...n},t){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},n),r?s.createElement("title",{id:a},r):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"}))}const Le=s.forwardRef(Ee);function Me({title:r,titleId:a,...n},t){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},n),r?s.createElement("title",{id:a},r):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 12.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 18.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5Z"}))}const Te=s.forwardRef(Me);function Pe({title:r,titleId:a,...n},t){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},n),r?s.createElement("title",{id:a},r):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.375 19.5h17.25m-17.25 0a1.125 1.125 0 0 1-1.125-1.125M3.375 19.5h1.5C5.496 19.5 6 18.996 6 18.375m-3.75 0V5.625m0 12.75v-1.5c0-.621.504-1.125 1.125-1.125m18.375 2.625V5.625m0 12.75c0 .621-.504 1.125-1.125 1.125m1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125m0 3.75h-1.5A1.125 1.125 0 0 1 18 18.375M20.625 4.5H3.375m17.25 0c.621 0 1.125.504 1.125 1.125M20.625 4.5h-1.5C18.504 4.5 18 5.004 18 5.625m3.75 0v1.5c0 .621-.504 1.125-1.125 1.125M3.375 4.5c-.621 0-1.125.504-1.125 1.125M3.375 4.5h1.5C5.496 4.5 6 5.004 6 5.625m-3.75 0v1.5c0 .621.504 1.125 1.125 1.125m0 0h1.5m-1.5 0c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125m1.5-3.75C5.496 8.25 6 7.746 6 7.125v-1.5M4.875 8.25C5.496 8.25 6 8.754 6 9.375v1.5m0-5.25v5.25m0-5.25C6 5.004 6.504 4.5 7.125 4.5h9.75c.621 0 1.125.504 1.125 1.125m1.125 2.625h1.5m-1.5 0A1.125 1.125 0 0 1 18 7.125v-1.5m1.125 2.625c-.621 0-1.125.504-1.125 1.125v1.5m2.625-2.625c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125M18 5.625v5.25M7.125 12h9.75m-9.75 0A1.125 1.125 0 0 1 6 10.875M7.125 12C6.504 12 6 12.504 6 13.125m0-2.25C6 11.496 5.496 12 4.875 12M18 10.875c0 .621-.504 1.125-1.125 1.125M18 10.875c0 .621.504 1.125 1.125 1.125m-2.25 0c.621 0 1.125.504 1.125 1.125m-12 5.25v-5.25m0 5.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125m-12 0v-1.5c0-.621-.504-1.125-1.125-1.125M18 18.375v-5.25m0 5.25v-1.5c0-.621.504-1.125 1.125-1.125M18 13.125v1.5c0 .621.504 1.125 1.125 1.125M18 13.125c0-.621.504-1.125 1.125-1.125M6 13.125v1.5c0 .621-.504 1.125-1.125 1.125M6 13.125C6 12.504 5.496 12 4.875 12m-1.5 0h1.5m-1.5 0c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125M19.125 12h1.5m0 0c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125m-17.25 0h1.5m14.25 0h1.5"}))}const De=s.forwardRef(Pe);function Se({title:r,titleId:a,...n},t){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},n),r?s.createElement("title",{id:a},r):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 10.5v6m3-3H9m4.06-7.19-2.12-2.12a1.5 1.5 0 0 0-1.061-.44H4.5A2.25 2.25 0 0 0 2.25 6v12a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9a2.25 2.25 0 0 0-2.25-2.25h-5.379a1.5 1.5 0 0 1-1.06-.44Z"}))}const Q=s.forwardRef(Se);function $e({title:r,titleId:a,...n},t){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},n),r?s.createElement("title",{id:a},r):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m9 9 10.5-3m0 6.553v3.75a2.25 2.25 0 0 1-1.632 2.163l-1.32.377a1.803 1.803 0 1 1-.99-3.467l2.31-.66a2.25 2.25 0 0 0 1.632-2.163Zm0 0V2.25L9 5.25v10.303m0 0v3.75a2.25 2.25 0 0 1-1.632 2.163l-1.32.377a1.803 1.803 0 0 1-.99-3.467l2.31-.66A2.25 2.25 0 0 0 9 15.553Z"}))}const Oe=s.forwardRef($e);function _e({title:r,titleId:a,...n},t){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},n),r?s.createElement("title",{id:a},r):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 7.5h1.5m-1.5 3h1.5m-7.5 3h7.5m-7.5 3h7.5m3-9h3.375c.621 0 1.125.504 1.125 1.125V18a2.25 2.25 0 0 1-2.25 2.25M16.5 7.5V18a2.25 2.25 0 0 0 2.25 2.25M16.5 7.5V4.875c0-.621-.504-1.125-1.125-1.125H4.125C3.504 3.75 3 4.254 3 4.875V18a2.25 2.25 0 0 0 2.25 2.25h13.5M6 7.5h3v3H6v-3Z"}))}const Ae=s.forwardRef(_e);function We({title:r,titleId:a,...n},t){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},n),r?s.createElement("title",{id:a},r):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z"}))}const Be=s.forwardRef(We);var E={exports:{}},L,H;function Ze(){if(H)return L;H=1;var r="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return L=r,L}var M,q;function Ve(){if(q)return M;q=1;var r=Ze();function a(){}function n(){}return n.resetWarningCache=a,M=function(){function t(p,l,b,m,i,g){if(g!==r){var c=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw c.name="Invariant Violation",c}}t.isRequired=t;function o(){return t}var d={array:t,bigint:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:o,element:t,elementType:t,instanceOf:o,node:t,objectOf:o,oneOf:o,oneOfType:o,shape:o,exact:o,checkPropTypes:n,resetWarningCache:a};return d.PropTypes=d,d},M}var U;function ze(){return U||(U=1,E.exports=Ve()()),E.exports}var He=ze();const h=me(He);function Y({file:r}){if(!r)return null;const a=t=>t.slice((t.lastIndexOf(".")-1>>>0)+2).toLowerCase();if(r.is_folder)return e.jsx(ge,{className:"h-6 w-6 text-yellow-500"});switch(a(r.name)){case"js":case"jsx":case"ts":case"tsx":case"html":case"css":case"json":return e.jsx(he,{className:"h-6 w-6 text-blue-400"});case"jpg":case"jpeg":case"png":case"gif":case"svg":case"webp":return e.jsx(Be,{className:"h-6 w-6 text-green-400"});case"pdf":case"doc":case"docx":return e.jsx(z,{className:"h-6 w-6 text-red-400"});case"txt":case"md":return e.jsx(z,{className:"h-6 w-6 text-gray-400"});case"mp3":case"wav":case"ogg":return e.jsx(Oe,{className:"h-6 w-6 text-purple-400"});case"mp4":case"avi":case"mov":case"webm":return e.jsx(De,{className:"h-6 w-6 text-pink-400"});case"zip":case"rar":case"tar":case"gz":return e.jsx(je,{className:"h-6 w-6 text-yellow-400"});case"csv":case"xlsx":case"xls":return e.jsx(Ae,{className:"h-6 w-6 text-green-600"});case"sh":case"bat":case"ps1":return e.jsx(Re,{className:"h-6 w-6 text-gray-400"});case"yaml":case"yml":case"conf":case"ini":case"env":return e.jsx(Fe,{className:"h-6 w-6 text-gray-400"});default:return e.jsx(Le,{className:"h-6 w-6 text-gray-400"})}}Y.propTypes={file:h.shape({name:h.string.isRequired,is_folder:h.bool})};function j({file:r,onClick:a,onMenuClick:n,selected:t}){if(!r)return console.warn("FileListItem: No file prop provided"),null;const o=l=>{l.stopPropagation(),n(l,r)},d=()=>!r.is_folder&&typeof r.size=="number"?`Размер: ${(r.size/1024).toFixed(2)} КБ`:null,p=!r.is_folder&&r.name.match(/\.(jpg|jpeg|png|gif|webp|bmp)$/i);return e.jsx("li",{className:"relative",children:e.jsxs("div",{className:`flex items-center w-full px-4 py-2 text-left cursor-pointer ${t?"bg-blue-100 dark:bg-blue-900 bg-opacity-70 dark:bg-opacity-40":"hover:bg-gray-100 dark:hover:bg-gray-700"}`,onClick:()=>a==null?void 0:a(r),children:[e.jsx("div",{className:"mr-4",children:p&&r.thumbnail?e.jsx("img",{src:r.thumbnail,alt:r.name,className:"h-6 w-6 object-cover rounded"}):e.jsx(Y,{file:r})}),e.jsxs("div",{className:"flex-grow min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-200 truncate",children:r.name}),d()&&e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:d()})]}),e.jsx("button",{className:"ml-2 p-1 rounded-full hover:bg-gray-200 dark:hover:bg-gray-600 focus:outline-none",onClick:o,children:e.jsx(Te,{className:"h-5 w-5 text-gray-500 dark:text-gray-400","aria-hidden":"true"})})]})})}j.propTypes={file:h.shape({name:h.string.isRequired,is_folder:h.bool,size:h.number,thumbnail:h.string}),onClick:h.func,onMenuClick:h.func,selected:h.bool};j.defaultProps={onClick:()=>{},onMenuClick:()=>{},selected:!1};function qe({files:r,folders:a,onItemClick:n,onMenuClick:t,selectedItem:o,onDrop:d,searchQuery:p}){const l=i=>{i.preventDefault()},b=a.filter(i=>i.name.toLowerCase().includes(p.toLowerCase())),m=r.filter(i=>i.name.toLowerCase().includes(p.toLowerCase()));return e.jsx("div",{className:"h-full overflow-auto bg-gray-50 dark:bg-gray-800 rounded-md shadow",onDrop:d,onDragOver:l,children:e.jsxs("ul",{children:[b.map(i=>e.jsx(j,{file:{...i,is_folder:!0},onClick:n,onMenuClick:t,selected:(o==null?void 0:o.id)===i.id},i.id)),m.map(i=>e.jsx(j,{file:{...i,is_folder:!1},onClick:n,onMenuClick:t,selected:(o==null?void 0:o.id)===i.id},i.id))]})})}function P({anchorEl:r,onClose:a,selectedItem:n,onDownload:t,onRename:o,onDelete:d}){const p=s.useRef(null),[l,b]=s.useState({top:0,left:0});return s.useEffect(()=>{if(r&&p.current){const m=i=>{p.current&&!p.current.contains(i.target)&&i.target!==r&&a()};return document.addEventListener("mousedown",m),()=>{document.removeEventListener("mousedown",m)}}},[r,a]),s.useEffect(()=>{if(r&&p.current){const m=r.getBoundingClientRect(),i=192,f=window.innerWidth-m.right<i?m.left-i:m.right;b({top:m.bottom,left:Math.max(0,f)})}},[r]),!n||!r?null:e.jsxs("div",{ref:p,className:"fixed z-50 bg-white dark:bg-gray-800 rounded-md shadow-lg py-1 w-48 ring-1 ring-black ring-opacity-5 focus:outline-none",style:{top:`${l.top}px`,left:`${l.left}px`},children:[!n.is_folder&&e.jsxs("button",{className:"flex items-center w-full px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>{t==null||t(),a()},children:[e.jsx(fe,{className:"h-5 w-5 mr-3 text-gray-500 dark:text-gray-400"}),e.jsx("span",{children:"Скачать"})]}),e.jsxs("button",{className:"flex items-center w-full px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>{o==null||o(),a()},children:[e.jsx(I,{className:"h-5 w-5 mr-3 text-gray-500 dark:text-gray-400"}),e.jsx("span",{children:"Переименовать"})]}),e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 my-1"}),e.jsxs("button",{className:"flex items-center w-full px-4 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>{d==null||d(),a()},children:[e.jsx(xe,{className:"h-5 w-5 mr-3 text-red-600 dark:text-red-400"}),e.jsx("span",{children:"Удалить"})]})]})}P.propTypes={anchorEl:h.object,onClose:h.func,selectedItem:h.shape({id:h.number,name:h.string,is_folder:h.bool}),onDownload:h.func,onRename:h.func,onDelete:h.func};P.defaultProps={onClose:()=>{},onDownload:()=>{},onRename:()=>{},onDelete:()=>{}};const Ue=({open:r,onClose:a,onCreate:n,value:t,onChange:o})=>{if(!r)return null;const d=l=>{l.target===l.currentTarget&&a()},p=l=>{l.stopPropagation()};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",onClick:d,children:[e.jsx("div",{className:"absolute inset-0 bg-gray-500/75 dark:bg-gray-900/75"}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg overflow-hidden shadow-xl w-full max-w-md mx-4 z-50 relative",onClick:p,children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Q,{className:"h-5 w-5 text-blue-500 mr-2"}),e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900 dark:text-gray-100",children:"Создание новой папки"})]}),e.jsx("div",{className:"mt-4",children:e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",placeholder:"Имя папки",value:t,onChange:l=>o(l.target.value),autoFocus:!0})})]}),e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-700 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse",children:[e.jsx("button",{type:"button",className:"w-full sm:w-auto sm:ml-3 inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:text-sm",onClick:n,children:"Создать"}),e.jsxs("button",{type:"button",className:"mt-3 sm:mt-0 w-full sm:w-auto inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-2 bg-white dark:bg-gray-800 text-base font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:text-sm",onClick:a,children:[e.jsx(T,{className:"h-5 w-5 mr-1"}),"Отмена"]})]})]})]})},Ie=({open:r,onClose:a,onRename:n,value:t,onChange:o})=>{if(!r)return null;const d=l=>{l.target===l.currentTarget&&a()},p=l=>{l.stopPropagation()};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",onClick:d,children:[e.jsx("div",{className:"absolute inset-0 bg-gray-500/75 dark:bg-gray-900/75"}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg overflow-hidden shadow-xl w-full max-w-md mx-4 z-50 relative",onClick:p,children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(I,{className:"h-5 w-5 text-blue-500 mr-2"}),e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900 dark:text-gray-100",children:"Переименование"})]}),e.jsx("div",{className:"mt-4",children:e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",placeholder:"Новое имя",value:t,onChange:l=>o(l.target.value),autoFocus:!0})})]}),e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-700 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse",children:[e.jsx("button",{type:"button",className:"w-full sm:w-auto sm:ml-3 inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:text-sm",onClick:n,children:"Переименовать"}),e.jsxs("button",{type:"button",className:"mt-3 sm:mt-0 w-full sm:w-auto inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-2 bg-white dark:bg-gray-800 text-base font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:text-sm",onClick:a,children:[e.jsx(T,{className:"h-5 w-5 mr-1"}),"Отмена"]})]})]})]})},Qe=({open:r,onClose:a,onDelete:n,item:t,dontAskAgain:o,onDontAskAgainChange:d})=>{if(!r)return null;const p=b=>{b.target===b.currentTarget&&a()},l=b=>{b.stopPropagation()};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",onClick:p,children:[e.jsx("div",{className:"absolute inset-0 bg-gray-500/75 dark:bg-gray-900/75"}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg overflow-hidden shadow-xl w-full max-w-md mx-4 z-50 relative",onClick:l,children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(be,{className:"h-5 w-5 text-red-500 mr-2"}),e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900 dark:text-gray-100",children:"Подтверждение удаления"})]}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:["Вы уверены, что хотите удалить ",t!=null&&t.is_folder?"папку":"файл",' "',t==null?void 0:t.name,'"?']}),(t==null?void 0:t.is_folder)&&e.jsx("p",{className:"mt-2 text-sm text-red-600 dark:text-red-400",children:"Это также удалит все содержимое папки."}),e.jsx("div",{className:"mt-4",children:e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"checkbox",className:"rounded border-gray-300 dark:border-gray-600 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50 bg-white dark:bg-gray-700",checked:o,onChange:b=>d(b.target.checked)}),e.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Больше не спрашивать"})]})})]})]}),e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-700 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse",children:[e.jsx("button",{type:"button",className:"w-full sm:w-auto sm:ml-3 inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:text-sm",onClick:n,children:"Удалить"}),e.jsxs("button",{type:"button",className:"mt-3 sm:mt-0 w-full sm:w-auto inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-2 bg-white dark:bg-gray-800 text-base font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:text-sm",onClick:a,children:[e.jsx(T,{className:"h-5 w-5 mr-1"}),"Отмена"]})]})]})]})},Ye=(r,a)=>{const[n,t]=s.useState({}),[o,d]=s.useState(null);return{loading:n,error:o,createFolder:async g=>{var c,f;t({type:"createFolder",status:!0}),d(null);try{await w.createFolder(g,r),a()}catch(x){throw console.error("Error creating folder:",x),d(((f=(c=x.response)==null?void 0:c.data)==null?void 0:f.detail)||"Ошибка при создании папки"),x}finally{t({type:"createFolder",status:!1})}},rename:async(g,c)=>{if(!(!g||!c)){t({type:"rename",status:!0});try{g.is_folder?await w.renameFolder(g.id,c):await w.renameFile(g.id,c),a()}catch(f){throw console.error("Error renaming item:",f),f}finally{t({type:"rename",status:!1})}}},deleteItem:async g=>{if(g){t({type:"delete",status:!0});try{g.is_folder?await w.deleteFolder(g.id):await w.deleteFile(g.id),a()}catch(c){throw console.error("Error deleting item:",c),c}finally{t({type:"delete",status:!1})}}},download:async g=>{if(!(!g||g.is_folder)){t({type:"download",status:!0});try{const c=await w.downloadFile(g.id),f=window.URL.createObjectURL(c),x=document.createElement("a");x.href=f,x.download=g.name,document.body.appendChild(x),x.click(),x.remove(),window.URL.revokeObjectURL(f)}catch(c){throw console.error("Error downloading file:",c),c}finally{t({type:"download",status:!1})}}},upload:async g=>{t({type:"upload",status:!0});try{for(const c of g)await w.uploadFile(c,r);a()}catch(c){throw console.error("Error uploading files:",c),c}finally{t({type:"upload",status:!1})}}}},Ge=()=>{const[r,a]=s.useState(null),[n,t]=s.useState([]),[o,d]=s.useState([]),[p,l]=s.useState([]),[b,m]=s.useState(!0),i=s.useCallback(async()=>{m(!0);try{const[f,x]=await Promise.all([w.getFolders(r),w.getFiles(r)]);d(f),l(x)}catch(f){console.error("Error fetching data:",f)}finally{m(!1)}},[r]);return s.useEffect(()=>{i()},[i]),{currentFolder:r,folderPath:n,folders:o,files:p,loading:b,navigateToFolder:f=>{a(f.id),t([...n,f])},navigateByBreadcrumb:f=>{if(f===-1)a(null),t([]);else{const x=n.slice(0,f+1);a(x[x.length-1].id),t(x)}},refresh:i}};function Je(){const{currentFolder:r,folderPath:a,folders:n,files:t,navigateToFolder:o,navigateByBreadcrumb:d,refresh:p}=Ge(),[l,b]=s.useState(""),[m,i]=s.useState(null),[g,c]=s.useState(null),f=s.useRef(null),[x,N]=s.useState(!1),[k,D]=s.useState(""),[G,F]=s.useState(!1),[S,C]=s.useState(""),[J,R]=s.useState(!1),[$,K]=s.useState(!1),{createFolder:X,rename:ee,deleteItem:re,download:te,upload:ae}=Ye(r,p),se=u=>{u.is_folder&&o(u)},ne=async()=>{if(!k.trim()){alert("Имя папки не может быть пустым");return}await X(k.trim()).then(()=>{N(!1),D("")}).catch(u=>{var v,A,W,B,Z,V;((v=u.response)==null?void 0:v.status)===400&&(((W=(A=u.response)==null?void 0:A.data)==null?void 0:W.detail)==="Folder already exists"||(V=(Z=(B=u.response)==null?void 0:B.data)==null?void 0:Z.detail)!=null&&V.includes("already exists"))?alert(`Папка с именем "${k}" уже существует`):console.error(u)})},oe=async()=>{await ee(m,S),F(!1),C("")},le=()=>{if(!$){R(!0),c(null);return}O()},O=async()=>{await re(m),c(null),R(!1)},_=async u=>{await ae(Array.from(u))},ce=()=>{var u;(u=f.current)==null||u.click()},ie=u=>{_(u.target.files),u.target.value=null},de=u=>{u.preventDefault(),_(u.dataTransfer.files)};return e.jsxs("div",{className:"h-full flex flex-col bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100",children:[e.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900",children:e.jsxs("div",{className:"relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(we,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",className:"block w-full pl-10 pr-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md leading-5 bg-white dark:bg-gray-800 placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:placeholder-gray-400 dark:focus:placeholder-gray-300 focus:ring-1 focus:ring-blue-500 focus:border-blue-500 sm:text-sm text-gray-900 dark:text-gray-100",placeholder:"Поиск файлов и папок...",value:l,onChange:u=>b(u.target.value)})]})}),e.jsx("div",{className:"px-4 py-2 bg-gray-100 dark:bg-gray-800",children:e.jsx("nav",{className:"flex","aria-label":"Breadcrumb",children:e.jsxs("ol",{className:"inline-flex items-center space-x-1 md:space-x-3",children:[e.jsx("li",{className:"inline-flex items-center",children:e.jsx("button",{className:"text-sm font-medium text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300",onClick:()=>d(-1),children:"Корневая папка"})}),a.map((u,v)=>e.jsx("li",{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ye,{className:"w-5 h-5 text-gray-500"}),e.jsx("button",{className:"ml-1 text-sm font-medium text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 md:ml-2",onClick:()=>d(v),children:u.name})]})},u.id))]})})}),e.jsx("div",{className:"flex-grow overflow-hidden bg-white dark:bg-gray-900",children:e.jsx(qe,{files:t,folders:n,onItemClick:se,onMenuClick:(u,v)=>{i(v),c(u.currentTarget)},selectedItem:m,onDrop:de,searchQuery:l})}),e.jsxs("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 flex space-x-4 bg-white dark:bg-gray-900",children:[e.jsxs("button",{className:"flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",onClick:()=>N(!0),children:[e.jsx(Q,{className:"h-5 w-5 mr-2"}),"Новая папка"]}),e.jsxs("button",{className:"flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",onClick:ce,children:[e.jsx(pe,{className:"h-5 w-5 mr-2"}),"Загрузить файл"]}),e.jsx("input",{type:"file",className:"hidden",ref:f,onChange:ie,multiple:!0})]}),e.jsx(P,{anchorEl:g,onClose:()=>c(null),selectedItem:m,onDownload:()=>te(m),onRename:()=>{F(!0),c(null),C((m==null?void 0:m.name)||"")},onDelete:le}),e.jsx(Ue,{open:x,onClose:()=>N(!1),onCreate:ne,value:k,onChange:D}),e.jsx(Ie,{open:G,onClose:()=>F(!1),onRename:oe,value:S,onChange:C}),e.jsx(Qe,{open:J,onClose:()=>R(!1),onDelete:O,item:m,dontAskAgain:$,onDontAskAgainChange:K})]})}function mr({}){return[{title:"Файловый менеджер"},{name:"description",content:"Создавайте, редактируйте и организуйте проекты в удобном файловом менеджере"}]}const gr=ue(function(){return e.jsx(ve,{requiredRoles:["admin","teacher"],children:e.jsx(Je,{})})});export{gr as default,mr as meta};
