import{w as L}from"./with-props-CdbLO-WJ.js";import{a,o as e,s as p,w as N}from"./chunk-AYJ5UCUI-B1579ApN.js";import{C as R}from"./CourseImagePlaceholder-tHKq6nVt.js";import{F as S}from"./AcademicCapIcon-DuzTDbhn.js";import{F as D}from"./UserIcon-CGgSBpiG.js";import{F as A,a as I}from"./EyeIcon-D81QwLUt.js";import{F as _}from"./ChevronDownIcon-BxZwbkus.js";import{c as y}from"./coursesService-DenKHoiM.js";import{F as v}from"./ArrowPathIcon-CYqLai-V.js";import{F as M}from"./ArrowLeftIcon-DK87n-Vp.js";import"./config-GGwLlXRi.js";function B({title:t,titleId:r,...n},o){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":r},n),t?a.createElement("title",{id:r},t):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.666 3.888A2.25 2.25 0 0 0 13.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 0 1-.75.75H9a.75.75 0 0 1-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 0 1 1.927-.184"}))}const W=a.forwardRef(B);function H({title:t,titleId:r,...n},o){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":r},n),t?a.createElement("title",{id:r},t):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))}const P=a.forwardRef(H);function T({title:t,titleId:r,...n},o){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":r},n),t?a.createElement("title",{id:r},t):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.568 3H5.25A2.25 2.25 0 0 0 3 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 0 0 5.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 0 0 9.568 3Z"}),a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 6h.008v.008H6V6Z"}))}const O=a.forwardRef(T);function V({course:t}){return e.jsx("div",{className:"mb-6",children:e.jsxs("nav",{className:"flex text-sm",children:[e.jsx(p,{to:"/",className:"text-gray-500 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400",children:"Главная"}),e.jsx("span",{className:"mx-2 text-gray-500 dark:text-gray-400",children:"/"}),e.jsx(p,{to:"/courses",className:"text-gray-500 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400",children:"Курсы"}),e.jsx("span",{className:"mx-2 text-gray-500 dark:text-gray-400",children:"/"}),e.jsx("span",{className:"text-gray-800 dark:text-gray-200 font-medium",children:t.title})]})})}function Z({course:t}){const r=t.students_count||t.total_enrollments||t.enrollments_count||(t.students!==void 0?t.students:0),n=t.author||"Автор не указан";return e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-800 dark:text-gray-100 mb-3",children:t.title}),e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx(S,{className:"h-5 w-5 text-gray-600 dark:text-gray-400 mr-2"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:n})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-x-4 gap-y-2 text-sm mb-4",children:[e.jsxs("div",{className:"flex items-center text-gray-500 dark:text-gray-400",children:[e.jsx(D,{className:"h-4 w-4 mr-1"}),e.jsxs("span",{children:[r," учеников"]})]}),e.jsxs("div",{className:"flex items-center text-gray-500 dark:text-gray-400",children:[e.jsx(A,{className:"h-4 w-4 mr-1"}),e.jsxs("span",{children:["Уровень: ",t.difficulty]})]})]})]})}function U({course:t}){const r=t.longDescription||t.longdescription;return r?e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-gray-100 mb-3",children:"Об этом курсе"}),e.jsx("div",{className:"text-gray-700 dark:text-gray-300",dangerouslySetInnerHTML:{__html:r}})]}):null}function q({lessons:t}){const[r,n]=a.useState(null);if(!t||t.length===0)return e.jsx("div",{className:"text-center py-6 bg-gray-50 dark:bg-gray-700 rounded-lg",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Для этого курса пока нет доступных уроков"})});const o=i=>i.scene_data&&i.scene_data!=="null";return e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-gray-100 mb-2",children:"Программа курса"}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden",children:t.map((i,l)=>e.jsxs("div",{className:`border-b border-gray-200 dark:border-gray-700 ${l===t.length-1?"border-b-0":""}`,children:[e.jsxs("div",{onClick:()=>n(r===l?null:l),className:`flex items-center justify-between p-4 cursor-pointer transition-colors ${r===l?"bg-blue-50 dark:bg-blue-900/30":"hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center ${r===l?"bg-blue-600 text-white":"bg-gray-100 dark:bg-gray-600 text-gray-700 dark:text-gray-300"}`,children:l+1}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-gray-100",children:i.title}),o(i)&&e.jsxs("span",{className:"inline-flex items-center mt-1 px-2 py-0.5 text-xs bg-blue-100 dark:bg-blue-800 text-blue-700 dark:text-blue-300 rounded-full",children:[e.jsx(I,{className:"w-3 h-3 mr-1"}),"Интерактивный"]})]})]}),e.jsx(_,{className:`h-5 w-5 text-gray-500 dark:text-gray-400 transform transition-transform ${r===l?"rotate-180":""}`})]}),r===l&&e.jsx("div",{className:"p-4 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-300",children:e.jsx("div",{className:"prose dark:prose-invert max-w-none",children:e.jsx(e.Fragment,{children:e.jsx("div",{className:"max-h-32 overflow-hidden relative",style:{maskImage:"linear-gradient(to bottom, black 60%, transparent 100%)",WebkitMaskImage:"linear-gradient(to bottom, black 60%, transparent 100%)"},children:e.jsx("div",{dangerouslySetInnerHTML:{__html:i.content}})})})})})]},i.id||l))})]})}function z({course:t}){const[r,n]=a.useState(!1),[o,i]=a.useState(!1),[l,d]=a.useState(null),[b,x]=a.useState(!0);a.useEffect(()=>{(async()=>{try{x(!0);const c=await y.getUserEnrollments(),g=c==null?void 0:c.some(h=>{var f;return h.course_id===t.id||((f=h.course)==null?void 0:f.id)===t.id});i(g)}catch(c){console.error("Failed to check enrollment status:",c)}finally{x(!1)}})()},[t.id]);const w=t.categories&&Array.isArray(t.categories)?t.categories.map(s=>s.name||s).join(", "):t.category||"Без категории",m=t.lessons_count||(t.lessons&&Array.isArray(t.lessons)?t.lessons.length:0),u=()=>{if(!m)return"Длительность не указана";let s=30;if(t.difficulty){const j=t.difficulty.toLowerCase();j.includes("начинающий")?s=20:j.includes("средний")?s=30:j.includes("продвинутый")&&(s=45)}const c=m*s;if(c<60)return`${c} минут`;const g=Math.floor(c/60),h=c%60;if(g<24)return`${g} ${C(g)}`+(h>0?` ${h} мин.`:"");const f=Math.round(c/(60*24));return`около ${f} ${E(f)}`},C=s=>s%10===1&&s%100!==11?"час":[2,3,4].includes(s%10)&&![12,13,14].includes(s%100)?"часа":"часов",E=s=>s%10===1&&s%100!==11?"день":[2,3,4].includes(s%10)&&![12,13,14].includes(s%100)?"дня":"дней",F=t.duration||u(),$=async()=>{try{n(!0),await y.enrollInCourse(t.id),i(!0),d(null)}catch(s){console.error("Failed to enroll:",s),s.message&&s.message.includes("уже записаны")?(i(!0),d(null)):s.message&&s.message.includes("авторизация")?d("Требуется авторизация для записи на курс"):d("Не удалось записаться на курс")}finally{n(!1)}},k=()=>r?e.jsxs("span",{className:"flex items-center justify-center",children:[e.jsx(v,{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white"}),"Запись..."]}):o?"Вы записаны на курс":"Начать прохождение";return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 sticky top-4",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600 dark:text-blue-400 mb-2",children:"Бесплатно"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Начните обучение уже сегодня"})]}),b?e.jsx("button",{className:"w-full py-3 bg-gray-400 text-white font-semibold rounded-lg cursor-not-allowed mb-4",disabled:!0,children:e.jsxs("span",{className:"flex items-center justify-center",children:[e.jsx(v,{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white"}),"Загрузка..."]})}):o?e.jsx("div",{className:"w-full py-3 bg-green-600 text-white font-semibold rounded-lg mb-4 text-center",children:k()}):e.jsx("button",{className:`w-full py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition-colors mb-4 ${r?"opacity-70 cursor-not-allowed":""}`,onClick:$,disabled:r,children:k()}),l&&e.jsx("div",{className:"text-red-500 dark:text-red-400 text-sm mb-4 text-center",children:l}),e.jsxs("div",{className:"space-y-4 mb-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(P,{className:"h-5 w-5 text-blue-600 dark:text-blue-400 mr-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:F})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(W,{className:"h-5 w-5 text-blue-600 dark:text-blue-400 mr-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"}),e.jsxs("span",{className:"text-gray-700 dark:text-gray-300",children:[m," уроков"]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(O,{className:"h-5 w-5 text-blue-600 dark:text-blue-400 mr-3 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:w})]})]})]})}function G({courseId:t}){const{id:r}=N(),[n,o]=a.useState(null),[i,l]=a.useState(!0),[d,b]=a.useState(null),x=t||r;return a.useEffect(()=>{x&&(async()=>{try{l(!0);const m=await y.getCourseById(x);try{const u=await y.getCourseWithLessons(x);o({...u,lessons:u.lessons||[]})}catch(u){console.warn("Failed to load lessons for the course:",u),o({...m,lessons:[]})}b(null)}catch(m){console.error("Error fetching course data:",m),b("Не удалось загрузить информацию о курсе")}finally{l(!1)}})()},[x]),i?e.jsx("div",{className:"container mx-auto px-4 sm:px-6 py-16 flex justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):d||!n?e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 py-16 text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100 mb-4",children:"Курс не найден"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:d||"К сожалению, запрашиваемый курс не существует или был удален"}),e.jsxs(p,{to:"/courses",className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(M,{className:"h-5 w-5 mr-2"}),"Вернуться к списку курсов"]})]}):e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 py-8",children:[e.jsx(V,{course:n}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-8",children:[e.jsx("div",{className:"order-1 lg:order-2 lg:w-1/3",children:e.jsx(z,{course:n})}),e.jsx("div",{className:"order-2 lg:order-1 lg:w-2/3",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden",children:[e.jsx("div",{className:"h-48 sm:h-64 bg-gray-200 dark:bg-gray-700 relative",children:e.jsx(R,{course:n})}),e.jsxs("div",{className:"p-6",children:[e.jsx(Z,{course:n}),e.jsx("div",{className:"mt-4 mb-6",children:e.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:n.description})}),e.jsx(U,{course:n}),n.lessons&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-gray-100 mb-3",children:"Учебный план"}),e.jsx(q,{lessons:n.lessons})]})]})]})})]})]})}function le({params:t}){return[{title:`Курс ${t.id}`},{name:"description",content:"Подробная информация о курсе"}]}const oe=L(function(){const{id:r}=N();return e.jsx(G,{courseId:r})});export{oe as default,le as meta};
