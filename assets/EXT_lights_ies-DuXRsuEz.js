import{bc as b,V as f,bt as y,C as _,T as p}from"./sceneFragmentDeclaration-CNWtVIbJ.js";import{A as l,G as u}from"./glTFLoader-BlBnIl-i.js";import{u as A,r as L}from"./model-viewer-CRf71ZHW.js";import"./objectModelMapping-DZbRXB0J.js";import"./with-props-CdbLO-WJ.js";import"./chunk-AYJ5UCUI-B1579ApN.js";import"./waterMaterial-DHEJP-Do.js";const n="EXT_lights_ies";class w{constructor(t){this.name=n,this._loader=t,this.enabled=this._loader.isExtensionUsed(n)}dispose(){this._loader=null,delete this._lights}onLoading(){const t=this._loader.gltf.extensions;if(t&&t[this.name]){const r=t[this.name];this._lights=r.lights,l.Assign(this._lights)}}loadNodeAsync(t,r,c){return u.LoadExtensionAsync(t,r,this.name,async(h,a)=>{this._loader._allMaterialsDirtyRequired=!0;let e,i;const g=await this._loader.loadNodeAsync(t,r,s=>{i=l.Get(h,this._lights,a.light);const m=i.name||s.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,e=new b(m,f.Zero(),f.Backward(),0,1,this._loader.babylonScene),e.angle=Math.PI/2,e.innerAngle=0,e._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,i._babylonLight=e,e.falloffType=y.FALLOFF_GLTF,e.diffuse=a.color?_.FromArray(a.color):_.White(),e.intensity=a.multiplier||1,e.range=Number.MAX_VALUE,e.parent=s,this._loader._babylonLights.push(e),u.AddPointerMetadata(e,h),c(s)});let o;if(i.uri)o=await this._loader.loadUriAsync(t,i,i.uri);else{const s=l.Get(`${t}/bufferView`,this._loader.gltf.bufferViews,i.bufferView);o=await this._loader.loadBufferViewAsync(`/bufferViews/${s.index}`,s)}return e.iesProfileTexture=new p(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,o,!0,void 0,void 0,void 0,void 0,".ies"),g})}}A(n);L(n,!0,d=>new w(d));export{w as EXT_lights_ies};
