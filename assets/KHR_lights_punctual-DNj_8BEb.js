import{bc as y,V as s,bs as m,D as L,bt as u,C as c}from"./sceneFragmentDeclaration-CNWtVIbJ.js";import{A as _,G as g}from"./glTFLoader-BlBnIl-i.js";import{u as A,r as f}from"./model-viewer-CRf71ZHW.js";import"./objectModelMapping-DZbRXB0J.js";import"./with-props-CdbLO-WJ.js";import"./chunk-AYJ5UCUI-B1579ApN.js";import"./waterMaterial-DHEJP-Do.js";const a="KHR_lights_punctual";class E{constructor(i){this.name=a,this._loader=i,this.enabled=this._loader.isExtensionUsed(a)}dispose(){this._loader=null,delete this._lights}onLoading(){const i=this._loader.gltf.extensions;if(i&&i[this.name]){const o=i[this.name];this._lights=o.lights,_.Assign(this._lights)}}loadNodeAsync(i,o,b){return g.LoadExtensionAsync(i,o,this.name,(r,p)=>(this._loader._allMaterialsDirtyRequired=!0,this._loader.loadNodeAsync(i,o,l=>{let e;const t=_.Get(r,this._lights,p.light),h=t.name||l.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,t.type){case"directional":{const n=new L(h,s.Backward(),this._loader.babylonScene);n.position.setAll(0),e=n;break}case"point":{e=new m(h,s.Zero(),this._loader.babylonScene);break}case"spot":{const n=new y(h,s.Zero(),s.Backward(),0,1,this._loader.babylonScene);n.angle=(t.spot&&t.spot.outerConeAngle||Math.PI/4)*2,n.innerAngle=(t.spot&&t.spot.innerConeAngle||0)*2,e=n;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${r}: Invalid light type (${t.type})`)}e._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,t._babylonLight=e,e.falloffType=u.FALLOFF_GLTF,e.diffuse=t.color?c.FromArray(t.color):c.White(),e.intensity=t.intensity==null?1:t.intensity,e.range=t.range==null?Number.MAX_VALUE:t.range,e.parent=l,this._loader._babylonLights.push(e),g.AddPointerMetadata(e,r),b(l)})))}}A(a);f(a,!0,d=>new E(d));export{E as KHR_lights};
