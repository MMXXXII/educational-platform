const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/EXT_lights_image_based-CgiLWVKD.js","assets/sceneFragmentDeclaration-CNWtVIbJ.js","assets/glTFLoader-BlBnIl-i.js","assets/objectModelMapping-DZbRXB0J.js","assets/with-props-CdbLO-WJ.js","assets/chunk-AYJ5UCUI-B1579ApN.js","assets/waterMaterial-DHEJP-Do.js","assets/EXT_mesh_gpu_instancing-BEwA5EgX.js","assets/EXT_meshopt_compression-CoRokCFD.js","assets/EXT_texture_avif-BQd20vFS.js","assets/EXT_texture_webp-B0dGWRU9.js","assets/ExtrasAsMetadata-DQcjLzUD.js","assets/KHR_animation_pointer-DiiAZQmY.js","assets/glTFLoaderAnimation-DdE2jIf_.js","assets/KHR_draco_mesh_compression-CGyvJgRX.js","assets/KHR_interactivity-Dxf0IgNM.js","assets/declarationMapper-BB1D8Xqx.js","assets/KHR_lights_punctual-DNj_8BEb.js","assets/EXT_lights_ies-DuXRsuEz.js","assets/KHR_materials_anisotropy-DFrPw_Yr.js","assets/KHR_materials_clearcoat-BsaZdOu8.js","assets/KHR_materials_diffuse_transmission-CrNsgWMf.js","assets/KHR_materials_dispersion-CD6S2Lpz.js","assets/KHR_materials_emissive_strength-DIClSBvc.js","assets/KHR_materials_ior-ClG4vLAt.js","assets/KHR_materials_iridescence-5niQ7555.js","assets/KHR_materials_pbrSpecularGlossiness-C-Iy2yxP.js","assets/KHR_materials_sheen-BUzeI08u.js","assets/KHR_materials_specular-dO5Qjfwb.js","assets/KHR_materials_transmission-BSEW73Ad.js","assets/KHR_materials_unlit-BK12MwcR.js","assets/KHR_materials_variants-D_BSsRLm.js","assets/KHR_materials_volume-kC0uHNH4.js","assets/KHR_mesh_quantization-CL3wGZbT.js","assets/KHR_texture_basisu-BZZuWkil.js","assets/KHR_texture_transform-DQO_d47-.js","assets/KHR_xmp_json_ld-DoGmVQ-r.js","assets/MSFT_audio_emitter-NzbVeqbH.js","assets/MSFT_lod-DbZnAKOx.js","assets/MSFT_minecraftMesh-CJ1hdOc8.js","assets/MSFT_sRGBFactors-sJbxZM2k.js","assets/KHR_node_visibility-CA5PWDvl.js","assets/KHR_node_hoverability-BxP9kq77.js","assets/KHR_node_selectability-DjwXALsO.js","assets/bvhFileLoader-CsecxpBi.js","assets/objFileLoader-C2eAwEwV.js","assets/splatFileLoader-DAfrzl6n.js","assets/stlFileLoader-DuZRujMZ.js"])))=>i.map(i=>d[i]);
import{w as ge}from"./with-props-CdbLO-WJ.js";import{a as d,o as s}from"./chunk-AYJ5UCUI-B1579ApN.js";import{L as pe,_ as o,R as q,E as we,C as O,V as w,S as he,A as ne,H as ye,D as xe,M as Q,b as se,d as be,g as ae,h as ie}from"./sceneFragmentDeclaration-CNWtVIbJ.js";import{G as Ee}from"./waterMaterial-DHEJP-Do.js";const oe={name:"bvh",extensions:{".bvh":{isBinary:!1}}},Z="Z2xURg",ce={name:"gltf",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad(e){return e.indexOf("asset")!==-1&&e.indexOf("version")!==-1||e.startsWith("data:base64,"+Z)||e.startsWith("data:;base64,"+Z)||e.startsWith("data:application/octet-stream;base64,"+Z)||e.startsWith("data:model/gltf-binary;base64,"+Z)}},le={name:"obj",extensions:".obj"},ue={name:"splat",extensions:{".splat":{isBinary:!0},".ply":{isBinary:!0},".spz":{isBinary:!0}}},ve={name:"stl",extensions:{".stl":{isBinary:!0}}},ee=new Map,Fe=ee;function u(e,n,r){Re(e)&&pe.Warn(`Extension with the name '${e}' already exists`),ee.set(e,{isGLTFExtension:n,factory:r})}function Re(e){return ee.delete(e)}function Le(){u("EXT_lights_image_based",!0,async e=>{const{EXT_lights_image_based:n}=await o(async()=>{const{EXT_lights_image_based:r}=await import("./EXT_lights_image_based-CgiLWVKD.js");return{EXT_lights_image_based:r}},__vite__mapDeps([0,1,2,3,4,5,6]));return new n(e)}),u("EXT_mesh_gpu_instancing",!0,async e=>{const{EXT_mesh_gpu_instancing:n}=await o(async()=>{const{EXT_mesh_gpu_instancing:r}=await import("./EXT_mesh_gpu_instancing-BEwA5EgX.js");return{EXT_mesh_gpu_instancing:r}},__vite__mapDeps([7,1,2,3,4,5,6]));return new n(e)}),u("EXT_meshopt_compression",!0,async e=>{const{EXT_meshopt_compression:n}=await o(async()=>{const{EXT_meshopt_compression:r}=await import("./EXT_meshopt_compression-CoRokCFD.js");return{EXT_meshopt_compression:r}},__vite__mapDeps([8,2,1,3,4,5,6]));return new n(e)}),u("EXT_texture_avif",!0,async e=>{const{EXT_texture_avif:n}=await o(async()=>{const{EXT_texture_avif:r}=await import("./EXT_texture_avif-BQd20vFS.js");return{EXT_texture_avif:r}},__vite__mapDeps([9,2,1,3,4,5,6]));return new n(e)}),u("EXT_texture_webp",!0,async e=>{const{EXT_texture_webp:n}=await o(async()=>{const{EXT_texture_webp:r}=await import("./EXT_texture_webp-B0dGWRU9.js");return{EXT_texture_webp:r}},__vite__mapDeps([10,2,1,3,4,5,6]));return new n(e)}),u("ExtrasAsMetadata",!1,async e=>{const{ExtrasAsMetadata:n}=await o(async()=>{const{ExtrasAsMetadata:r}=await import("./ExtrasAsMetadata-DQcjLzUD.js");return{ExtrasAsMetadata:r}},__vite__mapDeps([11,4,5,1,6]));return new n(e)}),u("KHR_animation_pointer",!0,async e=>{const{KHR_animation_pointer:n}=await o(async()=>{const{KHR_animation_pointer:r}=await import("./KHR_animation_pointer-DiiAZQmY.js");return{KHR_animation_pointer:r}},__vite__mapDeps([12,1,3,13,4,5,6]));return new n(e)}),u("KHR_draco_mesh_compression",!0,async e=>{const{KHR_draco_mesh_compression:n}=await o(async()=>{const{KHR_draco_mesh_compression:r}=await import("./KHR_draco_mesh_compression-CGyvJgRX.js");return{KHR_draco_mesh_compression:r}},__vite__mapDeps([14,1,2,3,4,5,6]));return new n(e)}),u("KHR_interactivity",!0,async e=>{const{KHR_interactivity:n}=await o(async()=>{const{KHR_interactivity:r}=await import("./KHR_interactivity-Dxf0IgNM.js");return{KHR_interactivity:r}},__vite__mapDeps([15,1,3,16,4,5,6]));return new n(e)}),u("KHR_lights_punctual",!0,async e=>{const{KHR_lights:n}=await o(async()=>{const{KHR_lights:r}=await import("./KHR_lights_punctual-DNj_8BEb.js");return{KHR_lights:r}},__vite__mapDeps([17,1,2,3,4,5,6]));return new n(e)}),u("EXT_lights_ies",!0,async e=>{const{EXT_lights_ies:n}=await o(async()=>{const{EXT_lights_ies:r}=await import("./EXT_lights_ies-DuXRsuEz.js");return{EXT_lights_ies:r}},__vite__mapDeps([18,1,2,3,4,5,6]));return new n(e)}),u("KHR_materials_anisotropy",!0,async e=>{const{KHR_materials_anisotropy:n}=await o(async()=>{const{KHR_materials_anisotropy:r}=await import("./KHR_materials_anisotropy-DFrPw_Yr.js");return{KHR_materials_anisotropy:r}},__vite__mapDeps([19,1,2,3,4,5,6]));return new n(e)}),u("KHR_materials_clearcoat",!0,async e=>{const{KHR_materials_clearcoat:n}=await o(async()=>{const{KHR_materials_clearcoat:r}=await import("./KHR_materials_clearcoat-BsaZdOu8.js");return{KHR_materials_clearcoat:r}},__vite__mapDeps([20,1,2,3,4,5,6]));return new n(e)}),u("KHR_materials_diffuse_transmission",!0,async e=>{const{KHR_materials_diffuse_transmission:n}=await o(async()=>{const{KHR_materials_diffuse_transmission:r}=await import("./KHR_materials_diffuse_transmission-CrNsgWMf.js");return{KHR_materials_diffuse_transmission:r}},__vite__mapDeps([21,1,2,3,4,5,6]));return new n(e)}),u("KHR_materials_dispersion",!0,async e=>{const{KHR_materials_dispersion:n}=await o(async()=>{const{KHR_materials_dispersion:r}=await import("./KHR_materials_dispersion-CD6S2Lpz.js");return{KHR_materials_dispersion:r}},__vite__mapDeps([22,1,2,3,4,5,6]));return new n(e)}),u("KHR_materials_emissive_strength",!0,async e=>{const{KHR_materials_emissive_strength:n}=await o(async()=>{const{KHR_materials_emissive_strength:r}=await import("./KHR_materials_emissive_strength-DIClSBvc.js");return{KHR_materials_emissive_strength:r}},__vite__mapDeps([23,1,2,3,4,5,6]));return new n(e)}),u("KHR_materials_ior",!0,async e=>{const{KHR_materials_ior:n}=await o(async()=>{const{KHR_materials_ior:r}=await import("./KHR_materials_ior-ClG4vLAt.js");return{KHR_materials_ior:r}},__vite__mapDeps([24,1,2,3,4,5,6]));return new n(e)}),u("KHR_materials_iridescence",!0,async e=>{const{KHR_materials_iridescence:n}=await o(async()=>{const{KHR_materials_iridescence:r}=await import("./KHR_materials_iridescence-5niQ7555.js");return{KHR_materials_iridescence:r}},__vite__mapDeps([25,1,2,3,4,5,6]));return new n(e)}),u("KHR_materials_pbrSpecularGlossiness",!0,async e=>{const{KHR_materials_pbrSpecularGlossiness:n}=await o(async()=>{const{KHR_materials_pbrSpecularGlossiness:r}=await import("./KHR_materials_pbrSpecularGlossiness-C-Iy2yxP.js");return{KHR_materials_pbrSpecularGlossiness:r}},__vite__mapDeps([26,1,2,3,4,5,6]));return new n(e)}),u("KHR_materials_sheen",!0,async e=>{const{KHR_materials_sheen:n}=await o(async()=>{const{KHR_materials_sheen:r}=await import("./KHR_materials_sheen-BUzeI08u.js");return{KHR_materials_sheen:r}},__vite__mapDeps([27,1,2,3,4,5,6]));return new n(e)}),u("KHR_materials_specular",!0,async e=>{const{KHR_materials_specular:n}=await o(async()=>{const{KHR_materials_specular:r}=await import("./KHR_materials_specular-dO5Qjfwb.js");return{KHR_materials_specular:r}},__vite__mapDeps([28,1,2,3,4,5,6]));return new n(e)}),u("KHR_materials_transmission",!0,async e=>{const{KHR_materials_transmission:n}=await o(async()=>{const{KHR_materials_transmission:r}=await import("./KHR_materials_transmission-BSEW73Ad.js");return{KHR_materials_transmission:r}},__vite__mapDeps([29,1,2,3,4,5,6]));return new n(e)}),u("KHR_materials_unlit",!0,async e=>{const{KHR_materials_unlit:n}=await o(async()=>{const{KHR_materials_unlit:r}=await import("./KHR_materials_unlit-BK12MwcR.js");return{KHR_materials_unlit:r}},__vite__mapDeps([30,1,2,3,4,5,6]));return new n(e)}),u("KHR_materials_variants",!0,async e=>{const{KHR_materials_variants:n}=await o(async()=>{const{KHR_materials_variants:r}=await import("./KHR_materials_variants-D_BSsRLm.js");return{KHR_materials_variants:r}},__vite__mapDeps([31,2,1,3,4,5,6]));return new n(e)}),u("KHR_materials_volume",!0,async e=>{const{KHR_materials_volume:n}=await o(async()=>{const{KHR_materials_volume:r}=await import("./KHR_materials_volume-kC0uHNH4.js");return{KHR_materials_volume:r}},__vite__mapDeps([32,1,2,3,4,5,6]));return new n(e)}),u("KHR_mesh_quantization",!0,async e=>{const{KHR_mesh_quantization:n}=await o(async()=>{const{KHR_mesh_quantization:r}=await import("./KHR_mesh_quantization-CL3wGZbT.js");return{KHR_mesh_quantization:r}},__vite__mapDeps([33,4,5,1,6]));return new n(e)}),u("KHR_texture_basisu",!0,async e=>{const{KHR_texture_basisu:n}=await o(async()=>{const{KHR_texture_basisu:r}=await import("./KHR_texture_basisu-BZZuWkil.js");return{KHR_texture_basisu:r}},__vite__mapDeps([34,2,1,3,4,5,6]));return new n(e)}),u("KHR_texture_transform",!0,async e=>{const{KHR_texture_transform:n}=await o(async()=>{const{KHR_texture_transform:r}=await import("./KHR_texture_transform-DQO_d47-.js");return{KHR_texture_transform:r}},__vite__mapDeps([35,1,2,3,4,5,6]));return new n(e)}),u("KHR_xmp_json_ld",!0,async e=>{const{KHR_xmp_json_ld:n}=await o(async()=>{const{KHR_xmp_json_ld:r}=await import("./KHR_xmp_json_ld-DoGmVQ-r.js");return{KHR_xmp_json_ld:r}},__vite__mapDeps([36,4,5,1,6]));return new n(e)}),u("MSFT_audio_emitter",!0,async e=>{const{MSFT_audio_emitter:n}=await o(async()=>{const{MSFT_audio_emitter:r}=await import("./MSFT_audio_emitter-NzbVeqbH.js");return{MSFT_audio_emitter:r}},__vite__mapDeps([37,1,2,3,4,5,6]));return new n(e)}),u("MSFT_lod",!0,async e=>{const{MSFT_lod:n}=await o(async()=>{const{MSFT_lod:r}=await import("./MSFT_lod-DbZnAKOx.js");return{MSFT_lod:r}},__vite__mapDeps([38,1,2,3,4,5,6]));return new n(e)}),u("MSFT_minecraftMesh",!0,async e=>{const{MSFT_minecraftMesh:n}=await o(async()=>{const{MSFT_minecraftMesh:r}=await import("./MSFT_minecraftMesh-CJ1hdOc8.js");return{MSFT_minecraftMesh:r}},__vite__mapDeps([39,1,2,3,4,5,6]));return new n(e)}),u("MSFT_sRGBFactors",!0,async e=>{const{MSFT_sRGBFactors:n}=await o(async()=>{const{MSFT_sRGBFactors:r}=await import("./MSFT_sRGBFactors-sJbxZM2k.js");return{MSFT_sRGBFactors:r}},__vite__mapDeps([40,1,2,3,4,5,6]));return new n(e)}),u("KHR_node_visibility",!0,async e=>{const{KHR_node_visibility:n}=await o(async()=>{const{KHR_node_visibility:r}=await import("./KHR_node_visibility-CA5PWDvl.js");return{KHR_node_visibility:r}},__vite__mapDeps([41,3,1,4,5,6]));return new n(e)}),u("KHR_node_hoverability",!0,async e=>{const{KHR_node_hoverability:n}=await o(async()=>{const{KHR_node_hoverability:r}=await import("./KHR_node_hoverability-BxP9kq77.js");return{KHR_node_hoverability:r}},__vite__mapDeps([42,16,1,3,4,5,6]));return new n(e)}),u("KHR_node_selectability",!0,async e=>{const{KHR_node_selectability:n}=await o(async()=>{const{KHR_node_selectability:r}=await import("./KHR_node_selectability-DjwXALsO.js");return{KHR_node_selectability:r}},__vite__mapDeps([43,16,1,3,4,5,6]));return new n(e)})}function Me(){q({...oe,createPlugin:async e=>{const{BVHFileLoader:n}=await o(async()=>{const{BVHFileLoader:r}=await import("./bvhFileLoader-CsecxpBi.js");return{BVHFileLoader:r}},__vite__mapDeps([44,1,4,5,6]));return new n(e[oe.name])}}),q({...ce,createPlugin:async e=>{const{GLTFFileLoader:n}=await o(async()=>{const{GLTFFileLoader:r}=await import("./glTFLoader-BlBnIl-i.js").then(A=>A.g);return{GLTFFileLoader:r}},__vite__mapDeps([2,1,3]));return new n(e[ce.name])}}),Le(),q({...le,createPlugin:async e=>{const{OBJFileLoader:n}=await o(async()=>{const{OBJFileLoader:r}=await import("./objFileLoader-C2eAwEwV.js");return{OBJFileLoader:r}},__vite__mapDeps([45,1,4,5,6]));return new n(e[le.name])}}),q({...ue,createPlugin:async e=>{const{SPLATFileLoader:n}=await o(async()=>{const{SPLATFileLoader:r}=await import("./splatFileLoader-DAfrzl6n.js");return{SPLATFileLoader:r}},__vite__mapDeps([46,1,4,5,6]));return new n(e[ue.name])}}),q({...ve,createPlugin:async()=>{const{STLFileLoader:e}=await o(async()=>{const{STLFileLoader:n}=await import("./stlFileLoader-DuZRujMZ.js");return{STLFileLoader:n}},__vite__mapDeps([47,1,4,5,6]));return new e}})}function Te({model:e,onChange:n}){const[r,A]=d.useState({x:20,y:20}),[M,C]=d.useState(!1),[T,y]=d.useState({x:0,y:0}),h=d.useRef(null),K=d.useRef(null);if(!e)return null;const E=(c,f=6)=>{const z=parseFloat(c);return isNaN(z)?0:parseFloat(z.toFixed(f))},b=c=>{c.target.select()},N=(c,f,z)=>{const G=E(z),Y={...e.transform,[c]:{...e.transform[c],[f]:G}};n(e.id,"transform",Y)},H=(c,f,z)=>{if(document.activeElement!==c.target)return;c.preventDefault();const G=E(c.target.step||1),Y=c.deltaY>0?-G:G;let D=E(c.target.value)+Y;f==="scaling"&&(D=Math.max(.1,E(D))),f==="rotation"&&(D=(D%360+360)%360),N(f,z,D.toString())},x=c=>{if(c.target.tagName==="INPUT"){K.current=c.target;return}C(!0),y({x:c.clientX-r.x,y:c.clientY-r.y})},X=c=>{M&&A({x:c.clientX-T.x,y:c.clientY-T.y})},k=()=>{C(!1)};d.useEffect(()=>(M?(document.addEventListener("mousemove",X),document.addEventListener("mouseup",k)):(document.removeEventListener("mousemove",X),document.removeEventListener("mouseup",k)),()=>{document.removeEventListener("mousemove",X),document.removeEventListener("mouseup",k)}),[M,T]);const U="w-full bg-gray-700 border border-gray-600 rounded px-1.5 py-0.5 text-white text-sm focus:border-blue-400 focus:outline-none",B="flex items-center space-x-1";return s.jsxs("div",{ref:h,className:"fixed p-3 border rounded-lg shadow-lg backdrop-blur-sm",style:{left:`${r.x}px`,top:`${r.y}px`,backgroundColor:"rgba(30, 30, 40, 0.85)",borderColor:"rgba(255, 255, 255, 0.1)",color:"#e2e2e2",cursor:M?"grabbing":"default",zIndex:1e3,minWidth:"260px"},onMouseDown:x,children:[s.jsx("h3",{className:"font-medium text-lg mb-1 pb-1 border-b border-gray-600 select-none",style:{cursor:"grab",userSelect:"none"},children:e.fileName}),s.jsxs("div",{className:"mb-3",children:[s.jsx("h4",{className:"font-medium text-sm mb-1",children:"Позиция"}),s.jsx("div",{className:"grid grid-cols-3 gap-1",children:["x","y","z"].map(c=>s.jsxs("div",{className:B,children:[s.jsx("label",{className:"block text-xs text-gray-300 mb-0.5 w-4",children:c.toUpperCase()}),s.jsx("input",{type:"number",value:e.transform.position[c],onChange:f=>N("position",c,f.target.value),onWheel:f=>H(f,"position",c),onClick:b,onFocus:b,step:"0.1",className:U,style:{maxWidth:"70px"}})]},`position-${c}`))})]}),s.jsxs("div",{className:"mb-3",children:[s.jsx("h4",{className:"font-medium text-sm mb-1",children:"Вращение"}),s.jsx("div",{className:"grid grid-cols-3 gap-1",children:["x","y","z"].map(c=>s.jsxs("div",{className:B,children:[s.jsx("label",{className:"block text-xs text-gray-300 mb-0.5 w-4",children:c.toUpperCase()}),s.jsx("input",{type:"number",value:e.transform.rotation[c],onChange:f=>N("rotation",c,f.target.value),onWheel:f=>H(f,"rotation",c),onClick:b,onFocus:b,step:"15",className:U,style:{maxWidth:"70px"}})]},`rotation-${c}`))})]}),s.jsxs("div",{className:"mb-3",children:[s.jsx("h4",{className:"font-medium text-sm mb-1",children:"Масштаб"}),s.jsx("div",{className:"grid grid-cols-3 gap-1",children:["x","y","z"].map(c=>s.jsxs("div",{className:B,children:[s.jsx("label",{className:"block text-xs text-gray-300 mb-0.5 w-4",children:c.toUpperCase()}),s.jsx("input",{type:"number",value:e.transform.scaling[c],onChange:f=>N("scaling",c,f.target.value),onWheel:f=>H(f,"scaling",c),onClick:b,onFocus:b,step:"0.1",min:"0.1",className:U,style:{maxWidth:"70px"}})]},`scaling-${c}`))})]}),s.jsx("div",{className:"mt-3 pt-2 border-t border-gray-600",children:s.jsx("button",{className:"px-2 py-0.5 bg-red-600 text-white rounded hover:bg-red-700 transition-colors text-sm",onClick:()=>n(e.id,"delete"),children:"Удалить модель"})})]})}function He({models:e,selectedModelId:n,onSelectModel:r,onFileSelect:A}){const[M,C]=d.useState({x:typeof window<"u"?window.innerWidth-320:100,y:20}),[T,y]=d.useState(!1),[h,K]=d.useState({x:0,y:0}),E=d.useRef(null);if(e.length===0)return null;const b=x=>{x.target.tagName==="INPUT"||x.target.tagName==="LABEL"||(y(!0),K({x:x.clientX-M.x,y:x.clientY-M.y}))},N=x=>{T&&C({x:x.clientX-h.x,y:x.clientY-h.y})},H=()=>{y(!1)};return d.useEffect(()=>(T?(document.addEventListener("mousemove",N),document.addEventListener("mouseup",H)):(document.removeEventListener("mousemove",N),document.removeEventListener("mouseup",H)),()=>{document.removeEventListener("mousemove",N),document.removeEventListener("mouseup",H)}),[T,h]),s.jsxs("div",{ref:E,className:"fixed p-3 border rounded-lg shadow-lg backdrop-blur-sm",style:{left:`${M.x}px`,top:`${M.y}px`,backgroundColor:"rgba(30, 30, 40, 0.85)",borderColor:"rgba(255, 255, 255, 0.1)",color:"#e2e2e2",cursor:T?"grabbing":"default",zIndex:1e3,minWidth:"260px",maxWidth:"300px",maxHeight:"400px",overflowY:"auto"},onMouseDown:b,children:[s.jsx("h3",{className:"font-medium text-lg mb-2 pb-1 border-b border-gray-600 select-none",style:{cursor:"grab",userSelect:"none"},children:"Загруженные модели"}),s.jsx("div",{className:"flex flex-col gap-2 mb-3",children:e.map(x=>x.fileName&&s.jsx("div",{className:`p-2 rounded cursor-pointer transition-colors ${n===x.id?"bg-blue-600/70 border border-blue-400":"bg-gray-700/50 hover:bg-gray-600/70 border border-gray-600"}`,onClick:()=>r(x.id),children:s.jsx("div",{className:"text-sm font-medium truncate",children:x.fileName})},x.id))}),s.jsxs("label",{className:`block w-full px-3 py-1.5 bg-blue-600 hover:bg-blue-700 text-white rounded \r
                 text-center text-sm cursor-pointer transition-colors`,children:["Добавить модели",s.jsx("input",{type:"file",accept:".glb,.gltf",className:"hidden",onChange:A,multiple:!0})]})]})}Me();function Ie(){const e=d.useRef(null),n=d.useRef(null),r=d.useRef(null),A=d.useRef(null),[M,C]=d.useState(!1),[T,y]=d.useState(""),[h,K]=d.useState([]),[E,b]=d.useState(null),[N,H]=d.useState({}),x=()=>`model-${Date.now()}-${Math.floor(Math.random()*1e3)}`;d.useEffect(()=>{if(!e.current)return;const t=new we(e.current,!0);n.current=t;const m=(()=>{const a=new he(t),l=new ne("camera",-Math.PI/2,Math.PI/2.5,10,new w(0,0,0),a);l.lowerRadiusLimit=1,l.upperRadiusLimit=300,l.attachControl(e.current,!0),l.wheelDeltaPercentage=.01;const g=new ye("light1",new w(1,1,0),a);g.intensity=.7;const P=new xe("light2",new w(-1,-1,-1),a);P.intensity=.5;const j=Q.CreateGround("ground",{width:100,height:100},a),p=new Ee("groundMaterial",a);p.majorUnitFrequency=5,p.minorUnitVisibility=.45,p.gridRatio=1,p.mainColor=new O(.6,.6,.6),p.lineColor=new O(.8,.8,.8),p.opacity=.98,j.material=p;const R=Q.CreateBox("skybox",{size:5e3},a),I=new se("skyboxMaterial",a);I.backFaceCulling=!1,I.diffuseColor=new O(0,0,0),I.specularColor=new O(0,0,0),I.emissiveColor=new O(.2,.5,.8),R.material=I;const F=new be("highlightLayer",a);return F.innerGlow=!0,F.outerGlow=!0,A.current=F,a.onPointerDown=(v,V)=>{var L;if(V.hit&&V.pickedMesh){const J=(L=V.pickedMesh.metadata)==null?void 0:L.modelId;b(J&&J!=="ground"?J:null)}else b(null)},a})();r.current=m,t.runRenderLoop(()=>{m.render()});const _=()=>{t.resize()};return window.addEventListener("resize",_),()=>{window.removeEventListener("resize",_),t.dispose()}},[]),d.useEffect(()=>{!r.current||!A.current||(A.current.removeAllMeshes(),E&&r.current.meshes.forEach(t=>{var i;((i=t.metadata)==null?void 0:i.modelId)===E&&A.current.addMesh(t,O.FromHexString("#00a0ff"))}))},[E]),d.useEffect(()=>{r.current&&h.forEach(t=>{const i=r.current.getMeshById(t.rootMeshId);i&&(i.position=new w(t.transform.position.x,t.transform.position.y,t.transform.position.z),i.rotation=new w(t.transform.rotation.x*(Math.PI/180),t.transform.rotation.y*(Math.PI/180),t.transform.rotation.z*(Math.PI/180)),i.scaling=new w(t.transform.scaling.x,t.transform.scaling.y,t.transform.scaling.z))})},[h]);const X=(t,i,m)=>{H(_=>({..._,[t]:{data:i,name:m}}))},k=async t=>{try{if(y(""),!r.current)return;const i=new FileReader;i.onload=async m=>{var _;try{if(!((_=m.target)!=null&&_.result))throw new Error("Не удалось прочитать файл");const a=new Uint8Array(m.target.result),l=t.name,g=x();X(g,a,l);const P=new File([a],l,{type:"application/octet-stream"}),j=await ae.ImportMeshAsync("","file:",P,r.current);if(j.meshes.length>0){const p=new ie(`root-${g}`,r.current);p.id=`root-${g}`,p.metadata={modelId:g};let R=Number.MAX_VALUE,I=Number.MAX_VALUE,F=Number.MAX_VALUE,v=Number.MIN_VALUE,V=Number.MIN_VALUE,L=Number.MIN_VALUE;j.meshes.forEach(S=>{if(S!==p){const $=S.getBoundingInfo().boundingBox;R=Math.min(R,$.minimum.x),I=Math.min(I,$.minimum.y),F=Math.min(F,$.minimum.z),v=Math.max(v,$.maximum.x),V=Math.max(V,$.maximum.y),L=Math.max(L,$.maximum.z),S.metadata={modelId:g},S.parent=p}});const J=v-R,me=V-I,de=L-F,re=Math.max(J,me,de),W=re>0?2/re:1,fe={id:g,fileName:l,rootMeshId:p.id,transform:{position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scaling:{x:W,y:W,z:W}}};if(p.scaling=new w(W,W,W),K(S=>[...S,fe]),b(g),h.length===0){const S=r.current.cameras[0];S instanceof ne&&(S.target=new w(0,0,0),S.radius=5)}}}catch(a){console.error("Error loading model:",a),y("Ошибка загрузки модели. Убедитесь, что это корректный GLB файл.")}},i.onerror=()=>{y("Ошибка чтения файла.")},i.readAsArrayBuffer(t)}catch(i){console.error("Fatal error:",i),y("Произошла непредвиденная ошибка.")}},U=(t,i,m)=>{if(i==="delete"){const _=h.find(a=>a.id===t);if(_&&r.current){const a=r.current.getMeshById(_.rootMeshId);a&&a.dispose(!1,!0)}K(a=>a.filter(l=>l.id!==t)),H(a=>{const l={...a};return delete l[t],l}),E===t&&b(null)}else i==="transform"&&K(_=>_.map(a=>a.id===t?{...a,transform:m}:a))},B=t=>{t.preventDefault(),t.stopPropagation(),t.type==="dragenter"||t.type==="dragover"?C(!0):t.type==="dragleave"&&C(!1)},c=t=>{t.preventDefault(),t.stopPropagation(),C(!1),t.dataTransfer.files&&t.dataTransfer.files.length>0&&Array.from(t.dataTransfer.files).forEach(i=>{i.name.toLowerCase().endsWith(".glb")?k(i):y("Поддерживаются только файлы формата .glb")})},f=t=>{t.target.files&&t.target.files.length>0&&Array.from(t.target.files).forEach(i=>{i.name.toLowerCase().endsWith(".glb")?k(i):y("Поддерживаются только файлы формата .glb")})},z=()=>{try{if(h.length===0){y("Нет моделей для экспорта");return}const t={timestamp:Date.now(),models:h.map(l=>{const g=N[l.id],P=G(g.data);return{id:l.id,fileName:l.fileName,fileData:P,transform:l.transform}})},i=JSON.stringify(t,null,2),m=new Blob([i],{type:"application/json"}),_=URL.createObjectURL(m),a=document.createElement("a");a.href=_,a.download=`scene-export-${new Date().toISOString().slice(0,10)}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(_)}catch(t){console.error("Error serializing scene:",t),y("Ошибка при экспорте сцены")}},G=t=>{const i=new Uint8Array(t);let m="";for(let _=0;_<i.byteLength;_++)m+=String.fromCharCode(i[_]);return window.btoa(m)},Y=t=>{const i=window.atob(t),m=i.length,_=new Uint8Array(m);for(let a=0;a<m;a++)_[a]=i.charCodeAt(a);return _},te=t=>{try{const i=t.target.files[0];if(!i)return;const m=new FileReader;m.onload=async _=>{try{const a=JSON.parse(_.target.result);D();for(const l of a.models)await _e(l)}catch(a){console.error("Error parsing scene file:",a),y("Ошибка парсинга файла сцены")}},m.onerror=()=>{y("Ошибка чтения файла сцены")},m.readAsText(i)}catch(i){console.error("Error deserializing scene:",i),y("Ошибка при импорте сцены")}},D=()=>{r.current&&h.forEach(t=>{const i=r.current.getMeshById(t.rootMeshId);i&&i.dispose(!1,!0)}),K([]),H({}),b(null)},_e=async t=>{try{if(t.id.startsWith("map")){let l=Q.CreateBox(t.id,{size:1},r.current);const g=new se("cubeMaterial",r.current);switch(t.type){case"cube":g.diffuseColor=new O(.4,.4,.8),l.material=g,l.position=new w(t.transform.position.x,t.transform.position.y,t.transform.position.z),l.rotation=new w(t.transform.rotation.x,t.transform.rotation.y,t.transform.rotation.z),l.scaling=new w(t.transform.scaling.x,t.transform.scaling.y,t.transform.scaling.z);break;case"player":g.diffuseColor=new O(0,1,0),l.visibility=.7,l.material=g,l.position=new w(t.transform.position.x,t.transform.position.y,t.transform.position.z),l.rotation=new w(t.transform.rotation.x,t.transform.rotation.y,t.transform.rotation.z),l.scaling=new w(t.transform.scaling.x,t.transform.scaling.y,t.transform.scaling.z);break;case"exit":g.diffuseColor=new O(1,0,0),l.visibility=.7,l.material=g,l.position=new w(t.transform.position.x,t.transform.position.y,t.transform.position.z),l.rotation=new w(t.transform.rotation.x,t.transform.rotation.y,t.transform.rotation.z),l.scaling=new w(t.transform.scaling.x,t.transform.scaling.y,t.transform.scaling.z);break;default:l.visibility=0}const P={id:t.id,type:t.type,metadata:t.metadata,rootMeshId:l.id,transform:t.transform};K(j=>[...j,P]);return}const i=Y(t.fileData),m=new File([i],t.fileName,{type:"application/octet-stream"}),_=t.id,a=new FileReader;return new Promise((l,g)=>{a.onload=async P=>{var j;try{if(!((j=P.target)!=null&&j.result))throw new Error("Не удалось прочитать файл");const p=new Uint8Array(P.target.result),R=_;X(R,p,t.fileName);const I=new File([p],t.fileName,{type:"application/octet-stream"}),F=await ae.ImportMeshAsync("","file:",I,r.current);if(F.meshes.length>0){const v=new ie(`root-${R}`,r.current);v.id=`root-${R}`,v.metadata={modelId:R},F.meshes.forEach(L=>{L!==v&&(L.metadata={modelId:R},L.parent=v)});const V={id:R,fileName:t.fileName,rootMeshId:v.id,transform:t.transform};v.position=new w(t.transform.position.x,t.transform.position.y,t.transform.position.z),v.rotation=new w(t.transform.rotation.x*(Math.PI/180),t.transform.rotation.y*(Math.PI/180),t.transform.rotation.z*(Math.PI/180)),v.scaling=new w(t.transform.scaling.x,t.transform.scaling.y,t.transform.scaling.z),K(L=>[...L,V]),l()}else g(new Error("Не удалось загрузить модель"))}catch(p){console.error("Error loading serialized model:",p),g(p)}},a.onerror=()=>{g(new Error("Ошибка чтения файла модели"))},a.readAsArrayBuffer(m)})}catch(i){console.error("Error in loadModelFromSerialized:",i),y("Ошибка загрузки сериализованной модели")}};return s.jsxs("div",{className:"flex flex-col items-center h-screen",children:[s.jsxs("div",{className:`relative w-full h-full ${M?"border-4 border-blue-500 bg-blue-50":null}`,onDragEnter:B,onDragOver:B,onDragLeave:B,onDrop:c,children:[s.jsx("canvas",{ref:e,className:"w-full h-full"}),h.length===0&&s.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center pointer-events-none",children:[s.jsx("div",{className:"text-lg font-medium text-gray-200",children:"Перетащите .glb файлы сюда"}),s.jsx("div",{className:"text-sm text-gray-400 mt-2",children:"или"}),s.jsxs("label",{className:"mt-2 px-4 py-2 bg-blue-500 text-white rounded-md cursor-pointer pointer-events-auto",children:["Выбрать файлы",s.jsx("input",{type:"file",accept:".glb",className:"hidden",onChange:f,multiple:!0})]})]}),T&&s.jsx("div",{className:"absolute bottom-2 left-0 right-0 mx-auto text-center text-red-500 bg-red-50 p-2 rounded max-w-md",children:T})]}),h.length>0&&s.jsx("div",{className:"flex gap-2",children:s.jsx("button",{onClick:z,className:"fixed bottom-16 left-4 px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-md",children:"Экспортировать сцену"})}),s.jsx("div",{children:s.jsxs("label",{className:"fixed bottom-4 left-4 px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-md cursor-pointer",children:["Импортировать сцену",s.jsx("input",{type:"file",accept:".json",className:"hidden",onChange:te})]})}),h.length>0&&s.jsx("div",{className:"w-full",children:s.jsx(He,{models:h,selectedModelId:E,onSelectModel:b,onModelChange:U,onFileSelect:f})}),E&&s.jsx("div",{className:"w-full",children:s.jsx(Te,{model:h.find(t=>t.id===E),onChange:U})})]})}function Se({}){return[{title:"Просмотр 3D‑моделей"},{name:"description",content:"Просматривайте .glb модели онлайн"}]}const je=ge(function(){return s.jsx(Ie,{})});export{oe as B,ce as G,le as O,ue as S,Z as a,Fe as b,ve as c,je as d,Se as m,u as r,Re as u};
