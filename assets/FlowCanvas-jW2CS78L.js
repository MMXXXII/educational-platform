import{a as h,r as Do,t as Yi,y as j,o as p}from"./chunk-AYJ5UCUI-B1579ApN.js";import{F as Vo}from"./XMarkIcon-D64FOle9.js";import{F as Zi}from"./CheckCircleIcon-UDH-7wKd.js";import{F as Mr,a as Dr}from"./ExclamationTriangleIcon-LoCsT_0_.js";import{F as Vr}from"./ChevronDownIcon-BxZwbkus.js";import{a as Po}from"./index-BHLz7_dj.js";import{F as qi}from"./RocketLaunchIcon-B-1hGzc_.js";import{F as Ki}from"./UserIcon-CGgSBpiG.js";import{F as Ji}from"./ArrowPathIcon-CYqLai-V.js";import{F as Qi}from"./DocumentTextIcon-Bx8j1DmN.js";import{F as ea}from"./CodeBracketIcon-TE7D0uFq.js";function ta({title:e,titleId:t,...n},r){return h.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},n),e?h.createElement("title",{id:t},e):null,h.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m15 15 6-6m0 0-6-6m6 6H9a6 6 0 0 0 0 12h3"}))}const Pr=h.forwardRef(ta);function na({title:e,titleId:t,...n},r){return h.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},n),e?h.createElement("title",{id:t},e):null,h.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m3.75 13.5 10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75Z"}))}const ra=h.forwardRef(na);function oa({title:e,titleId:t,...n},r){return h.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},n),e?h.createElement("title",{id:t},e):null,h.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 15.75V18m-7.5-6.75h.008v.008H8.25v-.008Zm0 2.25h.008v.008H8.25V13.5Zm0 2.25h.008v.008H8.25v-.008Zm0 2.25h.008v.008H8.25V18Zm2.498-6.75h.007v.008h-.007v-.008Zm0 2.25h.007v.008h-.007V13.5Zm0 2.25h.007v.008h-.007v-.008Zm0 2.25h.007v.008h-.007V18Zm2.504-6.75h.008v.008h-.008v-.008Zm0 2.25h.008v.008h-.008V13.5Zm0 2.25h.008v.008h-.008v-.008Zm0 2.25h.008v.008h-.008V18Zm2.498-6.75h.008v.008h-.008v-.008Zm0 2.25h.008v.008h-.008V13.5ZM8.25 6h7.5v2.25h-7.5V6ZM12 2.25c-1.892 0-3.758.11-5.593.322C5.307 2.7 4.5 3.65 4.5 4.757V19.5a2.25 2.25 0 0 0 2.25 2.25h10.5a2.25 2.25 0 0 0 2.25-2.25V4.757c0-1.108-.806-2.057-1.907-2.185A48.507 48.507 0 0 0 12 2.25Z"}))}const sa=h.forwardRef(oa);function ia({title:e,titleId:t,...n},r){return h.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},n),e?h.createElement("title",{id:t},e):null,h.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 7.5V6.108c0-1.135.845-2.098 1.976-2.192.373-.03.748-.057 1.123-.08M15.75 18H18a2.25 2.25 0 0 0 2.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 0 0-1.123-.08M15.75 18.75v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5A3.375 3.375 0 0 0 6.375 7.5H5.25m11.9-3.664A2.251 2.251 0 0 0 15 2.25h-1.5a2.251 2.251 0 0 0-2.15 1.586m5.8 0c.065.21.1.433.1.664v.75h-6V4.5c0-.231.035-.454.1-.664M6.75 7.5H4.875c-.621 0-1.125.504-1.125 1.125v12c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V16.5a9 9 0 0 0-9-9Z"}))}const aa=h.forwardRef(ia);function la({title:e,titleId:t,...n},r){return h.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},n),e?h.createElement("title",{id:t},e):null,h.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 3v1.5M3 21v-6m0 0 2.77-.693a9 9 0 0 1 6.208.682l.108.054a9 9 0 0 0 6.086.71l3.114-.732a48.524 48.524 0 0 1-.005-10.499l-3.11.732a9 9 0 0 1-6.085-.711l-.108-.054a9 9 0 0 0-6.208-.682L3 4.5M3 15V4.5"}))}const ca=h.forwardRef(la);function ua({title:e,titleId:t,...n},r){return h.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},n),e?h.createElement("title",{id:t},e):null,h.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 8.689c0-.864.933-1.406 1.683-.977l7.108 4.061a1.125 1.125 0 0 1 0 1.954l-7.108 4.061A1.125 1.125 0 0 1 3 16.811V8.69ZM12.75 8.689c0-.864.933-1.406 1.683-.977l7.108 4.061a1.125 1.125 0 0 1 0 1.954l-7.108 4.061a1.125 1.125 0 0 1-1.683-.977V8.69Z"}))}const da=h.forwardRef(ua);function fa({title:e,titleId:t,...n},r){return h.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},n),e?h.createElement("title",{id:t},e):null,h.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"}))}const ha=h.forwardRef(fa);function pa({title:e,titleId:t,...n},r){return h.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},n),e?h.createElement("title",{id:t},e):null,h.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18.364 18.364A9 9 0 0 0 5.636 5.636m12.728 12.728A9 9 0 0 1 5.636 5.636m12.728 12.728L5.636 5.636"}))}const ga=h.forwardRef(pa);function ma({title:e,titleId:t,...n},r){return h.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},n),e?h.createElement("title",{id:t},e):null,h.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.745 3A23.933 23.933 0 0 0 3 12c0 3.183.62 6.22 1.745 9M19.5 3c.967 2.78 1.5 5.817 1.5 9s-.533 6.22-1.5 9M8.25 8.885l1.444-.89a.75.75 0 0 1 1.105.402l2.402 7.206a.75.75 0 0 0 1.104.401l1.445-.889m-8.25.75.213.09a1.687 1.687 0 0 0 2.062-.617l4.45-6.676a1.688 1.688 0 0 1 2.062-.618l.213.09"}))}const ya=h.forwardRef(ma);function ge(e){if(typeof e=="string"||typeof e=="number")return""+e;let t="";if(Array.isArray(e))for(let n=0,r;n<e.length;n++)(r=ge(e[n]))!==""&&(t+=(t&&" ")+r);else for(let n in e)e[n]&&(t+=(t&&" ")+n);return t}var Tn={exports:{}},An={},Mn={exports:{}},Dn={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Or;function xa(){if(Or)return Dn;Or=1;var e=Do();function t(d,f){return d===f&&(d!==0||1/d===1/f)||d!==d&&f!==f}var n=typeof Object.is=="function"?Object.is:t,r=e.useState,o=e.useEffect,s=e.useLayoutEffect,i=e.useDebugValue;function a(d,f){var g=f(),b=r({inst:{value:g,getSnapshot:f}}),x=b[0].inst,w=b[1];return s(function(){x.value=g,x.getSnapshot=f,l(x)&&w({inst:x})},[d,g,f]),o(function(){return l(x)&&w({inst:x}),d(function(){l(x)&&w({inst:x})})},[d]),i(g),g}function l(d){var f=d.getSnapshot;d=d.value;try{var g=f();return!n(d,g)}catch{return!0}}function c(d,f){return f()}var u=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?c:a;return Dn.useSyncExternalStore=e.useSyncExternalStore!==void 0?e.useSyncExternalStore:u,Dn}var Lr;function wa(){return Lr||(Lr=1,Mn.exports=xa()),Mn.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Hr;function ba(){if(Hr)return An;Hr=1;var e=Do(),t=wa();function n(c,u){return c===u&&(c!==0||1/c===1/u)||c!==c&&u!==u}var r=typeof Object.is=="function"?Object.is:n,o=t.useSyncExternalStore,s=e.useRef,i=e.useEffect,a=e.useMemo,l=e.useDebugValue;return An.useSyncExternalStoreWithSelector=function(c,u,d,f,g){var b=s(null);if(b.current===null){var x={hasValue:!1,value:null};b.current=x}else x=b.current;b=a(function(){function m(C){if(!N){if(N=!0,S=C,C=f(C),g!==void 0&&x.hasValue){var M=x.value;if(g(M,C))return v=M}return v=C}if(M=v,r(S,C))return M;var O=f(C);return g!==void 0&&g(M,O)?(S=C,M):(S=C,v=O)}var N=!1,S,v,E=d===void 0?null:d;return[function(){return m(u())},E===null?void 0:function(){return m(E())}]},[u,d,f,g]);var w=o(c,b[0],b[1]);return i(function(){x.hasValue=!0,x.value=w},[w]),l(w),w},An}var zr;function va(){return zr||(zr=1,Tn.exports=ba()),Tn.exports}var Ea=va();const Na=Yi(Ea),Sa={},Fr=e=>{let t;const n=new Set,r=(u,d)=>{const f=typeof u=="function"?u(t):u;if(!Object.is(f,t)){const g=t;t=d??(typeof f!="object"||f===null)?f:Object.assign({},t,f),n.forEach(b=>b(t,g))}},o=()=>t,l={setState:r,getState:o,getInitialState:()=>c,subscribe:u=>(n.add(u),()=>n.delete(u)),destroy:()=>{(Sa?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},c=t=e(r,o,l);return l},Ca=e=>e?Fr(e):Fr,{useDebugValue:_a}=j,{useSyncExternalStoreWithSelector:$a}=Na,ka=e=>e;function Oo(e,t=ka,n){const r=$a(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,n);return _a(r),r}const Br=(e,t)=>{const n=Ca(e),r=(o,s=t)=>Oo(n,o,s);return Object.assign(r,n),r},Ia=(e,t)=>e?Br(e,t):Br;function pe(e,t){if(Object.is(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(const[r,o]of e)if(!Object.is(o,t.get(r)))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(const r of e)if(!t.has(r))return!1;return!0}const n=Object.keys(e);if(n.length!==Object.keys(t).length)return!1;for(const r of n)if(!Object.prototype.hasOwnProperty.call(t,r)||!Object.is(e[r],t[r]))return!1;return!0}var Ra={value:()=>{}};function Nn(){for(var e=0,t=arguments.length,n={},r;e<t;++e){if(!(r=arguments[e]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new un(n)}function un(e){this._=e}function ja(e,t){return e.trim().split(/^|\s+/).map(function(n){var r="",o=n.indexOf(".");if(o>=0&&(r=n.slice(o+1),n=n.slice(0,o)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}un.prototype=Nn.prototype={constructor:un,on:function(e,t){var n=this._,r=ja(e+"",n),o,s=-1,i=r.length;if(arguments.length<2){for(;++s<i;)if((o=(e=r[s]).type)&&(o=Ta(n[o],e.name)))return o;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++s<i;)if(o=(e=r[s]).type)n[o]=Wr(n[o],e.name,t);else if(t==null)for(o in n)n[o]=Wr(n[o],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new un(e)},call:function(e,t){if((o=arguments.length-2)>0)for(var n=new Array(o),r=0,o,s;r<o;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(s=this._[e],r=0,o=s.length;r<o;++r)s[r].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],o=0,s=r.length;o<s;++o)r[o].value.apply(t,n)}};function Ta(e,t){for(var n=0,r=e.length,o;n<r;++n)if((o=e[n]).name===t)return o.value}function Wr(e,t,n){for(var r=0,o=e.length;r<o;++r)if(e[r].name===t){e[r]=Ra,e=e.slice(0,r).concat(e.slice(r+1));break}return n!=null&&e.push({name:t,value:n}),e}var Yn="http://www.w3.org/1999/xhtml";const Ur={svg:"http://www.w3.org/2000/svg",xhtml:Yn,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Sn(e){var t=e+="",n=t.indexOf(":");return n>=0&&(t=e.slice(0,n))!=="xmlns"&&(e=e.slice(n+1)),Ur.hasOwnProperty(t)?{space:Ur[t],local:e}:e}function Aa(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===Yn&&t.documentElement.namespaceURI===Yn?t.createElement(e):t.createElementNS(n,e)}}function Ma(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function Lo(e){var t=Sn(e);return(t.local?Ma:Aa)(t)}function Da(){}function ur(e){return e==null?Da:function(){return this.querySelector(e)}}function Va(e){typeof e!="function"&&(e=ur(e));for(var t=this._groups,n=t.length,r=new Array(n),o=0;o<n;++o)for(var s=t[o],i=s.length,a=r[o]=new Array(i),l,c,u=0;u<i;++u)(l=s[u])&&(c=e.call(l,l.__data__,u,s))&&("__data__"in l&&(c.__data__=l.__data__),a[u]=c);return new Ne(r,this._parents)}function Pa(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function Oa(){return[]}function Ho(e){return e==null?Oa:function(){return this.querySelectorAll(e)}}function La(e){return function(){return Pa(e.apply(this,arguments))}}function Ha(e){typeof e=="function"?e=La(e):e=Ho(e);for(var t=this._groups,n=t.length,r=[],o=[],s=0;s<n;++s)for(var i=t[s],a=i.length,l,c=0;c<a;++c)(l=i[c])&&(r.push(e.call(l,l.__data__,c,i)),o.push(l));return new Ne(r,o)}function zo(e){return function(){return this.matches(e)}}function Fo(e){return function(t){return t.matches(e)}}var za=Array.prototype.find;function Fa(e){return function(){return za.call(this.children,e)}}function Ba(){return this.firstElementChild}function Wa(e){return this.select(e==null?Ba:Fa(typeof e=="function"?e:Fo(e)))}var Ua=Array.prototype.filter;function Ga(){return Array.from(this.children)}function Xa(e){return function(){return Ua.call(this.children,e)}}function Ya(e){return this.selectAll(e==null?Ga:Xa(typeof e=="function"?e:Fo(e)))}function Za(e){typeof e!="function"&&(e=zo(e));for(var t=this._groups,n=t.length,r=new Array(n),o=0;o<n;++o)for(var s=t[o],i=s.length,a=r[o]=[],l,c=0;c<i;++c)(l=s[c])&&e.call(l,l.__data__,c,s)&&a.push(l);return new Ne(r,this._parents)}function Bo(e){return new Array(e.length)}function qa(){return new Ne(this._enter||this._groups.map(Bo),this._parents)}function pn(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}pn.prototype={constructor:pn,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function Ka(e){return function(){return e}}function Ja(e,t,n,r,o,s){for(var i=0,a,l=t.length,c=s.length;i<c;++i)(a=t[i])?(a.__data__=s[i],r[i]=a):n[i]=new pn(e,s[i]);for(;i<l;++i)(a=t[i])&&(o[i]=a)}function Qa(e,t,n,r,o,s,i){var a,l,c=new Map,u=t.length,d=s.length,f=new Array(u),g;for(a=0;a<u;++a)(l=t[a])&&(f[a]=g=i.call(l,l.__data__,a,t)+"",c.has(g)?o[a]=l:c.set(g,l));for(a=0;a<d;++a)g=i.call(e,s[a],a,s)+"",(l=c.get(g))?(r[a]=l,l.__data__=s[a],c.delete(g)):n[a]=new pn(e,s[a]);for(a=0;a<u;++a)(l=t[a])&&c.get(f[a])===l&&(o[a]=l)}function el(e){return e.__data__}function tl(e,t){if(!arguments.length)return Array.from(this,el);var n=t?Qa:Ja,r=this._parents,o=this._groups;typeof e!="function"&&(e=Ka(e));for(var s=o.length,i=new Array(s),a=new Array(s),l=new Array(s),c=0;c<s;++c){var u=r[c],d=o[c],f=d.length,g=nl(e.call(u,u&&u.__data__,c,r)),b=g.length,x=a[c]=new Array(b),w=i[c]=new Array(b),m=l[c]=new Array(f);n(u,d,x,w,m,g,t);for(var N=0,S=0,v,E;N<b;++N)if(v=x[N]){for(N>=S&&(S=N+1);!(E=w[S])&&++S<b;);v._next=E||null}}return i=new Ne(i,r),i._enter=a,i._exit=l,i}function nl(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function rl(){return new Ne(this._exit||this._groups.map(Bo),this._parents)}function ol(e,t,n){var r=this.enter(),o=this,s=this.exit();return typeof e=="function"?(r=e(r),r&&(r=r.selection())):r=r.append(e+""),t!=null&&(o=t(o),o&&(o=o.selection())),n==null?s.remove():n(s),r&&o?r.merge(o).order():o}function sl(e){for(var t=e.selection?e.selection():e,n=this._groups,r=t._groups,o=n.length,s=r.length,i=Math.min(o,s),a=new Array(o),l=0;l<i;++l)for(var c=n[l],u=r[l],d=c.length,f=a[l]=new Array(d),g,b=0;b<d;++b)(g=c[b]||u[b])&&(f[b]=g);for(;l<o;++l)a[l]=n[l];return new Ne(a,this._parents)}function il(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var r=e[t],o=r.length-1,s=r[o],i;--o>=0;)(i=r[o])&&(s&&i.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(i,s),s=i);return this}function al(e){e||(e=ll);function t(d,f){return d&&f?e(d.__data__,f.__data__):!d-!f}for(var n=this._groups,r=n.length,o=new Array(r),s=0;s<r;++s){for(var i=n[s],a=i.length,l=o[s]=new Array(a),c,u=0;u<a;++u)(c=i[u])&&(l[u]=c);l.sort(t)}return new Ne(o,this._parents).order()}function ll(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function cl(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function ul(){return Array.from(this)}function dl(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],o=0,s=r.length;o<s;++o){var i=r[o];if(i)return i}return null}function fl(){let e=0;for(const t of this)++e;return e}function hl(){return!this.node()}function pl(e){for(var t=this._groups,n=0,r=t.length;n<r;++n)for(var o=t[n],s=0,i=o.length,a;s<i;++s)(a=o[s])&&e.call(a,a.__data__,s,o);return this}function gl(e){return function(){this.removeAttribute(e)}}function ml(e){return function(){this.removeAttributeNS(e.space,e.local)}}function yl(e,t){return function(){this.setAttribute(e,t)}}function xl(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function wl(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttribute(e):this.setAttribute(e,n)}}function bl(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function vl(e,t){var n=Sn(e);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((t==null?n.local?ml:gl:typeof t=="function"?n.local?bl:wl:n.local?xl:yl)(n,t))}function Wo(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function El(e){return function(){this.style.removeProperty(e)}}function Nl(e,t,n){return function(){this.style.setProperty(e,t,n)}}function Sl(e,t,n){return function(){var r=t.apply(this,arguments);r==null?this.style.removeProperty(e):this.style.setProperty(e,r,n)}}function Cl(e,t,n){return arguments.length>1?this.each((t==null?El:typeof t=="function"?Sl:Nl)(e,t,n??"")):St(this.node(),e)}function St(e,t){return e.style.getPropertyValue(t)||Wo(e).getComputedStyle(e,null).getPropertyValue(t)}function _l(e){return function(){delete this[e]}}function $l(e,t){return function(){this[e]=t}}function kl(e,t){return function(){var n=t.apply(this,arguments);n==null?delete this[e]:this[e]=n}}function Il(e,t){return arguments.length>1?this.each((t==null?_l:typeof t=="function"?kl:$l)(e,t)):this.node()[e]}function Uo(e){return e.trim().split(/^|\s+/)}function dr(e){return e.classList||new Go(e)}function Go(e){this._node=e,this._names=Uo(e.getAttribute("class")||"")}Go.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function Xo(e,t){for(var n=dr(e),r=-1,o=t.length;++r<o;)n.add(t[r])}function Yo(e,t){for(var n=dr(e),r=-1,o=t.length;++r<o;)n.remove(t[r])}function Rl(e){return function(){Xo(this,e)}}function jl(e){return function(){Yo(this,e)}}function Tl(e,t){return function(){(t.apply(this,arguments)?Xo:Yo)(this,e)}}function Al(e,t){var n=Uo(e+"");if(arguments.length<2){for(var r=dr(this.node()),o=-1,s=n.length;++o<s;)if(!r.contains(n[o]))return!1;return!0}return this.each((typeof t=="function"?Tl:t?Rl:jl)(n,t))}function Ml(){this.textContent=""}function Dl(e){return function(){this.textContent=e}}function Vl(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function Pl(e){return arguments.length?this.each(e==null?Ml:(typeof e=="function"?Vl:Dl)(e)):this.node().textContent}function Ol(){this.innerHTML=""}function Ll(e){return function(){this.innerHTML=e}}function Hl(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function zl(e){return arguments.length?this.each(e==null?Ol:(typeof e=="function"?Hl:Ll)(e)):this.node().innerHTML}function Fl(){this.nextSibling&&this.parentNode.appendChild(this)}function Bl(){return this.each(Fl)}function Wl(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Ul(){return this.each(Wl)}function Gl(e){var t=typeof e=="function"?e:Lo(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function Xl(){return null}function Yl(e,t){var n=typeof e=="function"?e:Lo(e),r=t==null?Xl:typeof t=="function"?t:ur(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function Zl(){var e=this.parentNode;e&&e.removeChild(this)}function ql(){return this.each(Zl)}function Kl(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Jl(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Ql(e){return this.select(e?Jl:Kl)}function ec(e){return arguments.length?this.property("__data__",e):this.node().__data__}function tc(e){return function(t){e.call(this,t,this.__data__)}}function nc(e){return e.trim().split(/^|\s+/).map(function(t){var n="",r=t.indexOf(".");return r>=0&&(n=t.slice(r+1),t=t.slice(0,r)),{type:t,name:n}})}function rc(e){return function(){var t=this.__on;if(t){for(var n=0,r=-1,o=t.length,s;n<o;++n)s=t[n],(!e.type||s.type===e.type)&&s.name===e.name?this.removeEventListener(s.type,s.listener,s.options):t[++r]=s;++r?t.length=r:delete this.__on}}}function oc(e,t,n){return function(){var r=this.__on,o,s=tc(t);if(r){for(var i=0,a=r.length;i<a;++i)if((o=r[i]).type===e.type&&o.name===e.name){this.removeEventListener(o.type,o.listener,o.options),this.addEventListener(o.type,o.listener=s,o.options=n),o.value=t;return}}this.addEventListener(e.type,s,n),o={type:e.type,name:e.name,value:t,listener:s,options:n},r?r.push(o):this.__on=[o]}}function sc(e,t,n){var r=nc(e+""),o,s=r.length,i;if(arguments.length<2){var a=this.node().__on;if(a){for(var l=0,c=a.length,u;l<c;++l)for(o=0,u=a[l];o<s;++o)if((i=r[o]).type===u.type&&i.name===u.name)return u.value}return}for(a=t?oc:rc,o=0;o<s;++o)this.each(a(r[o],t,n));return this}function Zo(e,t,n){var r=Wo(e),o=r.CustomEvent;typeof o=="function"?o=new o(t,n):(o=r.document.createEvent("Event"),n?(o.initEvent(t,n.bubbles,n.cancelable),o.detail=n.detail):o.initEvent(t,!1,!1)),e.dispatchEvent(o)}function ic(e,t){return function(){return Zo(this,e,t)}}function ac(e,t){return function(){return Zo(this,e,t.apply(this,arguments))}}function lc(e,t){return this.each((typeof t=="function"?ac:ic)(e,t))}function*cc(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],o=0,s=r.length,i;o<s;++o)(i=r[o])&&(yield i)}var qo=[null];function Ne(e,t){this._groups=e,this._parents=t}function Zt(){return new Ne([[document.documentElement]],qo)}function uc(){return this}Ne.prototype=Zt.prototype={constructor:Ne,select:Va,selectAll:Ha,selectChild:Wa,selectChildren:Ya,filter:Za,data:tl,enter:qa,exit:rl,join:ol,merge:sl,selection:uc,order:il,sort:al,call:cl,nodes:ul,node:dl,size:fl,empty:hl,each:pl,attr:vl,style:Cl,property:Il,classed:Al,text:Pl,html:zl,raise:Bl,lower:Ul,append:Gl,insert:Yl,remove:ql,clone:Ql,datum:ec,on:sc,dispatch:lc,[Symbol.iterator]:cc};function _e(e){return typeof e=="string"?new Ne([[document.querySelector(e)]],[document.documentElement]):new Ne([[e]],qo)}function dc(e){let t;for(;t=e.sourceEvent;)e=t;return e}function Te(e,t){if(e=dc(e),t===void 0&&(t=e.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=e.clientX,r.y=e.clientY,r=r.matrixTransform(t.getScreenCTM().inverse()),[r.x,r.y]}if(t.getBoundingClientRect){var o=t.getBoundingClientRect();return[e.clientX-o.left-t.clientLeft,e.clientY-o.top-t.clientTop]}}return[e.pageX,e.pageY]}const fc={passive:!1},Ht={capture:!0,passive:!1};function Vn(e){e.stopImmediatePropagation()}function vt(e){e.preventDefault(),e.stopImmediatePropagation()}function Ko(e){var t=e.document.documentElement,n=_e(e).on("dragstart.drag",vt,Ht);"onselectstart"in t?n.on("selectstart.drag",vt,Ht):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function Jo(e,t){var n=e.document.documentElement,r=_e(e).on("dragstart.drag",null);t&&(r.on("click.drag",vt,Ht),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const Qt=e=>()=>e;function Zn(e,{sourceEvent:t,subject:n,target:r,identifier:o,active:s,x:i,y:a,dx:l,dy:c,dispatch:u}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:o,enumerable:!0,configurable:!0},active:{value:s,enumerable:!0,configurable:!0},x:{value:i,enumerable:!0,configurable:!0},y:{value:a,enumerable:!0,configurable:!0},dx:{value:l,enumerable:!0,configurable:!0},dy:{value:c,enumerable:!0,configurable:!0},_:{value:u}})}Zn.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};function hc(e){return!e.ctrlKey&&!e.button}function pc(){return this.parentNode}function gc(e,t){return t??{x:e.x,y:e.y}}function mc(){return navigator.maxTouchPoints||"ontouchstart"in this}function yc(){var e=hc,t=pc,n=gc,r=mc,o={},s=Nn("start","drag","end"),i=0,a,l,c,u,d=0;function f(v){v.on("mousedown.drag",g).filter(r).on("touchstart.drag",w).on("touchmove.drag",m,fc).on("touchend.drag touchcancel.drag",N).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function g(v,E){if(!(u||!e.call(this,v,E))){var C=S(this,t.call(this,v,E),v,E,"mouse");C&&(_e(v.view).on("mousemove.drag",b,Ht).on("mouseup.drag",x,Ht),Ko(v.view),Vn(v),c=!1,a=v.clientX,l=v.clientY,C("start",v))}}function b(v){if(vt(v),!c){var E=v.clientX-a,C=v.clientY-l;c=E*E+C*C>d}o.mouse("drag",v)}function x(v){_e(v.view).on("mousemove.drag mouseup.drag",null),Jo(v.view,c),vt(v),o.mouse("end",v)}function w(v,E){if(e.call(this,v,E)){var C=v.changedTouches,M=t.call(this,v,E),O=C.length,A,L;for(A=0;A<O;++A)(L=S(this,M,v,E,C[A].identifier,C[A]))&&(Vn(v),L("start",v,C[A]))}}function m(v){var E=v.changedTouches,C=E.length,M,O;for(M=0;M<C;++M)(O=o[E[M].identifier])&&(vt(v),O("drag",v,E[M]))}function N(v){var E=v.changedTouches,C=E.length,M,O;for(u&&clearTimeout(u),u=setTimeout(function(){u=null},500),M=0;M<C;++M)(O=o[E[M].identifier])&&(Vn(v),O("end",v,E[M]))}function S(v,E,C,M,O,A){var L=s.copy(),H=Te(A||C,E),W,z,y;if((y=n.call(v,new Zn("beforestart",{sourceEvent:C,target:f,identifier:O,active:i,x:H[0],y:H[1],dx:0,dy:0,dispatch:L}),M))!=null)return W=y.x-H[0]||0,z=y.y-H[1]||0,function k(_,P,F){var $=H,V;switch(_){case"start":o[O]=k,V=i++;break;case"end":delete o[O],--i;case"drag":H=Te(F||P,E),V=i;break}L.call(_,v,new Zn(_,{sourceEvent:P,subject:y,target:f,identifier:O,active:V,x:H[0]+W,y:H[1]+z,dx:H[0]-$[0],dy:H[1]-$[1],dispatch:L}),M)}}return f.filter=function(v){return arguments.length?(e=typeof v=="function"?v:Qt(!!v),f):e},f.container=function(v){return arguments.length?(t=typeof v=="function"?v:Qt(v),f):t},f.subject=function(v){return arguments.length?(n=typeof v=="function"?v:Qt(v),f):n},f.touchable=function(v){return arguments.length?(r=typeof v=="function"?v:Qt(!!v),f):r},f.on=function(){var v=s.on.apply(s,arguments);return v===s?f:v},f.clickDistance=function(v){return arguments.length?(d=(v=+v)*v,f):Math.sqrt(d)},f}function fr(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function Qo(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function qt(){}var zt=.7,gn=1/zt,Et="\\s*([+-]?\\d+)\\s*",Ft="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Pe="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",xc=/^#([0-9a-f]{3,8})$/,wc=new RegExp(`^rgb\\(${Et},${Et},${Et}\\)$`),bc=new RegExp(`^rgb\\(${Pe},${Pe},${Pe}\\)$`),vc=new RegExp(`^rgba\\(${Et},${Et},${Et},${Ft}\\)$`),Ec=new RegExp(`^rgba\\(${Pe},${Pe},${Pe},${Ft}\\)$`),Nc=new RegExp(`^hsl\\(${Ft},${Pe},${Pe}\\)$`),Sc=new RegExp(`^hsla\\(${Ft},${Pe},${Pe},${Ft}\\)$`),Gr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};fr(qt,Bt,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:Xr,formatHex:Xr,formatHex8:Cc,formatHsl:_c,formatRgb:Yr,toString:Yr});function Xr(){return this.rgb().formatHex()}function Cc(){return this.rgb().formatHex8()}function _c(){return es(this).formatHsl()}function Yr(){return this.rgb().formatRgb()}function Bt(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=xc.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?Zr(t):n===3?new ve(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?en(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?en(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=wc.exec(e))?new ve(t[1],t[2],t[3],1):(t=bc.exec(e))?new ve(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=vc.exec(e))?en(t[1],t[2],t[3],t[4]):(t=Ec.exec(e))?en(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=Nc.exec(e))?Jr(t[1],t[2]/100,t[3]/100,1):(t=Sc.exec(e))?Jr(t[1],t[2]/100,t[3]/100,t[4]):Gr.hasOwnProperty(e)?Zr(Gr[e]):e==="transparent"?new ve(NaN,NaN,NaN,0):null}function Zr(e){return new ve(e>>16&255,e>>8&255,e&255,1)}function en(e,t,n,r){return r<=0&&(e=t=n=NaN),new ve(e,t,n,r)}function $c(e){return e instanceof qt||(e=Bt(e)),e?(e=e.rgb(),new ve(e.r,e.g,e.b,e.opacity)):new ve}function qn(e,t,n,r){return arguments.length===1?$c(e):new ve(e,t,n,r??1)}function ve(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}fr(ve,qn,Qo(qt,{brighter(e){return e=e==null?gn:Math.pow(gn,e),new ve(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?zt:Math.pow(zt,e),new ve(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new ve(lt(this.r),lt(this.g),lt(this.b),mn(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:qr,formatHex:qr,formatHex8:kc,formatRgb:Kr,toString:Kr}));function qr(){return`#${it(this.r)}${it(this.g)}${it(this.b)}`}function kc(){return`#${it(this.r)}${it(this.g)}${it(this.b)}${it((isNaN(this.opacity)?1:this.opacity)*255)}`}function Kr(){const e=mn(this.opacity);return`${e===1?"rgb(":"rgba("}${lt(this.r)}, ${lt(this.g)}, ${lt(this.b)}${e===1?")":`, ${e})`}`}function mn(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function lt(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function it(e){return e=lt(e),(e<16?"0":"")+e.toString(16)}function Jr(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new Ae(e,t,n,r)}function es(e){if(e instanceof Ae)return new Ae(e.h,e.s,e.l,e.opacity);if(e instanceof qt||(e=Bt(e)),!e)return new Ae;if(e instanceof Ae)return e;e=e.rgb();var t=e.r/255,n=e.g/255,r=e.b/255,o=Math.min(t,n,r),s=Math.max(t,n,r),i=NaN,a=s-o,l=(s+o)/2;return a?(t===s?i=(n-r)/a+(n<r)*6:n===s?i=(r-t)/a+2:i=(t-n)/a+4,a/=l<.5?s+o:2-s-o,i*=60):a=l>0&&l<1?0:i,new Ae(i,a,l,e.opacity)}function Ic(e,t,n,r){return arguments.length===1?es(e):new Ae(e,t,n,r??1)}function Ae(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}fr(Ae,Ic,Qo(qt,{brighter(e){return e=e==null?gn:Math.pow(gn,e),new Ae(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?zt:Math.pow(zt,e),new Ae(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,o=2*n-r;return new ve(Pn(e>=240?e-240:e+120,o,r),Pn(e,o,r),Pn(e<120?e+240:e-120,o,r),this.opacity)},clamp(){return new Ae(Qr(this.h),tn(this.s),tn(this.l),mn(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=mn(this.opacity);return`${e===1?"hsl(":"hsla("}${Qr(this.h)}, ${tn(this.s)*100}%, ${tn(this.l)*100}%${e===1?")":`, ${e})`}`}}));function Qr(e){return e=(e||0)%360,e<0?e+360:e}function tn(e){return Math.max(0,Math.min(1,e||0))}function Pn(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}const ts=e=>()=>e;function Rc(e,t){return function(n){return e+n*t}}function jc(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}function Tc(e){return(e=+e)==1?ns:function(t,n){return n-t?jc(t,n,e):ts(isNaN(t)?n:t)}}function ns(e,t){var n=t-e;return n?Rc(e,n):ts(isNaN(e)?t:e)}const eo=function e(t){var n=Tc(t);function r(o,s){var i=n((o=qn(o)).r,(s=qn(s)).r),a=n(o.g,s.g),l=n(o.b,s.b),c=ns(o.opacity,s.opacity);return function(u){return o.r=i(u),o.g=a(u),o.b=l(u),o.opacity=c(u),o+""}}return r.gamma=e,r}(1);function Ze(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}var Kn=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,On=new RegExp(Kn.source,"g");function Ac(e){return function(){return e}}function Mc(e){return function(t){return e(t)+""}}function Dc(e,t){var n=Kn.lastIndex=On.lastIndex=0,r,o,s,i=-1,a=[],l=[];for(e=e+"",t=t+"";(r=Kn.exec(e))&&(o=On.exec(t));)(s=o.index)>n&&(s=t.slice(n,s),a[i]?a[i]+=s:a[++i]=s),(r=r[0])===(o=o[0])?a[i]?a[i]+=o:a[++i]=o:(a[++i]=null,l.push({i,x:Ze(r,o)})),n=On.lastIndex;return n<t.length&&(s=t.slice(n),a[i]?a[i]+=s:a[++i]=s),a.length<2?l[0]?Mc(l[0].x):Ac(t):(t=l.length,function(c){for(var u=0,d;u<t;++u)a[(d=l[u]).i]=d.x(c);return a.join("")})}var to=180/Math.PI,Jn={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function rs(e,t,n,r,o,s){var i,a,l;return(i=Math.sqrt(e*e+t*t))&&(e/=i,t/=i),(l=e*n+t*r)&&(n-=e*l,r-=t*l),(a=Math.sqrt(n*n+r*r))&&(n/=a,r/=a,l/=a),e*r<t*n&&(e=-e,t=-t,l=-l,i=-i),{translateX:o,translateY:s,rotate:Math.atan2(t,e)*to,skewX:Math.atan(l)*to,scaleX:i,scaleY:a}}var nn;function Vc(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?Jn:rs(t.a,t.b,t.c,t.d,t.e,t.f)}function Pc(e){return e==null||(nn||(nn=document.createElementNS("http://www.w3.org/2000/svg","g")),nn.setAttribute("transform",e),!(e=nn.transform.baseVal.consolidate()))?Jn:(e=e.matrix,rs(e.a,e.b,e.c,e.d,e.e,e.f))}function os(e,t,n,r){function o(c){return c.length?c.pop()+" ":""}function s(c,u,d,f,g,b){if(c!==d||u!==f){var x=g.push("translate(",null,t,null,n);b.push({i:x-4,x:Ze(c,d)},{i:x-2,x:Ze(u,f)})}else(d||f)&&g.push("translate("+d+t+f+n)}function i(c,u,d,f){c!==u?(c-u>180?u+=360:u-c>180&&(c+=360),f.push({i:d.push(o(d)+"rotate(",null,r)-2,x:Ze(c,u)})):u&&d.push(o(d)+"rotate("+u+r)}function a(c,u,d,f){c!==u?f.push({i:d.push(o(d)+"skewX(",null,r)-2,x:Ze(c,u)}):u&&d.push(o(d)+"skewX("+u+r)}function l(c,u,d,f,g,b){if(c!==d||u!==f){var x=g.push(o(g)+"scale(",null,",",null,")");b.push({i:x-4,x:Ze(c,d)},{i:x-2,x:Ze(u,f)})}else(d!==1||f!==1)&&g.push(o(g)+"scale("+d+","+f+")")}return function(c,u){var d=[],f=[];return c=e(c),u=e(u),s(c.translateX,c.translateY,u.translateX,u.translateY,d,f),i(c.rotate,u.rotate,d,f),a(c.skewX,u.skewX,d,f),l(c.scaleX,c.scaleY,u.scaleX,u.scaleY,d,f),c=u=null,function(g){for(var b=-1,x=f.length,w;++b<x;)d[(w=f[b]).i]=w.x(g);return d.join("")}}}var Oc=os(Vc,"px, ","px)","deg)"),Lc=os(Pc,", ",")",")"),Hc=1e-12;function no(e){return((e=Math.exp(e))+1/e)/2}function zc(e){return((e=Math.exp(e))-1/e)/2}function Fc(e){return((e=Math.exp(2*e))-1)/(e+1)}const Bc=function e(t,n,r){function o(s,i){var a=s[0],l=s[1],c=s[2],u=i[0],d=i[1],f=i[2],g=u-a,b=d-l,x=g*g+b*b,w,m;if(x<Hc)m=Math.log(f/c)/t,w=function(M){return[a+M*g,l+M*b,c*Math.exp(t*M*m)]};else{var N=Math.sqrt(x),S=(f*f-c*c+r*x)/(2*c*n*N),v=(f*f-c*c-r*x)/(2*f*n*N),E=Math.log(Math.sqrt(S*S+1)-S),C=Math.log(Math.sqrt(v*v+1)-v);m=(C-E)/t,w=function(M){var O=M*m,A=no(E),L=c/(n*N)*(A*Fc(t*O+E)-zc(E));return[a+L*g,l+L*b,c*A/no(t*O+E)]}}return w.duration=m*1e3*t/Math.SQRT2,w}return o.rho=function(s){var i=Math.max(.001,+s),a=i*i,l=a*a;return e(i,a,l)},o}(Math.SQRT2,2,4);var Ct=0,Pt=0,Tt=0,ss=1e3,yn,Ot,xn=0,ut=0,Cn=0,Wt=typeof performance=="object"&&performance.now?performance:Date,is=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function hr(){return ut||(is(Wc),ut=Wt.now()+Cn)}function Wc(){ut=0}function wn(){this._call=this._time=this._next=null}wn.prototype=as.prototype={constructor:wn,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?hr():+n)+(t==null?0:+t),!this._next&&Ot!==this&&(Ot?Ot._next=this:yn=this,Ot=this),this._call=e,this._time=n,Qn()},stop:function(){this._call&&(this._call=null,this._time=1/0,Qn())}};function as(e,t,n){var r=new wn;return r.restart(e,t,n),r}function Uc(){hr(),++Ct;for(var e=yn,t;e;)(t=ut-e._time)>=0&&e._call.call(void 0,t),e=e._next;--Ct}function ro(){ut=(xn=Wt.now())+Cn,Ct=Pt=0;try{Uc()}finally{Ct=0,Xc(),ut=0}}function Gc(){var e=Wt.now(),t=e-xn;t>ss&&(Cn-=t,xn=e)}function Xc(){for(var e,t=yn,n,r=1/0;t;)t._call?(r>t._time&&(r=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:yn=n);Ot=e,Qn(r)}function Qn(e){if(!Ct){Pt&&(Pt=clearTimeout(Pt));var t=e-ut;t>24?(e<1/0&&(Pt=setTimeout(ro,e-Wt.now()-Cn)),Tt&&(Tt=clearInterval(Tt))):(Tt||(xn=Wt.now(),Tt=setInterval(Gc,ss)),Ct=1,is(ro))}}function oo(e,t,n){var r=new wn;return t=t==null?0:+t,r.restart(o=>{r.stop(),e(o+t)},t,n),r}var Yc=Nn("start","end","cancel","interrupt"),Zc=[],ls=0,so=1,er=2,dn=3,io=4,tr=5,fn=6;function _n(e,t,n,r,o,s){var i=e.__transition;if(!i)e.__transition={};else if(n in i)return;qc(e,n,{name:t,index:r,group:o,on:Yc,tween:Zc,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:ls})}function pr(e,t){var n=De(e,t);if(n.state>ls)throw new Error("too late; already scheduled");return n}function Oe(e,t){var n=De(e,t);if(n.state>dn)throw new Error("too late; already running");return n}function De(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function qc(e,t,n){var r=e.__transition,o;r[t]=n,n.timer=as(s,0,n.time);function s(c){n.state=so,n.timer.restart(i,n.delay,n.time),n.delay<=c&&i(c-n.delay)}function i(c){var u,d,f,g;if(n.state!==so)return l();for(u in r)if(g=r[u],g.name===n.name){if(g.state===dn)return oo(i);g.state===io?(g.state=fn,g.timer.stop(),g.on.call("interrupt",e,e.__data__,g.index,g.group),delete r[u]):+u<t&&(g.state=fn,g.timer.stop(),g.on.call("cancel",e,e.__data__,g.index,g.group),delete r[u])}if(oo(function(){n.state===dn&&(n.state=io,n.timer.restart(a,n.delay,n.time),a(c))}),n.state=er,n.on.call("start",e,e.__data__,n.index,n.group),n.state===er){for(n.state=dn,o=new Array(f=n.tween.length),u=0,d=-1;u<f;++u)(g=n.tween[u].value.call(e,e.__data__,n.index,n.group))&&(o[++d]=g);o.length=d+1}}function a(c){for(var u=c<n.duration?n.ease.call(null,c/n.duration):(n.timer.restart(l),n.state=tr,1),d=-1,f=o.length;++d<f;)o[d].call(e,u);n.state===tr&&(n.on.call("end",e,e.__data__,n.index,n.group),l())}function l(){n.state=fn,n.timer.stop(),delete r[t];for(var c in r)return;delete e.__transition}}function hn(e,t){var n=e.__transition,r,o,s=!0,i;if(n){t=t==null?null:t+"";for(i in n){if((r=n[i]).name!==t){s=!1;continue}o=r.state>er&&r.state<tr,r.state=fn,r.timer.stop(),r.on.call(o?"interrupt":"cancel",e,e.__data__,r.index,r.group),delete n[i]}s&&delete e.__transition}}function Kc(e){return this.each(function(){hn(this,e)})}function Jc(e,t){var n,r;return function(){var o=Oe(this,e),s=o.tween;if(s!==n){r=n=s;for(var i=0,a=r.length;i<a;++i)if(r[i].name===t){r=r.slice(),r.splice(i,1);break}}o.tween=r}}function Qc(e,t,n){var r,o;if(typeof n!="function")throw new Error;return function(){var s=Oe(this,e),i=s.tween;if(i!==r){o=(r=i).slice();for(var a={name:t,value:n},l=0,c=o.length;l<c;++l)if(o[l].name===t){o[l]=a;break}l===c&&o.push(a)}s.tween=o}}function eu(e,t){var n=this._id;if(e+="",arguments.length<2){for(var r=De(this.node(),n).tween,o=0,s=r.length,i;o<s;++o)if((i=r[o]).name===e)return i.value;return null}return this.each((t==null?Jc:Qc)(n,e,t))}function gr(e,t,n){var r=e._id;return e.each(function(){var o=Oe(this,r);(o.value||(o.value={}))[t]=n.apply(this,arguments)}),function(o){return De(o,r).value[t]}}function cs(e,t){var n;return(typeof t=="number"?Ze:t instanceof Bt?eo:(n=Bt(t))?(t=n,eo):Dc)(e,t)}function tu(e){return function(){this.removeAttribute(e)}}function nu(e){return function(){this.removeAttributeNS(e.space,e.local)}}function ru(e,t,n){var r,o=n+"",s;return function(){var i=this.getAttribute(e);return i===o?null:i===r?s:s=t(r=i,n)}}function ou(e,t,n){var r,o=n+"",s;return function(){var i=this.getAttributeNS(e.space,e.local);return i===o?null:i===r?s:s=t(r=i,n)}}function su(e,t,n){var r,o,s;return function(){var i,a=n(this),l;return a==null?void this.removeAttribute(e):(i=this.getAttribute(e),l=a+"",i===l?null:i===r&&l===o?s:(o=l,s=t(r=i,a)))}}function iu(e,t,n){var r,o,s;return function(){var i,a=n(this),l;return a==null?void this.removeAttributeNS(e.space,e.local):(i=this.getAttributeNS(e.space,e.local),l=a+"",i===l?null:i===r&&l===o?s:(o=l,s=t(r=i,a)))}}function au(e,t){var n=Sn(e),r=n==="transform"?Lc:cs;return this.attrTween(e,typeof t=="function"?(n.local?iu:su)(n,r,gr(this,"attr."+e,t)):t==null?(n.local?nu:tu)(n):(n.local?ou:ru)(n,r,t))}function lu(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}function cu(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}function uu(e,t){var n,r;function o(){var s=t.apply(this,arguments);return s!==r&&(n=(r=s)&&cu(e,s)),n}return o._value=t,o}function du(e,t){var n,r;function o(){var s=t.apply(this,arguments);return s!==r&&(n=(r=s)&&lu(e,s)),n}return o._value=t,o}function fu(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;var r=Sn(e);return this.tween(n,(r.local?uu:du)(r,t))}function hu(e,t){return function(){pr(this,e).delay=+t.apply(this,arguments)}}function pu(e,t){return t=+t,function(){pr(this,e).delay=t}}function gu(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?hu:pu)(t,e)):De(this.node(),t).delay}function mu(e,t){return function(){Oe(this,e).duration=+t.apply(this,arguments)}}function yu(e,t){return t=+t,function(){Oe(this,e).duration=t}}function xu(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?mu:yu)(t,e)):De(this.node(),t).duration}function wu(e,t){if(typeof t!="function")throw new Error;return function(){Oe(this,e).ease=t}}function bu(e){var t=this._id;return arguments.length?this.each(wu(t,e)):De(this.node(),t).ease}function vu(e,t){return function(){var n=t.apply(this,arguments);if(typeof n!="function")throw new Error;Oe(this,e).ease=n}}function Eu(e){if(typeof e!="function")throw new Error;return this.each(vu(this._id,e))}function Nu(e){typeof e!="function"&&(e=zo(e));for(var t=this._groups,n=t.length,r=new Array(n),o=0;o<n;++o)for(var s=t[o],i=s.length,a=r[o]=[],l,c=0;c<i;++c)(l=s[c])&&e.call(l,l.__data__,c,s)&&a.push(l);return new Ue(r,this._parents,this._name,this._id)}function Su(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,r=t.length,o=n.length,s=Math.min(r,o),i=new Array(r),a=0;a<s;++a)for(var l=t[a],c=n[a],u=l.length,d=i[a]=new Array(u),f,g=0;g<u;++g)(f=l[g]||c[g])&&(d[g]=f);for(;a<r;++a)i[a]=t[a];return new Ue(i,this._parents,this._name,this._id)}function Cu(e){return(e+"").trim().split(/^|\s+/).every(function(t){var n=t.indexOf(".");return n>=0&&(t=t.slice(0,n)),!t||t==="start"})}function _u(e,t,n){var r,o,s=Cu(t)?pr:Oe;return function(){var i=s(this,e),a=i.on;a!==r&&(o=(r=a).copy()).on(t,n),i.on=o}}function $u(e,t){var n=this._id;return arguments.length<2?De(this.node(),n).on.on(e):this.each(_u(n,e,t))}function ku(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}function Iu(){return this.on("end.remove",ku(this._id))}function Ru(e){var t=this._name,n=this._id;typeof e!="function"&&(e=ur(e));for(var r=this._groups,o=r.length,s=new Array(o),i=0;i<o;++i)for(var a=r[i],l=a.length,c=s[i]=new Array(l),u,d,f=0;f<l;++f)(u=a[f])&&(d=e.call(u,u.__data__,f,a))&&("__data__"in u&&(d.__data__=u.__data__),c[f]=d,_n(c[f],t,n,f,c,De(u,n)));return new Ue(s,this._parents,t,n)}function ju(e){var t=this._name,n=this._id;typeof e!="function"&&(e=Ho(e));for(var r=this._groups,o=r.length,s=[],i=[],a=0;a<o;++a)for(var l=r[a],c=l.length,u,d=0;d<c;++d)if(u=l[d]){for(var f=e.call(u,u.__data__,d,l),g,b=De(u,n),x=0,w=f.length;x<w;++x)(g=f[x])&&_n(g,t,n,x,f,b);s.push(f),i.push(u)}return new Ue(s,i,t,n)}var Tu=Zt.prototype.constructor;function Au(){return new Tu(this._groups,this._parents)}function Mu(e,t){var n,r,o;return function(){var s=St(this,e),i=(this.style.removeProperty(e),St(this,e));return s===i?null:s===n&&i===r?o:o=t(n=s,r=i)}}function us(e){return function(){this.style.removeProperty(e)}}function Du(e,t,n){var r,o=n+"",s;return function(){var i=St(this,e);return i===o?null:i===r?s:s=t(r=i,n)}}function Vu(e,t,n){var r,o,s;return function(){var i=St(this,e),a=n(this),l=a+"";return a==null&&(l=a=(this.style.removeProperty(e),St(this,e))),i===l?null:i===r&&l===o?s:(o=l,s=t(r=i,a))}}function Pu(e,t){var n,r,o,s="style."+t,i="end."+s,a;return function(){var l=Oe(this,e),c=l.on,u=l.value[s]==null?a||(a=us(t)):void 0;(c!==n||o!==u)&&(r=(n=c).copy()).on(i,o=u),l.on=r}}function Ou(e,t,n){var r=(e+="")=="transform"?Oc:cs;return t==null?this.styleTween(e,Mu(e,r)).on("end.style."+e,us(e)):typeof t=="function"?this.styleTween(e,Vu(e,r,gr(this,"style."+e,t))).each(Pu(this._id,e)):this.styleTween(e,Du(e,r,t),n).on("end.style."+e,null)}function Lu(e,t,n){return function(r){this.style.setProperty(e,t.call(this,r),n)}}function Hu(e,t,n){var r,o;function s(){var i=t.apply(this,arguments);return i!==o&&(r=(o=i)&&Lu(e,i,n)),r}return s._value=t,s}function zu(e,t,n){var r="style."+(e+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(t==null)return this.tween(r,null);if(typeof t!="function")throw new Error;return this.tween(r,Hu(e,t,n??""))}function Fu(e){return function(){this.textContent=e}}function Bu(e){return function(){var t=e(this);this.textContent=t??""}}function Wu(e){return this.tween("text",typeof e=="function"?Bu(gr(this,"text",e)):Fu(e==null?"":e+""))}function Uu(e){return function(t){this.textContent=e.call(this,t)}}function Gu(e){var t,n;function r(){var o=e.apply(this,arguments);return o!==n&&(t=(n=o)&&Uu(o)),t}return r._value=e,r}function Xu(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,Gu(e))}function Yu(){for(var e=this._name,t=this._id,n=ds(),r=this._groups,o=r.length,s=0;s<o;++s)for(var i=r[s],a=i.length,l,c=0;c<a;++c)if(l=i[c]){var u=De(l,t);_n(l,e,n,c,i,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new Ue(r,this._parents,e,n)}function Zu(){var e,t,n=this,r=n._id,o=n.size();return new Promise(function(s,i){var a={value:i},l={value:function(){--o===0&&s()}};n.each(function(){var c=Oe(this,r),u=c.on;u!==e&&(t=(e=u).copy(),t._.cancel.push(a),t._.interrupt.push(a),t._.end.push(l)),c.on=t}),o===0&&s()})}var qu=0;function Ue(e,t,n,r){this._groups=e,this._parents=t,this._name=n,this._id=r}function ds(){return++qu}var Fe=Zt.prototype;Ue.prototype={constructor:Ue,select:Ru,selectAll:ju,selectChild:Fe.selectChild,selectChildren:Fe.selectChildren,filter:Nu,merge:Su,selection:Au,transition:Yu,call:Fe.call,nodes:Fe.nodes,node:Fe.node,size:Fe.size,empty:Fe.empty,each:Fe.each,on:$u,attr:au,attrTween:fu,style:Ou,styleTween:zu,text:Wu,textTween:Xu,remove:Iu,tween:eu,delay:gu,duration:xu,ease:bu,easeVarying:Eu,end:Zu,[Symbol.iterator]:Fe[Symbol.iterator]};function Ku(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var Ju={time:null,delay:0,duration:250,ease:Ku};function Qu(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}function ed(e){var t,n;e instanceof Ue?(t=e._id,e=e._name):(t=ds(),(n=Ju).time=hr(),e=e==null?null:e+"");for(var r=this._groups,o=r.length,s=0;s<o;++s)for(var i=r[s],a=i.length,l,c=0;c<a;++c)(l=i[c])&&_n(l,e,t,c,i,n||Qu(l,t));return new Ue(r,this._parents,e,t)}Zt.prototype.interrupt=Kc;Zt.prototype.transition=ed;const rn=e=>()=>e;function td(e,{sourceEvent:t,target:n,transform:r,dispatch:o}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:o}})}function Be(e,t,n){this.k=e,this.x=t,this.y=n}Be.prototype={constructor:Be,scale:function(e){return e===1?this:new Be(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new Be(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var We=new Be(1,0,0);Be.prototype;function Ln(e){e.stopImmediatePropagation()}function At(e){e.preventDefault(),e.stopImmediatePropagation()}function nd(e){return(!e.ctrlKey||e.type==="wheel")&&!e.button}function rd(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function ao(){return this.__zoom||We}function od(e){return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function sd(){return navigator.maxTouchPoints||"ontouchstart"in this}function id(e,t,n){var r=e.invertX(t[0][0])-n[0][0],o=e.invertX(t[1][0])-n[1][0],s=e.invertY(t[0][1])-n[0][1],i=e.invertY(t[1][1])-n[1][1];return e.translate(o>r?(r+o)/2:Math.min(0,r)||Math.max(0,o),i>s?(s+i)/2:Math.min(0,s)||Math.max(0,i))}function fs(){var e=nd,t=rd,n=id,r=od,o=sd,s=[0,1/0],i=[[-1/0,-1/0],[1/0,1/0]],a=250,l=Bc,c=Nn("start","zoom","end"),u,d,f,g=500,b=150,x=0,w=10;function m(y){y.property("__zoom",ao).on("wheel.zoom",O,{passive:!1}).on("mousedown.zoom",A).on("dblclick.zoom",L).filter(o).on("touchstart.zoom",H).on("touchmove.zoom",W).on("touchend.zoom touchcancel.zoom",z).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}m.transform=function(y,k,_,P){var F=y.selection?y.selection():y;F.property("__zoom",ao),y!==F?E(y,k,_,P):F.interrupt().each(function(){C(this,arguments).event(P).start().zoom(null,typeof k=="function"?k.apply(this,arguments):k).end()})},m.scaleBy=function(y,k,_,P){m.scaleTo(y,function(){var F=this.__zoom.k,$=typeof k=="function"?k.apply(this,arguments):k;return F*$},_,P)},m.scaleTo=function(y,k,_,P){m.transform(y,function(){var F=t.apply(this,arguments),$=this.__zoom,V=_==null?v(F):typeof _=="function"?_.apply(this,arguments):_,I=$.invert(V),T=typeof k=="function"?k.apply(this,arguments):k;return n(S(N($,T),V,I),F,i)},_,P)},m.translateBy=function(y,k,_,P){m.transform(y,function(){return n(this.__zoom.translate(typeof k=="function"?k.apply(this,arguments):k,typeof _=="function"?_.apply(this,arguments):_),t.apply(this,arguments),i)},null,P)},m.translateTo=function(y,k,_,P,F){m.transform(y,function(){var $=t.apply(this,arguments),V=this.__zoom,I=P==null?v($):typeof P=="function"?P.apply(this,arguments):P;return n(We.translate(I[0],I[1]).scale(V.k).translate(typeof k=="function"?-k.apply(this,arguments):-k,typeof _=="function"?-_.apply(this,arguments):-_),$,i)},P,F)};function N(y,k){return k=Math.max(s[0],Math.min(s[1],k)),k===y.k?y:new Be(k,y.x,y.y)}function S(y,k,_){var P=k[0]-_[0]*y.k,F=k[1]-_[1]*y.k;return P===y.x&&F===y.y?y:new Be(y.k,P,F)}function v(y){return[(+y[0][0]+ +y[1][0])/2,(+y[0][1]+ +y[1][1])/2]}function E(y,k,_,P){y.on("start.zoom",function(){C(this,arguments).event(P).start()}).on("interrupt.zoom end.zoom",function(){C(this,arguments).event(P).end()}).tween("zoom",function(){var F=this,$=arguments,V=C(F,$).event(P),I=t.apply(F,$),T=_==null?v(I):typeof _=="function"?_.apply(F,$):_,R=Math.max(I[1][0]-I[0][0],I[1][1]-I[0][1]),D=F.__zoom,B=typeof k=="function"?k.apply(F,$):k,U=l(D.invert(T).concat(R/D.k),B.invert(T).concat(R/B.k));return function(q){if(q===1)q=B;else{var Z=U(q),K=R/Z[2];q=new Be(K,T[0]-Z[0]*K,T[1]-Z[1]*K)}V.zoom(null,q)}})}function C(y,k,_){return!_&&y.__zooming||new M(y,k)}function M(y,k){this.that=y,this.args=k,this.active=0,this.sourceEvent=null,this.extent=t.apply(y,k),this.taps=0}M.prototype={event:function(y){return y&&(this.sourceEvent=y),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(y,k){return this.mouse&&y!=="mouse"&&(this.mouse[1]=k.invert(this.mouse[0])),this.touch0&&y!=="touch"&&(this.touch0[1]=k.invert(this.touch0[0])),this.touch1&&y!=="touch"&&(this.touch1[1]=k.invert(this.touch1[0])),this.that.__zoom=k,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(y){var k=_e(this.that).datum();c.call(y,this.that,new td(y,{sourceEvent:this.sourceEvent,target:m,transform:this.that.__zoom,dispatch:c}),k)}};function O(y,...k){if(!e.apply(this,arguments))return;var _=C(this,k).event(y),P=this.__zoom,F=Math.max(s[0],Math.min(s[1],P.k*Math.pow(2,r.apply(this,arguments)))),$=Te(y);if(_.wheel)(_.mouse[0][0]!==$[0]||_.mouse[0][1]!==$[1])&&(_.mouse[1]=P.invert(_.mouse[0]=$)),clearTimeout(_.wheel);else{if(P.k===F)return;_.mouse=[$,P.invert($)],hn(this),_.start()}At(y),_.wheel=setTimeout(V,b),_.zoom("mouse",n(S(N(P,F),_.mouse[0],_.mouse[1]),_.extent,i));function V(){_.wheel=null,_.end()}}function A(y,...k){if(f||!e.apply(this,arguments))return;var _=y.currentTarget,P=C(this,k,!0).event(y),F=_e(y.view).on("mousemove.zoom",T,!0).on("mouseup.zoom",R,!0),$=Te(y,_),V=y.clientX,I=y.clientY;Ko(y.view),Ln(y),P.mouse=[$,this.__zoom.invert($)],hn(this),P.start();function T(D){if(At(D),!P.moved){var B=D.clientX-V,U=D.clientY-I;P.moved=B*B+U*U>x}P.event(D).zoom("mouse",n(S(P.that.__zoom,P.mouse[0]=Te(D,_),P.mouse[1]),P.extent,i))}function R(D){F.on("mousemove.zoom mouseup.zoom",null),Jo(D.view,P.moved),At(D),P.event(D).end()}}function L(y,...k){if(e.apply(this,arguments)){var _=this.__zoom,P=Te(y.changedTouches?y.changedTouches[0]:y,this),F=_.invert(P),$=_.k*(y.shiftKey?.5:2),V=n(S(N(_,$),P,F),t.apply(this,k),i);At(y),a>0?_e(this).transition().duration(a).call(E,V,P,y):_e(this).call(m.transform,V,P,y)}}function H(y,...k){if(e.apply(this,arguments)){var _=y.touches,P=_.length,F=C(this,k,y.changedTouches.length===P).event(y),$,V,I,T;for(Ln(y),V=0;V<P;++V)I=_[V],T=Te(I,this),T=[T,this.__zoom.invert(T),I.identifier],F.touch0?!F.touch1&&F.touch0[2]!==T[2]&&(F.touch1=T,F.taps=0):(F.touch0=T,$=!0,F.taps=1+!!u);u&&(u=clearTimeout(u)),$&&(F.taps<2&&(d=T[0],u=setTimeout(function(){u=null},g)),hn(this),F.start())}}function W(y,...k){if(this.__zooming){var _=C(this,k).event(y),P=y.changedTouches,F=P.length,$,V,I,T;for(At(y),$=0;$<F;++$)V=P[$],I=Te(V,this),_.touch0&&_.touch0[2]===V.identifier?_.touch0[0]=I:_.touch1&&_.touch1[2]===V.identifier&&(_.touch1[0]=I);if(V=_.that.__zoom,_.touch1){var R=_.touch0[0],D=_.touch0[1],B=_.touch1[0],U=_.touch1[1],q=(q=B[0]-R[0])*q+(q=B[1]-R[1])*q,Z=(Z=U[0]-D[0])*Z+(Z=U[1]-D[1])*Z;V=N(V,Math.sqrt(q/Z)),I=[(R[0]+B[0])/2,(R[1]+B[1])/2],T=[(D[0]+U[0])/2,(D[1]+U[1])/2]}else if(_.touch0)I=_.touch0[0],T=_.touch0[1];else return;_.zoom("touch",n(S(V,I,T),_.extent,i))}}function z(y,...k){if(this.__zooming){var _=C(this,k).event(y),P=y.changedTouches,F=P.length,$,V;for(Ln(y),f&&clearTimeout(f),f=setTimeout(function(){f=null},g),$=0;$<F;++$)V=P[$],_.touch0&&_.touch0[2]===V.identifier?delete _.touch0:_.touch1&&_.touch1[2]===V.identifier&&delete _.touch1;if(_.touch1&&!_.touch0&&(_.touch0=_.touch1,delete _.touch1),_.touch0)_.touch0[1]=this.__zoom.invert(_.touch0[0]);else if(_.end(),_.taps===2&&(V=Te(V,this),Math.hypot(d[0]-V[0],d[1]-V[1])<w)){var I=_e(this).on("dblclick.zoom");I&&I.apply(this,arguments)}}}return m.wheelDelta=function(y){return arguments.length?(r=typeof y=="function"?y:rn(+y),m):r},m.filter=function(y){return arguments.length?(e=typeof y=="function"?y:rn(!!y),m):e},m.touchable=function(y){return arguments.length?(o=typeof y=="function"?y:rn(!!y),m):o},m.extent=function(y){return arguments.length?(t=typeof y=="function"?y:rn([[+y[0][0],+y[0][1]],[+y[1][0],+y[1][1]]]),m):t},m.scaleExtent=function(y){return arguments.length?(s[0]=+y[0],s[1]=+y[1],m):[s[0],s[1]]},m.translateExtent=function(y){return arguments.length?(i[0][0]=+y[0][0],i[1][0]=+y[1][0],i[0][1]=+y[0][1],i[1][1]=+y[1][1],m):[[i[0][0],i[0][1]],[i[1][0],i[1][1]]]},m.constrain=function(y){return arguments.length?(n=y,m):n},m.duration=function(y){return arguments.length?(a=+y,m):a},m.interpolate=function(y){return arguments.length?(l=y,m):l},m.on=function(){var y=c.on.apply(c,arguments);return y===c?m:y},m.clickDistance=function(y){return arguments.length?(x=(y=+y)*y,m):Math.sqrt(x)},m.tapDistance=function(y){return arguments.length?(w=+y,m):w},m}const $n=h.createContext(null),ad=$n.Provider,Ge={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:e=>`Node type "${e}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:e=>`The old edge with id=${e} does not exist.`,error009:e=>`Marker type "${e}" doesn't exist.`,error008:(e,t)=>`Couldn't create edge for ${e?"target":"source"} handle id: "${e?t.targetHandle:t.sourceHandle}", edge id: ${t.id}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:e=>`Edge type "${e}" not found. Using fallback type "default".`,error012:e=>`Node with id "${e}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`},hs=Ge.error001();function ee(e,t){const n=h.useContext($n);if(n===null)throw new Error(hs);return Oo(n,e,t)}const ue=()=>{const e=h.useContext($n);if(e===null)throw new Error(hs);return h.useMemo(()=>({getState:e.getState,setState:e.setState,subscribe:e.subscribe,destroy:e.destroy}),[e])},ld=e=>e.userSelectionActive?"none":"all";function mr({position:e,children:t,className:n,style:r,...o}){const s=ee(ld),i=`${e}`.split("-");return j.createElement("div",{className:ge(["react-flow__panel",n,...i]),style:{...r,pointerEvents:s},...o},t)}function cd({proOptions:e,position:t="bottom-right"}){return e!=null&&e.hideAttribution?null:j.createElement(mr,{position:t,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://reactflow.dev/pro"},j.createElement("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution"},"React Flow"))}const ud=({x:e,y:t,label:n,labelStyle:r={},labelShowBg:o=!0,labelBgStyle:s={},labelBgPadding:i=[2,4],labelBgBorderRadius:a=2,children:l,className:c,...u})=>{const d=h.useRef(null),[f,g]=h.useState({x:0,y:0,width:0,height:0}),b=ge(["react-flow__edge-textwrapper",c]);return h.useEffect(()=>{if(d.current){const x=d.current.getBBox();g({x:x.x,y:x.y,width:x.width,height:x.height})}},[n]),typeof n>"u"||!n?null:j.createElement("g",{transform:`translate(${e-f.width/2} ${t-f.height/2})`,className:b,visibility:f.width?"visible":"hidden",...u},o&&j.createElement("rect",{width:f.width+2*i[0],x:-i[0],y:-i[1],height:f.height+2*i[1],className:"react-flow__edge-textbg",style:s,rx:a,ry:a}),j.createElement("text",{className:"react-flow__edge-text",y:f.height/2,dy:"0.3em",ref:d,style:r},n),l)};var dd=h.memo(ud);const yr=e=>({width:e.offsetWidth,height:e.offsetHeight}),_t=(e,t=0,n=1)=>Math.min(Math.max(e,t),n),xr=(e={x:0,y:0},t)=>({x:_t(e.x,t[0][0],t[1][0]),y:_t(e.y,t[0][1],t[1][1])}),lo=(e,t,n)=>e<t?_t(Math.abs(e-t),1,50)/50:e>n?-_t(Math.abs(e-n),1,50)/50:0,ps=(e,t)=>{const n=lo(e.x,35,t.width-35)*20,r=lo(e.y,35,t.height-35)*20;return[n,r]},gs=e=>{var t;return((t=e.getRootNode)==null?void 0:t.call(e))||(window==null?void 0:window.document)},ms=(e,t)=>({x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),x2:Math.max(e.x2,t.x2),y2:Math.max(e.y2,t.y2)}),Ut=({x:e,y:t,width:n,height:r})=>({x:e,y:t,x2:e+n,y2:t+r}),ys=({x:e,y:t,x2:n,y2:r})=>({x:e,y:t,width:n-e,height:r-t}),co=e=>({...e.positionAbsolute||{x:0,y:0},width:e.width||0,height:e.height||0}),fd=(e,t)=>ys(ms(Ut(e),Ut(t))),nr=(e,t)=>{const n=Math.max(0,Math.min(e.x+e.width,t.x+t.width)-Math.max(e.x,t.x)),r=Math.max(0,Math.min(e.y+e.height,t.y+t.height)-Math.max(e.y,t.y));return Math.ceil(n*r)},hd=e=>$e(e.width)&&$e(e.height)&&$e(e.x)&&$e(e.y),$e=e=>!isNaN(e)&&isFinite(e),se=Symbol.for("internals"),xs=["Enter"," ","Escape"],pd=(e,t)=>{},gd=e=>"nativeEvent"in e;function rr(e){var o,s;const t=gd(e)?e.nativeEvent:e,n=((s=(o=t.composedPath)==null?void 0:o.call(t))==null?void 0:s[0])||e.target;return["INPUT","SELECT","TEXTAREA"].includes(n==null?void 0:n.nodeName)||(n==null?void 0:n.hasAttribute("contenteditable"))||!!(n!=null&&n.closest(".nokey"))}const ws=e=>"clientX"in e,Je=(e,t)=>{var s,i;const n=ws(e),r=n?e.clientX:(s=e.touches)==null?void 0:s[0].clientX,o=n?e.clientY:(i=e.touches)==null?void 0:i[0].clientY;return{x:r-((t==null?void 0:t.left)??0),y:o-((t==null?void 0:t.top)??0)}},bn=()=>{var e;return typeof navigator<"u"&&((e=navigator==null?void 0:navigator.userAgent)==null?void 0:e.indexOf("Mac"))>=0},kt=({id:e,path:t,labelX:n,labelY:r,label:o,labelStyle:s,labelShowBg:i,labelBgStyle:a,labelBgPadding:l,labelBgBorderRadius:c,style:u,markerEnd:d,markerStart:f,interactionWidth:g=20})=>j.createElement(j.Fragment,null,j.createElement("path",{id:e,style:u,d:t,fill:"none",className:"react-flow__edge-path",markerEnd:d,markerStart:f}),g&&j.createElement("path",{d:t,fill:"none",strokeOpacity:0,strokeWidth:g,className:"react-flow__edge-interaction"}),o&&$e(n)&&$e(r)?j.createElement(dd,{x:n,y:r,label:o,labelStyle:s,labelShowBg:i,labelBgStyle:a,labelBgPadding:l,labelBgBorderRadius:c}):null);kt.displayName="BaseEdge";function Mt(e,t,n){return n===void 0?n:r=>{const o=t().edges.find(s=>s.id===e);o&&n(r,{...o})}}function bs({sourceX:e,sourceY:t,targetX:n,targetY:r}){const o=Math.abs(n-e)/2,s=n<e?n+o:n-o,i=Math.abs(r-t)/2,a=r<t?r+i:r-i;return[s,a,o,i]}function vs({sourceX:e,sourceY:t,targetX:n,targetY:r,sourceControlX:o,sourceControlY:s,targetControlX:i,targetControlY:a}){const l=e*.125+o*.375+i*.375+n*.125,c=t*.125+s*.375+a*.375+r*.125,u=Math.abs(l-e),d=Math.abs(c-t);return[l,c,u,d]}var dt;(function(e){e.Strict="strict",e.Loose="loose"})(dt||(dt={}));var at;(function(e){e.Free="free",e.Vertical="vertical",e.Horizontal="horizontal"})(at||(at={}));var Gt;(function(e){e.Partial="partial",e.Full="full"})(Gt||(Gt={}));var Ke;(function(e){e.Bezier="default",e.Straight="straight",e.Step="step",e.SmoothStep="smoothstep",e.SimpleBezier="simplebezier"})(Ke||(Ke={}));var vn;(function(e){e.Arrow="arrow",e.ArrowClosed="arrowclosed"})(vn||(vn={}));var G;(function(e){e.Left="left",e.Top="top",e.Right="right",e.Bottom="bottom"})(G||(G={}));function uo({pos:e,x1:t,y1:n,x2:r,y2:o}){return e===G.Left||e===G.Right?[.5*(t+r),n]:[t,.5*(n+o)]}function Es({sourceX:e,sourceY:t,sourcePosition:n=G.Bottom,targetX:r,targetY:o,targetPosition:s=G.Top}){const[i,a]=uo({pos:n,x1:e,y1:t,x2:r,y2:o}),[l,c]=uo({pos:s,x1:r,y1:o,x2:e,y2:t}),[u,d,f,g]=vs({sourceX:e,sourceY:t,targetX:r,targetY:o,sourceControlX:i,sourceControlY:a,targetControlX:l,targetControlY:c});return[`M${e},${t} C${i},${a} ${l},${c} ${r},${o}`,u,d,f,g]}const wr=h.memo(({sourceX:e,sourceY:t,targetX:n,targetY:r,sourcePosition:o=G.Bottom,targetPosition:s=G.Top,label:i,labelStyle:a,labelShowBg:l,labelBgStyle:c,labelBgPadding:u,labelBgBorderRadius:d,style:f,markerEnd:g,markerStart:b,interactionWidth:x})=>{const[w,m,N]=Es({sourceX:e,sourceY:t,sourcePosition:o,targetX:n,targetY:r,targetPosition:s});return j.createElement(kt,{path:w,labelX:m,labelY:N,label:i,labelStyle:a,labelShowBg:l,labelBgStyle:c,labelBgPadding:u,labelBgBorderRadius:d,style:f,markerEnd:g,markerStart:b,interactionWidth:x})});wr.displayName="SimpleBezierEdge";const fo={[G.Left]:{x:-1,y:0},[G.Right]:{x:1,y:0},[G.Top]:{x:0,y:-1},[G.Bottom]:{x:0,y:1}},md=({source:e,sourcePosition:t=G.Bottom,target:n})=>t===G.Left||t===G.Right?e.x<n.x?{x:1,y:0}:{x:-1,y:0}:e.y<n.y?{x:0,y:1}:{x:0,y:-1},ho=(e,t)=>Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2));function yd({source:e,sourcePosition:t=G.Bottom,target:n,targetPosition:r=G.Top,center:o,offset:s}){const i=fo[t],a=fo[r],l={x:e.x+i.x*s,y:e.y+i.y*s},c={x:n.x+a.x*s,y:n.y+a.y*s},u=md({source:l,sourcePosition:t,target:c}),d=u.x!==0?"x":"y",f=u[d];let g=[],b,x;const w={x:0,y:0},m={x:0,y:0},[N,S,v,E]=bs({sourceX:e.x,sourceY:e.y,targetX:n.x,targetY:n.y});if(i[d]*a[d]===-1){b=o.x??N,x=o.y??S;const M=[{x:b,y:l.y},{x:b,y:c.y}],O=[{x:l.x,y:x},{x:c.x,y:x}];i[d]===f?g=d==="x"?M:O:g=d==="x"?O:M}else{const M=[{x:l.x,y:c.y}],O=[{x:c.x,y:l.y}];if(d==="x"?g=i.x===f?O:M:g=i.y===f?M:O,t===r){const z=Math.abs(e[d]-n[d]);if(z<=s){const y=Math.min(s-1,s-z);i[d]===f?w[d]=(l[d]>e[d]?-1:1)*y:m[d]=(c[d]>n[d]?-1:1)*y}}if(t!==r){const z=d==="x"?"y":"x",y=i[d]===a[z],k=l[z]>c[z],_=l[z]<c[z];(i[d]===1&&(!y&&k||y&&_)||i[d]!==1&&(!y&&_||y&&k))&&(g=d==="x"?M:O)}const A={x:l.x+w.x,y:l.y+w.y},L={x:c.x+m.x,y:c.y+m.y},H=Math.max(Math.abs(A.x-g[0].x),Math.abs(L.x-g[0].x)),W=Math.max(Math.abs(A.y-g[0].y),Math.abs(L.y-g[0].y));H>=W?(b=(A.x+L.x)/2,x=g[0].y):(b=g[0].x,x=(A.y+L.y)/2)}return[[e,{x:l.x+w.x,y:l.y+w.y},...g,{x:c.x+m.x,y:c.y+m.y},n],b,x,v,E]}function xd(e,t,n,r){const o=Math.min(ho(e,t)/2,ho(t,n)/2,r),{x:s,y:i}=t;if(e.x===s&&s===n.x||e.y===i&&i===n.y)return`L${s} ${i}`;if(e.y===i){const c=e.x<n.x?-1:1,u=e.y<n.y?1:-1;return`L ${s+o*c},${i}Q ${s},${i} ${s},${i+o*u}`}const a=e.x<n.x?1:-1,l=e.y<n.y?-1:1;return`L ${s},${i+o*l}Q ${s},${i} ${s+o*a},${i}`}function or({sourceX:e,sourceY:t,sourcePosition:n=G.Bottom,targetX:r,targetY:o,targetPosition:s=G.Top,borderRadius:i=5,centerX:a,centerY:l,offset:c=20}){const[u,d,f,g,b]=yd({source:{x:e,y:t},sourcePosition:n,target:{x:r,y:o},targetPosition:s,center:{x:a,y:l},offset:c});return[u.reduce((w,m,N)=>{let S="";return N>0&&N<u.length-1?S=xd(u[N-1],m,u[N+1],i):S=`${N===0?"M":"L"}${m.x} ${m.y}`,w+=S,w},""),d,f,g,b]}const kn=h.memo(({sourceX:e,sourceY:t,targetX:n,targetY:r,label:o,labelStyle:s,labelShowBg:i,labelBgStyle:a,labelBgPadding:l,labelBgBorderRadius:c,style:u,sourcePosition:d=G.Bottom,targetPosition:f=G.Top,markerEnd:g,markerStart:b,pathOptions:x,interactionWidth:w})=>{const[m,N,S]=or({sourceX:e,sourceY:t,sourcePosition:d,targetX:n,targetY:r,targetPosition:f,borderRadius:x==null?void 0:x.borderRadius,offset:x==null?void 0:x.offset});return j.createElement(kt,{path:m,labelX:N,labelY:S,label:o,labelStyle:s,labelShowBg:i,labelBgStyle:a,labelBgPadding:l,labelBgBorderRadius:c,style:u,markerEnd:g,markerStart:b,interactionWidth:w})});kn.displayName="SmoothStepEdge";const br=h.memo(e=>{var t;return j.createElement(kn,{...e,pathOptions:h.useMemo(()=>{var n;return{borderRadius:0,offset:(n=e.pathOptions)==null?void 0:n.offset}},[(t=e.pathOptions)==null?void 0:t.offset])})});br.displayName="StepEdge";function wd({sourceX:e,sourceY:t,targetX:n,targetY:r}){const[o,s,i,a]=bs({sourceX:e,sourceY:t,targetX:n,targetY:r});return[`M ${e},${t}L ${n},${r}`,o,s,i,a]}const vr=h.memo(({sourceX:e,sourceY:t,targetX:n,targetY:r,label:o,labelStyle:s,labelShowBg:i,labelBgStyle:a,labelBgPadding:l,labelBgBorderRadius:c,style:u,markerEnd:d,markerStart:f,interactionWidth:g})=>{const[b,x,w]=wd({sourceX:e,sourceY:t,targetX:n,targetY:r});return j.createElement(kt,{path:b,labelX:x,labelY:w,label:o,labelStyle:s,labelShowBg:i,labelBgStyle:a,labelBgPadding:l,labelBgBorderRadius:c,style:u,markerEnd:d,markerStart:f,interactionWidth:g})});vr.displayName="StraightEdge";function on(e,t){return e>=0?.5*e:t*25*Math.sqrt(-e)}function po({pos:e,x1:t,y1:n,x2:r,y2:o,c:s}){switch(e){case G.Left:return[t-on(t-r,s),n];case G.Right:return[t+on(r-t,s),n];case G.Top:return[t,n-on(n-o,s)];case G.Bottom:return[t,n+on(o-n,s)]}}function Er({sourceX:e,sourceY:t,sourcePosition:n=G.Bottom,targetX:r,targetY:o,targetPosition:s=G.Top,curvature:i=.25}){const[a,l]=po({pos:n,x1:e,y1:t,x2:r,y2:o,c:i}),[c,u]=po({pos:s,x1:r,y1:o,x2:e,y2:t,c:i}),[d,f,g,b]=vs({sourceX:e,sourceY:t,targetX:r,targetY:o,sourceControlX:a,sourceControlY:l,targetControlX:c,targetControlY:u});return[`M${e},${t} C${a},${l} ${c},${u} ${r},${o}`,d,f,g,b]}const En=h.memo(({sourceX:e,sourceY:t,targetX:n,targetY:r,sourcePosition:o=G.Bottom,targetPosition:s=G.Top,label:i,labelStyle:a,labelShowBg:l,labelBgStyle:c,labelBgPadding:u,labelBgBorderRadius:d,style:f,markerEnd:g,markerStart:b,pathOptions:x,interactionWidth:w})=>{const[m,N,S]=Er({sourceX:e,sourceY:t,sourcePosition:o,targetX:n,targetY:r,targetPosition:s,curvature:x==null?void 0:x.curvature});return j.createElement(kt,{path:m,labelX:N,labelY:S,label:i,labelStyle:a,labelShowBg:l,labelBgStyle:c,labelBgPadding:u,labelBgBorderRadius:d,style:f,markerEnd:g,markerStart:b,interactionWidth:w})});En.displayName="BezierEdge";const Nr=h.createContext(null),bd=Nr.Provider;Nr.Consumer;const Ns=()=>h.useContext(Nr),vd=e=>"id"in e&&"source"in e&&"target"in e,Ed=({source:e,sourceHandle:t,target:n,targetHandle:r})=>`reactflow__edge-${e}${t||""}-${n}${r||""}`,sr=(e,t)=>typeof e>"u"?"":typeof e=="string"?e:`${t?`${t}__`:""}${Object.keys(e).sort().map(r=>`${r}=${e[r]}`).join("&")}`,Nd=(e,t)=>t.some(n=>n.source===e.source&&n.target===e.target&&(n.sourceHandle===e.sourceHandle||!n.sourceHandle&&!e.sourceHandle)&&(n.targetHandle===e.targetHandle||!n.targetHandle&&!e.targetHandle)),Ss=(e,t)=>{if(!e.source||!e.target)return t;let n;return vd(e)?n={...e}:n={...e,id:Ed(e)},Nd(n,t)?t:t.concat(n)},ir=({x:e,y:t},[n,r,o],s,[i,a])=>{const l={x:(e-n)/o,y:(t-r)/o};return s?{x:i*Math.round(l.x/i),y:a*Math.round(l.y/a)}:l},Cs=({x:e,y:t},[n,r,o])=>({x:e*o+n,y:t*o+r}),ct=(e,t=[0,0])=>{if(!e)return{x:0,y:0,positionAbsolute:{x:0,y:0}};const n=(e.width??0)*t[0],r=(e.height??0)*t[1],o={x:e.position.x-n,y:e.position.y-r};return{...o,positionAbsolute:e.positionAbsolute?{x:e.positionAbsolute.x-n,y:e.positionAbsolute.y-r}:o}},Kt=(e,t=[0,0])=>{if(e.length===0)return{x:0,y:0,width:0,height:0};const n=e.reduce((r,o)=>{const{x:s,y:i}=ct(o,t).positionAbsolute;return ms(r,Ut({x:s,y:i,width:o.width||0,height:o.height||0}))},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return ys(n)},_s=(e,t,[n,r,o]=[0,0,1],s=!1,i=!1,a=[0,0])=>{const l={x:(t.x-n)/o,y:(t.y-r)/o,width:t.width/o,height:t.height/o},c=[];return e.forEach(u=>{const{width:d,height:f,selectable:g=!0,hidden:b=!1}=u;if(i&&!g||b)return!1;const{positionAbsolute:x}=ct(u,a),w={x:x.x,y:x.y,width:d||0,height:f||0},m=nr(l,w),N=typeof d>"u"||typeof f>"u"||d===null||f===null,S=s&&m>0,v=(d||0)*(f||0);(N||S||m>=v||u.dragging)&&c.push(u)}),c},$s=(e,t)=>{const n=e.map(r=>r.id);return t.filter(r=>n.includes(r.source)||n.includes(r.target))},ks=(e,t,n,r,o,s=.1)=>{const i=t/(e.width*(1+s)),a=n/(e.height*(1+s)),l=Math.min(i,a),c=_t(l,r,o),u=e.x+e.width/2,d=e.y+e.height/2,f=t/2-u*c,g=n/2-d*c;return{x:f,y:g,zoom:c}},st=(e,t=0)=>e.transition().duration(t);function go(e,t,n,r){return(t[n]||[]).reduce((o,s)=>{var i,a;return`${e.id}-${s.id}-${n}`!==r&&o.push({id:s.id||null,type:n,nodeId:e.id,x:(((i=e.positionAbsolute)==null?void 0:i.x)??0)+s.x+s.width/2,y:(((a=e.positionAbsolute)==null?void 0:a.y)??0)+s.y+s.height/2}),o},[])}function Sd(e,t,n,r,o,s){const{x:i,y:a}=Je(e),c=t.elementsFromPoint(i,a).find(b=>b.classList.contains("react-flow__handle"));if(c){const b=c.getAttribute("data-nodeid");if(b){const x=Sr(void 0,c),w=c.getAttribute("data-handleid"),m=s({nodeId:b,id:w,type:x});if(m){const N=o.find(S=>S.nodeId===b&&S.type===x&&S.id===w);return{handle:{id:w,type:x,nodeId:b,x:(N==null?void 0:N.x)||n.x,y:(N==null?void 0:N.y)||n.y},validHandleResult:m}}}}let u=[],d=1/0;if(o.forEach(b=>{const x=Math.sqrt((b.x-n.x)**2+(b.y-n.y)**2);if(x<=r){const w=s(b);x<=d&&(x<d?u=[{handle:b,validHandleResult:w}]:x===d&&u.push({handle:b,validHandleResult:w}),d=x)}}),!u.length)return{handle:null,validHandleResult:Is()};if(u.length===1)return u[0];const f=u.some(({validHandleResult:b})=>b.isValid),g=u.some(({handle:b})=>b.type==="target");return u.find(({handle:b,validHandleResult:x})=>g?b.type==="target":f?x.isValid:!0)||u[0]}const Cd={source:null,target:null,sourceHandle:null,targetHandle:null},Is=()=>({handleDomNode:null,isValid:!1,connection:Cd,endHandle:null});function Rs(e,t,n,r,o,s,i){const a=o==="target",l=i.querySelector(`.react-flow__handle[data-id="${e==null?void 0:e.nodeId}-${e==null?void 0:e.id}-${e==null?void 0:e.type}"]`),c={...Is(),handleDomNode:l};if(l){const u=Sr(void 0,l),d=l.getAttribute("data-nodeid"),f=l.getAttribute("data-handleid"),g=l.classList.contains("connectable"),b=l.classList.contains("connectableend"),x={source:a?d:n,sourceHandle:a?f:r,target:a?n:d,targetHandle:a?r:f};c.connection=x,g&&b&&(t===dt.Strict?a&&u==="source"||!a&&u==="target":d!==n||f!==r)&&(c.endHandle={nodeId:d,handleId:f,type:u},c.isValid=s(x))}return c}function _d({nodes:e,nodeId:t,handleId:n,handleType:r}){return e.reduce((o,s)=>{if(s[se]){const{handleBounds:i}=s[se];let a=[],l=[];i&&(a=go(s,i,"source",`${t}-${n}-${r}`),l=go(s,i,"target",`${t}-${n}-${r}`)),o.push(...a,...l)}return o},[])}function Sr(e,t){return e||(t!=null&&t.classList.contains("target")?"target":t!=null&&t.classList.contains("source")?"source":null)}function Hn(e){e==null||e.classList.remove("valid","connecting","react-flow__handle-valid","react-flow__handle-connecting")}function $d(e,t){let n=null;return t?n="valid":e&&!t&&(n="invalid"),n}function js({event:e,handleId:t,nodeId:n,onConnect:r,isTarget:o,getState:s,setState:i,isValidConnection:a,edgeUpdaterType:l,onReconnectEnd:c}){const u=gs(e.target),{connectionMode:d,domNode:f,autoPanOnConnect:g,connectionRadius:b,onConnectStart:x,panBy:w,getNodes:m,cancelConnection:N}=s();let S=0,v;const{x:E,y:C}=Je(e),M=u==null?void 0:u.elementFromPoint(E,C),O=Sr(l,M),A=f==null?void 0:f.getBoundingClientRect();if(!A||!O)return;let L,H=Je(e,A),W=!1,z=null,y=!1,k=null;const _=_d({nodes:m(),nodeId:n,handleId:t,handleType:O}),P=()=>{if(!g)return;const[V,I]=ps(H,A);w({x:V,y:I}),S=requestAnimationFrame(P)};i({connectionPosition:H,connectionStatus:null,connectionNodeId:n,connectionHandleId:t,connectionHandleType:O,connectionStartHandle:{nodeId:n,handleId:t,type:O},connectionEndHandle:null}),x==null||x(e,{nodeId:n,handleId:t,handleType:O});function F(V){const{transform:I}=s();H=Je(V,A);const{handle:T,validHandleResult:R}=Sd(V,u,ir(H,I,!1,[1,1]),b,_,D=>Rs(D,d,n,t,o?"target":"source",a,u));if(v=T,W||(P(),W=!0),k=R.handleDomNode,z=R.connection,y=R.isValid,i({connectionPosition:v&&y?Cs({x:v.x,y:v.y},I):H,connectionStatus:$d(!!v,y),connectionEndHandle:R.endHandle}),!v&&!y&&!k)return Hn(L);z.source!==z.target&&k&&(Hn(L),L=k,k.classList.add("connecting","react-flow__handle-connecting"),k.classList.toggle("valid",y),k.classList.toggle("react-flow__handle-valid",y))}function $(V){var I,T;(v||k)&&z&&y&&(r==null||r(z)),(T=(I=s()).onConnectEnd)==null||T.call(I,V),l&&(c==null||c(V)),Hn(L),N(),cancelAnimationFrame(S),W=!1,y=!1,z=null,k=null,u.removeEventListener("mousemove",F),u.removeEventListener("mouseup",$),u.removeEventListener("touchmove",F),u.removeEventListener("touchend",$)}u.addEventListener("mousemove",F),u.addEventListener("mouseup",$),u.addEventListener("touchmove",F),u.addEventListener("touchend",$)}const mo=()=>!0,kd=e=>({connectionStartHandle:e.connectionStartHandle,connectOnClick:e.connectOnClick,noPanClassName:e.noPanClassName}),Id=(e,t,n)=>r=>{const{connectionStartHandle:o,connectionEndHandle:s,connectionClickStartHandle:i}=r;return{connecting:(o==null?void 0:o.nodeId)===e&&(o==null?void 0:o.handleId)===t&&(o==null?void 0:o.type)===n||(s==null?void 0:s.nodeId)===e&&(s==null?void 0:s.handleId)===t&&(s==null?void 0:s.type)===n,clickConnecting:(i==null?void 0:i.nodeId)===e&&(i==null?void 0:i.handleId)===t&&(i==null?void 0:i.type)===n}},Ts=h.forwardRef(({type:e="source",position:t=G.Top,isValidConnection:n,isConnectable:r=!0,isConnectableStart:o=!0,isConnectableEnd:s=!0,id:i,onConnect:a,children:l,className:c,onMouseDown:u,onTouchStart:d,...f},g)=>{var A,L;const b=i||null,x=e==="target",w=ue(),m=Ns(),{connectOnClick:N,noPanClassName:S}=ee(kd,pe),{connecting:v,clickConnecting:E}=ee(Id(m,b,e),pe);m||(L=(A=w.getState()).onError)==null||L.call(A,"010",Ge.error010());const C=H=>{const{defaultEdgeOptions:W,onConnect:z,hasDefaultEdges:y}=w.getState(),k={...W,...H};if(y){const{edges:_,setEdges:P}=w.getState();P(Ss(k,_))}z==null||z(k),a==null||a(k)},M=H=>{if(!m)return;const W=ws(H);o&&(W&&H.button===0||!W)&&js({event:H,handleId:b,nodeId:m,onConnect:C,isTarget:x,getState:w.getState,setState:w.setState,isValidConnection:n||w.getState().isValidConnection||mo}),W?u==null||u(H):d==null||d(H)},O=H=>{const{onClickConnectStart:W,onClickConnectEnd:z,connectionClickStartHandle:y,connectionMode:k,isValidConnection:_}=w.getState();if(!m||!y&&!o)return;if(!y){W==null||W(H,{nodeId:m,handleId:b,handleType:e}),w.setState({connectionClickStartHandle:{nodeId:m,type:e,handleId:b}});return}const P=gs(H.target),F=n||_||mo,{connection:$,isValid:V}=Rs({nodeId:m,id:b,type:e},k,y.nodeId,y.handleId||null,y.type,F,P);V&&C($),z==null||z(H),w.setState({connectionClickStartHandle:null})};return j.createElement("div",{"data-handleid":b,"data-nodeid":m,"data-handlepos":t,"data-id":`${m}-${b}-${e}`,className:ge(["react-flow__handle",`react-flow__handle-${t}`,"nodrag",S,c,{source:!x,target:x,connectable:r,connectablestart:o,connectableend:s,connecting:E,connectionindicator:r&&(o&&!v||s&&v)}]),onMouseDown:M,onTouchStart:M,onClick:N?O:void 0,ref:g,...f},l)});Ts.displayName="Handle";var $t=h.memo(Ts);const As=({data:e,isConnectable:t,targetPosition:n=G.Top,sourcePosition:r=G.Bottom})=>j.createElement(j.Fragment,null,j.createElement($t,{type:"target",position:n,isConnectable:t}),e==null?void 0:e.label,j.createElement($t,{type:"source",position:r,isConnectable:t}));As.displayName="DefaultNode";var ar=h.memo(As);const Ms=({data:e,isConnectable:t,sourcePosition:n=G.Bottom})=>j.createElement(j.Fragment,null,e==null?void 0:e.label,j.createElement($t,{type:"source",position:n,isConnectable:t}));Ms.displayName="InputNode";var Ds=h.memo(Ms);const Vs=({data:e,isConnectable:t,targetPosition:n=G.Top})=>j.createElement(j.Fragment,null,j.createElement($t,{type:"target",position:n,isConnectable:t}),e==null?void 0:e.label);Vs.displayName="OutputNode";var Ps=h.memo(Vs);const Cr=()=>null;Cr.displayName="GroupNode";const Rd=e=>({selectedNodes:e.getNodes().filter(t=>t.selected),selectedEdges:e.edges.filter(t=>t.selected).map(t=>({...t}))}),sn=e=>e.id;function jd(e,t){return pe(e.selectedNodes.map(sn),t.selectedNodes.map(sn))&&pe(e.selectedEdges.map(sn),t.selectedEdges.map(sn))}const Os=h.memo(({onSelectionChange:e})=>{const t=ue(),{selectedNodes:n,selectedEdges:r}=ee(Rd,jd);return h.useEffect(()=>{const o={nodes:n,edges:r};e==null||e(o),t.getState().onSelectionChange.forEach(s=>s(o))},[n,r,e]),null});Os.displayName="SelectionListener";const Td=e=>!!e.onSelectionChange;function Ad({onSelectionChange:e}){const t=ee(Td);return e||t?j.createElement(Os,{onSelectionChange:e}):null}const Md=e=>({setNodes:e.setNodes,setEdges:e.setEdges,setDefaultNodesAndEdges:e.setDefaultNodesAndEdges,setMinZoom:e.setMinZoom,setMaxZoom:e.setMaxZoom,setTranslateExtent:e.setTranslateExtent,setNodeExtent:e.setNodeExtent,reset:e.reset});function gt(e,t){h.useEffect(()=>{typeof e<"u"&&t(e)},[e])}function J(e,t,n){h.useEffect(()=>{typeof t<"u"&&n({[e]:t})},[t])}const Dd=({nodes:e,edges:t,defaultNodes:n,defaultEdges:r,onConnect:o,onConnectStart:s,onConnectEnd:i,onClickConnectStart:a,onClickConnectEnd:l,nodesDraggable:c,nodesConnectable:u,nodesFocusable:d,edgesFocusable:f,edgesUpdatable:g,elevateNodesOnSelect:b,minZoom:x,maxZoom:w,nodeExtent:m,onNodesChange:N,onEdgesChange:S,elementsSelectable:v,connectionMode:E,snapGrid:C,snapToGrid:M,translateExtent:O,connectOnClick:A,defaultEdgeOptions:L,fitView:H,fitViewOptions:W,onNodesDelete:z,onEdgesDelete:y,onNodeDrag:k,onNodeDragStart:_,onNodeDragStop:P,onSelectionDrag:F,onSelectionDragStart:$,onSelectionDragStop:V,noPanClassName:I,nodeOrigin:T,rfId:R,autoPanOnConnect:D,autoPanOnNodeDrag:B,onError:U,connectionRadius:q,isValidConnection:Z,nodeDragThreshold:K})=>{const{setNodes:X,setEdges:ne,setDefaultNodesAndEdges:oe,setMinZoom:de,setMaxZoom:ae,setTranslateExtent:ie,setNodeExtent:fe,reset:Q}=ee(Md,pe),Y=ue();return h.useEffect(()=>{const le=r==null?void 0:r.map(xe=>({...xe,...L}));return oe(n,le),()=>{Q()}},[]),J("defaultEdgeOptions",L,Y.setState),J("connectionMode",E,Y.setState),J("onConnect",o,Y.setState),J("onConnectStart",s,Y.setState),J("onConnectEnd",i,Y.setState),J("onClickConnectStart",a,Y.setState),J("onClickConnectEnd",l,Y.setState),J("nodesDraggable",c,Y.setState),J("nodesConnectable",u,Y.setState),J("nodesFocusable",d,Y.setState),J("edgesFocusable",f,Y.setState),J("edgesUpdatable",g,Y.setState),J("elementsSelectable",v,Y.setState),J("elevateNodesOnSelect",b,Y.setState),J("snapToGrid",M,Y.setState),J("snapGrid",C,Y.setState),J("onNodesChange",N,Y.setState),J("onEdgesChange",S,Y.setState),J("connectOnClick",A,Y.setState),J("fitViewOnInit",H,Y.setState),J("fitViewOnInitOptions",W,Y.setState),J("onNodesDelete",z,Y.setState),J("onEdgesDelete",y,Y.setState),J("onNodeDrag",k,Y.setState),J("onNodeDragStart",_,Y.setState),J("onNodeDragStop",P,Y.setState),J("onSelectionDrag",F,Y.setState),J("onSelectionDragStart",$,Y.setState),J("onSelectionDragStop",V,Y.setState),J("noPanClassName",I,Y.setState),J("nodeOrigin",T,Y.setState),J("rfId",R,Y.setState),J("autoPanOnConnect",D,Y.setState),J("autoPanOnNodeDrag",B,Y.setState),J("onError",U,Y.setState),J("connectionRadius",q,Y.setState),J("isValidConnection",Z,Y.setState),J("nodeDragThreshold",K,Y.setState),gt(e,X),gt(t,ne),gt(x,de),gt(w,ae),gt(O,ie),gt(m,fe),null},yo={display:"none"},Vd={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},Ls="react-flow__node-desc",Hs="react-flow__edge-desc",Pd="react-flow__aria-live",Od=e=>e.ariaLiveMessage;function Ld({rfId:e}){const t=ee(Od);return j.createElement("div",{id:`${Pd}-${e}`,"aria-live":"assertive","aria-atomic":"true",style:Vd},t)}function Hd({rfId:e,disableKeyboardA11y:t}){return j.createElement(j.Fragment,null,j.createElement("div",{id:`${Ls}-${e}`,style:yo},"Press enter or space to select a node.",!t&&"You can then use the arrow keys to move the node around."," Press delete to remove it and escape to cancel."," "),j.createElement("div",{id:`${Hs}-${e}`,style:yo},"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel."),!t&&j.createElement(Ld,{rfId:e}))}var Xt=(e=null,t={actInsideInputWithModifier:!0})=>{const[n,r]=h.useState(!1),o=h.useRef(!1),s=h.useRef(new Set([])),[i,a]=h.useMemo(()=>{if(e!==null){const c=(Array.isArray(e)?e:[e]).filter(d=>typeof d=="string").map(d=>d.split("+")),u=c.reduce((d,f)=>d.concat(...f),[]);return[c,u]}return[[],[]]},[e]);return h.useEffect(()=>{const l=typeof document<"u"?document:null,c=(t==null?void 0:t.target)||l;if(e!==null){const u=g=>{if(o.current=g.ctrlKey||g.metaKey||g.shiftKey,(!o.current||o.current&&!t.actInsideInputWithModifier)&&rr(g))return!1;const x=wo(g.code,a);s.current.add(g[x]),xo(i,s.current,!1)&&(g.preventDefault(),r(!0))},d=g=>{if((!o.current||o.current&&!t.actInsideInputWithModifier)&&rr(g))return!1;const x=wo(g.code,a);xo(i,s.current,!0)?(r(!1),s.current.clear()):s.current.delete(g[x]),g.key==="Meta"&&s.current.clear(),o.current=!1},f=()=>{s.current.clear(),r(!1)};return c==null||c.addEventListener("keydown",u),c==null||c.addEventListener("keyup",d),window.addEventListener("blur",f),()=>{c==null||c.removeEventListener("keydown",u),c==null||c.removeEventListener("keyup",d),window.removeEventListener("blur",f)}}},[e,r]),n};function xo(e,t,n){return e.filter(r=>n||r.length===t.size).some(r=>r.every(o=>t.has(o)))}function wo(e,t){return t.includes(e)?"code":"key"}function zs(e,t,n,r){var a,l;const o=e.parentNode||e.parentId;if(!o)return n;const s=t.get(o),i=ct(s,r);return zs(s,t,{x:(n.x??0)+i.x,y:(n.y??0)+i.y,z:(((a=s[se])==null?void 0:a.z)??0)>(n.z??0)?((l=s[se])==null?void 0:l.z)??0:n.z??0},r)}function Fs(e,t,n){e.forEach(r=>{var s;const o=r.parentNode||r.parentId;if(o&&!e.has(o))throw new Error(`Parent node ${o} not found`);if(o||n!=null&&n[r.id]){const{x:i,y:a,z:l}=zs(r,e,{...r.position,z:((s=r[se])==null?void 0:s.z)??0},t);r.positionAbsolute={x:i,y:a},r[se].z=l,n!=null&&n[r.id]&&(r[se].isParent=!0)}})}function zn(e,t,n,r){const o=new Map,s={},i=r?1e3:0;return e.forEach(a=>{var g;const l=($e(a.zIndex)?a.zIndex:0)+(a.selected?i:0),c=t.get(a.id),u={...a,positionAbsolute:{x:a.position.x,y:a.position.y}},d=a.parentNode||a.parentId;d&&(s[d]=!0);const f=(c==null?void 0:c.type)&&(c==null?void 0:c.type)!==a.type;Object.defineProperty(u,se,{enumerable:!1,value:{handleBounds:f||(g=c==null?void 0:c[se])==null?void 0:g.handleBounds,z:l}}),o.set(a.id,u)}),Fs(o,n,s),o}function Bs(e,t={}){const{getNodes:n,width:r,height:o,minZoom:s,maxZoom:i,d3Zoom:a,d3Selection:l,fitViewOnInitDone:c,fitViewOnInit:u,nodeOrigin:d}=e(),f=t.initial&&!c&&u;if(a&&l&&(f||!t.initial)){const b=n().filter(w=>{var N;const m=t.includeHiddenNodes?w.width&&w.height:!w.hidden;return(N=t.nodes)!=null&&N.length?m&&t.nodes.some(S=>S.id===w.id):m}),x=b.every(w=>w.width&&w.height);if(b.length>0&&x){const w=Kt(b,d),{x:m,y:N,zoom:S}=ks(w,r,o,t.minZoom??s,t.maxZoom??i,t.padding??.1),v=We.translate(m,N).scale(S);return typeof t.duration=="number"&&t.duration>0?a.transform(st(l,t.duration),v):a.transform(l,v),!0}}return!1}function zd(e,t){return e.forEach(n=>{const r=t.get(n.id);r&&t.set(r.id,{...r,[se]:r[se],selected:n.selected})}),new Map(t)}function Fd(e,t){return t.map(n=>{const r=e.find(o=>o.id===n.id);return r&&(n.selected=r.selected),n})}function an({changedNodes:e,changedEdges:t,get:n,set:r}){const{nodeInternals:o,edges:s,onNodesChange:i,onEdgesChange:a,hasDefaultNodes:l,hasDefaultEdges:c}=n();e!=null&&e.length&&(l&&r({nodeInternals:zd(e,o)}),i==null||i(e)),t!=null&&t.length&&(c&&r({edges:Fd(t,s)}),a==null||a(t))}const mt=()=>{},Bd={zoomIn:mt,zoomOut:mt,zoomTo:mt,getZoom:()=>1,setViewport:mt,getViewport:()=>({x:0,y:0,zoom:1}),fitView:()=>!1,setCenter:mt,fitBounds:mt,project:e=>e,screenToFlowPosition:e=>e,flowToScreenPosition:e=>e,viewportInitialized:!1},Wd=e=>({d3Zoom:e.d3Zoom,d3Selection:e.d3Selection}),Ud=()=>{const e=ue(),{d3Zoom:t,d3Selection:n}=ee(Wd,pe);return h.useMemo(()=>n&&t?{zoomIn:o=>t.scaleBy(st(n,o==null?void 0:o.duration),1.2),zoomOut:o=>t.scaleBy(st(n,o==null?void 0:o.duration),1/1.2),zoomTo:(o,s)=>t.scaleTo(st(n,s==null?void 0:s.duration),o),getZoom:()=>e.getState().transform[2],setViewport:(o,s)=>{const[i,a,l]=e.getState().transform,c=We.translate(o.x??i,o.y??a).scale(o.zoom??l);t.transform(st(n,s==null?void 0:s.duration),c)},getViewport:()=>{const[o,s,i]=e.getState().transform;return{x:o,y:s,zoom:i}},fitView:o=>Bs(e.getState,o),setCenter:(o,s,i)=>{const{width:a,height:l,maxZoom:c}=e.getState(),u=typeof(i==null?void 0:i.zoom)<"u"?i.zoom:c,d=a/2-o*u,f=l/2-s*u,g=We.translate(d,f).scale(u);t.transform(st(n,i==null?void 0:i.duration),g)},fitBounds:(o,s)=>{const{width:i,height:a,minZoom:l,maxZoom:c}=e.getState(),{x:u,y:d,zoom:f}=ks(o,i,a,l,c,(s==null?void 0:s.padding)??.1),g=We.translate(u,d).scale(f);t.transform(st(n,s==null?void 0:s.duration),g)},project:o=>{const{transform:s,snapToGrid:i,snapGrid:a}=e.getState();return console.warn("[DEPRECATED] `project` is deprecated. Instead use `screenToFlowPosition`. There is no need to subtract the react flow bounds anymore! https://reactflow.dev/api-reference/types/react-flow-instance#screen-to-flow-position"),ir(o,s,i,a)},screenToFlowPosition:o=>{const{transform:s,snapToGrid:i,snapGrid:a,domNode:l}=e.getState();if(!l)return o;const{x:c,y:u}=l.getBoundingClientRect(),d={x:o.x-c,y:o.y-u};return ir(d,s,i,a)},flowToScreenPosition:o=>{const{transform:s,domNode:i}=e.getState();if(!i)return o;const{x:a,y:l}=i.getBoundingClientRect(),c=Cs(o,s);return{x:c.x+a,y:c.y+l}},viewportInitialized:!0}:Bd,[t,n])};function Jt(){const e=Ud(),t=ue(),n=h.useCallback(()=>t.getState().getNodes().map(x=>({...x})),[]),r=h.useCallback(x=>t.getState().nodeInternals.get(x),[]),o=h.useCallback(()=>{const{edges:x=[]}=t.getState();return x.map(w=>({...w}))},[]),s=h.useCallback(x=>{const{edges:w=[]}=t.getState();return w.find(m=>m.id===x)},[]),i=h.useCallback(x=>{const{getNodes:w,setNodes:m,hasDefaultNodes:N,onNodesChange:S}=t.getState(),v=w(),E=typeof x=="function"?x(v):x;if(N)m(E);else if(S){const C=E.length===0?v.map(M=>({type:"remove",id:M.id})):E.map(M=>({item:M,type:"reset"}));S(C)}},[]),a=h.useCallback(x=>{const{edges:w=[],setEdges:m,hasDefaultEdges:N,onEdgesChange:S}=t.getState(),v=typeof x=="function"?x(w):x;if(N)m(v);else if(S){const E=v.length===0?w.map(C=>({type:"remove",id:C.id})):v.map(C=>({item:C,type:"reset"}));S(E)}},[]),l=h.useCallback(x=>{const w=Array.isArray(x)?x:[x],{getNodes:m,setNodes:N,hasDefaultNodes:S,onNodesChange:v}=t.getState();if(S){const C=[...m(),...w];N(C)}else if(v){const E=w.map(C=>({item:C,type:"add"}));v(E)}},[]),c=h.useCallback(x=>{const w=Array.isArray(x)?x:[x],{edges:m=[],setEdges:N,hasDefaultEdges:S,onEdgesChange:v}=t.getState();if(S)N([...m,...w]);else if(v){const E=w.map(C=>({item:C,type:"add"}));v(E)}},[]),u=h.useCallback(()=>{const{getNodes:x,edges:w=[],transform:m}=t.getState(),[N,S,v]=m;return{nodes:x().map(E=>({...E})),edges:w.map(E=>({...E})),viewport:{x:N,y:S,zoom:v}}},[]),d=h.useCallback(({nodes:x,edges:w})=>{const{nodeInternals:m,getNodes:N,edges:S,hasDefaultNodes:v,hasDefaultEdges:E,onNodesDelete:C,onEdgesDelete:M,onNodesChange:O,onEdgesChange:A}=t.getState(),L=(x||[]).map(k=>k.id),H=(w||[]).map(k=>k.id),W=N().reduce((k,_)=>{const P=_.parentNode||_.parentId,F=!L.includes(_.id)&&P&&k.find(V=>V.id===P);return(typeof _.deletable=="boolean"?_.deletable:!0)&&(L.includes(_.id)||F)&&k.push(_),k},[]),z=S.filter(k=>typeof k.deletable=="boolean"?k.deletable:!0),y=z.filter(k=>H.includes(k.id));if(W||y){const k=$s(W,z),_=[...y,...k],P=_.reduce((F,$)=>(F.includes($.id)||F.push($.id),F),[]);if((E||v)&&(E&&t.setState({edges:S.filter(F=>!P.includes(F.id))}),v&&(W.forEach(F=>{m.delete(F.id)}),t.setState({nodeInternals:new Map(m)}))),P.length>0&&(M==null||M(_),A&&A(P.map(F=>({id:F,type:"remove"})))),W.length>0&&(C==null||C(W),O)){const F=W.map($=>({id:$.id,type:"remove"}));O(F)}}},[]),f=h.useCallback(x=>{const w=hd(x),m=w?null:t.getState().nodeInternals.get(x.id);return!w&&!m?[null,null,w]:[w?x:co(m),m,w]},[]),g=h.useCallback((x,w=!0,m)=>{const[N,S,v]=f(x);return N?(m||t.getState().getNodes()).filter(E=>{if(!v&&(E.id===S.id||!E.positionAbsolute))return!1;const C=co(E),M=nr(C,N);return w&&M>0||M>=N.width*N.height}):[]},[]),b=h.useCallback((x,w,m=!0)=>{const[N]=f(x);if(!N)return!1;const S=nr(N,w);return m&&S>0||S>=N.width*N.height},[]);return h.useMemo(()=>({...e,getNodes:n,getNode:r,getEdges:o,getEdge:s,setNodes:i,setEdges:a,addNodes:l,addEdges:c,toObject:u,deleteElements:d,getIntersectingNodes:g,isNodeIntersecting:b}),[e,n,r,o,s,i,a,l,c,u,d,g,b])}const Gd={actInsideInputWithModifier:!1};var Xd=({deleteKeyCode:e,multiSelectionKeyCode:t})=>{const n=ue(),{deleteElements:r}=Jt(),o=Xt(e,Gd),s=Xt(t);h.useEffect(()=>{if(o){const{edges:i,getNodes:a}=n.getState(),l=a().filter(u=>u.selected),c=i.filter(u=>u.selected);r({nodes:l,edges:c}),n.setState({nodesSelectionActive:!1})}},[o]),h.useEffect(()=>{n.setState({multiSelectionActive:s})},[s])};function Yd(e){const t=ue();h.useEffect(()=>{let n;const r=()=>{var s,i;if(!e.current)return;const o=yr(e.current);(o.height===0||o.width===0)&&((i=(s=t.getState()).onError)==null||i.call(s,"004",Ge.error004())),t.setState({width:o.width||500,height:o.height||500})};return r(),window.addEventListener("resize",r),e.current&&(n=new ResizeObserver(()=>r()),n.observe(e.current)),()=>{window.removeEventListener("resize",r),n&&e.current&&n.unobserve(e.current)}},[])}const _r={position:"absolute",width:"100%",height:"100%",top:0,left:0},Zd=(e,t)=>e.x!==t.x||e.y!==t.y||e.zoom!==t.k,ln=e=>({x:e.x,y:e.y,zoom:e.k}),yt=(e,t)=>e.target.closest(`.${t}`),bo=(e,t)=>t===2&&Array.isArray(e)&&e.includes(2),vo=e=>{const t=e.ctrlKey&&bn()?10:1;return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*t},qd=e=>({d3Zoom:e.d3Zoom,d3Selection:e.d3Selection,d3ZoomHandler:e.d3ZoomHandler,userSelectionActive:e.userSelectionActive}),Kd=({onMove:e,onMoveStart:t,onMoveEnd:n,onPaneContextMenu:r,zoomOnScroll:o=!0,zoomOnPinch:s=!0,panOnScroll:i=!1,panOnScrollSpeed:a=.5,panOnScrollMode:l=at.Free,zoomOnDoubleClick:c=!0,elementsSelectable:u,panOnDrag:d=!0,defaultViewport:f,translateExtent:g,minZoom:b,maxZoom:x,zoomActivationKeyCode:w,preventScrolling:m=!0,children:N,noWheelClassName:S,noPanClassName:v})=>{const E=h.useRef(),C=ue(),M=h.useRef(!1),O=h.useRef(!1),A=h.useRef(null),L=h.useRef({x:0,y:0,zoom:0}),{d3Zoom:H,d3Selection:W,d3ZoomHandler:z,userSelectionActive:y}=ee(qd,pe),k=Xt(w),_=h.useRef(0),P=h.useRef(!1),F=h.useRef();return Yd(A),h.useEffect(()=>{if(A.current){const $=A.current.getBoundingClientRect(),V=fs().scaleExtent([b,x]).translateExtent(g),I=_e(A.current).call(V),T=We.translate(f.x,f.y).scale(_t(f.zoom,b,x)),R=[[0,0],[$.width,$.height]],D=V.constrain()(T,R,g);V.transform(I,D),V.wheelDelta(vo),C.setState({d3Zoom:V,d3Selection:I,d3ZoomHandler:I.on("wheel.zoom"),transform:[D.x,D.y,D.k],domNode:A.current.closest(".react-flow")})}},[]),h.useEffect(()=>{W&&H&&(i&&!k&&!y?W.on("wheel.zoom",$=>{if(yt($,S))return!1;$.preventDefault(),$.stopImmediatePropagation();const V=W.property("__zoom").k||1;if($.ctrlKey&&s){const Z=Te($),K=vo($),X=V*Math.pow(2,K);H.scaleTo(W,X,Z,$);return}const I=$.deltaMode===1?20:1;let T=l===at.Vertical?0:$.deltaX*I,R=l===at.Horizontal?0:$.deltaY*I;!bn()&&$.shiftKey&&l!==at.Vertical&&(T=$.deltaY*I,R=0),H.translateBy(W,-(T/V)*a,-(R/V)*a,{internal:!0});const D=ln(W.property("__zoom")),{onViewportChangeStart:B,onViewportChange:U,onViewportChangeEnd:q}=C.getState();clearTimeout(F.current),P.current||(P.current=!0,t==null||t($,D),B==null||B(D)),P.current&&(e==null||e($,D),U==null||U(D),F.current=setTimeout(()=>{n==null||n($,D),q==null||q(D),P.current=!1},150))},{passive:!1}):typeof z<"u"&&W.on("wheel.zoom",function($,V){if(!m&&$.type==="wheel"&&!$.ctrlKey||yt($,S))return null;$.preventDefault(),z.call(this,$,V)},{passive:!1}))},[y,i,l,W,H,z,k,s,m,S,t,e,n]),h.useEffect(()=>{H&&H.on("start",$=>{var T,R;if(!$.sourceEvent||$.sourceEvent.internal)return null;_.current=(T=$.sourceEvent)==null?void 0:T.button;const{onViewportChangeStart:V}=C.getState(),I=ln($.transform);M.current=!0,L.current=I,((R=$.sourceEvent)==null?void 0:R.type)==="mousedown"&&C.setState({paneDragging:!0}),V==null||V(I),t==null||t($.sourceEvent,I)})},[H,t]),h.useEffect(()=>{H&&(y&&!M.current?H.on("zoom",null):y||H.on("zoom",$=>{var I;const{onViewportChange:V}=C.getState();if(C.setState({transform:[$.transform.x,$.transform.y,$.transform.k]}),O.current=!!(r&&bo(d,_.current??0)),(e||V)&&!((I=$.sourceEvent)!=null&&I.internal)){const T=ln($.transform);V==null||V(T),e==null||e($.sourceEvent,T)}}))},[y,H,e,d,r]),h.useEffect(()=>{H&&H.on("end",$=>{if(!$.sourceEvent||$.sourceEvent.internal)return null;const{onViewportChangeEnd:V}=C.getState();if(M.current=!1,C.setState({paneDragging:!1}),r&&bo(d,_.current??0)&&!O.current&&r($.sourceEvent),O.current=!1,(n||V)&&Zd(L.current,$.transform)){const I=ln($.transform);L.current=I,clearTimeout(E.current),E.current=setTimeout(()=>{V==null||V(I),n==null||n($.sourceEvent,I)},i?150:0)}})},[H,i,d,n,r]),h.useEffect(()=>{H&&H.filter($=>{const V=k||o,I=s&&$.ctrlKey;if((d===!0||Array.isArray(d)&&d.includes(1))&&$.button===1&&$.type==="mousedown"&&(yt($,"react-flow__node")||yt($,"react-flow__edge")))return!0;if(!d&&!V&&!i&&!c&&!s||y||!c&&$.type==="dblclick"||yt($,S)&&$.type==="wheel"||yt($,v)&&($.type!=="wheel"||i&&$.type==="wheel"&&!k)||!s&&$.ctrlKey&&$.type==="wheel"||!V&&!i&&!I&&$.type==="wheel"||!d&&($.type==="mousedown"||$.type==="touchstart")||Array.isArray(d)&&!d.includes($.button)&&$.type==="mousedown")return!1;const T=Array.isArray(d)&&d.includes($.button)||!$.button||$.button<=1;return(!$.ctrlKey||$.type==="wheel")&&T})},[y,H,o,s,i,c,d,u,k]),j.createElement("div",{className:"react-flow__renderer",ref:A,style:_r},N)},Jd=e=>({userSelectionActive:e.userSelectionActive,userSelectionRect:e.userSelectionRect});function Qd(){const{userSelectionActive:e,userSelectionRect:t}=ee(Jd,pe);return e&&t?j.createElement("div",{className:"react-flow__selection react-flow__container",style:{width:t.width,height:t.height,transform:`translate(${t.x}px, ${t.y}px)`}}):null}function Eo(e,t){const n=t.parentNode||t.parentId,r=e.find(o=>o.id===n);if(r){const o=t.position.x+t.width-r.width,s=t.position.y+t.height-r.height;if(o>0||s>0||t.position.x<0||t.position.y<0){if(r.style={...r.style},r.style.width=r.style.width??r.width,r.style.height=r.style.height??r.height,o>0&&(r.style.width+=o),s>0&&(r.style.height+=s),t.position.x<0){const i=Math.abs(t.position.x);r.position.x=r.position.x-i,r.style.width+=i,t.position.x=0}if(t.position.y<0){const i=Math.abs(t.position.y);r.position.y=r.position.y-i,r.style.height+=i,t.position.y=0}r.width=r.style.width,r.height=r.style.height}}}function Ws(e,t){if(e.some(r=>r.type==="reset"))return e.filter(r=>r.type==="reset").map(r=>r.item);const n=e.filter(r=>r.type==="add").map(r=>r.item);return t.reduce((r,o)=>{const s=e.filter(a=>a.id===o.id);if(s.length===0)return r.push(o),r;const i={...o};for(const a of s)if(a)switch(a.type){case"select":{i.selected=a.selected;break}case"position":{typeof a.position<"u"&&(i.position=a.position),typeof a.positionAbsolute<"u"&&(i.positionAbsolute=a.positionAbsolute),typeof a.dragging<"u"&&(i.dragging=a.dragging),i.expandParent&&Eo(r,i);break}case"dimensions":{typeof a.dimensions<"u"&&(i.width=a.dimensions.width,i.height=a.dimensions.height),typeof a.updateStyle<"u"&&(i.style={...i.style||{},...a.dimensions}),typeof a.resizing=="boolean"&&(i.resizing=a.resizing),i.expandParent&&Eo(r,i);break}case"remove":return r}return r.push(i),r},n)}function Us(e,t){return Ws(e,t)}function ef(e,t){return Ws(e,t)}const qe=(e,t)=>({id:e,type:"select",selected:t});function wt(e,t){return e.reduce((n,r)=>{const o=t.includes(r.id);return!r.selected&&o?(r.selected=!0,n.push(qe(r.id,!0))):r.selected&&!o&&(r.selected=!1,n.push(qe(r.id,!1))),n},[])}const Fn=(e,t)=>n=>{n.target===t.current&&(e==null||e(n))},tf=e=>({userSelectionActive:e.userSelectionActive,elementsSelectable:e.elementsSelectable,dragging:e.paneDragging}),Gs=h.memo(({isSelecting:e,selectionMode:t=Gt.Full,panOnDrag:n,onSelectionStart:r,onSelectionEnd:o,onPaneClick:s,onPaneContextMenu:i,onPaneScroll:a,onPaneMouseEnter:l,onPaneMouseMove:c,onPaneMouseLeave:u,children:d})=>{const f=h.useRef(null),g=ue(),b=h.useRef(0),x=h.useRef(0),w=h.useRef(),{userSelectionActive:m,elementsSelectable:N,dragging:S}=ee(tf,pe),v=()=>{g.setState({userSelectionActive:!1,userSelectionRect:null}),b.current=0,x.current=0},E=z=>{s==null||s(z),g.getState().resetSelectedElements(),g.setState({nodesSelectionActive:!1})},C=z=>{if(Array.isArray(n)&&(n!=null&&n.includes(2))){z.preventDefault();return}i==null||i(z)},M=a?z=>a(z):void 0,O=z=>{const{resetSelectedElements:y,domNode:k}=g.getState();if(w.current=k==null?void 0:k.getBoundingClientRect(),!N||!e||z.button!==0||z.target!==f.current||!w.current)return;const{x:_,y:P}=Je(z,w.current);y(),g.setState({userSelectionRect:{width:0,height:0,startX:_,startY:P,x:_,y:P}}),r==null||r(z)},A=z=>{const{userSelectionRect:y,nodeInternals:k,edges:_,transform:P,onNodesChange:F,onEdgesChange:$,nodeOrigin:V,getNodes:I}=g.getState();if(!e||!w.current||!y)return;g.setState({userSelectionActive:!0,nodesSelectionActive:!1});const T=Je(z,w.current),R=y.startX??0,D=y.startY??0,B={...y,x:T.x<R?T.x:R,y:T.y<D?T.y:D,width:Math.abs(T.x-R),height:Math.abs(T.y-D)},U=I(),q=_s(k,B,P,t===Gt.Partial,!0,V),Z=$s(q,_).map(X=>X.id),K=q.map(X=>X.id);if(b.current!==K.length){b.current=K.length;const X=wt(U,K);X.length&&(F==null||F(X))}if(x.current!==Z.length){x.current=Z.length;const X=wt(_,Z);X.length&&($==null||$(X))}g.setState({userSelectionRect:B})},L=z=>{if(z.button!==0)return;const{userSelectionRect:y}=g.getState();!m&&y&&z.target===f.current&&(E==null||E(z)),g.setState({nodesSelectionActive:b.current>0}),v(),o==null||o(z)},H=z=>{m&&(g.setState({nodesSelectionActive:b.current>0}),o==null||o(z)),v()},W=N&&(e||m);return j.createElement("div",{className:ge(["react-flow__pane",{dragging:S,selection:e}]),onClick:W?void 0:Fn(E,f),onContextMenu:Fn(C,f),onWheel:Fn(M,f),onMouseEnter:W?void 0:l,onMouseDown:W?O:void 0,onMouseMove:W?A:c,onMouseUp:W?L:void 0,onMouseLeave:W?H:u,ref:f,style:_r},d,j.createElement(Qd,null))});Gs.displayName="Pane";function Xs(e,t){const n=e.parentNode||e.parentId;if(!n)return!1;const r=t.get(n);return r?r.selected?!0:Xs(r,t):!1}function No(e,t,n){let r=e;do{if(r!=null&&r.matches(t))return!0;if(r===n.current)return!1;r=r.parentElement}while(r);return!1}function nf(e,t,n,r){return Array.from(e.values()).filter(o=>(o.selected||o.id===r)&&(!o.parentNode||o.parentId||!Xs(o,e))&&(o.draggable||t&&typeof o.draggable>"u")).map(o=>{var s,i;return{id:o.id,position:o.position||{x:0,y:0},positionAbsolute:o.positionAbsolute||{x:0,y:0},distance:{x:n.x-(((s=o.positionAbsolute)==null?void 0:s.x)??0),y:n.y-(((i=o.positionAbsolute)==null?void 0:i.y)??0)},delta:{x:0,y:0},extent:o.extent,parentNode:o.parentNode||o.parentId,parentId:o.parentNode||o.parentId,width:o.width,height:o.height,expandParent:o.expandParent}})}function rf(e,t){return!t||t==="parent"?t:[t[0],[t[1][0]-(e.width||0),t[1][1]-(e.height||0)]]}function Ys(e,t,n,r,o=[0,0],s){const i=rf(e,e.extent||r);let a=i;const l=e.parentNode||e.parentId;if(e.extent==="parent"&&!e.expandParent)if(l&&e.width&&e.height){const d=n.get(l),{x:f,y:g}=ct(d,o).positionAbsolute;a=d&&$e(f)&&$e(g)&&$e(d.width)&&$e(d.height)?[[f+e.width*o[0],g+e.height*o[1]],[f+d.width-e.width+e.width*o[0],g+d.height-e.height+e.height*o[1]]]:a}else s==null||s("005",Ge.error005()),a=i;else if(e.extent&&l&&e.extent!=="parent"){const d=n.get(l),{x:f,y:g}=ct(d,o).positionAbsolute;a=[[e.extent[0][0]+f,e.extent[0][1]+g],[e.extent[1][0]+f,e.extent[1][1]+g]]}let c={x:0,y:0};if(l){const d=n.get(l);c=ct(d,o).positionAbsolute}const u=a&&a!=="parent"?xr(t,a):t;return{position:{x:u.x-c.x,y:u.y-c.y},positionAbsolute:u}}function Bn({nodeId:e,dragItems:t,nodeInternals:n}){const r=t.map(o=>({...n.get(o.id),position:o.position,positionAbsolute:o.positionAbsolute}));return[e?r.find(o=>o.id===e):r[0],r]}const So=(e,t,n,r)=>{const o=t.querySelectorAll(e);if(!o||!o.length)return null;const s=Array.from(o),i=t.getBoundingClientRect(),a={x:i.width*r[0],y:i.height*r[1]};return s.map(l=>{const c=l.getBoundingClientRect();return{id:l.getAttribute("data-handleid"),position:l.getAttribute("data-handlepos"),x:(c.left-i.left-a.x)/n,y:(c.top-i.top-a.y)/n,...yr(l)}})};function Dt(e,t,n){return n===void 0?n:r=>{const o=t().nodeInternals.get(e);o&&n(r,{...o})}}function lr({id:e,store:t,unselect:n=!1,nodeRef:r}){const{addSelectedNodes:o,unselectNodesAndEdges:s,multiSelectionActive:i,nodeInternals:a,onError:l}=t.getState(),c=a.get(e);if(!c){l==null||l("012",Ge.error012(e));return}t.setState({nodesSelectionActive:!1}),c.selected?(n||c.selected&&i)&&(s({nodes:[c],edges:[]}),requestAnimationFrame(()=>{var u;return(u=r==null?void 0:r.current)==null?void 0:u.blur()})):o([e])}function of(){const e=ue();return h.useCallback(({sourceEvent:n})=>{const{transform:r,snapGrid:o,snapToGrid:s}=e.getState(),i=n.touches?n.touches[0].clientX:n.clientX,a=n.touches?n.touches[0].clientY:n.clientY,l={x:(i-r[0])/r[2],y:(a-r[1])/r[2]};return{xSnapped:s?o[0]*Math.round(l.x/o[0]):l.x,ySnapped:s?o[1]*Math.round(l.y/o[1]):l.y,...l}},[])}function Wn(e){return(t,n,r)=>e==null?void 0:e(t,r)}function Zs({nodeRef:e,disabled:t=!1,noDragClassName:n,handleSelector:r,nodeId:o,isSelectable:s,selectNodesOnDrag:i}){const a=ue(),[l,c]=h.useState(!1),u=h.useRef([]),d=h.useRef({x:null,y:null}),f=h.useRef(0),g=h.useRef(null),b=h.useRef({x:0,y:0}),x=h.useRef(null),w=h.useRef(!1),m=h.useRef(!1),N=h.useRef(!1),S=of();return h.useEffect(()=>{if(e!=null&&e.current){const v=_e(e.current),E=({x:O,y:A})=>{const{nodeInternals:L,onNodeDrag:H,onSelectionDrag:W,updateNodePositions:z,nodeExtent:y,snapGrid:k,snapToGrid:_,nodeOrigin:P,onError:F}=a.getState();d.current={x:O,y:A};let $=!1,V={x:0,y:0,x2:0,y2:0};if(u.current.length>1&&y){const T=Kt(u.current,P);V=Ut(T)}if(u.current=u.current.map(T=>{const R={x:O-T.distance.x,y:A-T.distance.y};_&&(R.x=k[0]*Math.round(R.x/k[0]),R.y=k[1]*Math.round(R.y/k[1]));const D=[[y[0][0],y[0][1]],[y[1][0],y[1][1]]];u.current.length>1&&y&&!T.extent&&(D[0][0]=T.positionAbsolute.x-V.x+y[0][0],D[1][0]=T.positionAbsolute.x+(T.width??0)-V.x2+y[1][0],D[0][1]=T.positionAbsolute.y-V.y+y[0][1],D[1][1]=T.positionAbsolute.y+(T.height??0)-V.y2+y[1][1]);const B=Ys(T,R,L,D,P,F);return $=$||T.position.x!==B.position.x||T.position.y!==B.position.y,T.position=B.position,T.positionAbsolute=B.positionAbsolute,T}),!$)return;z(u.current,!0,!0),c(!0);const I=o?H:Wn(W);if(I&&x.current){const[T,R]=Bn({nodeId:o,dragItems:u.current,nodeInternals:L});I(x.current,T,R)}},C=()=>{if(!g.current)return;const[O,A]=ps(b.current,g.current);if(O!==0||A!==0){const{transform:L,panBy:H}=a.getState();d.current.x=(d.current.x??0)-O/L[2],d.current.y=(d.current.y??0)-A/L[2],H({x:O,y:A})&&E(d.current)}f.current=requestAnimationFrame(C)},M=O=>{var P;const{nodeInternals:A,multiSelectionActive:L,nodesDraggable:H,unselectNodesAndEdges:W,onNodeDragStart:z,onSelectionDragStart:y}=a.getState();m.current=!0;const k=o?z:Wn(y);(!i||!s)&&!L&&o&&((P=A.get(o))!=null&&P.selected||W()),o&&s&&i&&lr({id:o,store:a,nodeRef:e});const _=S(O);if(d.current=_,u.current=nf(A,H,_,o),k&&u.current){const[F,$]=Bn({nodeId:o,dragItems:u.current,nodeInternals:A});k(O.sourceEvent,F,$)}};if(t)v.on(".drag",null);else{const O=yc().on("start",A=>{const{domNode:L,nodeDragThreshold:H}=a.getState();H===0&&M(A),N.current=!1;const W=S(A);d.current=W,g.current=(L==null?void 0:L.getBoundingClientRect())||null,b.current=Je(A.sourceEvent,g.current)}).on("drag",A=>{var z,y;const L=S(A),{autoPanOnNodeDrag:H,nodeDragThreshold:W}=a.getState();if(A.sourceEvent.type==="touchmove"&&A.sourceEvent.touches.length>1&&(N.current=!0),!N.current){if(!w.current&&m.current&&H&&(w.current=!0,C()),!m.current){const k=L.xSnapped-(((z=d==null?void 0:d.current)==null?void 0:z.x)??0),_=L.ySnapped-(((y=d==null?void 0:d.current)==null?void 0:y.y)??0);Math.sqrt(k*k+_*_)>W&&M(A)}(d.current.x!==L.xSnapped||d.current.y!==L.ySnapped)&&u.current&&m.current&&(x.current=A.sourceEvent,b.current=Je(A.sourceEvent,g.current),E(L))}}).on("end",A=>{if(!(!m.current||N.current)&&(c(!1),w.current=!1,m.current=!1,cancelAnimationFrame(f.current),u.current)){const{updateNodePositions:L,nodeInternals:H,onNodeDragStop:W,onSelectionDragStop:z}=a.getState(),y=o?W:Wn(z);if(L(u.current,!1,!1),y){const[k,_]=Bn({nodeId:o,dragItems:u.current,nodeInternals:H});y(A.sourceEvent,k,_)}}}).filter(A=>{const L=A.target;return!A.button&&(!n||!No(L,`.${n}`,e))&&(!r||No(L,r,e))});return v.call(O),()=>{v.on(".drag",null)}}}},[e,t,n,r,s,a,o,i,S]),l}function qs(){const e=ue();return h.useCallback(n=>{const{nodeInternals:r,nodeExtent:o,updateNodePositions:s,getNodes:i,snapToGrid:a,snapGrid:l,onError:c,nodesDraggable:u}=e.getState(),d=i().filter(N=>N.selected&&(N.draggable||u&&typeof N.draggable>"u")),f=a?l[0]:5,g=a?l[1]:5,b=n.isShiftPressed?4:1,x=n.x*f*b,w=n.y*g*b,m=d.map(N=>{if(N.positionAbsolute){const S={x:N.positionAbsolute.x+x,y:N.positionAbsolute.y+w};a&&(S.x=l[0]*Math.round(S.x/l[0]),S.y=l[1]*Math.round(S.y/l[1]));const{positionAbsolute:v,position:E}=Ys(N,S,r,o,void 0,c);N.position=E,N.positionAbsolute=v}return N});s(m,!0,!1)},[])}const Nt={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}};var Vt=e=>{const t=({id:n,type:r,data:o,xPos:s,yPos:i,xPosOrigin:a,yPosOrigin:l,selected:c,onClick:u,onMouseEnter:d,onMouseMove:f,onMouseLeave:g,onContextMenu:b,onDoubleClick:x,style:w,className:m,isDraggable:N,isSelectable:S,isConnectable:v,isFocusable:E,selectNodesOnDrag:C,sourcePosition:M,targetPosition:O,hidden:A,resizeObserver:L,dragHandle:H,zIndex:W,isParent:z,noDragClassName:y,noPanClassName:k,initialized:_,disableKeyboardA11y:P,ariaLabel:F,rfId:$,hasHandleBounds:V})=>{const I=ue(),T=h.useRef(null),R=h.useRef(null),D=h.useRef(M),B=h.useRef(O),U=h.useRef(r),q=S||N||u||d||f||g,Z=qs(),K=Dt(n,I.getState,d),X=Dt(n,I.getState,f),ne=Dt(n,I.getState,g),oe=Dt(n,I.getState,b),de=Dt(n,I.getState,x),ae=Q=>{const{nodeDragThreshold:Y}=I.getState();if(S&&(!C||!N||Y>0)&&lr({id:n,store:I,nodeRef:T}),u){const le=I.getState().nodeInternals.get(n);le&&u(Q,{...le})}},ie=Q=>{if(!rr(Q)&&!P)if(xs.includes(Q.key)&&S){const Y=Q.key==="Escape";lr({id:n,store:I,unselect:Y,nodeRef:T})}else N&&c&&Object.prototype.hasOwnProperty.call(Nt,Q.key)&&(I.setState({ariaLiveMessage:`Moved selected node ${Q.key.replace("Arrow","").toLowerCase()}. New position, x: ${~~s}, y: ${~~i}`}),Z({x:Nt[Q.key].x,y:Nt[Q.key].y,isShiftPressed:Q.shiftKey}))};h.useEffect(()=>()=>{R.current&&(L==null||L.unobserve(R.current),R.current=null)},[]),h.useEffect(()=>{if(T.current&&!A){const Q=T.current;(!_||!V||R.current!==Q)&&(R.current&&(L==null||L.unobserve(R.current)),L==null||L.observe(Q),R.current=Q)}},[A,_,V]),h.useEffect(()=>{const Q=U.current!==r,Y=D.current!==M,le=B.current!==O;T.current&&(Q||Y||le)&&(Q&&(U.current=r),Y&&(D.current=M),le&&(B.current=O),I.getState().updateNodeDimensions([{id:n,nodeElement:T.current,forceUpdate:!0}]))},[n,r,M,O]);const fe=Zs({nodeRef:T,disabled:A||!N,noDragClassName:y,handleSelector:H,nodeId:n,isSelectable:S,selectNodesOnDrag:C});return A?null:j.createElement("div",{className:ge(["react-flow__node",`react-flow__node-${r}`,{[k]:N},m,{selected:c,selectable:S,parent:z,dragging:fe}]),ref:T,style:{zIndex:W,transform:`translate(${a}px,${l}px)`,pointerEvents:q?"all":"none",visibility:_?"visible":"hidden",...w},"data-id":n,"data-testid":`rf__node-${n}`,onMouseEnter:K,onMouseMove:X,onMouseLeave:ne,onContextMenu:oe,onClick:ae,onDoubleClick:de,onKeyDown:E?ie:void 0,tabIndex:E?0:void 0,role:E?"button":void 0,"aria-describedby":P?void 0:`${Ls}-${$}`,"aria-label":F},j.createElement(bd,{value:n},j.createElement(e,{id:n,data:o,type:r,xPos:s,yPos:i,selected:c,isConnectable:v,sourcePosition:M,targetPosition:O,dragging:fe,dragHandle:H,zIndex:W})))};return t.displayName="NodeWrapper",h.memo(t)};const sf=e=>{const t=e.getNodes().filter(n=>n.selected);return{...Kt(t,e.nodeOrigin),transformString:`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]})`,userSelectionActive:e.userSelectionActive}};function af({onSelectionContextMenu:e,noPanClassName:t,disableKeyboardA11y:n}){const r=ue(),{width:o,height:s,x:i,y:a,transformString:l,userSelectionActive:c}=ee(sf,pe),u=qs(),d=h.useRef(null);if(h.useEffect(()=>{var b;n||(b=d.current)==null||b.focus({preventScroll:!0})},[n]),Zs({nodeRef:d}),c||!o||!s)return null;const f=e?b=>{const x=r.getState().getNodes().filter(w=>w.selected);e(b,x)}:void 0,g=b=>{Object.prototype.hasOwnProperty.call(Nt,b.key)&&u({x:Nt[b.key].x,y:Nt[b.key].y,isShiftPressed:b.shiftKey})};return j.createElement("div",{className:ge(["react-flow__nodesselection","react-flow__container",t]),style:{transform:l}},j.createElement("div",{ref:d,className:"react-flow__nodesselection-rect",onContextMenu:f,tabIndex:n?void 0:-1,onKeyDown:n?void 0:g,style:{width:o,height:s,top:a,left:i}}))}var lf=h.memo(af);const cf=e=>e.nodesSelectionActive,Ks=({children:e,onPaneClick:t,onPaneMouseEnter:n,onPaneMouseMove:r,onPaneMouseLeave:o,onPaneContextMenu:s,onPaneScroll:i,deleteKeyCode:a,onMove:l,onMoveStart:c,onMoveEnd:u,selectionKeyCode:d,selectionOnDrag:f,selectionMode:g,onSelectionStart:b,onSelectionEnd:x,multiSelectionKeyCode:w,panActivationKeyCode:m,zoomActivationKeyCode:N,elementsSelectable:S,zoomOnScroll:v,zoomOnPinch:E,panOnScroll:C,panOnScrollSpeed:M,panOnScrollMode:O,zoomOnDoubleClick:A,panOnDrag:L,defaultViewport:H,translateExtent:W,minZoom:z,maxZoom:y,preventScrolling:k,onSelectionContextMenu:_,noWheelClassName:P,noPanClassName:F,disableKeyboardA11y:$})=>{const V=ee(cf),I=Xt(d),T=Xt(m),R=T||L,D=T||C,B=I||f&&R!==!0;return Xd({deleteKeyCode:a,multiSelectionKeyCode:w}),j.createElement(Kd,{onMove:l,onMoveStart:c,onMoveEnd:u,onPaneContextMenu:s,elementsSelectable:S,zoomOnScroll:v,zoomOnPinch:E,panOnScroll:D,panOnScrollSpeed:M,panOnScrollMode:O,zoomOnDoubleClick:A,panOnDrag:!I&&R,defaultViewport:H,translateExtent:W,minZoom:z,maxZoom:y,zoomActivationKeyCode:N,preventScrolling:k,noWheelClassName:P,noPanClassName:F},j.createElement(Gs,{onSelectionStart:b,onSelectionEnd:x,onPaneClick:t,onPaneMouseEnter:n,onPaneMouseMove:r,onPaneMouseLeave:o,onPaneContextMenu:s,onPaneScroll:i,panOnDrag:R,isSelecting:!!B,selectionMode:g},e,V&&j.createElement(lf,{onSelectionContextMenu:_,noPanClassName:F,disableKeyboardA11y:$})))};Ks.displayName="FlowRenderer";var uf=h.memo(Ks);function df(e){return ee(h.useCallback(n=>e?_s(n.nodeInternals,{x:0,y:0,width:n.width,height:n.height},n.transform,!0):n.getNodes(),[e]))}function ff(e){const t={input:Vt(e.input||Ds),default:Vt(e.default||ar),output:Vt(e.output||Ps),group:Vt(e.group||Cr)},n={},r=Object.keys(e).filter(o=>!["input","default","output","group"].includes(o)).reduce((o,s)=>(o[s]=Vt(e[s]||ar),o),n);return{...t,...r}}const hf=({x:e,y:t,width:n,height:r,origin:o})=>!n||!r?{x:e,y:t}:o[0]<0||o[1]<0||o[0]>1||o[1]>1?{x:e,y:t}:{x:e-n*o[0],y:t-r*o[1]},pf=e=>({nodesDraggable:e.nodesDraggable,nodesConnectable:e.nodesConnectable,nodesFocusable:e.nodesFocusable,elementsSelectable:e.elementsSelectable,updateNodeDimensions:e.updateNodeDimensions,onError:e.onError}),Js=e=>{const{nodesDraggable:t,nodesConnectable:n,nodesFocusable:r,elementsSelectable:o,updateNodeDimensions:s,onError:i}=ee(pf,pe),a=df(e.onlyRenderVisibleElements),l=h.useRef(),c=h.useMemo(()=>{if(typeof ResizeObserver>"u")return null;const u=new ResizeObserver(d=>{const f=d.map(g=>({id:g.target.getAttribute("data-id"),nodeElement:g.target,forceUpdate:!0}));s(f)});return l.current=u,u},[]);return h.useEffect(()=>()=>{var u;(u=l==null?void 0:l.current)==null||u.disconnect()},[]),j.createElement("div",{className:"react-flow__nodes",style:_r},a.map(u=>{var E,C,M;let d=u.type||"default";e.nodeTypes[d]||(i==null||i("003",Ge.error003(d)),d="default");const f=e.nodeTypes[d]||e.nodeTypes.default,g=!!(u.draggable||t&&typeof u.draggable>"u"),b=!!(u.selectable||o&&typeof u.selectable>"u"),x=!!(u.connectable||n&&typeof u.connectable>"u"),w=!!(u.focusable||r&&typeof u.focusable>"u"),m=e.nodeExtent?xr(u.positionAbsolute,e.nodeExtent):u.positionAbsolute,N=(m==null?void 0:m.x)??0,S=(m==null?void 0:m.y)??0,v=hf({x:N,y:S,width:u.width??0,height:u.height??0,origin:e.nodeOrigin});return j.createElement(f,{key:u.id,id:u.id,className:u.className,style:u.style,type:d,data:u.data,sourcePosition:u.sourcePosition||G.Bottom,targetPosition:u.targetPosition||G.Top,hidden:u.hidden,xPos:N,yPos:S,xPosOrigin:v.x,yPosOrigin:v.y,selectNodesOnDrag:e.selectNodesOnDrag,onClick:e.onNodeClick,onMouseEnter:e.onNodeMouseEnter,onMouseMove:e.onNodeMouseMove,onMouseLeave:e.onNodeMouseLeave,onContextMenu:e.onNodeContextMenu,onDoubleClick:e.onNodeDoubleClick,selected:!!u.selected,isDraggable:g,isSelectable:b,isConnectable:x,isFocusable:w,resizeObserver:c,dragHandle:u.dragHandle,zIndex:((E=u[se])==null?void 0:E.z)??0,isParent:!!((C=u[se])!=null&&C.isParent),noDragClassName:e.noDragClassName,noPanClassName:e.noPanClassName,initialized:!!u.width&&!!u.height,rfId:e.rfId,disableKeyboardA11y:e.disableKeyboardA11y,ariaLabel:u.ariaLabel,hasHandleBounds:!!((M=u[se])!=null&&M.handleBounds)})}))};Js.displayName="NodeRenderer";var gf=h.memo(Js);const mf=(e,t,n)=>n===G.Left?e-t:n===G.Right?e+t:e,yf=(e,t,n)=>n===G.Top?e-t:n===G.Bottom?e+t:e,Co="react-flow__edgeupdater",_o=({position:e,centerX:t,centerY:n,radius:r=10,onMouseDown:o,onMouseEnter:s,onMouseOut:i,type:a})=>j.createElement("circle",{onMouseDown:o,onMouseEnter:s,onMouseOut:i,className:ge([Co,`${Co}-${a}`]),cx:mf(t,r,e),cy:yf(n,r,e),r,stroke:"transparent",fill:"transparent"}),xf=()=>!0;var xt=e=>{const t=({id:n,className:r,type:o,data:s,onClick:i,onEdgeDoubleClick:a,selected:l,animated:c,label:u,labelStyle:d,labelShowBg:f,labelBgStyle:g,labelBgPadding:b,labelBgBorderRadius:x,style:w,source:m,target:N,sourceX:S,sourceY:v,targetX:E,targetY:C,sourcePosition:M,targetPosition:O,elementsSelectable:A,hidden:L,sourceHandleId:H,targetHandleId:W,onContextMenu:z,onMouseEnter:y,onMouseMove:k,onMouseLeave:_,reconnectRadius:P,onReconnect:F,onReconnectStart:$,onReconnectEnd:V,markerEnd:I,markerStart:T,rfId:R,ariaLabel:D,isFocusable:B,isReconnectable:U,pathOptions:q,interactionWidth:Z,disableKeyboardA11y:K})=>{const X=h.useRef(null),[ne,oe]=h.useState(!1),[de,ae]=h.useState(!1),ie=ue(),fe=h.useMemo(()=>`url('#${sr(T,R)}')`,[T,R]),Q=h.useMemo(()=>`url('#${sr(I,R)}')`,[I,R]);if(L)return null;const Y=we=>{var Ve;const{edges:je,addSelectedEdges:tt,unselectNodesAndEdges:nt,multiSelectionActive:rt}=ie.getState(),ze=je.find(Rt=>Rt.id===n);ze&&(A&&(ie.setState({nodesSelectionActive:!1}),ze.selected&&rt?(nt({nodes:[],edges:[ze]}),(Ve=X.current)==null||Ve.blur()):tt([n])),i&&i(we,ze))},le=Mt(n,ie.getState,a),xe=Mt(n,ie.getState,z),Ee=Mt(n,ie.getState,y),Ce=Mt(n,ie.getState,k),Le=Mt(n,ie.getState,_),He=(we,je)=>{if(we.button!==0)return;const{edges:tt,isValidConnection:nt}=ie.getState(),rt=je?N:m,ze=(je?W:H)||null,Ve=je?"target":"source",Rt=nt||xf,In=je,jt=tt.find(ot=>ot.id===n);ae(!0),$==null||$(we,jt,Ve);const Rn=ot=>{ae(!1),V==null||V(ot,jt,Ve)};js({event:we,handleId:ze,nodeId:rt,onConnect:ot=>F==null?void 0:F(jt,ot),isTarget:In,getState:ie.getState,setState:ie.setState,isValidConnection:Rt,edgeUpdaterType:Ve,onReconnectEnd:Rn})},ft=we=>He(we,!0),Qe=we=>He(we,!1),et=()=>oe(!0),ht=()=>oe(!1),pt=!A&&!i,It=we=>{var je;if(!K&&xs.includes(we.key)&&A){const{unselectNodesAndEdges:tt,addSelectedEdges:nt,edges:rt}=ie.getState();we.key==="Escape"?((je=X.current)==null||je.blur(),tt({edges:[rt.find(Ve=>Ve.id===n)]})):nt([n])}};return j.createElement("g",{className:ge(["react-flow__edge",`react-flow__edge-${o}`,r,{selected:l,animated:c,inactive:pt,updating:ne}]),onClick:Y,onDoubleClick:le,onContextMenu:xe,onMouseEnter:Ee,onMouseMove:Ce,onMouseLeave:Le,onKeyDown:B?It:void 0,tabIndex:B?0:void 0,role:B?"button":"img","data-testid":`rf__edge-${n}`,"aria-label":D===null?void 0:D||`Edge from ${m} to ${N}`,"aria-describedby":B?`${Hs}-${R}`:void 0,ref:X},!de&&j.createElement(e,{id:n,source:m,target:N,selected:l,animated:c,label:u,labelStyle:d,labelShowBg:f,labelBgStyle:g,labelBgPadding:b,labelBgBorderRadius:x,data:s,style:w,sourceX:S,sourceY:v,targetX:E,targetY:C,sourcePosition:M,targetPosition:O,sourceHandleId:H,targetHandleId:W,markerStart:fe,markerEnd:Q,pathOptions:q,interactionWidth:Z}),U&&j.createElement(j.Fragment,null,(U==="source"||U===!0)&&j.createElement(_o,{position:M,centerX:S,centerY:v,radius:P,onMouseDown:ft,onMouseEnter:et,onMouseOut:ht,type:"source"}),(U==="target"||U===!0)&&j.createElement(_o,{position:O,centerX:E,centerY:C,radius:P,onMouseDown:Qe,onMouseEnter:et,onMouseOut:ht,type:"target"})))};return t.displayName="EdgeWrapper",h.memo(t)};function wf(e){const t={default:xt(e.default||En),straight:xt(e.bezier||vr),step:xt(e.step||br),smoothstep:xt(e.step||kn),simplebezier:xt(e.simplebezier||wr)},n={},r=Object.keys(e).filter(o=>!["default","bezier"].includes(o)).reduce((o,s)=>(o[s]=xt(e[s]||En),o),n);return{...t,...r}}function $o(e,t,n=null){const r=((n==null?void 0:n.x)||0)+t.x,o=((n==null?void 0:n.y)||0)+t.y,s=(n==null?void 0:n.width)||t.width,i=(n==null?void 0:n.height)||t.height;switch(e){case G.Top:return{x:r+s/2,y:o};case G.Right:return{x:r+s,y:o+i/2};case G.Bottom:return{x:r+s/2,y:o+i};case G.Left:return{x:r,y:o+i/2}}}function ko(e,t){return e?e.length===1||!t?e[0]:t&&e.find(n=>n.id===t)||null:null}const bf=(e,t,n,r,o,s)=>{const i=$o(n,e,t),a=$o(s,r,o);return{sourceX:i.x,sourceY:i.y,targetX:a.x,targetY:a.y}};function vf({sourcePos:e,targetPos:t,sourceWidth:n,sourceHeight:r,targetWidth:o,targetHeight:s,width:i,height:a,transform:l}){const c={x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),x2:Math.max(e.x+n,t.x+o),y2:Math.max(e.y+r,t.y+s)};c.x===c.x2&&(c.x2+=1),c.y===c.y2&&(c.y2+=1);const u=Ut({x:(0-l[0])/l[2],y:(0-l[1])/l[2],width:i/l[2],height:a/l[2]}),d=Math.max(0,Math.min(u.x2,c.x2)-Math.max(u.x,c.x)),f=Math.max(0,Math.min(u.y2,c.y2)-Math.max(u.y,c.y));return Math.ceil(d*f)>0}function Io(e){var r,o,s,i,a;const t=((r=e==null?void 0:e[se])==null?void 0:r.handleBounds)||null,n=t&&(e==null?void 0:e.width)&&(e==null?void 0:e.height)&&typeof((o=e==null?void 0:e.positionAbsolute)==null?void 0:o.x)<"u"&&typeof((s=e==null?void 0:e.positionAbsolute)==null?void 0:s.y)<"u";return[{x:((i=e==null?void 0:e.positionAbsolute)==null?void 0:i.x)||0,y:((a=e==null?void 0:e.positionAbsolute)==null?void 0:a.y)||0,width:(e==null?void 0:e.width)||0,height:(e==null?void 0:e.height)||0},t,!!n]}const Ef=[{level:0,isMaxLevel:!0,edges:[]}];function Nf(e,t,n=!1){let r=-1;const o=e.reduce((i,a)=>{var u,d;const l=$e(a.zIndex);let c=l?a.zIndex:0;if(n){const f=t.get(a.target),g=t.get(a.source),b=a.selected||(f==null?void 0:f.selected)||(g==null?void 0:g.selected),x=Math.max(((u=g==null?void 0:g[se])==null?void 0:u.z)||0,((d=f==null?void 0:f[se])==null?void 0:d.z)||0,1e3);c=(l?a.zIndex:0)+(b?x:0)}return i[c]?i[c].push(a):i[c]=[a],r=c>r?c:r,i},{}),s=Object.entries(o).map(([i,a])=>{const l=+i;return{edges:a,level:l,isMaxLevel:l===r}});return s.length===0?Ef:s}function Sf(e,t,n){const r=ee(h.useCallback(o=>e?o.edges.filter(s=>{const i=t.get(s.source),a=t.get(s.target);return(i==null?void 0:i.width)&&(i==null?void 0:i.height)&&(a==null?void 0:a.width)&&(a==null?void 0:a.height)&&vf({sourcePos:i.positionAbsolute||{x:0,y:0},targetPos:a.positionAbsolute||{x:0,y:0},sourceWidth:i.width,sourceHeight:i.height,targetWidth:a.width,targetHeight:a.height,width:o.width,height:o.height,transform:o.transform})}):o.edges,[e,t]));return Nf(r,t,n)}const Cf=({color:e="none",strokeWidth:t=1})=>j.createElement("polyline",{style:{stroke:e,strokeWidth:t},strokeLinecap:"round",strokeLinejoin:"round",fill:"none",points:"-5,-4 0,0 -5,4"}),_f=({color:e="none",strokeWidth:t=1})=>j.createElement("polyline",{style:{stroke:e,fill:e,strokeWidth:t},strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"}),Ro={[vn.Arrow]:Cf,[vn.ArrowClosed]:_f};function $f(e){const t=ue();return h.useMemo(()=>{var o,s;return Object.prototype.hasOwnProperty.call(Ro,e)?Ro[e]:((s=(o=t.getState()).onError)==null||s.call(o,"009",Ge.error009(e)),null)},[e])}const kf=({id:e,type:t,color:n,width:r=12.5,height:o=12.5,markerUnits:s="strokeWidth",strokeWidth:i,orient:a="auto-start-reverse"})=>{const l=$f(t);return l?j.createElement("marker",{className:"react-flow__arrowhead",id:e,markerWidth:`${r}`,markerHeight:`${o}`,viewBox:"-10 -10 20 20",markerUnits:s,orient:a,refX:"0",refY:"0"},j.createElement(l,{color:n,strokeWidth:i})):null},If=({defaultColor:e,rfId:t})=>n=>{const r=[];return n.edges.reduce((o,s)=>([s.markerStart,s.markerEnd].forEach(i=>{if(i&&typeof i=="object"){const a=sr(i,t);r.includes(a)||(o.push({id:a,color:i.color||e,...i}),r.push(a))}}),o),[]).sort((o,s)=>o.id.localeCompare(s.id))},Qs=({defaultColor:e,rfId:t})=>{const n=ee(h.useCallback(If({defaultColor:e,rfId:t}),[e,t]),(r,o)=>!(r.length!==o.length||r.some((s,i)=>s.id!==o[i].id)));return j.createElement("defs",null,n.map(r=>j.createElement(kf,{id:r.id,key:r.id,type:r.type,color:r.color,width:r.width,height:r.height,markerUnits:r.markerUnits,strokeWidth:r.strokeWidth,orient:r.orient})))};Qs.displayName="MarkerDefinitions";var Rf=h.memo(Qs);const jf=e=>({nodesConnectable:e.nodesConnectable,edgesFocusable:e.edgesFocusable,edgesUpdatable:e.edgesUpdatable,elementsSelectable:e.elementsSelectable,width:e.width,height:e.height,connectionMode:e.connectionMode,nodeInternals:e.nodeInternals,onError:e.onError}),ei=({defaultMarkerColor:e,onlyRenderVisibleElements:t,elevateEdgesOnSelect:n,rfId:r,edgeTypes:o,noPanClassName:s,onEdgeContextMenu:i,onEdgeMouseEnter:a,onEdgeMouseMove:l,onEdgeMouseLeave:c,onEdgeClick:u,onEdgeDoubleClick:d,onReconnect:f,onReconnectStart:g,onReconnectEnd:b,reconnectRadius:x,children:w,disableKeyboardA11y:m})=>{const{edgesFocusable:N,edgesUpdatable:S,elementsSelectable:v,width:E,height:C,connectionMode:M,nodeInternals:O,onError:A}=ee(jf,pe),L=Sf(t,O,n);return E?j.createElement(j.Fragment,null,L.map(({level:H,edges:W,isMaxLevel:z})=>j.createElement("svg",{key:H,style:{zIndex:H},width:E,height:C,className:"react-flow__edges react-flow__container"},z&&j.createElement(Rf,{defaultColor:e,rfId:r}),j.createElement("g",null,W.map(y=>{const[k,_,P]=Io(O.get(y.source)),[F,$,V]=Io(O.get(y.target));if(!P||!V)return null;let I=y.type||"default";o[I]||(A==null||A("011",Ge.error011(I)),I="default");const T=o[I]||o.default,R=M===dt.Strict?$.target:($.target??[]).concat($.source??[]),D=ko(_.source,y.sourceHandle),B=ko(R,y.targetHandle),U=(D==null?void 0:D.position)||G.Bottom,q=(B==null?void 0:B.position)||G.Top,Z=!!(y.focusable||N&&typeof y.focusable>"u"),K=y.reconnectable||y.updatable,X=typeof f<"u"&&(K||S&&typeof K>"u");if(!D||!B)return A==null||A("008",Ge.error008(D,y)),null;const{sourceX:ne,sourceY:oe,targetX:de,targetY:ae}=bf(k,D,U,F,B,q);return j.createElement(T,{key:y.id,id:y.id,className:ge([y.className,s]),type:I,data:y.data,selected:!!y.selected,animated:!!y.animated,hidden:!!y.hidden,label:y.label,labelStyle:y.labelStyle,labelShowBg:y.labelShowBg,labelBgStyle:y.labelBgStyle,labelBgPadding:y.labelBgPadding,labelBgBorderRadius:y.labelBgBorderRadius,style:y.style,source:y.source,target:y.target,sourceHandleId:y.sourceHandle,targetHandleId:y.targetHandle,markerEnd:y.markerEnd,markerStart:y.markerStart,sourceX:ne,sourceY:oe,targetX:de,targetY:ae,sourcePosition:U,targetPosition:q,elementsSelectable:v,onContextMenu:i,onMouseEnter:a,onMouseMove:l,onMouseLeave:c,onClick:u,onEdgeDoubleClick:d,onReconnect:f,onReconnectStart:g,onReconnectEnd:b,reconnectRadius:x,rfId:r,ariaLabel:y.ariaLabel,isFocusable:Z,isReconnectable:X,pathOptions:"pathOptions"in y?y.pathOptions:void 0,interactionWidth:y.interactionWidth,disableKeyboardA11y:m})})))),w):null};ei.displayName="EdgeRenderer";var Tf=h.memo(ei);const Af=e=>`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]})`;function Mf({children:e}){const t=ee(Af);return j.createElement("div",{className:"react-flow__viewport react-flow__container",style:{transform:t}},e)}function Df(e){const t=Jt(),n=h.useRef(!1);h.useEffect(()=>{!n.current&&t.viewportInitialized&&e&&(setTimeout(()=>e(t),1),n.current=!0)},[e,t.viewportInitialized])}const Vf={[G.Left]:G.Right,[G.Right]:G.Left,[G.Top]:G.Bottom,[G.Bottom]:G.Top},ti=({nodeId:e,handleType:t,style:n,type:r=Ke.Bezier,CustomComponent:o,connectionStatus:s})=>{var C,M,O;const{fromNode:i,handleId:a,toX:l,toY:c,connectionMode:u}=ee(h.useCallback(A=>({fromNode:A.nodeInternals.get(e),handleId:A.connectionHandleId,toX:(A.connectionPosition.x-A.transform[0])/A.transform[2],toY:(A.connectionPosition.y-A.transform[1])/A.transform[2],connectionMode:A.connectionMode}),[e]),pe),d=(C=i==null?void 0:i[se])==null?void 0:C.handleBounds;let f=d==null?void 0:d[t];if(u===dt.Loose&&(f=f||(d==null?void 0:d[t==="source"?"target":"source"])),!i||!f)return null;const g=a?f.find(A=>A.id===a):f[0],b=g?g.x+g.width/2:(i.width??0)/2,x=g?g.y+g.height/2:i.height??0,w=(((M=i.positionAbsolute)==null?void 0:M.x)??0)+b,m=(((O=i.positionAbsolute)==null?void 0:O.y)??0)+x,N=g==null?void 0:g.position,S=N?Vf[N]:null;if(!N||!S)return null;if(o)return j.createElement(o,{connectionLineType:r,connectionLineStyle:n,fromNode:i,fromHandle:g,fromX:w,fromY:m,toX:l,toY:c,fromPosition:N,toPosition:S,connectionStatus:s});let v="";const E={sourceX:w,sourceY:m,sourcePosition:N,targetX:l,targetY:c,targetPosition:S};return r===Ke.Bezier?[v]=Er(E):r===Ke.Step?[v]=or({...E,borderRadius:0}):r===Ke.SmoothStep?[v]=or(E):r===Ke.SimpleBezier?[v]=Es(E):v=`M${w},${m} ${l},${c}`,j.createElement("path",{d:v,fill:"none",className:"react-flow__connection-path",style:n})};ti.displayName="ConnectionLine";const Pf=e=>({nodeId:e.connectionNodeId,handleType:e.connectionHandleType,nodesConnectable:e.nodesConnectable,connectionStatus:e.connectionStatus,width:e.width,height:e.height});function Of({containerStyle:e,style:t,type:n,component:r}){const{nodeId:o,handleType:s,nodesConnectable:i,width:a,height:l,connectionStatus:c}=ee(Pf,pe);return!(o&&s&&a&&i)?null:j.createElement("svg",{style:e,width:a,height:l,className:"react-flow__edges react-flow__connectionline react-flow__container"},j.createElement("g",{className:ge(["react-flow__connection",c])},j.createElement(ti,{nodeId:o,handleType:s,style:t,type:n,CustomComponent:r,connectionStatus:c})))}function jo(e,t){return h.useRef(null),ue(),h.useMemo(()=>t(e),[e])}const ni=({nodeTypes:e,edgeTypes:t,onMove:n,onMoveStart:r,onMoveEnd:o,onInit:s,onNodeClick:i,onEdgeClick:a,onNodeDoubleClick:l,onEdgeDoubleClick:c,onNodeMouseEnter:u,onNodeMouseMove:d,onNodeMouseLeave:f,onNodeContextMenu:g,onSelectionContextMenu:b,onSelectionStart:x,onSelectionEnd:w,connectionLineType:m,connectionLineStyle:N,connectionLineComponent:S,connectionLineContainerStyle:v,selectionKeyCode:E,selectionOnDrag:C,selectionMode:M,multiSelectionKeyCode:O,panActivationKeyCode:A,zoomActivationKeyCode:L,deleteKeyCode:H,onlyRenderVisibleElements:W,elementsSelectable:z,selectNodesOnDrag:y,defaultViewport:k,translateExtent:_,minZoom:P,maxZoom:F,preventScrolling:$,defaultMarkerColor:V,zoomOnScroll:I,zoomOnPinch:T,panOnScroll:R,panOnScrollSpeed:D,panOnScrollMode:B,zoomOnDoubleClick:U,panOnDrag:q,onPaneClick:Z,onPaneMouseEnter:K,onPaneMouseMove:X,onPaneMouseLeave:ne,onPaneScroll:oe,onPaneContextMenu:de,onEdgeContextMenu:ae,onEdgeMouseEnter:ie,onEdgeMouseMove:fe,onEdgeMouseLeave:Q,onReconnect:Y,onReconnectStart:le,onReconnectEnd:xe,reconnectRadius:Ee,noDragClassName:Ce,noWheelClassName:Le,noPanClassName:He,elevateEdgesOnSelect:ft,disableKeyboardA11y:Qe,nodeOrigin:et,nodeExtent:ht,rfId:pt})=>{const It=jo(e,ff),we=jo(t,wf);return Df(s),j.createElement(uf,{onPaneClick:Z,onPaneMouseEnter:K,onPaneMouseMove:X,onPaneMouseLeave:ne,onPaneContextMenu:de,onPaneScroll:oe,deleteKeyCode:H,selectionKeyCode:E,selectionOnDrag:C,selectionMode:M,onSelectionStart:x,onSelectionEnd:w,multiSelectionKeyCode:O,panActivationKeyCode:A,zoomActivationKeyCode:L,elementsSelectable:z,onMove:n,onMoveStart:r,onMoveEnd:o,zoomOnScroll:I,zoomOnPinch:T,zoomOnDoubleClick:U,panOnScroll:R,panOnScrollSpeed:D,panOnScrollMode:B,panOnDrag:q,defaultViewport:k,translateExtent:_,minZoom:P,maxZoom:F,onSelectionContextMenu:b,preventScrolling:$,noDragClassName:Ce,noWheelClassName:Le,noPanClassName:He,disableKeyboardA11y:Qe},j.createElement(Mf,null,j.createElement(Tf,{edgeTypes:we,onEdgeClick:a,onEdgeDoubleClick:c,onlyRenderVisibleElements:W,onEdgeContextMenu:ae,onEdgeMouseEnter:ie,onEdgeMouseMove:fe,onEdgeMouseLeave:Q,onReconnect:Y,onReconnectStart:le,onReconnectEnd:xe,reconnectRadius:Ee,defaultMarkerColor:V,noPanClassName:He,elevateEdgesOnSelect:!!ft,disableKeyboardA11y:Qe,rfId:pt},j.createElement(Of,{style:N,type:m,component:S,containerStyle:v})),j.createElement("div",{className:"react-flow__edgelabel-renderer"}),j.createElement(gf,{nodeTypes:It,onNodeClick:i,onNodeDoubleClick:l,onNodeMouseEnter:u,onNodeMouseMove:d,onNodeMouseLeave:f,onNodeContextMenu:g,selectNodesOnDrag:y,onlyRenderVisibleElements:W,noPanClassName:He,noDragClassName:Ce,disableKeyboardA11y:Qe,nodeOrigin:et,nodeExtent:ht,rfId:pt})))};ni.displayName="GraphView";var Lf=h.memo(ni);const cr=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],Xe={rfId:"1",width:0,height:0,transform:[0,0,1],nodeInternals:new Map,edges:[],onNodesChange:null,onEdgesChange:null,hasDefaultNodes:!1,hasDefaultEdges:!1,d3Zoom:null,d3Selection:null,d3ZoomHandler:void 0,minZoom:.5,maxZoom:2,translateExtent:cr,nodeExtent:cr,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionNodeId:null,connectionHandleId:null,connectionHandleType:"source",connectionPosition:{x:0,y:0},connectionStatus:null,connectionMode:dt.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:[0,0],nodeDragThreshold:0,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesUpdatable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,fitViewOnInit:!1,fitViewOnInitDone:!1,fitViewOnInitOptions:void 0,onSelectionChange:[],multiSelectionActive:!1,connectionStartHandle:null,connectionEndHandle:null,connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,connectionRadius:20,onError:pd,isValidConnection:void 0},Hf=()=>Ia((e,t)=>({...Xe,setNodes:n=>{const{nodeInternals:r,nodeOrigin:o,elevateNodesOnSelect:s}=t();e({nodeInternals:zn(n,r,o,s)})},getNodes:()=>Array.from(t().nodeInternals.values()),setEdges:n=>{const{defaultEdgeOptions:r={}}=t();e({edges:n.map(o=>({...r,...o}))})},setDefaultNodesAndEdges:(n,r)=>{const o=typeof n<"u",s=typeof r<"u",i=o?zn(n,new Map,t().nodeOrigin,t().elevateNodesOnSelect):new Map;e({nodeInternals:i,edges:s?r:[],hasDefaultNodes:o,hasDefaultEdges:s})},updateNodeDimensions:n=>{const{onNodesChange:r,nodeInternals:o,fitViewOnInit:s,fitViewOnInitDone:i,fitViewOnInitOptions:a,domNode:l,nodeOrigin:c}=t(),u=l==null?void 0:l.querySelector(".react-flow__viewport");if(!u)return;const d=window.getComputedStyle(u),{m22:f}=new window.DOMMatrixReadOnly(d.transform),g=n.reduce((x,w)=>{const m=o.get(w.id);if(m!=null&&m.hidden)o.set(m.id,{...m,[se]:{...m[se],handleBounds:void 0}});else if(m){const N=yr(w.nodeElement);!!(N.width&&N.height&&(m.width!==N.width||m.height!==N.height||w.forceUpdate))&&(o.set(m.id,{...m,[se]:{...m[se],handleBounds:{source:So(".source",w.nodeElement,f,c),target:So(".target",w.nodeElement,f,c)}},...N}),x.push({id:m.id,type:"dimensions",dimensions:N}))}return x},[]);Fs(o,c);const b=i||s&&!i&&Bs(t,{initial:!0,...a});e({nodeInternals:new Map(o),fitViewOnInitDone:b}),(g==null?void 0:g.length)>0&&(r==null||r(g))},updateNodePositions:(n,r=!0,o=!1)=>{const{triggerNodeChanges:s}=t(),i=n.map(a=>{const l={id:a.id,type:"position",dragging:o};return r&&(l.positionAbsolute=a.positionAbsolute,l.position=a.position),l});s(i)},triggerNodeChanges:n=>{const{onNodesChange:r,nodeInternals:o,hasDefaultNodes:s,nodeOrigin:i,getNodes:a,elevateNodesOnSelect:l}=t();if(n!=null&&n.length){if(s){const c=Us(n,a()),u=zn(c,o,i,l);e({nodeInternals:u})}r==null||r(n)}},addSelectedNodes:n=>{const{multiSelectionActive:r,edges:o,getNodes:s}=t();let i,a=null;r?i=n.map(l=>qe(l,!0)):(i=wt(s(),n),a=wt(o,[])),an({changedNodes:i,changedEdges:a,get:t,set:e})},addSelectedEdges:n=>{const{multiSelectionActive:r,edges:o,getNodes:s}=t();let i,a=null;r?i=n.map(l=>qe(l,!0)):(i=wt(o,n),a=wt(s(),[])),an({changedNodes:a,changedEdges:i,get:t,set:e})},unselectNodesAndEdges:({nodes:n,edges:r}={})=>{const{edges:o,getNodes:s}=t(),i=n||s(),a=r||o,l=i.map(u=>(u.selected=!1,qe(u.id,!1))),c=a.map(u=>qe(u.id,!1));an({changedNodes:l,changedEdges:c,get:t,set:e})},setMinZoom:n=>{const{d3Zoom:r,maxZoom:o}=t();r==null||r.scaleExtent([n,o]),e({minZoom:n})},setMaxZoom:n=>{const{d3Zoom:r,minZoom:o}=t();r==null||r.scaleExtent([o,n]),e({maxZoom:n})},setTranslateExtent:n=>{var r;(r=t().d3Zoom)==null||r.translateExtent(n),e({translateExtent:n})},resetSelectedElements:()=>{const{edges:n,getNodes:r}=t(),s=r().filter(a=>a.selected).map(a=>qe(a.id,!1)),i=n.filter(a=>a.selected).map(a=>qe(a.id,!1));an({changedNodes:s,changedEdges:i,get:t,set:e})},setNodeExtent:n=>{const{nodeInternals:r}=t();r.forEach(o=>{o.positionAbsolute=xr(o.position,n)}),e({nodeExtent:n,nodeInternals:new Map(r)})},panBy:n=>{const{transform:r,width:o,height:s,d3Zoom:i,d3Selection:a,translateExtent:l}=t();if(!i||!a||!n.x&&!n.y)return!1;const c=We.translate(r[0]+n.x,r[1]+n.y).scale(r[2]),u=[[0,0],[o,s]],d=i==null?void 0:i.constrain()(c,u,l);return i.transform(a,d),r[0]!==d.x||r[1]!==d.y||r[2]!==d.k},cancelConnection:()=>e({connectionNodeId:Xe.connectionNodeId,connectionHandleId:Xe.connectionHandleId,connectionHandleType:Xe.connectionHandleType,connectionStatus:Xe.connectionStatus,connectionStartHandle:Xe.connectionStartHandle,connectionEndHandle:Xe.connectionEndHandle}),reset:()=>e({...Xe})}),Object.is),ri=({children:e})=>{const t=h.useRef(null);return t.current||(t.current=Hf()),j.createElement(ad,{value:t.current},e)};ri.displayName="ReactFlowProvider";const oi=({children:e})=>h.useContext($n)?j.createElement(j.Fragment,null,e):j.createElement(ri,null,e);oi.displayName="ReactFlowWrapper";const zf={input:Ds,default:ar,output:Ps,group:Cr},Ff={default:En,straight:vr,step:br,smoothstep:kn,simplebezier:wr},Bf=[0,0],Wf=[15,15],Uf={x:0,y:0,zoom:1},Gf={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0},si=h.forwardRef(({nodes:e,edges:t,defaultNodes:n,defaultEdges:r,className:o,nodeTypes:s=zf,edgeTypes:i=Ff,onNodeClick:a,onEdgeClick:l,onInit:c,onMove:u,onMoveStart:d,onMoveEnd:f,onConnect:g,onConnectStart:b,onConnectEnd:x,onClickConnectStart:w,onClickConnectEnd:m,onNodeMouseEnter:N,onNodeMouseMove:S,onNodeMouseLeave:v,onNodeContextMenu:E,onNodeDoubleClick:C,onNodeDragStart:M,onNodeDrag:O,onNodeDragStop:A,onNodesDelete:L,onEdgesDelete:H,onSelectionChange:W,onSelectionDragStart:z,onSelectionDrag:y,onSelectionDragStop:k,onSelectionContextMenu:_,onSelectionStart:P,onSelectionEnd:F,connectionMode:$=dt.Strict,connectionLineType:V=Ke.Bezier,connectionLineStyle:I,connectionLineComponent:T,connectionLineContainerStyle:R,deleteKeyCode:D="Backspace",selectionKeyCode:B="Shift",selectionOnDrag:U=!1,selectionMode:q=Gt.Full,panActivationKeyCode:Z="Space",multiSelectionKeyCode:K=bn()?"Meta":"Control",zoomActivationKeyCode:X=bn()?"Meta":"Control",snapToGrid:ne=!1,snapGrid:oe=Wf,onlyRenderVisibleElements:de=!1,selectNodesOnDrag:ae=!0,nodesDraggable:ie,nodesConnectable:fe,nodesFocusable:Q,nodeOrigin:Y=Bf,edgesFocusable:le,edgesUpdatable:xe,elementsSelectable:Ee,defaultViewport:Ce=Uf,minZoom:Le=.5,maxZoom:He=2,translateExtent:ft=cr,preventScrolling:Qe=!0,nodeExtent:et,defaultMarkerColor:ht="#b1b1b7",zoomOnScroll:pt=!0,zoomOnPinch:It=!0,panOnScroll:we=!1,panOnScrollSpeed:je=.5,panOnScrollMode:tt=at.Free,zoomOnDoubleClick:nt=!0,panOnDrag:rt=!0,onPaneClick:ze,onPaneMouseEnter:Ve,onPaneMouseMove:Rt,onPaneMouseLeave:In,onPaneScroll:jt,onPaneContextMenu:Rn,children:Rr,onEdgeContextMenu:ot,onEdgeDoubleClick:gi,onEdgeMouseEnter:mi,onEdgeMouseMove:yi,onEdgeMouseLeave:xi,onEdgeUpdate:wi,onEdgeUpdateStart:bi,onEdgeUpdateEnd:vi,onReconnect:Ei,onReconnectStart:Ni,onReconnectEnd:Si,reconnectRadius:Ci=10,edgeUpdaterRadius:_i=10,onNodesChange:$i,onEdgesChange:ki,noDragClassName:Ii="nodrag",noWheelClassName:Ri="nowheel",noPanClassName:jr="nopan",fitView:ji=!1,fitViewOptions:Ti,connectOnClick:Ai=!0,attributionPosition:Mi,proOptions:Di,defaultEdgeOptions:Vi,elevateNodesOnSelect:Pi=!0,elevateEdgesOnSelect:Oi=!1,disableKeyboardA11y:Tr=!1,autoPanOnConnect:Li=!0,autoPanOnNodeDrag:Hi=!0,connectionRadius:zi=20,isValidConnection:Fi,onError:Bi,style:Wi,id:Ar,nodeDragThreshold:Ui,...Gi},Xi)=>{const jn=Ar||"1";return j.createElement("div",{...Gi,style:{...Wi,...Gf},ref:Xi,className:ge(["react-flow",o]),"data-testid":"rf__wrapper",id:Ar},j.createElement(oi,null,j.createElement(Lf,{onInit:c,onMove:u,onMoveStart:d,onMoveEnd:f,onNodeClick:a,onEdgeClick:l,onNodeMouseEnter:N,onNodeMouseMove:S,onNodeMouseLeave:v,onNodeContextMenu:E,onNodeDoubleClick:C,nodeTypes:s,edgeTypes:i,connectionLineType:V,connectionLineStyle:I,connectionLineComponent:T,connectionLineContainerStyle:R,selectionKeyCode:B,selectionOnDrag:U,selectionMode:q,deleteKeyCode:D,multiSelectionKeyCode:K,panActivationKeyCode:Z,zoomActivationKeyCode:X,onlyRenderVisibleElements:de,selectNodesOnDrag:ae,defaultViewport:Ce,translateExtent:ft,minZoom:Le,maxZoom:He,preventScrolling:Qe,zoomOnScroll:pt,zoomOnPinch:It,zoomOnDoubleClick:nt,panOnScroll:we,panOnScrollSpeed:je,panOnScrollMode:tt,panOnDrag:rt,onPaneClick:ze,onPaneMouseEnter:Ve,onPaneMouseMove:Rt,onPaneMouseLeave:In,onPaneScroll:jt,onPaneContextMenu:Rn,onSelectionContextMenu:_,onSelectionStart:P,onSelectionEnd:F,onEdgeContextMenu:ot,onEdgeDoubleClick:gi,onEdgeMouseEnter:mi,onEdgeMouseMove:yi,onEdgeMouseLeave:xi,onReconnect:Ei??wi,onReconnectStart:Ni??bi,onReconnectEnd:Si??vi,reconnectRadius:Ci??_i,defaultMarkerColor:ht,noDragClassName:Ii,noWheelClassName:Ri,noPanClassName:jr,elevateEdgesOnSelect:Oi,rfId:jn,disableKeyboardA11y:Tr,nodeOrigin:Y,nodeExtent:et}),j.createElement(Dd,{nodes:e,edges:t,defaultNodes:n,defaultEdges:r,onConnect:g,onConnectStart:b,onConnectEnd:x,onClickConnectStart:w,onClickConnectEnd:m,nodesDraggable:ie,nodesConnectable:fe,nodesFocusable:Q,edgesFocusable:le,edgesUpdatable:xe,elementsSelectable:Ee,elevateNodesOnSelect:Pi,minZoom:Le,maxZoom:He,nodeExtent:et,onNodesChange:$i,onEdgesChange:ki,snapToGrid:ne,snapGrid:oe,connectionMode:$,translateExtent:ft,connectOnClick:Ai,defaultEdgeOptions:Vi,fitView:ji,fitViewOptions:Ti,onNodesDelete:L,onEdgesDelete:H,onNodeDragStart:M,onNodeDrag:O,onNodeDragStop:A,onSelectionDrag:y,onSelectionDragStart:z,onSelectionDragStop:k,noPanClassName:jr,nodeOrigin:Y,rfId:jn,autoPanOnConnect:Li,autoPanOnNodeDrag:Hi,onError:Bi,connectionRadius:zi,isValidConnection:Fi,nodeDragThreshold:Ui}),j.createElement(Ad,{onSelectionChange:W}),Rr,j.createElement(cd,{proOptions:Di,position:Mi}),j.createElement(Hd,{rfId:jn,disableKeyboardA11y:Tr})))});si.displayName="ReactFlow";const Xf=e=>{var t;return(t=e.domNode)==null?void 0:t.querySelector(".react-flow__edgelabel-renderer")};function To({children:e}){const t=ee(Xf);return t?Po.createPortal(e,t):null}function ii(){const e=ue();return h.useCallback(t=>{const{domNode:n,updateNodeDimensions:r}=e.getState(),s=(Array.isArray(t)?t:[t]).reduce((i,a)=>{const l=n==null?void 0:n.querySelector(`.react-flow__node[data-id="${a}"]`);return l&&i.push({id:a,nodeElement:l,forceUpdate:!0}),i},[]);requestAnimationFrame(()=>r(s))},[])}function ai(e){return t=>{const[n,r]=h.useState(t),o=h.useCallback(s=>r(i=>e(s,i)),[]);return[n,r,o]}}const Yf=ai(Us),Zf=ai(ef),li=({id:e,x:t,y:n,width:r,height:o,style:s,color:i,strokeColor:a,strokeWidth:l,className:c,borderRadius:u,shapeRendering:d,onClick:f,selected:g})=>{const{background:b,backgroundColor:x}=s||{},w=i||b||x;return j.createElement("rect",{className:ge(["react-flow__minimap-node",{selected:g},c]),x:t,y:n,rx:u,ry:u,width:r,height:o,fill:w,stroke:a,strokeWidth:l,shapeRendering:d,onClick:f?m=>f(m,e):void 0})};li.displayName="MiniMapNode";var qf=h.memo(li);const Kf=e=>e.nodeOrigin,Jf=e=>e.getNodes().filter(t=>!t.hidden&&t.width&&t.height),Un=e=>e instanceof Function?e:()=>e;function Qf({nodeStrokeColor:e="transparent",nodeColor:t="#e2e2e2",nodeClassName:n="",nodeBorderRadius:r=5,nodeStrokeWidth:o=2,nodeComponent:s=qf,onClick:i}){const a=ee(Jf,pe),l=ee(Kf),c=Un(t),u=Un(e),d=Un(n),f=typeof window>"u"||window.chrome?"crispEdges":"geometricPrecision";return j.createElement(j.Fragment,null,a.map(g=>{const{x:b,y:x}=ct(g,l).positionAbsolute;return j.createElement(s,{key:g.id,x:b,y:x,width:g.width,height:g.height,style:g.style,selected:g.selected,className:d(g),color:c(g),borderRadius:r,strokeColor:u(g),strokeWidth:o,shapeRendering:f,onClick:i,id:g.id})}))}var eh=h.memo(Qf);const th=200,nh=150,rh=e=>{const t=e.getNodes(),n={x:-e.transform[0]/e.transform[2],y:-e.transform[1]/e.transform[2],width:e.width/e.transform[2],height:e.height/e.transform[2]};return{viewBB:n,boundingRect:t.length>0?fd(Kt(t,e.nodeOrigin),n):n,rfId:e.rfId}},oh="react-flow__minimap-desc";function ci({style:e,className:t,nodeStrokeColor:n="transparent",nodeColor:r="#e2e2e2",nodeClassName:o="",nodeBorderRadius:s=5,nodeStrokeWidth:i=2,nodeComponent:a,maskColor:l="rgb(240, 240, 240, 0.6)",maskStrokeColor:c="none",maskStrokeWidth:u=1,position:d="bottom-right",onClick:f,onNodeClick:g,pannable:b=!1,zoomable:x=!1,ariaLabel:w="React Flow mini map",inversePan:m=!1,zoomStep:N=10,offsetScale:S=5}){const v=ue(),E=h.useRef(null),{boundingRect:C,viewBB:M,rfId:O}=ee(rh,pe),A=(e==null?void 0:e.width)??th,L=(e==null?void 0:e.height)??nh,H=C.width/A,W=C.height/L,z=Math.max(H,W),y=z*A,k=z*L,_=S*z,P=C.x-(y-C.width)/2-_,F=C.y-(k-C.height)/2-_,$=y+_*2,V=k+_*2,I=`${oh}-${O}`,T=h.useRef(0);T.current=z,h.useEffect(()=>{if(E.current){const B=_e(E.current),U=K=>{const{transform:X,d3Selection:ne,d3Zoom:oe}=v.getState();if(K.sourceEvent.type!=="wheel"||!ne||!oe)return;const de=-K.sourceEvent.deltaY*(K.sourceEvent.deltaMode===1?.05:K.sourceEvent.deltaMode?1:.002)*N,ae=X[2]*Math.pow(2,de);oe.scaleTo(ne,ae)},q=K=>{const{transform:X,d3Selection:ne,d3Zoom:oe,translateExtent:de,width:ae,height:ie}=v.getState();if(K.sourceEvent.type!=="mousemove"||!ne||!oe)return;const fe=T.current*Math.max(1,X[2])*(m?-1:1),Q={x:X[0]-K.sourceEvent.movementX*fe,y:X[1]-K.sourceEvent.movementY*fe},Y=[[0,0],[ae,ie]],le=We.translate(Q.x,Q.y).scale(X[2]),xe=oe.constrain()(le,Y,de);oe.transform(ne,xe)},Z=fs().on("zoom",b?q:null).on("zoom.wheel",x?U:null);return B.call(Z),()=>{B.on("zoom",null)}}},[b,x,m,N]);const R=f?B=>{const U=Te(B);f(B,{x:U[0],y:U[1]})}:void 0,D=g?(B,U)=>{const q=v.getState().nodeInternals.get(U);g(B,q)}:void 0;return j.createElement(mr,{position:d,style:e,className:ge(["react-flow__minimap",t]),"data-testid":"rf__minimap"},j.createElement("svg",{width:A,height:L,viewBox:`${P} ${F} ${$} ${V}`,role:"img","aria-labelledby":I,ref:E,onClick:R},w&&j.createElement("title",{id:I},w),j.createElement(eh,{onClick:D,nodeColor:r,nodeStrokeColor:n,nodeBorderRadius:s,nodeClassName:o,nodeStrokeWidth:i,nodeComponent:a}),j.createElement("path",{className:"react-flow__minimap-mask",d:`M${P-_},${F-_}h${$+_*2}v${V+_*2}h${-$-_*2}z
        M${M.x},${M.y}h${M.width}v${M.height}h${-M.width}z`,fill:l,fillRule:"evenodd",stroke:c,strokeWidth:u,pointerEvents:"none"})))}ci.displayName="MiniMap";var sh=h.memo(ci);function ih(){return j.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},j.createElement("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"}))}function ah(){return j.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5"},j.createElement("path",{d:"M0 0h32v4.2H0z"}))}function lh(){return j.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30"},j.createElement("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"}))}function ch(){return j.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},j.createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"}))}function uh(){return j.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},j.createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"}))}const Lt=({children:e,className:t,...n})=>j.createElement("button",{type:"button",className:ge(["react-flow__controls-button",t]),...n},e);Lt.displayName="ControlButton";const dh=e=>({isInteractive:e.nodesDraggable||e.nodesConnectable||e.elementsSelectable,minZoomReached:e.transform[2]<=e.minZoom,maxZoomReached:e.transform[2]>=e.maxZoom}),ui=({style:e,showZoom:t=!0,showFitView:n=!0,showInteractive:r=!0,fitViewOptions:o,onZoomIn:s,onZoomOut:i,onFitView:a,onInteractiveChange:l,className:c,children:u,position:d="bottom-left"})=>{const f=ue(),[g,b]=h.useState(!1),{isInteractive:x,minZoomReached:w,maxZoomReached:m}=ee(dh,pe),{zoomIn:N,zoomOut:S,fitView:v}=Jt();if(h.useEffect(()=>{b(!0)},[]),!g)return null;const E=()=>{N(),s==null||s()},C=()=>{S(),i==null||i()},M=()=>{v(o),a==null||a()},O=()=>{f.setState({nodesDraggable:!x,nodesConnectable:!x,elementsSelectable:!x}),l==null||l(!x)};return j.createElement(mr,{className:ge(["react-flow__controls",c]),position:d,style:e,"data-testid":"rf__controls"},t&&j.createElement(j.Fragment,null,j.createElement(Lt,{onClick:E,className:"react-flow__controls-zoomin",title:"zoom in","aria-label":"zoom in",disabled:m},j.createElement(ih,null)),j.createElement(Lt,{onClick:C,className:"react-flow__controls-zoomout",title:"zoom out","aria-label":"zoom out",disabled:w},j.createElement(ah,null))),n&&j.createElement(Lt,{className:"react-flow__controls-fitview",onClick:M,title:"fit view","aria-label":"fit view"},j.createElement(lh,null)),r&&j.createElement(Lt,{className:"react-flow__controls-interactive",onClick:O,title:"toggle interactivity","aria-label":"toggle interactivity"},x?j.createElement(uh,null):j.createElement(ch,null)),u)};ui.displayName="Controls";var fh=h.memo(ui),Me;(function(e){e.Lines="lines",e.Dots="dots",e.Cross="cross"})(Me||(Me={}));function hh({color:e,dimensions:t,lineWidth:n}){return j.createElement("path",{stroke:e,strokeWidth:n,d:`M${t[0]/2} 0 V${t[1]} M0 ${t[1]/2} H${t[0]}`})}function ph({color:e,radius:t}){return j.createElement("circle",{cx:t,cy:t,r:t,fill:e})}const gh={[Me.Dots]:"#91919a",[Me.Lines]:"#eee",[Me.Cross]:"#e2e2e2"},mh={[Me.Dots]:1,[Me.Lines]:1,[Me.Cross]:6},yh=e=>({transform:e.transform,patternId:`pattern-${e.rfId}`});function di({id:e,variant:t=Me.Dots,gap:n=20,size:r,lineWidth:o=1,offset:s=2,color:i,style:a,className:l}){const c=h.useRef(null),{transform:u,patternId:d}=ee(yh,pe),f=i||gh[t],g=r||mh[t],b=t===Me.Dots,x=t===Me.Cross,w=Array.isArray(n)?n:[n,n],m=[w[0]*u[2]||1,w[1]*u[2]||1],N=g*u[2],S=x?[N,N]:m,v=b?[N/s,N/s]:[S[0]/s,S[1]/s];return j.createElement("svg",{className:ge(["react-flow__background",l]),style:{...a,position:"absolute",width:"100%",height:"100%",top:0,left:0},ref:c,"data-testid":"rf__background"},j.createElement("pattern",{id:d+e,x:u[0]%m[0],y:u[1]%m[1],width:m[0],height:m[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${v[0]},-${v[1]})`},b?j.createElement(ph,{color:f,radius:N/s}):j.createElement(hh,{dimensions:S,color:f,lineWidth:o})),j.createElement("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${d+e})`}))}di.displayName="Background";var xh=h.memo(di);const wh=e=>{var t;return(t=e.domNode)==null?void 0:t.querySelector(".react-flow__renderer")};function bh({children:e}){const t=ee(wh);return t?Po.createPortal(e,t):null}const vh=(e,t)=>{var n,r,o,s,i,a;return((n=e==null?void 0:e.positionAbsolute)==null?void 0:n.x)===((r=t==null?void 0:t.positionAbsolute)==null?void 0:r.x)&&((o=e==null?void 0:e.positionAbsolute)==null?void 0:o.y)===((s=t==null?void 0:t.positionAbsolute)==null?void 0:s.y)&&(e==null?void 0:e.width)===(t==null?void 0:t.width)&&(e==null?void 0:e.height)===(t==null?void 0:t.height)&&(e==null?void 0:e.selected)===(t==null?void 0:t.selected)&&((i=e==null?void 0:e[se])==null?void 0:i.z)===((a=t==null?void 0:t[se])==null?void 0:a.z)},Eh=(e,t)=>e.length===t.length&&e.every((n,r)=>vh(n,t[r])),Nh=e=>({transform:e.transform,nodeOrigin:e.nodeOrigin,selectedNodesCount:e.getNodes().filter(t=>t.selected).length});function Sh(e,t,n,r,o){let s=.5;o==="start"?s=0:o==="end"&&(s=1);let i=[(e.x+e.width*s)*t[2]+t[0],e.y*t[2]+t[1]-r],a=[-100*s,-100];switch(n){case G.Right:i=[(e.x+e.width)*t[2]+t[0]+r,(e.y+e.height*s)*t[2]+t[1]],a=[0,-100*s];break;case G.Bottom:i[1]=(e.y+e.height)*t[2]+t[1]+r,a[1]=0;break;case G.Left:i=[e.x*t[2]+t[0]-r,(e.y+e.height*s)*t[2]+t[1]],a=[-100,-100*s];break}return`translate(${i[0]}px, ${i[1]}px) translate(${a[0]}%, ${a[1]}%)`}function Ch({nodeId:e,children:t,className:n,style:r,isVisible:o,position:s=G.Top,offset:i=10,align:a="center",...l}){const c=Ns(),u=h.useCallback(S=>(Array.isArray(e)?e:[e||c||""]).reduce((E,C)=>{const M=S.nodeInternals.get(C);return M&&E.push(M),E},[]),[e,c]),d=ee(u,Eh),{transform:f,nodeOrigin:g,selectedNodesCount:b}=ee(Nh,pe);if(!(typeof o=="boolean"?o:d.length===1&&d[0].selected&&b===1)||!d.length)return null;const w=Kt(d,g),m=Math.max(...d.map(S=>{var v;return(((v=S[se])==null?void 0:v.z)||1)+1})),N={position:"absolute",transform:Sh(w,f,s,i,a),zIndex:m,...r};return j.createElement(bh,null,j.createElement("div",{style:N,className:ge(["react-flow__node-toolbar",n]),...l},t))}var cn,_h=new Uint8Array(16);function $h(){if(!cn&&(cn=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!cn))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return cn(_h)}const kh=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Ih(e){return typeof e=="string"&&kh.test(e)}var me=[];for(var Gn=0;Gn<256;++Gn)me.push((Gn+256).toString(16).substr(1));function Rh(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=(me[e[t+0]]+me[e[t+1]]+me[e[t+2]]+me[e[t+3]]+"-"+me[e[t+4]]+me[e[t+5]]+"-"+me[e[t+6]]+me[e[t+7]]+"-"+me[e[t+8]]+me[e[t+9]]+"-"+me[e[t+10]]+me[e[t+11]]+me[e[t+12]]+me[e[t+13]]+me[e[t+14]]+me[e[t+15]]).toLowerCase();if(!Ih(n))throw TypeError("Stringified UUID is invalid");return n}function ye(e,t,n){e=e||{};var r=e.random||(e.rng||$h)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,Rh(r)}class be{constructor(t,n,r,o={}){this.id=t,this.type=n,this.label=r||n,this.data=o,this.inputs=[],this.outputs=[],this.state={}}addInput(t,n,r="any",o=!1){return this.inputs.push({id:`input-${t}`,name:t,label:n||t,dataType:r,required:o}),this}addOutput(t,n,r="any"){return this.outputs.push({id:`output-${t}`,name:t,label:n||t,dataType:r}),this}static isCompatibleTypes(t,n){return t===n||t==="any"||n==="any"||t==="number"&&n==="string"}setProperty(t,n){if(this.data[t]=n,t==="name"&&this.type==="variable"&&(this.label=`: ${n}`),t==="operation"&&this.type==="math")switch(n){case"add":this.label="";break;case"subtract":this.label="";break;case"multiply":this.label="";break;case"divide":this.label="";break;default:this.label=". "}return this}getProperty(t){return this.data[t]}execute(t,n={}){throw new Error(" execute     ")}toReactFlowNode(t={x:0,y:0}){return{id:this.id,type:"customNode",position:t,data:{nodeRef:this,type:this.type,label:this.label,inputs:this.inputs,outputs:this.outputs,data:this.data}}}update(){return this}serialize(){return{id:this.id,type:this.type,label:this.label,data:this.data,inputs:this.inputs,outputs:this.outputs}}static deserialize(t){const n=new be(t.id,t.type,t.label,t.data);return n.inputs=t.inputs,n.outputs=t.outputs,n}}let jh=class extends be{constructor(t=ye(),n={}){const r=n.name||"x";super(t,"variable",`: ${r}`,{name:r,initialValue:n.initialValue!==void 0?n.initialValue:"",variableType:n.variableType||"any",...n}),this.addInput("flow","Flow","flow"),this.addInput("value","Value",n.variableType||"any"),this.addOutput("flow","Flow","flow"),this.addOutput("reference","Variable","reference")}execute(t,n){let r=t.value;return r===void 0&&(r=this.data.initialValue),this.data.variableType==="number"&&typeof r!="number"?r=Number(r)||0:this.data.variableType==="string"&&typeof r!="string"?r=String(r):this.data.variableType==="boolean"&&typeof r!="boolean"&&(r=!!r),n.variables&&(n.variables[this.data.name]=r,n.log("output",` ${this.data.name} = ${r}`)),this.state={currentValue:r},{flow:!0,reference:{type:"reference",name:this.data.name,variableType:this.data.variableType}}}setProperty(t,n){if(t==="name"?(super.setProperty(t,n),this.label=`: ${n}`):super.setProperty(t,n),t==="variableType"){const r=this.inputs.filter(o=>o.name==="value");r.length>0&&(r[0].dataType=n)}return this}},Th=class extends be{constructor(t=ye(),n={}){super(t,"print","",{message:n.message||"",...n}),this.addInput("flow","","flow"),this.addInput("value","Value","any"),this.addOutput("flow","","flow")}execute(t,n){const r=t.value!==void 0?t.value:this.data.message;let o;if(r===null)o="null";else if(r===void 0)o="undefined";else if(typeof r=="object")try{o=JSON.stringify(r)}catch{o="[Object]"}else o=String(r);return this.state={value:o},n.console?n.console.push({type:"output",value:o}):console.warn("[PrintNode] Context doesn't have console array"),{flow:!0}}};class Ah extends be{constructor(t=ye(),n={}){super(t,"loop","",{firstIndex:n.firstIndex!==void 0?n.firstIndex:0,lastIndex:n.lastIndex!==void 0?n.lastIndex:5,step:n.step!==void 0?n.step:1,...n}),this.addInput("flow","","flow"),this.addInput("firstIndex"," ","number"),this.addInput("lastIndex"," ","number"),this.addInput("step","","number"),this.addOutput("body"," ","flow"),this.addOutput("next"," ","flow"),this.addOutput("index","","number"),this.reset()}execute(t,n){console.log("  :",this.id," :",JSON.stringify(this.state));const r=t.firstIndex!==void 0?Number(t.firstIndex):Number(this.data.firstIndex),o=t.lastIndex!==void 0?Number(t.lastIndex):Number(this.data.lastIndex),s=t.step!==void 0?Number(t.step)||1:Number(this.data.step)||1,i=s!==0?Math.floor(Math.abs((o-r)/s))+1:0;if(this.state.isFirstRun){this.state={firstIndex:r,lastIndex:o,step:s,count:i,currentIteration:0,currentIndex:r,isFirstRun:!1,isCompleted:!1,bodyEntered:!1};const a=s>0&&r<=o||s<0&&r>=o;return n.setLoopReturn(this.id),console.log(`   :  ${r}  ${o}   ${s}`),n.log("debug",` : ${r}  ${o} ( ${s})`),!a||s===0?(this.state.isCompleted=!0,n.log("debug"," :  "),{next:!0}):{body:!0,index:r}}return this.state.isCompleted?(n.log("debug","  "),{next:!0}):n.loopReturn===this.id?(this.state.currentIteration+=1,this.state.currentIndex+=this.state.step,n.clearLoopReturn(),console.log("  , :",this.state.currentIteration,":",this.state.currentIndex),(this.state.step>0?this.state.currentIndex>this.state.lastIndex:this.state.currentIndex<this.state.lastIndex)?(this.state.isCompleted=!0,n.log("debug",`   ${this.state.currentIteration} `),{next:!0}):(n.log("debug",`:  ${this.state.currentIndex},  ${this.state.currentIteration+1}/${this.state.count}`),n.setLoopReturn(this.id),{body:!0,index:this.state.currentIndex})):(this.reset(),n.log("debug",": "),{})}setProperty(t,n){switch(t){case"firstIndex":case"lastIndex":super.setProperty(t,Number(n));break;case"step":const r=Number(n);super.setProperty(t,r===0?1:r);break;default:super.setProperty(t,n)}return this}reset(){console.log(`  : ${this.id}`),this.state={firstIndex:this.data.firstIndex||0,lastIndex:this.data.lastIndex||5,step:this.data.step||1,count:Math.floor(Math.abs(((this.data.lastIndex||5)-(this.data.firstIndex||0))/(this.data.step||1)))+1,currentIteration:0,currentIndex:this.data.firstIndex||0,isFirstRun:!0,isCompleted:!1,bodyEntered:!1}}}class Mh extends be{constructor(t=ye(),n={}){const r=n.operation||"add";let o;switch(r){case"add":o="";break;case"subtract":o="";break;case"multiply":o="";break;case"divide":o="";break;case"modulo":o="";break;default:o=". "}super(t,"math",o,{operation:r,leftValue:n.leftValue!==void 0?n.leftValue:0,rightValue:n.rightValue!==void 0?n.rightValue:0,leftType:n.leftType||"number",rightType:n.rightType||"number",...n}),this.addInput("flow","Flow","flow"),this.addInput("left","Left","any",!0),this.addInput("right","Right","any",!0),this.addOutput("flow","Flow","flow"),this.addOutput("result","Result","any")}execute(t,n){const r=t.left!==void 0?t.left:this.data.leftValue,o=t.right!==void 0?t.right:this.data.rightValue;let s=r,i=o;this.data.leftType==="number"&&typeof s!="number"&&(s=Number(s)||0),this.data.rightType==="number"&&typeof i!="number"&&(i=Number(i)||0);let a;switch(this.data.operation){case"add":a=s+i;break;case"subtract":a=s-i;break;case"multiply":a=s*i;break;case"divide":i===0?(n.log("error",":   "),a=NaN):a=s/i;break;case"modulo":i===0?(n.log("error",":     "),a=NaN):a=s%i;break;default:a=0}this.state={left:s,right:i,result:a};let l="";switch(this.data.operation){case"add":l="+";break;case"subtract":l="-";break;case"multiply":l="*";break;case"divide":l="/";break;case"modulo":l="%";break}return n.log("output",`: ${s} ${l} ${i} = ${a}`),{flow:!0,result:a}}setProperty(t,n){if(super.setProperty(t,n),t==="operation")switch(n){case"add":this.label="";break;case"subtract":this.label="";break;case"multiply":this.label="";break;case"divide":this.label="";break;case"modulo":this.label="";break;default:this.label=". "}return this}}class Dh extends be{constructor(t=ye(),n={}){const r=n.operation||"equal";let o;switch(r){case"equal":o=" (==)";break;case"notEqual":o="  (!=)";break;case"strictEqual":o="  (===)";break;case"strictNotEqual":o="   (!==)";break;case"greater":o=" (>)";break;case"greaterEqual":o="   (>=)";break;case"less":o=" (<)";break;case"lessEqual":o="   (<=)";break;default:o=". "}super(t,"logical",o,{operation:r,leftValue:n.leftValue!==void 0?n.leftValue:0,rightValue:n.rightValue!==void 0?n.rightValue:0,leftType:n.leftType||"number",rightType:n.rightType||"number",...n}),this.addInput("flow","Flow","flow"),this.addInput("left","Left","any",!0),this.addInput("right","Right","any",!0),this.addOutput("flow","Flow","flow"),this.addOutput("result","Result","boolean")}convertValue(t,n){if(t==null)return null;switch(n){case"number":return Number(t)||0;case"string":return String(t);case"boolean":return!!t;default:return t}}execute(t,n){const r=t.left!==void 0?t.left:this.convertValue(this.data.leftValue,this.data.leftType),o=t.right!==void 0?t.right:this.convertValue(this.data.rightValue,this.data.rightType);let s;switch(this.data.operation){case"equal":s=r==o;break;case"notEqual":s=r!=o;break;case"strictEqual":s=r===o;break;case"strictNotEqual":s=r!==o;break;case"greater":s=r>o;break;case"greaterEqual":s=r>=o;break;case"less":s=r<o;break;case"lessEqual":s=r<=o;break;default:s=!1}return this.state={left:r,right:o,result:s},{flow:!0,result:s}}setProperty(t,n){if(super.setProperty(t,n),t==="operation")switch(n){case"equal":this.label=" (==)";break;case"notEqual":this.label="  (!=)";break;case"strictEqual":this.label="  (===)";break;case"strictNotEqual":this.label="   (!==)";break;case"greater":this.label=" (>)";break;case"greaterEqual":this.label="   (>=)";break;case"less":this.label=" (<)";break;case"lessEqual":this.label="   (<=)";break;default:this.label=". "}return this}}class Vh extends be{constructor(t=ye(),n={}){super(t,"if","",n),this.addInput("flow","","flow"),this.addInput("test","Test","boolean",!0),this.addOutput("true","True","flow"),this.addOutput("false","False","flow"),this.addOutput("result","Result","boolean")}execute(t,n){const r=t.test,o=!!r;return this.state={test:r,result:o},{...o?{true:!0}:{false:!0},result:o}}}let Ph=class extends be{constructor(t=ye(),n={}){super(t,"assignment","",{...n}),this.addInput("flow","Flow","flow"),this.addInput("left","left","reference",!0),this.addInput("right","right","any",!0),this.addOutput("flow","Flow","flow"),this.addOutput("result","Result","any")}execute(t,n){console.log("AssignmentNode execute.  :",JSON.stringify(t));let r=t.left,o=t.right;if(typeof r=="string"&&(r={type:"reference",name:r,variableType:"any"},console.log("   :",JSON.stringify(r))),!r||r.type!=="reference"||!r.name)throw new Error("     ");if(o===void 0)throw new Error("    ");return r.variableType==="number"&&typeof o!="number"?o=Number(o)||0:r.variableType==="string"&&typeof o!="string"?o=String(o):r.variableType==="boolean"&&typeof o!="boolean"&&(o=!!o),n.variables&&(n.variables[r.name]=o,n.log("output",` "${r.name}"  : ${o}`)),this.state={variableName:r.name,value:o,result:o},{flow:!0,result:o}}},Oh=class extends be{constructor(t=ye(),n={}){const r=n.operation||"and";let o;switch(r){case"and":o=" ";break;case"or":o=" ";break;default:o=" "}super(t,"booleanLogic",o,{operation:r,...n}),this.addInput("flow","Flow","flow"),this.addInput("left","Left","boolean",!0),this.addInput("right","Right","boolean",!0),this.addOutput("flow","Flow","flow"),this.addOutput("result","Result","boolean")}execute(t,n){if(t.left===void 0||t.right===void 0)throw new Error("     ");const r=!!t.left,o=!!t.right;let s;switch(this.data.operation){case"and":s=r&&o;break;case"or":s=r||o;break;default:s=!1}const i=this.data.operation==="and"?"&&":"||",a=this.data.operation==="and"?"":"";return n.log("output",` ${a}: ${r} ${i} ${o} = ${s}`),this.state={left:r,right:o,result:s},{flow:!0,result:s}}setProperty(t,n){if(super.setProperty(t,n),t==="operation")switch(n){case"and":this.label=" ";break;case"or":this.label=" ";break;default:this.label=" "}return this}};const te={PLAYER_MOVE:"PLAYER_MOVE_SIGNAL",PLAYER_TURN:"PLAYER_TURN_SIGNAL",PLAYER_JUMP:"PLAYER_JUMP_SIGNAL",WALL_CHECK:"WALL_CHECK_SIGNAL",EXIT_CHECK:"EXIT_CHECK_SIGNAL",NODE_EXECUTED:"NODE_EXECUTED_SIGNAL"},bt=new Map;function re(e,t={},n=null){console.log(`[SignalSystem]  : ${e}`,t);const r={type:e,data:t,sender:n,timestamp:Date.now()};if(typeof window<"u"&&window.document)try{const s=new CustomEvent("signal",{detail:r,bubbles:!0,cancelable:!0});window.dispatchEvent(s)}catch(s){console.error("    :",s)}if(!bt.has(e))return;bt.get(e).forEach(s=>{try{s(r)}catch(i){console.error(`[SignalSystem]     ${e}:`,i)}})}function Lh(e,t){bt.has(e)||bt.set(e,new Set);const n=bt.get(e);return n.add(t),()=>{n.delete(t),n.size===0&&bt.delete(e)}}function Hh(e){const t=Object.values(te).map(n=>Lh(n,e));return()=>{t.forEach(n=>n())}}typeof window<"u"&&(window.SIGNALS=te,window.sendTestSignal=(e,t)=>{console.log("  :",e,t),re(e,t,{source:"test"})});let zh=class extends be{constructor(t=ye(),n={}){super(t,"player","",{...n}),this.addInput("flow","Flow","flow"),this.addOutput("flow","Flow","flow"),this.addOutput("actions","","List"),this.addOutput("direction","","string")}execute(t,n){try{let r={position:{x:0,y:0},direction:"east"},o={walls:[],exit:{x:0,y:0}};if(n.scene3d)try{return r=n.scene3d.getPlayerState(),o=n.scene3d.getMapState(),this.state={position:r.position,direction:r.direction,mapState:o},n.log("output",`:  (${r.position.x}, ${r.position.y}), : ${r.direction}`),{flow:!0,position:r.position,direction:r.direction}}catch(i){console.error("      :",i)}typeof window<"u"&&window.signalVisualizerData&&(r=window.signalVisualizerData.playerState,o=window.signalVisualizerData.environmentState),this.state={position:r.position,direction:r.direction,mapState:o},n&&n.log("output",`:  (${r.position.x}, ${r.position.y}), : ${r.direction}`);const s={position:r.position,direction:r.direction,mapState:o};return re(te.NODE_EXECUTED,{nodeType:this.type,nodeId:this.id,operation:"playerStatus",result:s},this),{flow:!0,position:r.position,direction:r.direction}}catch(r){throw console.error("   :",r),n&&n.log("error",`   "": ${r.message}`),re(te.NODE_EXECUTED,{nodeType:this.type,nodeId:this.id,operation:"playerStatus",error:r.message,result:!1},this),r}}},Fh=class extends be{constructor(t=ye(),n={}){super(t,"move","",{steps:n.steps!==void 0?n.steps:1,...n}),this.addInput("flow","Flow","flow"),this.addInput("entity","","Object"),this.addOutput("flow","Flow","flow"),this.addOutput("success","","boolean")}execute(t,n){var r;try{const o=this.data.steps;if(n.scene3d&&typeof((r=n.scene3d.nodeActions)==null?void 0:r.movePlayerNode)=="function"){const s=n.scene3d.nodeActions.movePlayerNode(o);return this.state={success:s.success,steps:o},re(te.PLAYER_MOVE,s,this),re(te.NODE_EXECUTED,{nodeType:this.type,nodeId:this.id,operation:"move",result:s.success},this),{flow:!0,success:s.success}}else{let s=!0,i={x:0,y:0},a="east";if(typeof window<"u"&&window.signalVisualizerData){const c=window.signalVisualizerData.playerState,u=window.signalVisualizerData.environmentState.walls,d=window.signalVisualizerData.environmentState.gridSize;i={...c.position},a=c.direction;const f={...i};switch(a){case"north":f.y-=o;break;case"east":f.x+=o;break;case"south":f.y+=o;break;case"west":f.x-=o;break}const g=f.x<0||f.x>=d||f.y<0||f.y>=d,b=u.some(x=>x.x===f.x&&x.y===f.y);s=!g&&!b,s&&(window.signalVisualizerData.playerState.position=f,window.signalVisualizerData.notifyUpdateCallbacks(),i=f)}this.state={success:s,steps:o};const l={success:s,steps:o,position:i,direction:a};return re(te.PLAYER_MOVE,l,this),n&&(s?n.log("output",`   ${o} ()`):n.log("output","   -  ")),re(te.NODE_EXECUTED,{nodeType:this.type,nodeId:this.id,operation:"move",result:s},this),{flow:!0,success:s}}}catch(o){throw console.error("   :",o),n&&n.log("error",`   "": ${o.message}`),re(te.NODE_EXECUTED,{nodeType:this.type,nodeId:this.id,operation:"move",error:o.message,result:!1},this),o}}},Bh=class extends be{constructor(t=ye(),n={}){const o=` ${n.direction==="left"?"":""}`;super(t,"turn",o,{direction:n.direction||"right",...n}),this.addInput("flow","Flow","flow"),this.addInput("entity","","object"),this.addOutput("flow","Flow","flow"),this.addOutput("direction","","string")}execute(t,n){var r;try{const o=this.data.direction;if(n.scene3d&&typeof((r=n.scene3d.nodeActions)==null?void 0:r.turnPlayerNode)=="function"){const s=n.scene3d.nodeActions.turnPlayerNode(o);return this.state={turnDirection:o,previousDirection:s.previousDirection,newDirection:s.newDirection},re(te.PLAYER_TURN,s,this),re(te.NODE_EXECUTED,{nodeType:this.type,nodeId:this.id,operation:"turn",direction:o,result:!0},this),{flow:!0,direction:s.newDirection}}else{const s={left:{north:"west",west:"south",south:"east",east:"north"},right:{north:"east",east:"south",south:"west",west:"north"}};let i="east";typeof window<"u"&&window.signalVisualizerData&&(i=window.signalVisualizerData.playerState.direction||i);const a=s[o][i];if(!a)return console.error(`     : ${o}, ${i}`),console.log(" :",s),console.log(" :",{direction:o,currentDirection:i}),n&&n.log("error",` :   ${i}`),{flow:!0,direction:i};this.state={turnDirection:o,previousDirection:i,newDirection:a},typeof window<"u"&&window.signalVisualizerData&&(window.signalVisualizerData.playerState.direction=a,window.signalVisualizerData.notifyUpdateCallbacks());const l={direction:o,previousDirection:i,newDirection:a,success:!0};if(re(te.PLAYER_TURN,l,this),n){const c=o==="left"?"":"";n.log("output",`  ${c},  : ${a}`)}return re(te.NODE_EXECUTED,{nodeType:this.type,nodeId:this.id,operation:"turn",direction:o,result:!0},this),{flow:!0,direction:a}}}catch(o){throw console.error("   :",o),n&&n.log("error",`   "": ${o.message}`),re(te.NODE_EXECUTED,{nodeType:this.type,nodeId:this.id,operation:"turn",error:o.message,result:!1},this),o}}setProperty(t,n){if(super.setProperty(t,n),t==="direction"){const r=n==="left"?"":"";this.label=` ${r}`}return this}},Wh=class extends be{constructor(t=ye(),n={}){super(t,"wallAhead"," ",n),this.addInput("flow","Flow","flow"),this.addInput("entity","","object"),this.addOutput("true","","flow"),this.addOutput("false","","flow"),this.addOutput("result","","boolean")}execute(t,n){var r;try{if(n.scene3d&&typeof((r=n.scene3d.nodeActions)==null?void 0:r.checkWallNode)=="function"){const o=n.scene3d.nodeActions.checkWallNode();return this.state={result:o.wallExists},re(te.WALL_CHECK,o,this),re(te.NODE_EXECUTED,{nodeType:this.type,nodeId:this.id,operation:"wallCheck",result:o.wallExists},this),{...o.wallExists?{true:!0}:{false:!0},result:o.wallExists}}else{let o=!1,s={x:0,y:0},i="east",a={x:0,y:0};if(typeof window<"u"&&window.signalVisualizerData){const c=window.signalVisualizerData.playerState,u=window.signalVisualizerData.environmentState.walls,d=window.signalVisualizerData.environmentState.gridSize;switch(s=c.position,i=c.direction,a={...s},i){case"north":a.y-=1;break;case"east":a.x+=1;break;case"south":a.y+=1;break;case"west":a.x-=1;break}const f=a.x<0||a.x>=d||a.y<0||a.y>=d,g=u.some(b=>b.x===a.x&&b.y===a.y);o=f||g}else o=Math.random()<.5;this.state={result:o};const l={wallExists:o,position:s,direction:i,obstaclePosition:o?a:null};return re(te.WALL_CHECK,l,this),n&&n.log("output",`  : ${o?" ":" "}`),console.log("  :",l),re(te.NODE_EXECUTED,{nodeType:this.type,nodeId:this.id,operation:"wallCheck",result:o},this),{...o?{true:!0}:{false:!0},result:o}}}catch(o){throw console.error("    :",o),n&&n.log("error",`   " ": ${o.message}`),re(te.NODE_EXECUTED,{nodeType:this.type,nodeId:this.id,operation:"wallCheck",error:o.message,result:!1},this),o}}},Uh=class extends be{constructor(t=ye(),n={}){super(t,"exitReached"," ",n),this.addInput("flow","Flow","flow"),this.addInput("entity","","object"),this.addOutput("true","","flow"),this.addOutput("false","","flow"),this.addOutput("result","","boolean")}execute(t,n){var r;try{if(n.scene3d&&typeof((r=n.scene3d.nodeActions)==null?void 0:r.checkExitNode)=="function"){const o=n.scene3d.nodeActions.checkExitNode();if(this.state={isReached:o.isReached,position:o.position,exitPosition:o.exitPosition},re(te.EXIT_CHECK,o,this),n){const s=o.isReached?"":" ";n.log("output",` :  ${s}`),o.isReached&&n.log("output","!   !")}return re(te.NODE_EXECUTED,{nodeType:this.type,nodeId:this.id,operation:"exitCheck",result:o.isReached},this),{...o.isReached?{true:!0}:{false:!0},result:o.isReached}}else{let o=!1,s={x:0,y:0},i={x:10,y:10};if(typeof window<"u"&&window.signalVisualizerData){const l=window.signalVisualizerData.playerState,c=window.signalVisualizerData.environmentState.exit;s=l.position,i=c,o=s.x===c.x&&s.y===c.y}else o=Math.random()<.3;this.state={isReached:o,position:s,exitPosition:i};const a={isReached:o,position:s,exitPosition:i};if(re(te.EXIT_CHECK,a,this),n){const l=o?"":" ";n.log("output",` :  ${l}`),o&&n.log("output","!   !")}return re(te.NODE_EXECUTED,{nodeType:this.type,nodeId:this.id,operation:"exitCheck",result:o},this),{...o?{true:!0}:{false:!0},result:o}}}catch(o){throw console.error("    :",o),n&&n.log("error",`   " ": ${o.message}`),re(te.NODE_EXECUTED,{nodeType:this.type,nodeId:this.id,operation:"exitCheck",error:o.message,result:!1},this),o}}},Gh=class extends be{constructor(t=ye(),n={}){super(t,"jump","",n),this.addInput("flow","Flow","flow"),this.addOutput("flow","Flow","flow"),this.addOutput("success","","boolean")}execute(t,n){var r;try{if(n.scene3d&&typeof((r=n.scene3d.nodeActions)==null?void 0:r.jumpPlayerNode)=="function"){const o=n.scene3d.nodeActions.jumpPlayerNode();if(this.state={success:o.success,executed:!0},re(te.PLAYER_JUMP,o,this),n){const s=o.success?" ":"   ";n.log("output",s)}return re(te.NODE_EXECUTED,{nodeType:this.type,nodeId:this.id,operation:"jump",result:o.success},this),{flow:!0,success:o.success}}else{let o=!0,s={x:0,y:0};typeof window<"u"&&window.signalVisualizerData&&(s=window.signalVisualizerData.playerState.position,window.signalVisualizerData.playerState.isJumping=!0,window.signalVisualizerData.notifyUpdateCallbacks(),setTimeout(()=>{window.signalVisualizerData.playerState.isJumping=!1,window.signalVisualizerData.notifyUpdateCallbacks()},1e3)),this.state={success:o,executed:!0};const i={success:o,height:1,position:s};if(re(te.PLAYER_JUMP,i,this),n){const a=o?" ":"   ";n.log("output",a)}return console.log(` : success=${o}, height=${i.height}`),re(te.NODE_EXECUTED,{nodeType:this.type,nodeId:this.id,operation:"jump",result:o},this),{flow:!0,success:o}}}catch(o){throw console.error("   :",o),n&&n.log("error",`   "": ${o.message}`),re(te.NODE_EXECUTED,{nodeType:this.type,nodeId:this.id,operation:"jump",error:o.message,result:!1},this),o}}};const Xh={variable:jh,print:Th,loop:Ah,math:Mh,logical:Dh,if:Vh,assignment:Ph,booleanLogic:Oh,player:zh,move:Fh,turn:Bh,wallAhead:Wh,exitReached:Uh,jump:Gh};function Yt(e,t={}){if(e==="number")return Yt("variable",{...t,variableType:"number",initialValue:t.value||0});if(e==="string")return Yt("variable",{...t,variableType:"string",initialValue:t.value||""});const n=Xh[e];if(!n)throw new Error(`  : ${e}`);return new n(t.id||ye(),t)}const Ye=()=>{if(typeof window>"u"||!window.localStorage)return!1;try{const e="_test_localStorage_";return localStorage.setItem(e,"1"),localStorage.removeItem(e),!0}catch(e){return console.error("localStorage :",e),!1}},he={serializeGraph(e,t,n={}){if(!e||!Array.isArray(e)||!t||!Array.isArray(t))throw console.error(":    ",{nodes:e,edges:t}),new Error("   ");try{const r=e.map(i=>{var a,l,c,u;try{if(i.data&&i.data.nodeRef){const d={id:i.id,type:i.data.type,position:i.position||{x:0,y:0},data:i.data.nodeRef.serialize()};return i.data.nodeRef.data&&(d.data.data=JSON.parse(JSON.stringify(i.data.nodeRef.data))),d}else return{id:i.id,type:((a=i.data)==null?void 0:a.type)||"unknown",position:i.position||{x:0,y:0},data:{...i.data||{},content:void 0,nodeRef:void 0}}}catch(d){return console.error(`    ${i.id}:`,d),{id:i.id,type:((l=i.data)==null?void 0:l.type)||"unknown",position:i.position||{x:0,y:0},data:{id:i.id,type:((c=i.data)==null?void 0:c.type)||"unknown",label:((u=i.data)==null?void 0:u.label)||" "}}}}),o=t.map(i=>({id:i.id,source:i.source,target:i.target,sourceHandle:i.sourceHandle,targetHandle:i.targetHandle,animated:i.animated,style:i.style})),s={version:n.version||"1.0.0",createdAt:n.createdAt||new Date().toISOString(),updatedAt:new Date().toISOString(),versionHistory:n.versionHistory||[],...n};return{nodes:r,edges:o,metadata:s}}catch(r){throw console.error("   :",r),new Error(`   : ${r.message}`)}},deserializeGraph(e){if(!e||!e.nodes||!e.edges)throw console.error("  :",e),new Error("  ");if(!Array.isArray(e.nodes)||!Array.isArray(e.edges)){console.warn("    ,  ");let t=Array.isArray(e.nodes)?e.nodes:[],n=Array.isArray(e.edges)?e.edges:[];if(e.nodes&&typeof e.nodes=="object"&&!Array.isArray(e.nodes))if(e.nodes.node&&Array.isArray(e.nodes.node))t=e.nodes.node;else if(e.nodes.item&&Array.isArray(e.nodes.item))t=e.nodes.item;else{const r=Object.values(e.nodes).filter(o=>Array.isArray(o));r.length>0&&(t=r[0])}if(e.edges&&typeof e.edges=="object"&&!Array.isArray(e.edges))if(e.edges.edge&&Array.isArray(e.edges.edge))n=e.edges.edge;else if(e.edges.item&&Array.isArray(e.edges.item))n=e.edges.item;else{const r=Object.values(e.edges).filter(o=>Array.isArray(o));r.length>0&&(n=r[0])}if(e.nodes=t,e.edges=n,e.nodes.length===0&&e.edges.length===0)throw new Error("      ")}try{const t=e.nodes.map(o=>{var s,i,a,l;try{let c;try{const u={id:o.id,...o.data};o.data&&o.data.data&&Object.assign(u,o.data.data),c=Yt(o.type,u),o.data&&o.data.data&&Object.entries(o.data.data).forEach(([d,f])=>{f!==void 0&&c.setProperty(d,f)})}catch(u){return console.warn(`     ${o.type}:`,u),{id:o.id,type:"customNode",position:o.position||{x:0,y:0},data:{id:o.id,type:o.type||"unknown",label:((s=o.data)==null?void 0:s.label)||o.type||" ",inputs:((i=o.data)==null?void 0:i.inputs)||[],outputs:((a=o.data)==null?void 0:a.outputs)||[]}}}return{id:o.id,type:"customNode",position:o.position||{x:0,y:0},data:{nodeRef:c,id:c.id,type:c.type,label:c.label,inputs:c.inputs,outputs:c.outputs,content:c.content}}}catch(c){return console.error(`    ${o.id}:`,c),{id:o.id,type:"customNode",position:o.position||{x:0,y:0},data:{id:o.id,type:o.type||"unknown",label:": "+(((l=o.data)==null?void 0:l.label)||o.type||" "),inputs:[],outputs:[]}}}}),n={};t.forEach(o=>{n[o.id]=o});const r=e.edges.filter(o=>{var c,u;const s=n[o.source],i=n[o.target];if(!s||!i)return console.warn(` :      : ${o.id}`),!1;const a=!o.sourceHandle||((c=s.data.outputs)==null?void 0:c.some(d=>d.id===o.sourceHandle)),l=!o.targetHandle||((u=i.data.inputs)==null?void 0:u.some(d=>d.id===o.targetHandle));return!a||!l?(console.warn(` :   : ${o.id}, : ${o.sourceHandle}, : ${o.targetHandle}`),!1):!0}).map(o=>{var s,i;try{return{id:o.id,source:o.source,target:o.target,sourceHandle:o.sourceHandle,targetHandle:o.targetHandle,animated:o.animated||((s=o.sourceHandle)==null?void 0:s.includes("flow"))||((i=o.targetHandle)==null?void 0:i.includes("flow")),style:o.style||{stroke:"#555",strokeWidth:2},type:"animatedEdge"}}catch(a){return console.error(`    ${o.id}:`,a),null}}).filter(Boolean);return{nodes:t,edges:r,metadata:e.metadata||{}}}catch(t){throw console.error("   :",t),new Error(`   : ${t.message}`)}},saveToLocalStorage(e,t,n={}){if(!Ye())return console.error("localStorage "),!1;if(!e||e.trim()==="")return console.error("     "),!1;try{const r=this.loadFromLocalStorage(e);r&&r.metadata&&(t.metadata={...r.metadata,...t.metadata,...n,updatedAt:new Date().toISOString()});const o=e.trim();if(o==="")return console.error("      (  )"),!1;const s=`nodeEditor_project_${o}`,i=JSON.stringify(t);if(localStorage.setItem(s,i),!localStorage.getItem(s))return console.error("   :   "),!1;const l=this.getProjectsList();return l.includes(o)||(l.push(o),localStorage.setItem("nodeEditor_projects",JSON.stringify(l))),console.log(` "${o}"  , : ${i.length} `),!0}catch(r){return console.error("     localStorage:",r),!1}},loadFromLocalStorage(e){if(!Ye())return console.error("localStorage "),null;if(!e||e.trim()==="")return console.error("     "),null;try{const t=`nodeEditor_project_${e.trim()}`,n=localStorage.getItem(t);return n?JSON.parse(n):(console.warn(` "${e}"    localStorage`),null)}catch(t){return console.error(`    "${e}"  localStorage:`,t),null}},getProjectsList(){if(!Ye())return console.warn("localStorage ,    "),[];try{const e=localStorage.getItem("nodeEditor_projects");return e?JSON.parse(e):[]}catch(e){return console.error("    :",e),[]}},deleteProject(e){if(!Ye())return console.error("localStorage "),!1;if(!e||e.trim()==="")return console.error("     "),!1;try{const n=this.getProjectsList().filter(o=>o!==e.trim());return localStorage.setItem("nodeEditor_projects",JSON.stringify(n)),localStorage.removeItem(`nodeEditor_project_${e.trim()}`),this.getProjectVersions(e).forEach(o=>{localStorage.removeItem(`nodeEditor_version_${e.trim()}_${o.name}`)}),console.log(` "${e}"  `),!0}catch(t){return console.error(`    "${e}":`,t),!1}},createProjectVersion(e,t,n=""){if(!Ye()||!e)return!1;try{const r=e.trim(),o=`nodeEditor_project_${r}`,s=localStorage.getItem(o);if(!s)return console.error(`   "${e}"   `),!1;const i=JSON.parse(s),l=`${`nodeEditor_version_${r}_`}${t}`;localStorage.getItem(l)&&console.warn(`   "${t}"  `);const c={name:t,date:new Date().toISOString(),comment:n,snapshot:i};localStorage.setItem(l,JSON.stringify(c)),console.log(` "${t}"   "${e}"   localStorage`),i.metadata||(i.metadata={}),i.metadata.versionHistory||(i.metadata.versionHistory=[]);const u=i.metadata.versionHistory.findIndex(d=>d.name===t);return u>=0?i.metadata.versionHistory[u]={name:t,date:c.date,comment:n}:i.metadata.versionHistory.push({name:t,date:c.date,comment:n}),i.metadata.updatedAt=new Date().toISOString(),localStorage.setItem(o,JSON.stringify(i)),!0}catch(r){return console.error(`     "${e}":`,r),!1}},getProjectVersions(e){if(!Ye()||!e)return[];try{const n=`nodeEditor_version_${e.trim()}_`,r=[];for(let o=0;o<localStorage.length;o++){const s=localStorage.key(o);if(s&&s.startsWith(n))try{const i=JSON.parse(localStorage.getItem(s));i&&i.name&&i.date&&r.push({name:i.name,date:i.date,comment:i.comment||""})}catch(i){console.warn(`       ${s}:`,i)}}return r.sort((o,s)=>new Date(s.date)-new Date(o.date)),r}catch(t){return console.error(`     "${e}":`,t),[]}},loadProjectVersion(e,t){if(!Ye()||!e||!t)return null;try{const n=`nodeEditor_version_${e.trim()}_${t}`,r=localStorage.getItem(n);return r?JSON.parse(r).snapshot:null}catch(n){return console.error(`    "${t}"  "${e}":`,n),null}},deleteProjectVersion(e,t){if(!Ye()||!e||!t)return!1;try{const n=e.trim(),r=`nodeEditor_project_${n}`,o=`nodeEditor_version_${n}_${t}`;localStorage.removeItem(o);const s=localStorage.getItem(r);if(s)try{const i=JSON.parse(s);i.metadata&&i.metadata.versionHistory&&(i.metadata.versionHistory=i.metadata.versionHistory.filter(a=>a.name!==t),i.metadata.updatedAt=new Date().toISOString(),localStorage.setItem(r,JSON.stringify(i)))}catch(i){console.warn("       :",i)}return console.log(` "${t}"  "${e}"  `),!0}catch(n){return console.error(`    "${t}"  "${e}":`,n),!1}},exportToFile(e,t){if(typeof document>"u")return console.error("document ,  "),!1;try{const n=(e==null?void 0:e.trim())||"project",r=encodeURIComponent(JSON.stringify(t,null,2)),o="application/json",i=`${n}_${new Date().toISOString().slice(0,10)}.json`,a=`data:${o};charset=utf-8,${r}`,l=document.createElement("a");return l.setAttribute("href",a),l.setAttribute("download",i),l.style.display="none",document.body.appendChild(l),l.click(),document.body.removeChild(l),console.log(` "${e}"     ${i}`),!0}catch(n){return console.error("     :",n),!1}},importFromFile(e){return new Promise((t,n)=>{if(typeof FileReader>"u"){n(new Error("FileReader "));return}if(!e){n(new Error("  "));return}const r=new FileReader;r.onload=o=>{var s;try{if(!((s=o.target)!=null&&s.result))throw new Error("    ");const i=o.target.result;let a;if(e.name.split(".").pop().toLowerCase()==="json")a=JSON.parse(i);else throw new Error("   JSON");if((!a.nodes||!a.edges)&&a.nodeEditorProject&&(a=a.nodeEditorProject),!a.nodes||!a.edges)throw new Error("       (  )");console.log(` ${e.name}  , :`,a),t(a)}catch(i){console.error(`     ${e.name}:`,i),n(new Error(`    : ${i.message}`))}},r.onerror=()=>{console.error(`   ${e.name}`),n(new Error("  "))},r.readAsText(e)})}},fi=h.createContext(),mp=({children:e})=>{const[t,n,r]=Yf([]),[o,s,i]=Zf([]),[a,l]=h.useState(""),[c,u]=h.useState([]),[d,f]=h.useState([]),[g,b]=h.useState(!1),[x,w]=h.useState(null),[m,N]=h.useState(!1),[S,v]=h.useState(null),[E,C]=h.useState(null),[M,O]=h.useState(!1),A=!!(a&&a.trim()!==""),L=h.useRef({}),H=h.useCallback(()=>{if(m)try{const R=he.getProjectsList();u(R),console.log("  :",R)}catch(R){console.error("    :",R)}},[m]);L.current.refreshProjectsList=H;const W=h.useCallback(()=>{if(m&&a)try{console.log(`    "${a}"...`);const R=he.getProjectVersions(a);console.log(` ${R.length} :`,R),f(R)}catch(R){console.error("    :",R)}},[m,a]);L.current.refreshVersionsList=W;const z=h.useCallback((R,D="")=>{if(v(null),!m){const B="  : localStorage ";return console.warn(B),v(B),!1}if(!a){const B="   ";return console.warn(B),v(B),!1}if(!R){const B="   ";return console.warn(B),v(B),!1}try{const B=he.serializeGraph(t,o);if(!he.saveToLocalStorage(a,B)){const Z="      ";return console.error(Z),v(Z),!1}if(he.createProjectVersion(a,R,D))return console.log(` "${R}"  "${a}"  `),W(),!0;{const Z=`    "${R}"  "${a}"`;return console.error(Z),v(Z),!1}}catch(B){return console.error("    :",B),v(`   : ${B.message}`),!1}},[a,t,o,m,W]);L.current.createProjectVersion=z;const y=h.useCallback(R=>{if(C(null),!m){const D="  : localStorage ";return console.warn(D),C(D),!1}if(!a){const D="   ";return console.warn(D),C(D),!1}if(!R){const D="   ";return console.warn(D),C(D),!1}try{const D=he.loadProjectVersion(a,R);if(!D){const q=` "${R}"  "${a}"  `;return console.error(q),C(q),!1}try{const q=`nodeEditor_project_${a.trim()}`,Z=localStorage.getItem(q);if(Z){const K=JSON.parse(Z);K.metadata||(K.metadata={}),K.metadata.lastLoadedVersion=R,K.metadata.updatedAt=new Date().toISOString(),localStorage.setItem(q,JSON.stringify(K))}}catch(q){console.warn("      :",q)}const{nodes:B,edges:U}=he.deserializeGraph(D);return n([]),s([]),setTimeout(()=>{n(B),s(U),b(!1),w(null),O(!0),console.log(` "${R}"  "${a}"  `)},100),!0}catch(D){return console.error(`    "${R}"  "${a}":`,D),C(`   : ${D.message}`),!1}},[a,m,n,s,b,w,O,C]);L.current.loadProjectVersion=y;const k=h.useCallback(R=>{if(!m)return console.warn("  : localStorage "),!1;if(!a)return console.warn("   "),!1;if(!R)return console.warn("   "),!1;try{return he.deleteProjectVersion(a,R)?(console.log(` "${R}"  "${a}"  `),W(),!0):(console.error(`    "${R}"  "${a}"`),!1)}catch(D){return console.error(`    "${R}"  "${a}":`,D),!1}},[a,m,W]);L.current.deleteProjectVersion=k;const _=h.useCallback((R=null)=>{v(null);let D=!1;try{const U="__test__";localStorage.setItem(U,U),localStorage.removeItem(U),D=!0}catch{D=!1}if(!D){const U="  : localStorage . ,          .";return console.warn(U),v(U),!1}const B=R||a;if(!B||B.trim()===""){const U="     ";return console.warn(U),v(U),!1}try{const U=he.serializeGraph(t,o);if(console.log(" :",U),he.saveToLocalStorage(B,U))return console.log(` "${B}"  `),l(B),b(!1),H(),!0;{const Z=`    "${B}"`;return console.error(Z),v(Z),!1}}catch(U){return console.error("   :",U),v(`  : ${U.message}`),!1}},[t,o,a,H]);L.current.saveProject=_;const P=h.useCallback((R,D=!1)=>{if(v(null),!R||R.trim()===""){const B="     ";return console.warn(B),v(B),!1}g&&a&&a!==R&&window.confirm(` "${a}"  .      ?`)&&L.current.saveProject(a);try{l(R),D||(n([]),s([])),b(!1),w(null),v(null),C(null);const B=he.serializeGraph(D?t:[],D?o:[]);return he.saveToLocalStorage(R,B),H(),console.log(`  : ${R}${D?"   ":""}`),!0}catch(B){const U=`   : ${B.message}`;return console.error(U),v(U),!1}},[t,o,n,s,g,a,H]);L.current.createNewProject=P;const F=h.useCallback(R=>{if(C(null),!m){const D="  : localStorage ";return console.warn(D),C(D),!1}if(!R||R.trim()===""){const D="     ";return console.warn(D),C(D),!1}g&&a&&a!==R&&window.confirm(` "${a}"  .      ?`)&&L.current.saveProject(a);try{const D=he.loadFromLocalStorage(R);if(!D){const B=` "${R}"  `;return console.error(B),C(B),!1}console.log(`  "${R}"`,D);try{const{nodes:B,edges:U}=he.deserializeGraph(D);return n([]),s([]),setTimeout(()=>{n(B),s(U),l(R),b(!1),w(null),W(),O(!0),console.log(` "${R}"  `,{nodes:B,edges:U})},100),!0}catch(B){return console.error("   :",B),C(`  : ${B.message}`),!1}}catch(D){return console.error("   :",D),C(`  : ${D.message}`),!1}},[n,s,m,g,a,O,l,b,w,C,W]);L.current.loadProject=F;const $=h.useCallback(R=>{if(!m)return console.warn("    "),!1;if(!R||R.trim()==="")return console.warn("     "),!1;try{return he.deleteProject(R)?(console.log(` "${R}"  `),H(),R===a&&(l(" "),n([]),s([]),b(!1),w(null),v(null),C(null)),!0):(console.error(`    "${R}"`),!1)}catch(D){return console.error("   :",D),!1}},[a,m,H]);L.current.deleteProject=$;const V=h.useCallback(()=>{if(!m)return console.warn("    "),!1;try{const R=he.serializeGraph(t,o);return he.exportToFile(a,R)}catch(R){return console.error("   :",R),!1}},[t,o,a,m]),I=h.useCallback(async R=>{if(!m)return console.warn("    "),!1;try{g&&a&&window.confirm(` "${a}"  .    ?`)&&L.current.saveProject(a);const D=await he.importFromFile(R),{nodes:B,edges:U}=he.deserializeGraph(D);n(B),s(U);const q=R.name.replace(/\.json$/i,"");return l(q),b(!0),w(null),O(!0),!0}catch(D){return console.error("   :",D),!1}},[n,s,m,g,a]),T={nodes:t,edges:o,projectName:a,hasActiveProject:A,projectsList:c,projectVersions:d,isModified:g,selectedNodeId:x,isBrowser:m,saveError:S,loadError:E,needsFitView:M,setNodes:n,setEdges:s,onNodesChange:r,onEdgesChange:i,setProjectName:l,setIsModified:b,setSelectedNodeId:w,setNeedsFitView:O,createNewProject:P,saveProject:_,loadProject:F,deleteProject:$,exportProject:V,importProject:I,refreshProjectsList:H,createProjectVersion:z,loadProjectVersion:y,refreshVersionsList:W,deleteProjectVersion:k};return p.jsx(fi.Provider,{value:T,children:e})},Yh=()=>{const e=h.useContext(fi);if(!e)throw new Error("useEditor    EditorProvider");return e},yp=({notification:e,onClose:t,autoHideTime:n=0})=>{const[r,o]=h.useState(0),[s,i]=h.useState(0);if(h.useEffect(()=>{if(!e)return;let d=n;if(n===0)switch(e.type){case"error":d=1e4;break;case"warning":d=8e3;break;case"success":d=5e3;break;case"info":default:d=7e3;break}if(o(d),i(d),d>0){const f=setTimeout(()=>{t()},d);return()=>clearTimeout(f)}},[e,n,t]),!e)return null;const a=()=>{switch(e.type){case"error":return{icon:p.jsx(Mr,{className:"h-5 w-5 text-red-500"}),style:"bg-red-100 text-red-800 border-l-4 border-red-500",progressColor:"bg-red-500"};case"warning":return{icon:p.jsx(Mr,{className:"h-5 w-5 text-yellow-500"}),style:"bg-yellow-100 text-yellow-800 border-l-4 border-yellow-500",progressColor:"bg-yellow-500"};case"success":return{icon:p.jsx(Zi,{className:"h-5 w-5 text-green-500"}),style:"bg-green-100 text-green-800 border-l-4 border-green-500",progressColor:"bg-green-500"};case"info":default:return{icon:p.jsx(ha,{className:"h-5 w-5 text-blue-500"}),style:"bg-blue-100 text-blue-800 border-l-4 border-blue-500",progressColor:"bg-blue-500"}}},{icon:l,style:c,progressColor:u}=a();return p.jsxs("div",{className:`fixed bottom-4 left-4 z-50 p-4 rounded-lg shadow-lg flex flex-col max-w-md ${c} overflow-hidden`,role:"alert",children:[p.jsxs("div",{className:"flex items-center w-full",children:[p.jsx("div",{className:"mr-2",children:l}),p.jsx("span",{className:"flex-grow",children:e.message}),p.jsx("button",{className:"ml-3 text-gray-500 hover:text-gray-700",onClick:t,"aria-label":" ",children:p.jsx(Vo,{className:"h-4 w-4"})})]}),r>0&&p.jsx("div",{className:"h-1 w-full mt-2 bg-gray-200 rounded-full overflow-hidden",children:p.jsx("div",{className:`h-full ${u} transition-all ease-linear`,style:{width:"100%",animation:`shrink ${s}ms linear forwards`}})}),p.jsx("style",{id:"notification-animation",children:`
                @keyframes shrink {
                    from { width: 100%; }
                    to { width: 0%; }
                }
            `})]})},ce={VARIABLES:"variables",OPERATIONS:"operations",CONTROL:"control",SCENE_3D:"scene3d"},$r={variable:{type:"variable",category:ce.VARIABLES,name:"",description:"   ",iconComponent:ya,color:{bg:"bg-green-100 dark:bg-green-900",border:"border-green-500",text:"text-green-800 dark:text-green-200"},paletteColor:"bg-green-500 hover:bg-green-600",hexColor:"#22c55e",getActiveValue:e=>{var t;return(t=e.state)==null?void 0:t.currentValue},defaultData:{name:"x",initialValue:"",variableType:"any"}},assignment:{type:"assignment",category:ce.OPERATIONS,name:"",description:"  ",iconComponent:aa,color:{bg:"bg-teal-100 dark:bg-teal-900",border:"border-teal-500",text:"text-teal-800 dark:text-teal-200"},paletteColor:"bg-teal-500 hover:bg-teal-600",hexColor:"#14b8a6",getActiveValue:e=>{var t;return(t=e.state)==null?void 0:t.result},defaultData:{leftValue:"",rightValue:"",leftType:"any",rightType:"any"}},math:{type:"math",category:ce.OPERATIONS,name:". ",description:"  ",iconComponent:sa,color:{bg:"bg-purple-100 dark:bg-purple-900",border:"border-purple-500",text:"text-purple-800 dark:text-purple-200"},paletteColor:"bg-purple-500 hover:bg-purple-600",hexColor:"#a855f7",getActiveValue:e=>{var t;return(t=e.state)==null?void 0:t.result},defaultData:{operation:"add"}},logical:{type:"logical",category:ce.OPERATIONS,name:"",description:"   ",iconComponent:ea,color:{bg:"bg-blue-100 dark:bg-blue-900",border:"border-blue-500",text:"text-blue-800 dark:text-blue-200"},paletteColor:"bg-blue-500 hover:bg-blue-600",hexColor:"#3b82f6",getActiveValue:e=>{var t;return((t=e.state)==null?void 0:t.result)!==void 0?e.state.result?"":"":null},defaultData:{operation:"equal"}},booleanLogic:{type:"booleanLogic",category:ce.OPERATIONS,name:"",description:"   AND/OR",iconComponent:ra,color:{bg:"bg-indigo-100 dark:bg-indigo-900",border:"border-indigo-500",text:"text-indigo-800 dark:text-indigo-200"},paletteColor:"bg-indigo-500 hover:bg-indigo-600",hexColor:"#6366f1",getActiveValue:e=>{var t;return((t=e.state)==null?void 0:t.result)!==void 0?e.state.result?"TRUE":"FALSE":null},defaultData:{operation:"and"}},print:{type:"print",category:ce.OPERATIONS,name:"",description:"   ",iconComponent:Qi,color:{bg:"bg-yellow-100 dark:bg-yellow-900",border:"border-yellow-500",text:"text-yellow-800 dark:text-yellow-200"},paletteColor:"bg-yellow-500 hover:bg-yellow-600",hexColor:"#eab308",getActiveValue:e=>""},if:{type:"if",category:ce.CONTROL,name:"",description:" ",iconComponent:Pr,color:{bg:"bg-indigo-100 dark:bg-indigo-900",border:"border-indigo-500",text:"text-indigo-800 dark:text-indigo-200"},paletteColor:"bg-indigo-500 hover:bg-indigo-600",hexColor:"#6366f1",getActiveValue:e=>{var t;return((t=e.state)==null?void 0:t.result)!==void 0?e.state.result?"":"":null}},loop:{type:"loop",category:ce.CONTROL,name:"",description:"    ",iconComponent:Ji,color:{bg:"bg-red-100 dark:bg-red-900",border:"border-red-500",text:"text-red-800 dark:text-red-200"},paletteColor:"bg-red-500 hover:bg-red-600",hexColor:"#ef4444",getActiveValue:e=>{var t;return((t=e.state)==null?void 0:t.currentIteration)!==void 0?` ${e.state.currentIteration+1}/${e.state.count}`:null}},player:{type:"player",category:ce.SCENE_3D,name:"",description:",   3D ",iconComponent:Ki,color:{bg:"bg-blue-100 dark:bg-blue-900",border:"border-blue-500",text:"text-blue-800 dark:text-blue-200"},paletteColor:"bg-blue-500 hover:bg-blue-600",hexColor:"#3b82f6",getActiveValue:e=>{var t;return(t=e.state)!=null&&t.position?`X:${e.state.position.x}, Z:${e.state.position.z}`:null}},move:{type:"move",category:ce.SCENE_3D,name:"",description:"  ",iconComponent:da,color:{bg:"bg-green-100 dark:bg-green-900",border:"border-green-500",text:"text-green-800 dark:text-green-200"},paletteColor:"bg-green-500 hover:bg-green-600",hexColor:"#22c55e",getActiveValue:e=>{var t;return(t=e.state)!=null&&t.steps?`${e.state.steps} ()`:null},defaultData:{steps:1}},turn:{type:"turn",category:ce.SCENE_3D,name:"",description:" ",iconComponent:Pr,color:{bg:"bg-yellow-100 dark:bg-yellow-900",border:"border-yellow-500",text:"text-yellow-800 dark:text-yellow-200"},paletteColor:"bg-yellow-500 hover:bg-yellow-600",hexColor:"#eab308",getActiveValue:e=>{var t;return(t=e.state)==null?void 0:t.direction},defaultData:{direction:"right"}},wallAhead:{type:"wallAhead",category:ce.SCENE_3D,name:" ",description:"    ",iconComponent:ga,color:{bg:"bg-red-100 dark:bg-red-900",border:"border-red-500",text:"text-red-800 dark:text-red-200"},paletteColor:"bg-red-500 hover:bg-red-600",hexColor:"#ef4444",getActiveValue:e=>{var t;return((t=e.state)==null?void 0:t.result)!==void 0?e.state.result?"":"":null}},exitReached:{type:"exitReached",category:ce.SCENE_3D,name:" ",description:",    ",iconComponent:ca,color:{bg:"bg-purple-100 dark:bg-purple-900",border:"border-purple-500",text:"text-purple-800 dark:text-purple-200"},paletteColor:"bg-purple-500 hover:bg-purple-600",hexColor:"#a855f7",getActiveValue:e=>{var t;return((t=e.state)==null?void 0:t.result)!==void 0?e.state.result?"":"":null}},jump:{type:"jump",category:ce.SCENE_3D,name:"",description:"  ",iconComponent:qi,color:{bg:"bg-cyan-100 dark:bg-cyan-900",border:"border-cyan-500",text:"text-cyan-800 dark:text-cyan-200"},paletteColor:"bg-cyan-500 hover:bg-cyan-600",hexColor:"#06b6d4",getActiveValue:e=>{var t;return(t=e.state)!=null&&t.executed?"":null}}};function Ao(e){var t;return((t=$r[e])==null?void 0:t.hexColor)||"#9ca3af"}function Zh(e){return $r[e]||null}function qh(){const e={};return Object.values(ce).forEach(t=>{e[t]={id:t,name:Kh(t),nodes:[]}}),Object.values($r).forEach(t=>{const n=t.category;e[n]&&e[n].nodes.push({...t,icon:t.iconComponent})}),Object.values(e)}function Kh(e){switch(e){case ce.VARIABLES:return"";case ce.OPERATIONS:return"";case ce.CONTROL:return"";case ce.SCENE_3D:return"3D ";default:return""}}const xp=({allowedCategories:e=Object.values(ce),allowedNodeTypes:t=[],excludedNodeTypes:n=[],defaultExpanded:r=!0,customTitle:o={},onNodeSelect:s})=>{const i=qh(),[a,l]=h.useState(!1),[c,u]=h.useState(!1),d=h.useRef(null),f=i.filter(E=>e.includes(E.id)).map(E=>({...E,nodes:E.nodes.filter(C=>(t.length===0||t.includes(C.type))&&!n.includes(C.type))})).filter(E=>E.nodes.length>0),[g,b]=h.useState(()=>{const E={};return f.forEach(C=>{E[C.id]=r}),E});h.useEffect(()=>{const E=()=>{l(window.innerWidth<768)};return E(),window.addEventListener("resize",E),()=>{window.removeEventListener("resize",E)}},[]),h.useEffect(()=>{const E=C=>{a&&c&&d.current&&!d.current.contains(C.target)&&u(!1)};return a&&c&&document.addEventListener("mousedown",E),()=>{document.removeEventListener("mousedown",E)}},[a,c]);const x=f.map(E=>E.id).join(",");h.useEffect(()=>{b(E=>{const C={};let M=!1;f.forEach(L=>{const H=E[L.id]!==void 0?E[L.id]:r;C[L.id]=H,E[L.id]!==H&&(M=!0)});const O=Object.keys(E),A=f.map(L=>L.id);return O.length!==A.length&&(M=!0),M?C:E})},[x,r]);const w=(E,C,M={},O=!0)=>{console.log("NodePalette handleNodeEvent:",{nodeType:C,isDrag:O,isMobile:a}),O&&(E.dataTransfer.setData("application/reactflow",C),E.dataTransfer.setData("application/json",JSON.stringify(M)),E.dataTransfer.effectAllowed="move"),s&&(console.log("NodePalette calling onNodeSelect:",C,M),s(C,M),a&&!O&&u(!1))},m=(E,C,M={})=>{w(E,C,M,!0)},N=(E,C={})=>{w(null,E,C,!1)},S=E=>{b(C=>({...C,[E]:!C[E]}))};if(f.length===0)return p.jsx("div",{className:"w-64 border-r border-gray-200 dark:border-gray-700 h-full overflow-y-auto bg-white dark:bg-gray-900 flex items-center justify-center",children:p.jsx("p",{className:"text-center text-gray-500 dark:text-gray-400 p-4",children:"    "})});const v={paletteButton:{position:"absolute",bottom:"20px",left:"20px",zIndex:10,width:"48px",height:"48px",borderRadius:"50%",backgroundColor:"#6366f1",color:"white",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",border:"none",cursor:"pointer"}};return a&&!c?p.jsx("button",{className:v.paletteButton,onClick:()=>u(!0),children:p.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})}):a&&c?p.jsx("div",{ref:d,className:"fixed inset-0 z-50 bg-white dark:bg-gray-900 overflow-y-auto",children:p.jsxs("div",{className:"p-4",children:[p.jsxs("div",{className:"flex justify-between items-center mb-4",children:[p.jsx("h3",{className:"text-lg font-bold text-gray-800 dark:text-gray-200",children:" "}),p.jsx("button",{className:"p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-300",onClick:()=>u(!1),children:p.jsx(Vo,{className:"h-6 w-6"})})]}),f.map(E=>p.jsxs("div",{className:"mb-4",children:[p.jsxs("button",{className:"w-full flex items-center justify-between p-3 bg-gray-100 dark:bg-gray-800 rounded text-left text-gray-800 dark:text-gray-200 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors",onClick:()=>S(E.id),children:[p.jsx("span",{className:"font-medium",children:o[E.id]||E.name}),g[E.id]?p.jsx(Vr,{className:"w-5 h-5"}):p.jsx(Dr,{className:"w-5 h-5"})]}),g[E.id]&&p.jsx("div",{className:"mt-2 pl-2 space-y-2",children:E.nodes.map(C=>p.jsxs("div",{className:`
                                                ${C.paletteColor}
                                                text-white p-3 rounded
                                                flex items-center transition-all
                                                hover:shadow-md active:scale-95
                                            `,onClick:()=>N(C.type,C.defaultData),children:[p.jsx("span",{className:"mr-2",children:C.icon&&j.createElement(C.icon,{className:"w-5 h-5"})}),p.jsx("span",{children:C.name})]},`${C.type}-${JSON.stringify(C.defaultData||{})}`))})]},E.id))]})}):p.jsx("div",{className:"w-64 border-r border-gray-200 dark:border-gray-700 h-full overflow-y-auto bg-white dark:bg-gray-900",children:p.jsxs("div",{className:"p-4",children:[p.jsx("h3",{className:"text-lg font-bold mb-4 text-gray-800 dark:text-gray-200",children:" "}),f.map(E=>p.jsxs("div",{className:"mb-4",children:[p.jsxs("button",{className:"w-full flex items-center justify-between p-2 bg-gray-100 dark:bg-gray-800 rounded text-left text-gray-800 dark:text-gray-200 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors",onClick:()=>S(E.id),children:[p.jsx("span",{className:"font-medium",children:o[E.id]||E.name}),g[E.id]?p.jsx(Vr,{className:"w-4 h-4"}):p.jsx(Dr,{className:"w-4 h-4"})]}),g[E.id]&&p.jsx("div",{className:"mt-2 pl-2 space-y-2",children:E.nodes.map(C=>p.jsxs("div",{className:`
                                            ${C.paletteColor}
                                            text-white p-2 rounded cursor-move
                                            flex items-center transition-all
                                            hover:shadow-md transform hover:-translate-y-0.5
                                        `,draggable:!0,onDragStart:M=>m(M,C.type,C.defaultData),children:[p.jsx("span",{className:"mr-2",children:C.icon&&j.createElement(C.icon,{className:"w-5 h-5"})}),p.jsx("span",{children:C.name})]},`${C.type}-${JSON.stringify(C.defaultData||{})}`))})]},E.id))]})})};class Jh{constructor(t,n){this.nodes=t,this.edges=n,this.startNodeIds=[],this.executionOrder=[],this.dependencyGraph={}}setGraph(t,n){this.nodes=t,this.edges=n,this.startNodeIds=[],this.executionOrder=[],this.dependencyGraph={}}initialize(){return this.nodes.length===0||(this.startNodeIds=this.findStartingNodes().map(t=>t.id),this.startNodeIds.length===0)?!1:(this.buildDependencyGraph(),this.executionOrder=this.determineExecutionOrder(),!0)}buildDependencyGraph(){this.dependencyGraph={},this.nodes.forEach(t=>{this.dependencyGraph[t.id]={inputs:[],outputs:[]}}),this.edges.forEach(t=>{const n=t.source,r=t.target;if(!this.dependencyGraph[n]||!this.dependencyGraph[r])return;const o=t.sourceHandle&&t.sourceHandle.includes("flow")||t.targetHandle&&t.targetHandle.includes("flow");if(!this.dependencyGraph[r].inputs.includes(n)&&(this.dependencyGraph[r].inputs.push(n),o&&this.dependencyGraph[r].inputs.length>1)){const s=this.dependencyGraph[r].inputs.indexOf(n);this.dependencyGraph[r].inputs.splice(s,1),this.dependencyGraph[r].inputs.unshift(n)}if(!this.dependencyGraph[n].outputs.includes(r)&&(this.dependencyGraph[n].outputs.push(r),o&&this.dependencyGraph[n].outputs.length>1)){const s=this.dependencyGraph[n].outputs.indexOf(r);this.dependencyGraph[n].outputs.splice(s,1),this.dependencyGraph[n].outputs.unshift(r)}})}findStartingNodes(){const t=new Set(this.edges.filter(o=>o.target).map(o=>o.target)),n=this.nodes.filter(o=>!t.has(o.id)),r=n.filter(o=>["get_variable"].includes(o.data.type));return r.length>0?r:n}determineExecutionOrder(){const t={},n={};this.nodes.forEach(s=>{t[s.id]=[],n[s.id]=0}),this.edges.forEach(s=>{t[s.source]&&(t[s.source].push(s.target),n[s.target]=(n[s.target]||0)+1)});const r=this.startNodeIds.slice(),o=[];for(;r.length>0;){const s=r.shift();o.push(s),t[s]&&t[s].forEach(i=>{n[i]--,n[i]===0&&r.push(i)})}return o.length!==this.nodes.length&&this.nodes.forEach(s=>{o.includes(s.id)||o.push(s.id)}),o}getNodeById(t){return this.nodes.find(n=>n.id===t)||null}getFirstStartNode(){return this.startNodeIds.length>0?this.startNodeIds[0]:null}findNextNode(t,n,r,o){if(!t.data.outputs||t.data.outputs.length===0)return null;const i=["next","true","false","body","flow"].find(l=>n[l]);if(i){const l=`output-${i}`,c=this.edges.filter(u=>u.source===t.id&&u.sourceHandle===l);if(c.length>0)return c[0].target}if(t.id in this.dependencyGraph){const l=this.dependencyGraph[t.id].outputs;for(const c of l){const u=this.getNodeById(c);if(!(!u||r.has(c))&&this.isNodeReadyForExecution(u,r,o))return c}}const a=this.executionOrder.filter(l=>!r.has(l));for(const l of a){const c=this.getNodeById(l);if(c&&this.isNodeReadyForExecution(c,r,o))return l}return null}isNodeReadyForExecution(t,n,r){if(!this.areAllInputsReady(t,n,r))return!1;if(t.id in this.dependencyGraph){const o=this.dependencyGraph[t.id].inputs;for(const s of o){if(!n.has(s))return!1;const i=this.edges.filter(a=>a.source===s&&a.target===t.id);for(const a of i)if(!a.sourceHandle.includes("flow")&&!a.targetHandle.includes("flow")){const l=a.sourceHandle.replace("output-",""),c=`${s}:${l}`;if(r[c]===void 0)return!1}}}return!0}areAllInputsReady(t,n,r){const o=t.data.inputs||[];if(o.length===0)return!0;for(const s of o)if(s.required){const i=this.edges.filter(a=>a.target===t.id&&a.targetHandle===s.id);if(i.length===0){const a=s.name;if(!(t.data.nodeRef&&t.data.nodeRef.data&&(t.data.nodeRef.data[a]!==void 0||t.data.nodeRef.data[`${a}Value`]!==void 0)))return!1}else{let a=!1;for(const l of i){const c=l.source;if(n.has(c)){const u=l.sourceHandle.replace("output-",""),d=`${c}:${u}`;if(r[d]!==void 0){a=!0;break}}}if(!a)return!1}}return!0}getStartNodes(){return this.startNodeIds}getExecutionOrder(){return this.executionOrder}findLoopBodyNodes(t){const n=this.getNodeById(t);if(!n||n.data.type!=="loop")return[];const r=new Set,o=this.edges.filter(s=>s.source===t&&s.sourceHandle==="output-body");if(o.length===0){const s=this.edges.filter(i=>i.source===t&&i.sourceHandle!=="output-next");if(s.length>0)for(const i of s){const a=i.target;r.add(a),this.findAllConnectedNodes(a,t).forEach(c=>r.add(c))}}else for(const s of o){const i=s.target;r.add(i),this.findAllConnectedNodes(i,t).forEach(l=>r.add(l))}return Array.from(r)}findAllConnectedNodes(t,n){const r=new Set,o=new Set,s=[t];for(;s.length>0;){const i=s.pop();if(o.has(i))continue;o.add(i),i!==n&&r.add(i);const a=this.edges.filter(l=>l.source===i&&!(l.target===n&&l.targetHandle==="input-flow"));for(const l of a)o.has(l.target)||s.push(l.target)}return r}checkLoopReturn(t,n){if(!n.loopReturn)return null;if(this.edges.some(s=>s.source===t&&s.target===n.loopReturn&&s.targetHandle==="input-flow"))return n.loopReturn;const o=this.findLoopBodyNodes(n.loopReturn);return o.includes(t)&&!this.edges.some(i=>i.source===t&&i.target!==n.loopReturn&&o.includes(i.target))?n.loopReturn:null}}class Qh{constructor(t,n){this.dataManager=t,this.state=n,this.executionPath=[],this.externalContexts={}}reset(){this.executionPath=[]}setExternalContext(t,n){this.externalContexts[t]=n}executeNode(t,n=null){var r,o,s;if(!t)return{error:"  ",nodeId:null};try{this.state.setActiveNode(t.id),this.executionPath.push(t.id);const i=this.dataManager.collectInputValues(t),a=t.data.nodeRef;if(!a)throw new Error(`  ID ${t.id}     `);const l={...this.state,...this.externalContexts,log:(r=this.state.log)==null?void 0:r.bind(this.state),setLoopReturn:(o=this.state.setLoopReturn)==null?void 0:o.bind(this.state),clearLoopReturn:(s=this.state.clearLoopReturn)==null?void 0:s.bind(this.state)},c=a.execute(i,l);return this.dataManager.cacheOutputValues(t,c),this.logNodeExecution(t,i,c),{success:!0,nodeId:t.id,outputs:c}}catch(i){return this.state.log("error",`   "${t.data.label}": ${i.message}`),{error:i.message,nodeId:t.id}}}logNodeExecution(t,n,r){var a;let o="",s=-1,i=-1;if(this.state.loopReturn){const l=this.state.loopReturn,c=(a=this.state.nodes)==null?void 0:a.find(u=>u.id===l);c&&c.data.nodeRef&&c.data.nodeRef.state?(s=c.data.nodeRef.state.currentIteration,i=c.data.nodeRef.state.count,o=` ( ${s+1}/${i})`):o=" ( )"}if(t.data.type!=="math")if(t.data.type==="if"){const l=t.data.nodeRef.state.result;this.state.log("output",`: ${l?"":""}${o}`)}else if(t.data.type==="loop"){if(r.body){const l=t.data.nodeRef.state.currentIteration,c=t.data.nodeRef.state.count;this.state.log("output",`:   ${l+1}/${c}`)}else if(r.next){const l=t.data.nodeRef.state.count;this.state.log("output",`:  (${l} )`)}}else t.data.type==="print"&&this.state.loopReturn&&console.log(`   (=${s+1}/${i})`)}getLoopIteration(t){const n=this.getNodeById(t);if(n&&n.data&&n.data.nodeRef&&n.data.nodeRef.state&&n.data.nodeRef.state.currentIteration!==void 0){const r=n.data.nodeRef.state.currentIteration+1,o=n.data.nodeRef.state.count||5;return`${r}/${o}`}return""}getNodeById(t){return t&&this.executionPath.map(r=>(this.state.nodes||[]).find(s=>s.id===r)).filter(Boolean).find(r=>r.id===t)||null}getExecutionPath(){return this.executionPath}wasNodeExecuted(t){return this.executionPath.includes(t)}}class e0{constructor(t){this.edges=t,this.inputCache={},this.dataTransfers=[],this.executionContext=null}setEdges(t){this.edges=t}reset(){this.inputCache={},this.dataTransfers=[]}setExecutionContext(t){this.executionContext=t}resolveReference(t){if(t&&typeof t=="object"&&t.type==="reference"){const n=t.name;if(this.executionContext&&this.executionContext.variables){const r=this.executionContext.variables[n];return r!==void 0?r:void 0}return}return t}collectInputValues(t){const n={};return!t.data.inputs||t.data.inputs.length===0||t.data.inputs.forEach(r=>{const o=r.id,s=r.name,i=this.edges.filter(a=>a.target===t.id&&a.targetHandle===o);if(i.length>0){const a=i[0],l=a.source;if(l){const c=a.sourceHandle,u=c.replace("output-",""),d=`${l}:${u}`;if(this.inputCache[d]!==void 0){let f=this.inputCache[d];f=this.resolveReference(f),n[s]=f,this.dataTransfers.push({edgeId:a.id,sourceNodeId:l,targetNodeId:t.id,sourceHandle:c,targetHandle:o,value:f,timestamp:Date.now()})}}}}),n}cacheOutputValues(t,n){n&&Object.entries(n).forEach(([r,o])=>{if(r!=="next"&&r!=="true"&&r!=="false"&&r!=="body"){const s=`${t.id}:${r}`;this.inputCache[s]=o}})}getDataTransfers(){return this.dataTransfers}clearDataTransfers(){this.dataTransfers=[]}hasOutputValue(t,n){const r=`${t}:${n}`;return this.inputCache[r]!==void 0}getOutputValue(t,n){const r=`${t}:${n}`;return this.inputCache[r]}}class kr{constructor(t={},n=null,r=!1){this.variables={},this.console=[],this.activeNodeId=null,this.previousNodeId=null,this.visitedNodes=new Set,this.loopReturn=null,this.globalVariables=t||{},this.setGlobalVariable=n||null,this.debug=r}formatValueForLog(t){if(t===null)return"null";if(t===void 0)return"undefined";if(t&&typeof t=="object"&&t.type==="reference"){const n=t.name,r=this.variables[n];return r!==void 0?String(r):"undefined"}if(typeof t=="object")try{return JSON.stringify(t)}catch{return"[]"}return String(t)}reset(){const t=this.globalVariables,n=this.setGlobalVariable,r=this.debug;this.variables={},this.console=[],this.activeNodeId=null,this.previousNodeId=null,this.visitedNodes=new Set,this.loopReturn=null,this.globalVariables=t,this.setGlobalVariable=n,this.debug=r,this.debug&&this.debugLog(" ExecutionState ")}setActiveNode(t){this.previousNodeId=this.activeNodeId,this.activeNodeId=t,this.visitedNodes.add(t)}log(t,n){this.console.push({type:t,value:n})}debugLog(t,n=null){this.debug&&(n?this.log("debug",`[DEBUG] ${t}: ${JSON.stringify(n).substring(0,100)}`):this.log("debug",`[DEBUG] ${t}`))}isVisited(t){return this.visitedNodes.has(t)}setLoopReturn(t){this.loopReturn=t}clearLoopReturn(){this.loopReturn=null}getVariable(t){return this.variables[t]}setVariable(t,n){this.variables[t]=n}clone(){const t=new kr(this.globalVariables,this.setGlobalVariable,this.debug);return t.variables={...this.variables},t.console=[...this.console],t.activeNodeId=this.activeNodeId,t.previousNodeId=this.previousNodeId,t.visitedNodes=new Set(this.visitedNodes),t.loopReturn=this.loopReturn,t}}class t0{constructor(t,n,r={},o=null,s={}){this.nodes=t,this.edges=n,this.state=new kr(r,o),this.state.nodes=t,this.dataManager=new e0(n),this.graphManager=new Jh(t,n),this.nodeExecutor=new Qh(this.dataManager,this.state),this.externalContexts=s,s&&Object.entries(s).forEach(([i,a])=>{this.nodeExecutor.setExternalContext(i,a)}),this.isComplete=!1,this.currentNodeId=null,this.maxSteps=100,this.stepCount=0,this.activeBranches=new Map,this.currentLoopBody={loopId:null,bodyNodes:[],executionOrder:[],currentIndex:0}}setExternalContext(t,n){this.externalContexts[t]=n,this.nodeExecutor.setExternalContext(t,n)}initialize(){return this.reset(),this.state.reset(),this.dataManager.reset(),this.dataManager.setExecutionContext(this.state),this.nodeExecutor.reset(),this.isComplete=!1,this.stepCount=0,this.activeBranches.clear(),this.currentLoopBody={loopId:null,bodyNodes:[],executionOrder:[],currentIndex:0},this.nodes.length===0?(this.state.log("error",":    "),!1):this.graphManager.initialize()?(this.currentNodeId=this.graphManager.getFirstStartNode(),this.state.activeNodeId=this.currentNodeId,this.state.log("output","   "),!0):(this.state.log("error","   .    (, , )"),!1)}runFull(){if(!this.initialize())return{isComplete:!1,error:" ",context:this.state};this.state.log("output","  ");let t,n=0;do if(t=this.step(),n++,n>this.maxSteps)return this.state.log("error",`    (${this.maxSteps}). ,     .`),{isComplete:!0,error:"   ",context:this.state};while(!t.isComplete);return this.state.log("output","  "),t}isNodeInActiveBranch(t){if(this.activeBranches.size===0)return!0;for(const[n,r]of this.activeBranches){const o=this.edges.filter(i=>i.source===n&&i.sourceHandle===`output-${r}`);if(o.some(i=>i.target===t))return!0;const s=o.map(i=>i.target);for(const i of s)if(this.edges.filter(l=>l.source===i).some(l=>l.target===t))return!0}return!1}buildLoopBodyExecutionOrder(t){const n=this.graphManager.findLoopBodyNodes(t);if(n.length===0)return[];const r=this.edges.filter(l=>l.source===t&&l.sourceHandle==="output-body").map(l=>l.target);let o=r.length>0?r:[];if(o.length===0&&(o=this.edges.filter(l=>l.source===t&&l.target!==t&&n.includes(l.target)&&l.targetHandle!=="input-flow").map(l=>l.target)),o.length===0){const l=new Set;this.edges.forEach(c=>{n.includes(c.source)&&n.includes(c.target)&&c.source!==c.target&&l.add(c.target)}),o=n.filter(c=>!l.has(c))}o.length===0&&n.length>0&&(o=[n[0]]);const s=[],i=new Set,a=l=>{if(i.has(l)||!n.includes(l))return;i.add(l),s.push(l);const c=this.edges.filter(u=>u.source===l&&n.includes(u.target)&&u.sourceHandle&&u.sourceHandle.includes("flow"));if(c.length>0)for(const u of c)a(u.target);else{const u=this.edges.filter(d=>d.source===l&&n.includes(d.target)&&!d.sourceHandle.includes("flow"));for(const d of u)a(d.target)}};for(const l of o)a(l);for(const l of n)i.has(l)||s.push(l);return console.log("     :",s),s}updateCurrentLoopBody(t){if(this.currentLoopBody.loopId!==t){const n=this.graphManager.findLoopBodyNodes(t),r=this.buildLoopBodyExecutionOrder(t);this.currentLoopBody={loopId:t,bodyNodes:n,executionOrder:r,currentIndex:0},console.log(`      ${t}:`),console.log("  :",n),console.log(" :",r)}}findNextNodeInLoopBody(){if(!this.currentLoopBody.loopId||this.currentLoopBody.executionOrder.length===0||this.currentLoopBody.currentIndex>=this.currentLoopBody.executionOrder.length)return null;const t=this.currentLoopBody.executionOrder[this.currentLoopBody.currentIndex];return this.currentLoopBody.currentIndex++,t}isLoopBodyComplete(){return this.currentLoopBody.currentIndex>=this.currentLoopBody.executionOrder.length}resetLoopBodyExecution(){this.currentLoopBody.currentIndex=0}step(){if(this.isComplete)return{isComplete:!0,context:this.state};if(this.stepCount++,this.stepCount>this.maxSteps)return this.isComplete=!0,this.state.log("error",`    (${this.maxSteps}). ,     .`),{isComplete:!0,error:"   ",context:this.state};this.dataManager.clearDataTransfers();try{if(!this.currentNodeId&&!this.initialize())return this.isComplete=!0,{isComplete:!0,error:"   ",context:this.state};const t=this.graphManager.getNodeById(this.currentNodeId);if(!t)throw new Error(`  ID ${this.currentNodeId}  `);console.log(" ,  :",this.currentNodeId,":",t.data.type);const n=this.nodeExecutor.executeNode(t,this.graphManager);if(n.error)return this.isComplete=!0,{isComplete:!0,error:n.error,errorNodeId:this.currentNodeId,context:this.state,dataTransfers:this.dataManager.getDataTransfers()};if(t.data.type==="loop"&&n.outputs&&n.outputs.body){this.updateCurrentLoopBody(t.id),this.resetLoopBodyExecution();const o=this.findNextNodeInLoopBody();if(o)return console.log("     :",o),this.currentNodeId=o,{isComplete:!1,currentNodeId:this.currentNodeId,previousNodeId:t.id,context:this.state,dataTransfers:this.dataManager.getDataTransfers()}}if(this.state.loopReturn){if(console.log("   :",this.state.loopReturn),this.updateCurrentLoopBody(this.state.loopReturn),this.currentLoopBody.bodyNodes.includes(t.id)){const o=this.findNextNodeInLoopBody();if(o)return console.log("    :",o),this.currentNodeId=o,{isComplete:!1,currentNodeId:this.currentNodeId,previousNodeId:t.id,context:this.state,dataTransfers:this.dataManager.getDataTransfers()};if(this.isLoopBodyComplete())return console.log("    ,   "),this.currentNodeId=this.state.loopReturn,{isComplete:!1,currentNodeId:this.currentNodeId,previousNodeId:t.id,context:this.state,dataTransfers:this.dataManager.getDataTransfers()}}if(t.id===this.state.loopReturn&&n.outputs&&n.outputs.next)console.log("  "),this.state.clearLoopReturn();else if(t.id===this.state.loopReturn){this.resetLoopBodyExecution();const o=this.findNextNodeInLoopBody();if(o)return console.log("     :",o),this.currentNodeId=o,{isComplete:!1,currentNodeId:this.currentNodeId,previousNodeId:t.id,context:this.state,dataTransfers:this.dataManager.getDataTransfers()}}}let r=null;if(n.outputs){const o=Object.keys(n.outputs).filter(s=>(s==="flow"||s==="true"||s==="false"||s==="body"||s==="next")&&n.outputs[s]);if(o.length>0){const s=o[0],i=`output-${s}`,a=this.edges.filter(l=>l.source===t.id&&l.sourceHandle===i);a.length>0&&(r=a[0].target,console.log("   flow-:",r)),t.data.type==="if"&&(console.log(` ${t.id}  : ${s}`),this.activeBranches.set(t.id,s))}}return t.data.type==="if"&&!r?(this.isComplete=!0,{isComplete:!0,lastNodeId:this.currentNodeId,context:this.state,dataTransfers:this.dataManager.getDataTransfers()}):(r||(r=this.graphManager.findNextNode(t,n.outputs||{},this.state.visitedNodes,this.dataManager.inputCache),r&&!this.isNodeInActiveBranch(r)?(console.log(` ${r}     , `),r=null):r&&console.log("    GraphManager:",r)),r?(this.currentNodeId=r,{isComplete:!1,currentNodeId:this.currentNodeId,previousNodeId:t.id,context:this.state,dataTransfers:this.dataManager.getDataTransfers()}):(this.isComplete=!0,{isComplete:!0,lastNodeId:this.currentNodeId,context:this.state,dataTransfers:this.dataManager.getDataTransfers()}))}catch(t){return console.error(" :",t),this.isComplete=!0,this.state.log("error",` : ${t.message}`),{isComplete:!0,error:t.message,context:this.state,dataTransfers:this.dataManager.getDataTransfers()}}}getContext(){return this.state}updateGraph(t,n){this.nodes=t,this.edges=n,this.graphManager.setGraph(t,n),this.dataManager.setEdges(n),this.initialize()}setDebugMode(t){this.state.debug=t}reset(){try{return this.isComplete=!1,this.currentNodeId=null,this.stepCount=0,this.activeBranches.clear(),this.currentLoopBody={loopId:null,bodyNodes:[],executionOrder:[],currentIndex:0},this.state.reset(),this.dataManager.reset(),this.nodeExecutor.reset(),this.nodes&&Array.isArray(this.nodes)&&this.nodes.forEach(t=>{t.data&&t.data.nodeRef&&(typeof t.data.nodeRef.reset=="function"?(console.log(`  ${t.id}  ${t.data.type}`),t.data.nodeRef.reset()):t.data.nodeRef.state={},t.style&&(t.style={}))}),console.log("   "),this.state.log("output","  "),!0}catch(t){return console.error("   :",t),!1}}}const hi=h.createContext(),wp=({children:e})=>{const[t,n]=h.useState({position:{x:2,y:2},direction:"east",isJumping:!1}),[r,o]=h.useState({walls:[{x:2,y:3},{x:1,y:2},{x:4,y:4},{x:5,y:2},{x:3,y:5}],exit:{x:7,y:7},gridSize:10}),[s,i]=h.useState([]),a=h.useCallback(w=>{i(m=>[w,...m.slice(0,9)]),typeof window<"u"&&window.signalVisualizerData&&(window.signalVisualizerData.lastAction=w)},[]),l=h.useCallback(w=>r.walls.some(m=>m.x===w.x&&m.y===w.y),[r.walls]),c=h.useCallback(w=>w.x>=0&&w.x<r.gridSize&&w.y>=0&&w.y<r.gridSize,[r.gridSize]),u=h.useCallback((w=1)=>{const{position:m,direction:N}=t,S={...m};switch(N){case"north":S.y-=w;break;case"east":S.x+=w;break;case"south":S.y+=w;break;case"west":S.x-=w;break}return S},[t]),d=h.useCallback(()=>{n({position:{x:2,y:2},direction:"east",isJumping:!1}),typeof window<"u"&&window.signalVisualizerData&&(window.signalVisualizerData.playerState={position:{x:2,y:2},direction:"east",isJumping:!1},window.signalVisualizerData.notifyUpdateCallbacks()),a("    ")},[a]),f={movePlayerNode:h.useCallback((w=1)=>{const m=u(w),N=c(m)&&!l(m);return N?(n(S=>({...S,position:m})),typeof window<"u"&&window.signalVisualizerData&&(window.signalVisualizerData.playerState.position=m,window.signalVisualizerData.notifyUpdateCallbacks()),a(`   ${w} ()`)):a("   -  "),{success:N,steps:w,position:N?m:t.position,direction:t.direction}},[u,c,l,t,a]),turnPlayerNode:h.useCallback(w=>{const m={left:{north:"west",west:"south",south:"east",east:"north"},right:{north:"east",east:"south",south:"west",west:"north"}},N=t.direction,S=m[w][N];return S?(n(E=>({...E,direction:S})),typeof window<"u"&&window.signalVisualizerData&&(window.signalVisualizerData.playerState.direction=S,window.signalVisualizerData.notifyUpdateCallbacks()),a(`  ${w==="left"?"":""},  : ${S}`),{success:!0,direction:w,previousDirection:N,newDirection:S}):(console.error(`     : ${w}, ${N}`),console.log(" :",m),console.log(" :",{direction:w,previousDirection:N}),{success:!1,direction:w,previousDirection:N,newDirection:N})},[t.direction,a]),jumpPlayerNode:h.useCallback(()=>(n(w=>({...w,isJumping:!0})),typeof window<"u"&&window.signalVisualizerData&&(window.signalVisualizerData.playerState.isJumping=!0,window.signalVisualizerData.notifyUpdateCallbacks(),setTimeout(()=>{window.signalVisualizerData.playerState.isJumping=!1,window.signalVisualizerData.notifyUpdateCallbacks(),n(w=>({...w,isJumping:!1}))},1e3)),a("  "),{success:!0,height:1,position:t.position}),[t.position,a]),checkWallNode:h.useCallback(()=>{const w=u(),m=!c(w)||l(w);return a(`  : ${m?" ":" "}`),{wallExists:m,position:t.position,direction:t.direction,obstaclePosition:m?w:null}},[u,c,l,t,a]),checkExitNode:h.useCallback(()=>{const{position:w}=t,{exit:m}=r,N=w.x===m.x&&w.y===m.y;return a(N?" :  !":" :   "),{isReached:N,position:w,exitPosition:m}},[t,r,a])},g=h.useCallback(()=>({...t}),[t]),b=h.useCallback(()=>({...r}),[r]);h.useEffect(()=>{typeof window<"u"&&window.signalVisualizerData&&(window.signalVisualizerData.playerState={...t},window.signalVisualizerData.environmentState={...r},window.signalVisualizerData.notifyUpdateCallbacks())},[t,r]),h.useEffect(()=>{const m=Hh(N=>{switch(N.type){case te.PLAYER_MOVE:N.data.success&&N.data.position&&n(S=>({...S,position:N.data.position}));break;case te.PLAYER_TURN:N.data.newDirection&&n(S=>({...S,direction:N.data.newDirection}));break;case te.PLAYER_JUMP:N.data.success&&(n(S=>({...S,isJumping:!0})),setTimeout(()=>{n(S=>({...S,isJumping:!1}))},1e3));break}});return()=>{m()}},[]);const x={playerState:t,environmentState:r,actionHistory:s,resetScene:d,getPlayerState:g,getMapState:b,nodeActions:f};return p.jsx(hi.Provider,{value:x,children:e})},n0=(e,t,n,r={})=>{const{resetVisualizerState:o}=r;let s=null;try{s=h.useContext(hi),s&&(!s.nodeActions||!s.resetScene)&&(s=null)}catch{console.log("3D  ,   ")}const[i,a]=h.useState(!1),[l,c]=h.useState(!1),[u,d]=h.useState(!1),[f,g]=h.useState(0),[b,x]=h.useState(1),[w,m]=h.useState(null),[N,S]=h.useState(null),[v,E]=h.useState([]),[C,M]=h.useState([]),O=h.useRef(null),A=h.useRef(null),L=h.useRef(!1),H=h.useCallback(()=>{const I={};s&&(I.scene3d=s),O.current=new t0(e,t,{},null,I);const T=O.current.initialize();return L.current=T,T||(S("    .   ."),E(R=>[...R,{type:"error",value:"    .   ."}])),T},[e,t,s]),W=h.useCallback(I=>{I&&(n(T=>T.map(R=>{var K;const D=R.id===I.currentNodeId,B=R.id===I.previousNodeId,U=(K=I.context.visitedNodes)==null?void 0:K.has(R.id),q=R.id===I.errorNodeId,Z={};return D?(Z.boxShadow="0 0 0 4px #10b981",Z.zIndex=1e3):B?Z.boxShadow="0 0 0 1px #10b981":q?(Z.boxShadow="0 0 0 2px #ef4444",Z.zIndex=1e3):U&&(Z.boxShadow="0 0 0 1px #5c8f7a"),{...R,style:{...R.style,...Z}}})),I.dataTransfers&&I.dataTransfers.length>0&&M(I.dataTransfers))},[n]),z=h.useCallback(()=>{g(0),m(null),d(!1),S(null),E([]),M([]),n(T=>T.map(R=>({...R,style:{}}))),L.current=!1;const I=H();return typeof o=="function"&&o(),I},[H,n,o]),y=h.useCallback(()=>{try{if((f===0||u)&&!z())return{error:"   "};if(!O.current)return console.error("   "),{error:"   "};const I=O.current.step();if(g(T=>T+1),m(I.currentNodeId||null),I.context&&I.context.console&&E(I.context.console),I.error&&(S(I.error),a(!1),d(!0)),I.isComplete&&(d(!0),a(!1)),I.dataTransfers){const T=I.dataTransfers.map(R=>({...R,animationId:Math.random().toString(36).substr(2,9)}));M(T)}return W(I),I}catch(I){return S(I.message),a(!1),d(!0),E(T=>[...T,{type:"error",value:`  : ${I.message}`}]),{error:I.message,isComplete:!0}}},[z,W,f,u]),k=h.useCallback(()=>{if(!(!i||l||u))try{if(!y().isComplete&&i&&!l){const T=Math.max(300,800/b);A.current=setTimeout(k,T)}}catch(I){a(!1),S(I.message),E(T=>[...T,{type:"error",value:`  : ${I.message}`}])}},[i,l,u,y,b]),_=h.useCallback(()=>{var I;try{if(!z())return{error:"   "};const T=O.current.runFull();return T.error?(S(T.error),E(T.context.console||[]),d(!0),T):(E(T.context.console||[]),n(R=>R.map(D=>{var U;const B=(U=T.context.visitedNodes)==null?void 0:U.has(D.id);return{...D,style:{...D.style,boxShadow:B?"0 0 0 1px #10b981":void 0}}})),d(!0),g(((I=T.executionPath)==null?void 0:I.length)||0),T)}catch(T){return S(T.message),E(R=>[...R,{type:"error",value:` : ${T.message}`}]),d(!0),{error:T.message}}},[z,n]),P=h.useCallback(()=>{z()&&(a(!0),c(!1),A.current&&(clearTimeout(A.current),A.current=null),A.current=setTimeout(k,500))},[z,k]),F=h.useCallback(()=>{a(!1),c(!1),M([]),A.current&&(clearTimeout(A.current),A.current=null),E(I=>[...I,{type:"output",value:" "}]),n(I=>I.map(T=>({...T,style:{}}))),O.current&&(console.log("    "),O.current.reset())},[n]),$=h.useCallback(()=>{c(I=>{const T=!I;return E(R=>[...R,{type:"output",value:T?" ":" "}]),!T&&i&&(A.current&&clearTimeout(A.current),A.current=setTimeout(k,500)),T})},[i,k]),V=h.useCallback(I=>{x(I),i&&!l&&A.current&&(clearTimeout(A.current),A.current=setTimeout(k,1e3/I))},[i,l,k]);return h.useEffect(()=>{O.current&&i&&O.current.updateGraph(e,t)},[e,t,i]),h.useEffect(()=>()=>{A.current&&clearTimeout(A.current)},[]),{isExecuting:i,isPaused:l,isComplete:u,executionStep:f,executionSpeed:b,activeNodeId:w,error:N,consoleOutput:v,dataFlows:C,runFullAlgorithm:_,startExecution:P,stopExecution:F,togglePause:$,executeStep:y,runFullAlgorithm:_,setSpeed:V}},Ir=(e,t)=>{const n={left:!1,right:!1,value:!1,inputs:{},outputs:{}};return t.forEach(r=>{if(r.target===e){const o=r.targetHandle.replace("input-","");n.inputs[o]=!0,o==="left"&&(n.left=!0),o==="right"&&(n.right=!0),o==="value"&&(n.value=!0)}if(r.source===e){const o=r.sourceHandle.replace("output-","");n.outputs[o]=!0}}),n},ke=({inputs:e,nodeId:t,nodeType:n,onConnect:r})=>{const[o,s]=h.useState(null),i=ii();if(h.useEffect(()=>{t&&i(t)},[t,e,i,n]),!e||e.length===0)return null;const a=(l,c)=>{const u={if:{flow:22,test:45},loop:{flow:22,firstIndex:42,lastIndex:72,step:102},assignment:{flow:22,left:60,right:80},variable:{flow:22,value:77},print:{flow:22,value:52},math:{flow:22,left:52,right:86},logical:{flow:22,left:52,right:86},booleanLogic:{flow:22,left:52,right:72},player:{flow:22},move:{flow:22,entity:50},turn:{flow:22,entity:50},wallAhead:{flow:22,entity:50},exitReached:{flow:22,entity:50},jump:{flow:22}};return n in u&&l.name in u[n]?u[n][l.name]:l.dataType==="flow"?24:50+e.filter(g=>g.dataType!=="flow").findIndex(g=>g.id===l.id)*30};return p.jsx(p.Fragment,{children:e.map((l,c)=>{const u=a(l);return p.jsxs("div",{className:"absolute left-0",children:[p.jsx($t,{type:"target",position:G.Left,id:l.id||l.name,style:{left:-8,top:u,width:l.dataType==="flow"?14:12,height:l.dataType==="flow"?14:12,transform:l.dataType==="flow"?"rotate(45deg)":"none",borderRadius:l.dataType==="flow"?0:"50%"},onMouseEnter:()=>s(c),onMouseLeave:()=>s(null),onConnect:r}),o===c&&p.jsxs("div",{className:"absolute left-2 text-xs bg-gray-800 text-white px-2 py-1 rounded z-10 whitespace-nowrap",style:{top:u-6},children:[l.label||l.name," ",l.dataType!=="flow"&&`(${l.dataType})`]})]},`input-${l.id||c}`)})})},Ie=({outputs:e,nodeId:t,nodeType:n})=>{const[r,o]=h.useState(null),s=ii();if(h.useEffect(()=>{t&&s(t)},[t,e,s,n]),!e||e.length===0)return null;const i=(a,l)=>{const c={if:{flow:null,true:22,false:45,result:70},loop:{flow:null,body:22,next:45,index:70},assignment:{flow:22,result:70},variable:{flow:22,reference:77},print:{flow:22},math:{flow:22,result:68},logical:{flow:22,result:68},booleanLogic:{flow:22,result:62},player:{flow:22,actions:50,direction:70},move:{flow:22,success:50},turn:{flow:22,direction:50},wallAhead:{flow:null,true:22,false:45,result:70},exitReached:{flow:22,result:50},jump:{flow:22,success:50}};return n in c&&a.name in c[n]&&c[n][a.name]!==null?c[n][a.name]:a.dataType==="flow"?24:50+e.filter(f=>f.dataType!=="flow").findIndex(f=>f.id===a.id)*30};return p.jsx(p.Fragment,{children:e.map((a,l)=>{const c=i(a);return p.jsxs("div",{className:"absolute right-0",children:[p.jsx($t,{type:"source",position:G.Right,id:a.id||a.name,style:{right:-8,top:c,width:a.dataType==="flow"?14:12,height:a.dataType==="flow"?14:12,transform:a.dataType==="flow"?"rotate(45deg)":"none",borderRadius:a.dataType==="flow"?0:"50%"},onMouseEnter:()=>o(l),onMouseLeave:()=>o(null)}),r===l&&p.jsxs("div",{className:"absolute right-2 text-xs bg-gray-800 text-white px-2 py-1 rounded z-10 whitespace-nowrap",style:{top:c-6},children:[a.label||a.name," ",a.dataType!=="flow"&&`(${a.dataType})`]})]},`output-${a.id||l}`)})})},r0=e=>{if(e===null)return"null";if(e===void 0)return"undefined";if(typeof e=="object")try{return JSON.stringify(e)}catch{return"[]"}const t=String(e);return t.length>10?t.substring(0,8)+"...":t},Re=({nodeRef:e,nodeType:t})=>{if(!e||!e.state)return null;const n=e.state;if(!(Object.keys(n).length>0))return null;if(n.currentValue!==void 0){const o=r0(n.currentValue);return p.jsx("div",{className:"absolute -top-2 -right-2 py-1 px-2 bg-blue-500 text-white text-xs rounded-full shadow-md font-semibold z-10",children:o})}if((t==="logical"||t==="if")&&n.result!==void 0)return p.jsx("div",{className:`absolute -top-2 -right-2 py-1 px-2 ${n.result?"bg-green-500":"bg-red-500"} text-white text-xs rounded-full shadow-md font-semibold z-10`,children:n.result?"":""});if(t==="loop"){if(n.currentIteration!==void 0&&n.isFirstRun===!1){const s=`${n.isCompleted?n.count:Math.min(n.currentIteration+1,n.count)}/${n.count}`;return p.jsx("div",{className:"absolute -top-2 -right-2 py-1 px-2 bg-purple-500 text-white text-xs rounded-full shadow-md font-semibold z-10",children:s})}return null}return n.error?p.jsx("div",{className:"absolute -top-2 -right-2 py-1 px-2 bg-red-500 text-white text-xs rounded-full shadow-md font-semibold z-10",children:""}):null},Se=({children:e,className:t=""})=>p.jsx("div",{className:`font-bold text-center mb-2 pb-1 border-b border-gray-300 dark:border-gray-600 node-drag-handle cursor-move ${t}`,children:e}),o0=({id:e,data:t,selected:n,nodeDefinition:r})=>{const[o,s]=h.useState({name:"",initialValue:"",variableType:"any"}),[i,a]=h.useState({value:!1}),l=ee(f=>f.edges),c=h.useCallback(()=>{if(!e)return;const f=l.some(g=>g.target===e&&g.targetHandle==="input-value");a({value:f})},[l,e]);h.useEffect(()=>{t.nodeRef&&s({name:t.nodeRef.data.name||"",initialValue:t.nodeRef.data.initialValue!==void 0?t.nodeRef.data.initialValue:"",variableType:t.nodeRef.data.variableType||"any"})},[t.nodeRef]),h.useEffect(()=>{c();const f=setInterval(c,300);return()=>clearInterval(f)},[c]);const u=(f,g)=>{s(b=>({...b,[f]:g})),t.nodeRef&&t.nodeRef.setProperty(f,g)},d=(r==null?void 0:r.color)||{bg:"bg-gray-100 dark:bg-gray-800",text:"text-gray-800 dark:text-gray-200"};return p.jsxs("div",{className:`${d.bg} ${d.text} flex flex-col relative`,style:{minWidth:"220px",minHeight:"120px",padding:"1rem",borderRadius:"0.375rem",borderWidth:"2px",borderStyle:"solid",borderColor:n?"#ffffff":"#22c55e",boxShadow:n?"0 0 0 1px #22c55e, 0 4px 6px -1px rgba(0, 0, 0, 0.1)":"0 1px 3px 0 rgba(0, 0, 0, 0.1)",transition:"all 0.2s ease"},children:[p.jsx(Re,{nodeRef:t.nodeRef,nodeType:"variable"}),p.jsx(Se,{children:t.label}),p.jsxs("div",{className:"flex flex-col space-y-2 w-full",children:[p.jsxs("div",{className:"flex items-center",children:[p.jsx("label",{className:"text-xs text-gray-600 dark:text-gray-400 w-16",children:":"}),p.jsx("input",{type:"text",value:o.name||"",onChange:f=>u("name",f.target.value),className:"w-full p-1 text-xs bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded shadow-sm nodrag",placeholder:""})]}),p.jsxs("div",{className:"flex items-center",children:[p.jsx("label",{className:"text-xs text-gray-600 dark:text-gray-400 w-16",children:":"}),i.value?p.jsx("div",{className:"bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-white p-1 text-xs rounded text-center w-full",children:"( )"}):p.jsx("input",{type:o.variableType==="number"?"number":"text",value:o.initialValue!==void 0?o.initialValue:"",onChange:f=>u("initialValue",o.variableType==="number"?Number(f.target.value):f.target.value),className:"w-full p-1 text-xs bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded shadow-sm nodrag",placeholder:""})]}),p.jsxs("div",{className:"flex items-center",children:[p.jsx("label",{className:"text-xs text-gray-600 dark:text-gray-400 w-16",children:":"}),p.jsxs("select",{className:"w-full p-1 text-xs bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded shadow-sm nodrag",value:o.variableType||"any",onChange:f=>u("variableType",f.target.value),children:[p.jsx("option",{value:"any",children:" "}),p.jsx("option",{value:"number",children:""}),p.jsx("option",{value:"string",children:""}),p.jsx("option",{value:"boolean",children:""})]})]})]}),p.jsx(ke,{inputs:t.inputs,nodeId:e,nodeType:"variable",onConnect:c}),p.jsx(Ie,{outputs:t.outputs,nodeId:e,nodeType:"variable"})]})},s0=({id:e,data:t,selected:n,nodeDefinition:r})=>{const o=t.type,[s,i]=h.useState({operation:"",leftValue:0,rightValue:0,leftType:"number",rightType:"number"}),[a,l]=h.useState({left:!1,right:!1}),c=ee(x=>x.edges),u=h.useCallback(()=>{const x=Ir(e,c);l({left:x.inputs.left||!1,right:x.inputs.right||!1})},[c,e]);h.useEffect(()=>{t.nodeRef&&i({operation:t.nodeRef.data.operation||(o==="math"?"add":"equal"),leftValue:t.nodeRef.data.leftValue!==void 0?t.nodeRef.data.leftValue:0,rightValue:t.nodeRef.data.rightValue!==void 0?t.nodeRef.data.rightValue:0,leftType:t.nodeRef.data.leftType||"number",rightType:t.nodeRef.data.rightType||"number"})},[t.nodeRef,o]),h.useEffect(()=>{u();const x=setInterval(u,300);return()=>clearInterval(x)},[u]);const d=(x,w)=>{i(m=>({...m,[x]:w})),t.nodeRef&&t.nodeRef.setProperty(x,w)},f=(r==null?void 0:r.color)||{bg:"bg-gray-100 dark:bg-gray-800",text:"text-gray-800 dark:text-gray-200"},g=()=>o==="math"?p.jsx(p.Fragment,{children:p.jsxs("select",{value:s.operation||"add",onChange:x=>d("operation",x.target.value),className:"w-full p-1 text-sm bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded shadow-sm nodrag mb-2",children:[p.jsx("option",{value:"add",children:" (+)"}),p.jsx("option",{value:"subtract",children:" (-)"}),p.jsx("option",{value:"multiply",children:" (*)"}),p.jsx("option",{value:"divide",children:" (/)"}),p.jsx("option",{value:"modulo",children:" (%)"})]})}):o==="logical"?p.jsx(p.Fragment,{children:p.jsxs("select",{value:s.operation||"equal",onChange:x=>d("operation",x.target.value),className:"w-full p-1 text-sm bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded shadow-sm nodrag mb-2",children:[p.jsx("option",{value:"equal",children:" (==)"}),p.jsx("option",{value:"notEqual",children:"  (!=)"}),p.jsx("option",{value:"strictEqual",children:"  (===)"}),p.jsx("option",{value:"strictNotEqual",children:"   (!==)"}),p.jsx("option",{value:"greater",children:" (>)"}),p.jsx("option",{value:"greaterEqual",children:"   (>=)"}),p.jsx("option",{value:"less",children:" (<)"}),p.jsx("option",{value:"lessEqual",children:"   (<=)"})]})}):o==="booleanLogic"?p.jsx(p.Fragment,{children:p.jsxs("select",{value:s.operation||"and",onChange:x=>d("operation",x.target.value),className:"w-full p-1 text-sm bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded shadow-sm nodrag mb-2",children:[p.jsx("option",{value:"and",children:"  (AND)"}),p.jsx("option",{value:"or",children:"  (OR)"})]})}):null,b=()=>p.jsxs("div",{className:"flex flex-col space-y-2 mt-2",children:[p.jsx("div",{className:"flex items-center",title:" ",children:a.left?p.jsx("div",{className:"bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-white p-1 text-xs rounded text-center w-full",children:"( )"}):p.jsxs("div",{className:"flex space-x-1 w-full",children:[s.leftType==="boolean"?p.jsxs("select",{value:String(s.leftValue),onChange:x=>d("leftValue",x.target.value==="true"),className:"w-20 p-1 text-xs bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded nodrag",children:[p.jsx("option",{value:"true",children:""}),p.jsx("option",{value:"false",children:""})]}):p.jsx("input",{type:s.leftType==="number"?"number":"text",value:s.leftValue!==void 0?s.leftValue:"",onChange:x=>{let w=x.target.value;s.leftType==="number"&&(w=x.target.value!==""?Number(x.target.value):0),d("leftValue",w)},className:"w-20 p-1 text-xs bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded nodrag"}),p.jsxs("select",{value:s.leftType||"number",onChange:x=>d("leftType",x.target.value),className:"flex-1 p-1 text-xs bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded nodrag",children:[p.jsx("option",{value:"number",children:""}),p.jsx("option",{value:"string",children:""}),p.jsx("option",{value:"boolean",children:"."})]})]})}),p.jsx("div",{className:"flex items-center",title:" ",children:a.right?p.jsx("div",{className:"bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-white p-1 text-xs rounded text-center w-full",children:"( )"}):p.jsxs("div",{className:"flex space-x-1 w-full",children:[s.rightType==="boolean"?p.jsxs("select",{value:String(s.rightValue),onChange:x=>d("rightValue",x.target.value==="true"),className:"w-20 p-1 text-xs bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded nodrag",children:[p.jsx("option",{value:"true",children:""}),p.jsx("option",{value:"false",children:""})]}):p.jsx("input",{type:s.rightType==="number"?"number":"text",value:s.rightValue!==void 0?s.rightValue:"",onChange:x=>{let w=x.target.value;s.rightType==="number"&&(w=x.target.value!==""?Number(x.target.value):0),d("rightValue",w)},className:"w-20 p-1 text-xs bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded nodrag"}),p.jsxs("select",{value:s.rightType||"number",onChange:x=>d("rightType",x.target.value),className:"flex-1 p-1 text-xs bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded nodrag",children:[p.jsx("option",{value:"number",children:""}),p.jsx("option",{value:"string",children:""}),p.jsx("option",{value:"boolean",children:"."})]})]})})]});return p.jsxs("div",{className:`${f.bg} ${f.text} flex flex-col relative`,style:{minWidth:"200px",minHeight:"150px",padding:"1rem",borderRadius:"0.375rem",borderWidth:"2px",borderStyle:"solid",borderColor:n?"#ffffff":o==="math"?"#a855f7":"#3b82f6",boxShadow:n?`0 0 0 1px ${o==="math"?"#a855f7":"#3b82f6"}, 0 4px 6px -1px rgba(0, 0, 0, 0.1)`:"0 1px 3px 0 rgba(0, 0, 0, 0.1)",transition:"all 0.2s ease"},children:[p.jsx(Re,{nodeRef:t.nodeRef,nodeType:o}),p.jsx(Se,{children:t.label}),p.jsxs("div",{className:"w-full",children:[g(),b()]}),p.jsx(ke,{inputs:t.inputs,nodeId:e,nodeType:o,onConnect:u}),p.jsx(Ie,{outputs:t.outputs,nodeId:e,nodeType:o})]})},i0=({id:e,data:t,selected:n,nodeDefinition:r})=>{const o=t.type,[s,i]=h.useState({firstIndex:0,lastIndex:5,step:1,condition:"equal"}),[a,l]=h.useState({firstIndex:!1,lastIndex:!1,step:!1,test:!1,flow:!1}),c=ee(w=>w.edges),u=h.useCallback(()=>{if(!e)return;const w=Ir(e,c);o==="loop"?l({firstIndex:w.inputs.firstIndex||!1,lastIndex:w.inputs.lastIndex||!1,step:w.inputs.step||!1,flow:w.inputs.flow||!1}):o==="if"&&l({test:w.inputs.test||!1,flow:w.inputs.flow||!1})},[c,e,o]);h.useEffect(()=>{t.nodeRef&&(o==="loop"?i({firstIndex:t.nodeRef.data.firstIndex!==void 0?t.nodeRef.data.firstIndex:0,lastIndex:t.nodeRef.data.lastIndex!==void 0?t.nodeRef.data.lastIndex:5,step:t.nodeRef.data.step!==void 0?t.nodeRef.data.step:1}):o==="if"&&i({condition:t.nodeRef.data.condition||"equal"}))},[t.nodeRef,o]),h.useEffect(()=>{u();const w=setInterval(u,300);return()=>clearInterval(w)},[u]);const d=(w,m)=>{i(N=>({...N,[w]:m})),t.nodeRef&&t.nodeRef.setProperty(w,m)},f=(r==null?void 0:r.color)||{bg:"bg-gray-100 dark:bg-gray-800",text:"text-gray-800 dark:text-gray-200"},b=o==="loop"?{minWidth:"200px",minHeight:"160px"}:{minWidth:"160px",minHeight:"100px"},x=()=>{if(o==="loop"){const w=Number(s.firstIndex||0),m=Number(s.lastIndex||5),N=Number(s.step||1),S=N!==0?Math.floor(Math.abs((m-w)/N))+1:0;return p.jsxs("div",{className:"w-full space-y-2",children:[p.jsxs("div",{className:"flex items-center mb-1",children:[p.jsx("label",{className:"block text-xs mr-2 w-24",children:":"}),a.firstIndex?p.jsx("div",{className:"bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-white p-1 text-xs rounded text-center w-full",children:"( )"}):p.jsx("input",{type:"number",value:s.firstIndex!==void 0?s.firstIndex:0,onChange:v=>d("firstIndex",Number(v.target.value)),className:"w-full p-1 text-xs bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded shadow-sm nodrag"})]}),p.jsxs("div",{className:"flex items-center mb-1",children:[p.jsx("label",{className:"block text-xs mr-2 w-24",children:":"}),a.lastIndex?p.jsx("div",{className:"bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-white p-1 text-xs rounded text-center w-full",children:"( )"}):p.jsx("input",{type:"number",value:s.lastIndex!==void 0?s.lastIndex:5,onChange:v=>d("lastIndex",Number(v.target.value)),className:"w-full p-1 text-xs bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded shadow-sm nodrag"})]}),p.jsxs("div",{className:"flex items-center mb-1",children:[p.jsx("label",{className:"block text-xs mr-2 w-24",children:":"}),a.step?p.jsx("div",{className:"bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-white p-1 text-xs rounded text-center w-full",children:"( )"}):p.jsx("input",{type:"number",value:s.step!==void 0?s.step:1,onChange:v=>{const E=Number(v.target.value);d("step",E===0?1:E)},className:"w-full p-1 text-xs bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded shadow-sm nodrag"})]}),p.jsxs("div",{className:"text-center text-xs text-gray-500 dark:text-gray-400 mt-1",children:["~",S," "]})]})}else if(o==="if")return null;return null};return p.jsxs("div",{className:`${f.bg} ${f.text} flex flex-col relative`,style:{minWidth:b.minWidth,minHeight:b.minHeight,padding:"1rem",borderRadius:"0.375rem",borderWidth:"2px",borderStyle:"solid",borderColor:n?"#ffffff":o==="if"?"#6366f1":"#ef4444",boxShadow:n?`0 0 0 1px ${o==="if"?"#6366f1":"#ef4444"}, 0 4px 6px -1px rgba(0, 0, 0, 0.1)`:"0 1px 3px 0 rgba(0, 0, 0, 0.1)",transition:"all 0.2s ease"},children:[p.jsx(Re,{nodeRef:t.nodeRef,nodeType:o}),p.jsx(Se,{children:t.label}),p.jsx("div",{className:"flex justify-center w-full flex-1",children:x()}),p.jsx(ke,{inputs:t.inputs,nodeId:e,nodeType:o,onConnect:u}),p.jsx(Ie,{outputs:t.outputs,nodeId:e,nodeType:o})]})},a0=({id:e,data:t,selected:n,nodeDefinition:r})=>{const[o,s]=h.useState({message:""}),[i,a]=h.useState({value:!1}),l=ee(f=>f.edges),c=h.useCallback(()=>{if(!e)return;const f=l.some(g=>g.target===e&&g.targetHandle==="input-value");a({value:f})},[l,e]);h.useEffect(()=>{t.nodeRef&&s({message:t.nodeRef.data.message||""})},[t.nodeRef]),h.useEffect(()=>{c();const f=setInterval(c,300);return()=>clearInterval(f)},[c]);const u=(f,g)=>{s(b=>({...b,[f]:g})),t.nodeRef&&t.nodeRef.setProperty(f,g)},d=(r==null?void 0:r.color)||{bg:"bg-gray-100 dark:bg-gray-800",text:"text-gray-800 dark:text-gray-200"};return p.jsxs("div",{className:`${d.bg} ${d.text} flex flex-col relative`,style:{minWidth:"200px",minHeight:"120px",padding:"1rem",borderRadius:"0.375rem",borderWidth:"2px",borderStyle:"solid",borderColor:n?"#ffffff":"#f59e0b",boxShadow:n?"0 0 0 1px #f59e0b, 0 4px 6px -1px rgba(0, 0, 0, 0.1)":"0 1px 3px 0 rgba(0, 0, 0, 0.1)",transition:"all 0.2s ease"},children:[p.jsx(Re,{nodeRef:t.nodeRef,nodeType:"print"}),p.jsx(Se,{children:t.label}),p.jsx("div",{className:"flex flex-col w-full",children:p.jsx("div",{className:"w-full",children:i.value?p.jsx("div",{className:"bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-white p-1 text-xs rounded text-center w-full",children:"( )"}):p.jsx("textarea",{value:o.message||"",onChange:f=>u("message",f.target.value),className:"w-full p-1 text-xs bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded shadow-sm nodrag min-h-[40px] resize-y",placeholder:"   ",rows:Math.max(2,(o.message||"").split(`
`).length)})})}),p.jsx(ke,{inputs:t.inputs,nodeId:e,nodeType:"print",onConnect:c}),p.jsx(Ie,{outputs:t.outputs,nodeId:e,nodeType:"print"})]})},l0=({id:e,data:t,selected:n,nodeDefinition:r})=>{const o=ee(c=>c.edges),[s,i]=h.useState({left:!1,right:!1,flow:!1}),a=h.useCallback(()=>{const c=Ir(e,o);i({left:c.inputs.left||!1,right:c.inputs.right||!1,flow:c.inputs.flow||!1})},[o,e]);h.useEffect(()=>{a();const c=setInterval(a,300);return()=>clearInterval(c)},[a]);const l=(r==null?void 0:r.color)||{bg:"bg-gray-100 dark:bg-gray-800",text:"text-gray-800 dark:text-gray-200"};return p.jsxs("div",{className:`${l.bg} ${l.text} flex flex-col items-center relative`,style:{minWidth:"180px",minHeight:"120px",padding:"1rem",borderRadius:"0.375rem",borderWidth:"2px",borderStyle:"solid",borderColor:n?"#ffffff":"#10b981",boxShadow:n?"0 0 0 1px #10b981, 0 4px 6px -1px rgba(0, 0, 0, 0.1)":"0 1px 3px 0 rgba(0, 0, 0, 0.1)",transition:"all 0.2s ease"},children:[p.jsx(Re,{nodeRef:t.nodeRef,nodeType:"assignment"}),p.jsx(Se,{children:t.label}),p.jsx("div",{className:"text-center text-xl font-bold my-2",children:"="}),p.jsx(ke,{inputs:t.inputs,nodeId:e,nodeType:"assignment",onConnect:a}),p.jsx(Ie,{outputs:t.outputs,nodeId:e,nodeType:"assignment"})]})},c0=({id:e,data:t,selected:n,nodeDefinition:r})=>{const[o,s]=h.useState("and");h.useEffect(()=>{t.nodeRef&&s(t.nodeRef.data.operation||"and")},[t.nodeRef]);const i=l=>{s(l),t.nodeRef&&t.nodeRef.setProperty("operation",l)},a=(r==null?void 0:r.color)||{bg:"bg-indigo-100 dark:bg-indigo-900",text:"text-indigo-800 dark:text-indigo-200"};return p.jsxs("div",{className:`${a.bg} ${a.text} flex flex-col relative`,style:{minWidth:"180px",minHeight:"120px",padding:"1rem",borderRadius:"0.375rem",borderWidth:"2px",borderStyle:"solid",borderColor:n?"#ffffff":"#6366f1",boxShadow:n?"0 0 0 1px #6366f1, 0 4px 6px -1px rgba(0, 0, 0, 0.1)":"0 1px 3px 0 rgba(0, 0, 0, 0.1)",transition:"all 0.2s ease"},children:[p.jsx(Re,{nodeRef:t.nodeRef,nodeType:"booleanLogic"}),p.jsx(Se,{children:t.label}),p.jsx("div",{className:"flex flex-grow items-center justify-center",children:p.jsxs("select",{value:o,onChange:l=>i(l.target.value),className:`w-4/5 p-2 text-sm bg-white dark:bg-gray-700 border \r
                              border-gray-300 dark:border-gray-600 rounded shadow-sm nodrag`,children:[p.jsx("option",{value:"and",children:" (&&)"}),p.jsx("option",{value:"or",children:" (||)"})]})}),p.jsx(ke,{inputs:t.inputs,nodeId:e,nodeType:"booleanLogic"}),p.jsx(Ie,{outputs:t.outputs,nodeId:e,nodeType:"booleanLogic"})]})},u0=({id:e,data:t,selected:n,nodeDefinition:r})=>{var s;const o=(r==null?void 0:r.color)||{bg:"bg-blue-100 dark:bg-blue-900",text:"text-blue-800 dark:text-blue-200"};return(s=t.nodeRef)!=null&&s.state,p.jsxs("div",{className:`${o.bg} ${o.text} flex flex-col relative`,style:{minWidth:"220px",minHeight:"120px",padding:"1rem",borderRadius:"0.375rem",borderWidth:"2px",borderStyle:"solid",borderColor:n?"#ffffff":"#3b82f6",boxShadow:n?"0 0 0 1px #3b82f6, 0 4px 6px -1px rgba(0, 0, 0, 0.1)":"0 1px 3px 0 rgba(0, 0, 0, 0.1)",transition:"all 0.2s ease"},children:[p.jsx(Re,{nodeRef:t.nodeRef,nodeType:"player"}),p.jsx(Se,{children:t.label}),p.jsx("div",{className:"flex flex-col items-center justify-center p-2",children:p.jsx("div",{className:"text-center text-sm text-gray-600 dark:text-gray-400",children:"    "})}),p.jsx(ke,{inputs:t.inputs,nodeId:e,nodeType:"player"}),p.jsx(Ie,{outputs:t.outputs,nodeId:e,nodeType:"player"})]})},d0=({id:e,data:t,selected:n,nodeDefinition:r})=>{const[o,s]=h.useState(1);h.useEffect(()=>{t.nodeRef&&s(t.nodeRef.data.steps||1)},[t.nodeRef]);const i=l=>{const c=parseInt(l)||1;s(c),t.nodeRef&&t.nodeRef.setProperty("steps",c)},a=(r==null?void 0:r.color)||{bg:"bg-green-100 dark:bg-green-900",text:"text-green-800 dark:text-green-200"};return p.jsxs("div",{className:`${a.bg} ${a.text} flex flex-col relative`,style:{minWidth:"150px",minHeight:"120px",padding:"1rem",borderRadius:"0.375rem",borderWidth:"2px",borderStyle:"solid",borderColor:n?"#ffffff":"#22c55e",boxShadow:n?"0 0 0 1px #22c55e, 0 4px 6px -1px rgba(0, 0, 0, 0.1)":"0 1px 3px 0 rgba(0, 0, 0, 0.1)",transition:"all 0.2s ease"},children:[p.jsx(Re,{nodeRef:t.nodeRef,nodeType:"move"}),p.jsx(Se,{children:t.label}),p.jsx("div",{className:"flex flex-col items-center justify-center p-2",children:p.jsxs("div",{className:"flex items-center w-full mb-2",children:[p.jsx("span",{className:"text-gray-600 dark:text-gray-300 text-sm mr-2",children:":"}),p.jsx("input",{type:"number",min:"1",max:"10",value:o,onChange:l=>i(l.target.value),className:"bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded px-2 py-1 text-sm w-16 nodrag"})]})}),p.jsx(ke,{inputs:t.inputs,nodeId:e,nodeType:"move"}),p.jsx(Ie,{outputs:t.outputs,nodeId:e,nodeType:"move"})]})},f0=({id:e,data:t,selected:n,nodeDefinition:r})=>{const[o,s]=h.useState("right");h.useEffect(()=>{t.nodeRef&&(s(t.nodeRef.data.direction||"right"),a(t.nodeRef.data.direction||"right"))},[t.nodeRef]);const i=c=>{s(c),t.nodeRef&&(t.nodeRef.setProperty("direction",c),a(c))},a=c=>{if(t.nodeRef){const u=c==="left"?"":"";t.nodeRef.label=` ${u}`}},l=(r==null?void 0:r.color)||{bg:"bg-yellow-100 dark:bg-yellow-900",text:"text-yellow-800 dark:text-yellow-200"};return p.jsxs("div",{className:`${l.bg} ${l.text} flex flex-col relative`,style:{minWidth:"220px",minHeight:"120px",padding:"1rem",borderRadius:"0.375rem",borderWidth:"2px",borderStyle:"solid",borderColor:n?"#ffffff":"#eab308",boxShadow:n?"0 0 0 1px #eab308, 0 4px 6px -1px rgba(0, 0, 0, 0.1)":"0 1px 3px 0 rgba(0, 0, 0, 0.1)",transition:"all 0.2s ease"},children:[p.jsx(Re,{nodeRef:t.nodeRef,nodeType:"turn"}),p.jsx(Se,{children:t.label}),p.jsx("div",{className:"flex flex-col items-center justify-center p-2",children:p.jsxs("div",{className:"flex items-center w-full mb-2",children:[p.jsx("span",{className:"text-gray-600 dark:text-gray-300 text-sm mr-2",children:":"}),p.jsxs("select",{value:o,onChange:c=>i(c.target.value),className:"bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded px-2 py-1 text-sm flex-grow nodrag",children:[p.jsx("option",{value:"left",children:""}),p.jsx("option",{value:"right",children:""})]})]})}),p.jsx(ke,{inputs:t.inputs,nodeId:e,nodeType:"turn"}),p.jsx(Ie,{outputs:t.outputs,nodeId:e,nodeType:"turn"})]})},h0=({id:e,data:t,selected:n,nodeDefinition:r})=>{const o=(r==null?void 0:r.color)||{bg:"bg-red-100 dark:bg-red-900",text:"text-red-800 dark:text-red-200"};return p.jsxs("div",{className:`${o.bg} ${o.text} flex flex-col relative`,style:{minWidth:"220px",minHeight:"120px",padding:"1rem",borderRadius:"0.375rem",borderWidth:"2px",borderStyle:"solid",borderColor:n?"#ffffff":"#ef4444",boxShadow:n?"0 0 0 1px #ef4444, 0 4px 6px -1px rgba(0, 0, 0, 0.1)":"0 1px 3px 0 rgba(0, 0, 0, 0.1)",transition:"all 0.2s ease"},children:[p.jsx(Re,{nodeRef:t.nodeRef,nodeType:"wallAhead"}),p.jsx(Se,{children:t.label}),p.jsx("div",{className:"flex flex-col items-center justify-center p-2",children:p.jsx("div",{className:"text-center text-sm text-gray-600 dark:text-gray-400",children:"     "})}),p.jsx(ke,{inputs:t.inputs,nodeId:e,nodeType:"wallAhead"}),p.jsx(Ie,{outputs:t.outputs,nodeId:e,nodeType:"wallAhead"})]})},p0=({id:e,data:t,selected:n,nodeDefinition:r})=>{const o=(r==null?void 0:r.color)||{bg:"bg-purple-100 dark:bg-purple-900",text:"text-purple-800 dark:text-purple-200"};return p.jsxs("div",{className:`${o.bg} ${o.text} flex flex-col relative`,style:{minWidth:"220px",minHeight:"120px",padding:"1rem",borderRadius:"0.375rem",borderWidth:"2px",borderStyle:"solid",borderColor:n?"#ffffff":"#a855f7",boxShadow:n?"0 0 0 1px #a855f7, 0 4px 6px -1px rgba(0, 0, 0, 0.1)":"0 1px 3px 0 rgba(0, 0, 0, 0.1)",transition:"all 0.2s ease"},children:[p.jsx(Re,{nodeRef:t.nodeRef,nodeType:"exitReached"}),p.jsx(Se,{children:t.label}),p.jsx("div",{className:"flex flex-col items-center justify-center p-2",children:p.jsx("div",{className:"text-center text-sm text-gray-600 dark:text-gray-400",children:",      "})}),p.jsx(ke,{inputs:t.inputs,nodeId:e,nodeType:"exitReached"}),p.jsx(Ie,{outputs:t.outputs,nodeId:e,nodeType:"exitReached"})]})},g0=({id:e,data:t,selected:n,nodeDefinition:r})=>{const o=(r==null?void 0:r.color)||{bg:"bg-cyan-100 dark:bg-cyan-900",text:"text-cyan-800 dark:text-cyan-200"};return p.jsxs("div",{className:`${o.bg} ${o.text} flex flex-col relative`,style:{minWidth:"220px",minHeight:"120px",padding:"1rem",borderRadius:"0.375rem",borderWidth:"2px",borderStyle:"solid",borderColor:n?"#ffffff":"#22d3ee",boxShadow:n?"0 0 0 1px #22d3ee, 0 4px 6px -1px rgba(0, 0, 0, 0.1)":"0 1px 3px 0 rgba(0, 0, 0, 0.1)",transition:"all 0.2s ease"},children:[p.jsx(Re,{nodeRef:t.nodeRef,nodeType:"jump"}),p.jsx(Se,{children:t.label}),p.jsx("div",{className:"flex flex-col items-center justify-center p-2",children:p.jsx("div",{className:"text-center text-sm text-gray-600 dark:text-gray-400",children:"  "})}),p.jsx(ke,{inputs:t.inputs,nodeId:e,nodeType:"jump"}),p.jsx(Ie,{outputs:t.outputs,nodeId:e,nodeType:"jump"})]})};function m0({title:e,titleId:t,...n},r){return h.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},n),e?h.createElement("title",{id:t},e):null,h.createElement("path",{fillRule:"evenodd",d:"M14.615 1.595a.75.75 0 0 1 .359.852L12.982 9.75h7.268a.75.75 0 0 1 .548 1.262l-10.5 11.25a.75.75 0 0 1-1.272-.71l1.992-7.302H3.75a.75.75 0 0 1-.548-1.262l10.5-11.25a.75.75 0 0 1 .913-.143Z",clipRule:"evenodd"}))}const y0=h.forwardRef(m0);function x0({title:e,titleId:t,...n},r){return h.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},n),e?h.createElement("title",{id:t},e):null,h.createElement("path",{fillRule:"evenodd",d:"M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12Zm13.36-1.814a.75.75 0 1 0-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 0 0-1.06 1.06l2.25 2.25a.75.75 0 0 0 1.14-.094l3.75-5.25Z",clipRule:"evenodd"}))}const w0=h.forwardRef(x0);function b0({title:e,titleId:t,...n},r){return h.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},n),e?h.createElement("title",{id:t},e):null,h.createElement("path",{fillRule:"evenodd",d:"M12.53 16.28a.75.75 0 0 1-1.06 0l-7.5-7.5a.75.75 0 0 1 1.06-1.06L12 14.69l6.97-6.97a.75.75 0 1 1 1.06 1.06l-7.5 7.5Z",clipRule:"evenodd"}))}const v0=h.forwardRef(b0);function E0({title:e,titleId:t,...n},r){return h.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},n),e?h.createElement("title",{id:t},e):null,h.createElement("path",{fillRule:"evenodd",d:"M11.47 7.72a.75.75 0 0 1 1.06 0l7.5 7.5a.75.75 0 1 1-1.06 1.06L12 9.31l-6.97 6.97a.75.75 0 0 1-1.06-1.06l7.5-7.5Z",clipRule:"evenodd"}))}const N0=h.forwardRef(E0);function S0({title:e,titleId:t,...n},r){return h.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},n),e?h.createElement("title",{id:t},e):null,h.createElement("path",{fillRule:"evenodd",d:"M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12ZM12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75Zm0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z",clipRule:"evenodd"}))}const C0=h.forwardRef(S0);function _0({title:e,titleId:t,...n},r){return h.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},n),e?h.createElement("title",{id:t},e):null,h.createElement("path",{d:"M5.055 7.06C3.805 6.347 2.25 7.25 2.25 8.69v8.122c0 1.44 1.555 2.343 2.805 1.628L12 14.471v2.34c0 1.44 1.555 2.343 2.805 1.628l7.108-4.061c1.26-.72 1.26-2.536 0-3.256l-7.108-4.061C13.555 6.346 12 7.249 12 8.689v2.34L5.055 7.061Z"}))}const Mo=h.forwardRef(_0);function $0({title:e,titleId:t,...n},r){return h.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},n),e?h.createElement("title",{id:t},e):null,h.createElement("path",{fillRule:"evenodd",d:"M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12Zm8.706-1.442c1.146-.573 2.437.463 2.126 1.706l-.709 2.836.042-.02a.75.75 0 0 1 .67 1.34l-.04.022c-1.147.573-2.438-.463-2.127-1.706l.71-2.836-.042.02a.75.75 0 1 1-.671-1.34l.041-.022ZM12 9a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z",clipRule:"evenodd"}))}const k0=h.forwardRef($0);function I0({title:e,titleId:t,...n},r){return h.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},n),e?h.createElement("title",{id:t},e):null,h.createElement("path",{fillRule:"evenodd",d:"M4.5 5.653c0-1.427 1.529-2.33 2.779-1.643l11.54 6.347c1.295.712 1.295 2.573 0 3.286L7.28 19.99c-1.25.687-2.779-.217-2.779-1.643V5.653Z",clipRule:"evenodd"}))}const Xn=h.forwardRef(I0);function R0({title:e,titleId:t,...n},r){return h.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},n),e?h.createElement("title",{id:t},e):null,h.createElement("path",{fillRule:"evenodd",d:"M4.5 7.5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-9a3 3 0 0 1-3-3v-9Z",clipRule:"evenodd"}))}const j0=h.forwardRef(R0);function T0({title:e,titleId:t,...n},r){return h.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},n),e?h.createElement("title",{id:t},e):null,h.createElement("path",{fillRule:"evenodd",d:"M16.5 4.478v.227a48.816 48.816 0 0 1 3.878.512.75.75 0 1 1-.256 1.478l-.209-.035-1.005 13.07a3 3 0 0 1-2.991 2.77H8.084a3 3 0 0 1-2.991-2.77L4.087 6.66l-.209.035a.75.75 0 0 1-.256-1.478A48.567 48.567 0 0 1 7.5 4.705v-.227c0-1.564 1.213-2.9 2.816-2.951a52.662 52.662 0 0 1 3.369 0c1.603.051 2.815 1.387 2.815 2.951Zm-6.136-1.452a51.196 51.196 0 0 1 3.273 0C14.39 3.05 15 3.684 15 4.478v.113a49.488 49.488 0 0 0-6 0v-.113c0-.794.609-1.428 1.364-1.452Zm-.355 5.945a.75.75 0 1 0-1.5.058l.347 9a.75.75 0 1 0 1.499-.058l-.346-9Zm5.48.058a.75.75 0 1 0-1.498-.058l-.347 9a.75.75 0 0 0 1.5.058l.345-9Z",clipRule:"evenodd"}))}const pi=h.forwardRef(T0);function A0({title:e,titleId:t,...n},r){return h.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},n),e?h.createElement("title",{id:t},e):null,h.createElement("path",{fillRule:"evenodd",d:"M5.47 5.47a.75.75 0 0 1 1.06 0L12 10.94l5.47-5.47a.75.75 0 1 1 1.06 1.06L13.06 12l5.47 5.47a.75.75 0 1 1-1.06 1.06L12 13.06l-5.47 5.47a.75.75 0 0 1-1.06-1.06L10.94 12 5.47 6.53a.75.75 0 0 1 0-1.06Z",clipRule:"evenodd"}))}const M0=h.forwardRef(A0),D0=({selected:e,nodeId:t,onDelete:n})=>{if(!e)return null;const r=o=>{o.stopPropagation(),n&&t&&n(t)};return p.jsx(Ch,{position:"top",align:"center",className:"node-toolbar",children:p.jsx("button",{onClick:r,className:"node-toolbar__button bg-black bg-opacity-70 hover:bg-opacity-80 text-white rounded-full w-8 h-8 flex items-center justify-center shadow-md transition-all",title:"",children:p.jsx(pi,{className:"h-5 w-5"})})})},V0=({data:e,selected:t,id:n})=>{const r=e==null?void 0:e.type,o=Jt(),s=h.useCallback(()=>{n&&o.deleteElements({nodes:[{id:n}]})},[n,o]),i=Zh(r);let a;switch(r){case"variable":a=p.jsx(o0,{id:n,data:e,selected:t,nodeDefinition:i});break;case"assignment":a=p.jsx(l0,{id:n,data:e,selected:t,nodeDefinition:i});break;case"math":case"logical":a=p.jsx(s0,{id:n,data:e,selected:t,nodeDefinition:i});break;case"booleanLogic":a=p.jsx(c0,{id:n,data:e,selected:t,nodeDefinition:i});break;case"if":case"loop":a=p.jsx(i0,{id:n,data:e,selected:t,nodeDefinition:i});break;case"print":a=p.jsx(a0,{id:n,data:e,selected:t,nodeDefinition:i});break;case"player":a=p.jsx(u0,{id:n,data:e,selected:t,nodeDefinition:i});break;case"move":a=p.jsx(d0,{id:n,data:e,selected:t,nodeDefinition:i});break;case"turn":a=p.jsx(f0,{id:n,data:e,selected:t,nodeDefinition:i});break;case"wallAhead":a=p.jsx(h0,{id:n,data:e,selected:t,nodeDefinition:i});break;case"exitReached":a=p.jsx(p0,{id:n,data:e,selected:t,nodeDefinition:i});break;case"jump":a=p.jsx(g0,{id:n,data:e,selected:t,nodeDefinition:i});break;default:a=p.jsxs("div",{className:"bg-gray-100 dark:bg-gray-800 border-2 border-gray-500 p-3 rounded-md shadow w-48 min-h-[100px]",children:[p.jsx(Se,{children:(e==null?void 0:e.label)||" "}),p.jsxs("div",{className:"text-center text-sm",children:[": ",r||" "]})]})}return p.jsxs(p.Fragment,{children:[p.jsx(D0,{selected:t,nodeId:n,onDelete:s}),a]})},P0=h.memo(V0),O0=({selected:e,edgeId:t,edge:n,onDelete:r})=>{const[o,s]=h.useState(e),i=h.useCallback(c=>{c.stopPropagation(),r&&t&&r(t)},[t,r]);if(j.useEffect(()=>{s(e)},[e]),!o||!n||!n.sourceX)return null;const a=(n.sourceX+n.targetX)/2,l=(n.sourceY+n.targetY)/2;return p.jsx("div",{className:"edge-toolbar",style:{top:`${l}px`,left:`${a}px`},children:p.jsx("button",{onClick:i,className:"edge-toolbar__button bg-black bg-opacity-70 hover:bg-opacity-80 text-white rounded-full w-8 h-8 flex items-center justify-center shadow-md transition-all",title:" ",children:p.jsx(pi,{className:"h-5 w-5"})})})},L0=({id:e,source:t,target:n,sourceX:r,sourceY:o,targetX:s,targetY:i,sourcePosition:a,targetPosition:l,sourceHandle:c,targetHandle:u,style:d={},data:f,markerEnd:g,selected:b})=>{const x=Jt(),w=h.useCallback(()=>{e&&x.deleteElements({edges:[{id:e}]})},[e,x]),[m,N,S]=Er({sourceX:r,sourceY:o,sourcePosition:a,targetX:s,targetY:i,targetPosition:l}),[v,E]=h.useState(!1),[C,M]=h.useState(null),[O,A]=h.useState(null);h.useEffect(()=>{f!=null&&f.dataTransfer&&(E(!1),A(null),setTimeout(()=>{E(!0),M(f.dataTransfer.value),A(`animate-${Date.now()}`);const z=setTimeout(()=>{E(!1),A(null)},2e3);return()=>clearTimeout(z)},0))},[f==null?void 0:f.dataTransfer]);const L={...d,strokeWidth:b?3:v?2.5:1.5,stroke:b||v?"#3b82f6":d.stroke||"#b1b1b7",filter:b?`url(#glow-${e})`:void 0},H=z=>{if(z===null)return"null";if(z===void 0)return"undefined";if(z==="flow")return"";if(typeof z=="object")try{return JSON.stringify(z)}catch{return"[]"}return String(z)},W={sourceX:r,sourceY:o,targetX:s,targetY:i};return p.jsxs(p.Fragment,{children:[p.jsx("defs",{children:p.jsxs("filter",{id:`glow-${e}`,x:"-50%",y:"-50%",width:"200%",height:"200%",children:[p.jsx("feGaussianBlur",{stdDeviation:"2",result:"coloredBlur"}),p.jsxs("feMerge",{children:[p.jsx("feMergeNode",{in:"coloredBlur"}),p.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),p.jsx(kt,{path:m,markerEnd:g,style:L}),v&&O&&p.jsx("svg",{style:{overflow:"visible",position:"absolute",left:0,top:0,width:"100%",height:"100%",pointerEvents:"none"},children:p.jsx("circle",{r:"4",fill:"#3b82f6",filter:`url(#glow-${e})`,children:p.jsx("animateMotion",{dur:"1.5s",repeatCount:"2",path:m,rotate:"auto"})})},O),v&&C!==null&&C!=="flow"&&p.jsx(To,{children:p.jsx("div",{style:{position:"absolute",transform:`translate(-50%, -50%) translate(${N}px, ${S}px)`,background:"#ffffff",padding:"4px 8px",borderRadius:"4px",fontSize:12,fontWeight:500,boxShadow:"0 0 0 1px rgba(0,0,0,0.1), 0 2px 4px rgba(0,0,0,0.1)",pointerEvents:"all",color:"#333",zIndex:1e3},className:"nodrag nopan",children:H(C)},`label-${O}`)}),p.jsx(To,{children:p.jsx(O0,{selected:b,edgeId:e,edge:W,onDelete:w})})]})},H0=h.memo(L0),z0=({consoleOutput:e=[],onClear:t,title:n="",className:r="",initiallyExpanded:o=!0,isMobile:s=!1,compactMode:i=!1,maxWidth:a})=>{const[l,c]=h.useState(o),[u,d]=h.useState([]),f=h.useRef(null);h.useEffect(()=>{e&&e.length>0&&(d(e),setTimeout(()=>{f.current&&l&&(f.current.scrollTop=f.current.scrollHeight)},50))},[e,l]);const g=S=>{S&&S.stopPropagation(),c(!l)},b=S=>{S&&S.stopPropagation(),d([]),t&&t()},x=S=>{if(S===null)return"null";if(S===void 0)return"undefined";if(typeof S=="object")try{return JSON.stringify(S)}catch{return"[]"}return String(S)},w=S=>{if(i)return null;switch(S){case"error":return p.jsx(C0,{className:"w-4 h-4 mr-1 text-red-500"});case"output":return p.jsx(w0,{className:"w-4 h-4 mr-1 text-green-500"});case"debug":return p.jsx(k0,{className:"w-4 h-4 mr-1 text-gray-400"});default:return null}},m=i?"h-20":s?"h-28":"h-48",N=a?{maxWidth:`${a}px`}:{};return p.jsxs("div",{className:`border rounded dark:border-gray-700 ${r}`,style:N,children:[p.jsxs("div",{className:`flex items-center justify-between ${i?"p-1":"p-2"} bg-gray-100 dark:bg-gray-700`,children:[p.jsxs("div",{className:"flex items-center cursor-pointer flex-1 nodrag",onClick:g,children:[p.jsxs("h4",{className:`font-medium text-gray-800 dark:text-gray-200 ${i?"text-xs":s?"text-sm":""}`,children:[n," ",u.length>0&&`(${u.length})`]}),p.jsx("button",{className:"text-gray-500 dark:text-gray-400 ml-1",children:l?p.jsx(N0,{className:`${i?"w-3 h-3":"w-4 h-4"}`}):p.jsx(v0,{className:`${i?"w-3 h-3":"w-4 h-4"}`})})]}),p.jsx("button",{onClick:b,className:`${i?"text-[10px] px-1":"text-xs px-2"} text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 py-1 nodrag`,children:""})]}),l&&p.jsx("div",{ref:f,className:`${i?"p-1":"p-2"} bg-gray-50 dark:bg-gray-900 ${m} overflow-y-auto font-mono ${i?"text-[10px]":s?"text-xs":"text-sm"} nodrag`,children:u.length===0?p.jsx("div",{className:"text-gray-500 dark:text-gray-400 italic",children:" "}):u.map((S,v)=>p.jsxs("div",{className:`${i?"mb-0.5":"mb-1"} flex items-center ${S.type==="error"?"text-red-600 dark:text-red-400":S.type==="debug"?"text-gray-500 dark:text-gray-500 text-xs":"text-gray-800 dark:text-gray-200"}`,children:[w(S.type),S.type==="debug"?p.jsx("span",{className:"opacity-60 break-all",children:x(S.value)}):p.jsx("span",{className:"break-all",children:x(S.value)})]},v))})]})},F0=({isExecuting:e,executionStep:t,onStop:n,onStep:r,onRunFull:o,consoleOutput:s=[],isMobile:i=!1})=>p.jsxs("div",{className:`bg-white dark:bg-gray-800 rounded-lg ${i?"max-w-[200px] mx-auto px-2 py-1.5":"w-full"} nodrag nopan`,children:[p.jsxs("div",{className:`flex flex-col ${i?"mb-2":"mb-4"}`,children:[p.jsx("div",{className:"flex items-center justify-between mb-1",children:p.jsxs("div",{className:`${i?"text-xs":"text-sm"} text-gray-600 dark:text-gray-400`,children:[": ",t]})}),p.jsx("div",{className:"flex flex-col gap-1.5",children:e?p.jsxs(p.Fragment,{children:[p.jsxs("button",{onClick:a=>{a.stopPropagation(),r()},className:`w-full flex items-center justify-center ${i?"py-1 px-2 text-xs":"py-2 px-4 text-sm"} bg-green-500 hover:bg-green-600 text-white rounded transition-colors`,children:[p.jsx(Mo,{className:`${i?"w-3 h-3":"w-4 h-4"} mr-1`})," "]}),p.jsxs("button",{onClick:a=>{a.stopPropagation(),n()},className:`w-full flex items-center justify-center ${i?"py-1 px-2 text-xs":"py-2 px-4 text-sm"} bg-red-500 hover:bg-red-600 text-white rounded transition-colors`,children:[p.jsx(j0,{className:`${i?"w-3 h-3":"w-4 h-4"} mr-1`}),""]})]}):p.jsxs(p.Fragment,{children:[p.jsxs("button",{onClick:a=>{a.stopPropagation(),r()},className:`w-full flex items-center justify-center ${i?"py-1 px-2 text-xs":"py-2 px-4 text-sm"} bg-green-500 hover:bg-green-600 text-white rounded transition-colors`,children:[p.jsx(Mo,{className:`${i?"w-3 h-3":"w-4 h-4"} mr-1`})," "]}),p.jsxs("button",{onClick:a=>{a.stopPropagation(),o()},className:`w-full flex items-center justify-center ${i?"py-1 px-2 text-xs":"py-2 px-4 text-sm"} bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors`,children:[p.jsx(y0,{className:`${i?"w-3 h-3":"w-4 h-4"} mr-1`})," "]})]})})]}),p.jsx(z0,{consoleOutput:s,isMobile:i,compactMode:i,maxWidth:i?180:void 0})]}),B0=({isExecuting:e,executionStep:t,onStop:n,onStep:r,onRunFull:o,consoleOutput:s,selectedNodeId:i,nodes:a,isMobile:l=!1})=>{const c={EXECUTION:"execution",HIDDEN:"hidden"},[u,d]=h.useState(c.EXECUTION);i&&a.find(b=>b.id===i);const f=b=>{d(b===u?c.HIDDEN:b)},g=()=>{switch(u){case c.EXECUTION:return p.jsx(F0,{isExecuting:e,executionStep:t,onStop:n,onStep:r,onRunFull:o,consoleOutput:s,isMobile:l});case c.HIDDEN:return null;default:return null}};return u===c.HIDDEN?p.jsx("div",{className:"panel-collapsed absolute top-4 right-4 z-50",children:p.jsx("button",{onClick:b=>{b.stopPropagation(),f(c.EXECUTION)},className:"mode-button p-2 bg-gray-200 dark:bg-gray-700 rounded hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors shadow-md",title:"",children:p.jsx(Xn,{className:"w-5 h-5 text-gray-700 dark:text-gray-200"})})}):p.jsxs("div",{className:`right-sidebar absolute top-4 right-4 ${l?"w-full max-w-[220px] mx-4":"w-96"} bg-white dark:bg-gray-800 rounded-lg shadow-lg z-50 nodrag nopan`,children:[p.jsxs("div",{className:`flex items-center justify-between ${l?"px-2 py-1":"px-4 py-2"} border-b border-gray-200 dark:border-gray-700`,children:[p.jsx("div",{className:"flex items-center",children:p.jsx("span",{className:`font-bold text-gray-800 dark:text-gray-200 mr-3 ${l?"text-xs":""}`,children:u===c.EXECUTION&&p.jsxs("span",{className:"flex items-center",children:[p.jsx(Xn,{className:`${l?"w-3 h-3":"w-4 h-4"} mr-1 text-blue-600 dark:text-blue-400`}),""]})})}),p.jsxs("div",{className:"panel-tabs flex gap-2",children:[p.jsx("button",{onClick:b=>{b.stopPropagation(),f(c.EXECUTION)},className:`mode-button ${u===c.EXECUTION?"active":""} ${l?"p-1":"p-1.5"} rounded ${u===c.EXECUTION?"bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-300":"hover:bg-gray-200 dark:hover:bg-gray-700"}`,title:"",children:p.jsx(Xn,{className:`${l?"w-3 h-3":"w-4 h-4"}`})}),p.jsx("button",{onClick:b=>{b.stopPropagation(),f(u)},className:`${l?"p-1":"p-1.5"} hover:bg-gray-200 dark:hover:bg-gray-700 rounded`,title:" ",children:p.jsx(M0,{className:`${l?"w-3 h-3":"w-4 h-4"} text-gray-500`})})]})]}),p.jsx("div",{className:`properties-panel ${l?"p-1":"p-4"} panel-content-wrapper`,onMouseDown:b=>b.stopPropagation(),children:g()})]})},W0=(e,t,n,r)=>{const o=h.useCallback(i=>{i.preventDefault(),i.dataTransfer.dropEffect="move"},[]),s=h.useCallback(i=>{i.preventDefault();const a=e.current.getBoundingClientRect(),l=t.current.screenToFlowPosition({x:i.clientX-a.left,y:i.clientY-a.top}),c=i.dataTransfer.getData("application/reactflow");let u={};try{const b=i.dataTransfer.getData("application/json");b&&(u=JSON.parse(b))}catch(b){console.error("   :",b)}if(!c)return;const d=ye(),f=Yt(c,{id:d,...u}),g={id:d,type:"customNode",position:l,data:{nodeRef:f,id:f.id,type:f.type,label:f.label,inputs:f.inputs,outputs:f.outputs}};n(b=>[...b,g]),r(!0)},[n,r,e,t]);return{onDragOver:o,onDrop:s}},U0=(e,t,n,r,o)=>{const s=h.useCallback(c=>{t(u=>(e(d=>{var m,N,S,v;const f=u.find(E=>E.id===c.source),g=u.find(E=>E.id===c.target);if(!f||!g)return console.warn(" :      "),d;if(c.source===c.target)return console.warn(" :      "),d;const b=(m=f.data.outputs)==null?void 0:m.find(E=>E.id===c.sourceHandle),x=(N=g.data.inputs)==null?void 0:N.find(E=>E.id===c.targetHandle);if(!b||!x)return console.warn(` :    - : ${c.sourceHandle}, : ${c.targetHandle}`),d;if(b.dataType!==x.dataType&&b.dataType!=="any"&&x.dataType!=="any"&&b.dataType!=="reference")return console.warn(` :   : ${b.dataType} -> ${x.dataType}`),d;if(x.dataType!=="flow"&&d.find(C=>C.target===c.target&&C.targetHandle===c.targetHandle))return console.warn(" :    "),d;const w=Ss({...c,id:`edge-${ye()}`,type:"animatedEdge",animated:((S=c.sourceHandle)==null?void 0:S.includes("flow"))||((v=c.targetHandle)==null?void 0:v.includes("flow")),style:{stroke:"#555",strokeWidth:2}},d);return r(!0),w}),u))},[e,r,t]),i=h.useCallback(({nodes:c})=>{c.length===1?o(c[0].id):o(null)},[o]),a=h.useCallback(c=>{n(c),c.filter(d=>d.type==="select"&&d.selected).length>0&&t(d=>d.map(f=>f.data.nodeRef?{...f,data:{...f.data,label:f.data.nodeRef.label,inputs:f.data.nodeRef.inputs,outputs:f.data.nodeRef.outputs}}:f))},[n,t]);h.useEffect(()=>{const c=setInterval(()=>{t(u=>u.some(f=>f.data.nodeRef?f.data.label!==f.data.nodeRef.label||JSON.stringify(f.data.inputs)!==JSON.stringify(f.data.nodeRef.inputs)||JSON.stringify(f.data.outputs)!==JSON.stringify(f.data.nodeRef.outputs):!1)?u.map(f=>f.data.nodeRef&&(f.data.label!==f.data.nodeRef.label||JSON.stringify(f.data.inputs)!==JSON.stringify(f.data.nodeRef.inputs)||JSON.stringify(f.data.outputs)!==JSON.stringify(f.data.nodeRef.outputs))?{...f,data:{...f.data,label:f.data.nodeRef.label,inputs:f.data.nodeRef.inputs,outputs:f.data.nodeRef.outputs}}:f):u)},500);return()=>clearInterval(c)},[t]);const l=h.useCallback(()=>{t(c=>(c.length===0||e(u=>u.filter(d=>{var w,m;const f=c.find(N=>N.id===d.source),g=c.find(N=>N.id===d.target);if(!f||!g)return!1;const b=!d.sourceHandle||((w=f.data.outputs)==null?void 0:w.some(N=>N.id===d.sourceHandle)),x=!d.targetHandle||((m=g.data.inputs)==null?void 0:m.some(N=>N.id===d.targetHandle));return b&&x})),c))},[e,t]);return h.useEffect(()=>{const c=setTimeout(()=>{l()},500);return()=>clearTimeout(c)},[l]),{onConnect:s,onSelectionChange:i,handleNodesChange:a,validateExistingEdges:l}},G0=(e,t,n)=>{const r=h.useMemo(()=>!e||!n||n.length===0?e:e.filter(s=>{var u,d;const i=n.find(f=>f.id===s.source),a=n.find(f=>f.id===s.target);if(!i||!a)return console.warn(`  ${s.id}:      `),!1;const l=!s.sourceHandle||((u=i.data.outputs)==null?void 0:u.some(f=>f.id===s.sourceHandle)),c=!s.targetHandle||((d=a.data.inputs)==null?void 0:d.some(f=>f.id===s.targetHandle));return!l||!c?(console.warn(`  ${s.id}:   `),!1):!0}),[e,n]);return h.useMemo(()=>!t||t.length===0?r:r.map(s=>{const i=t.find(a=>a.edgeId===s.id);return i?{...s,type:"animatedEdge",animated:i.isFlow||!1,data:{...s.data,dataTransfer:i}}:s}),[r,t])},bp=h.forwardRef(({sidebarComponent:e=B0,sidebarProps:t={},hideSidebar:n=!1,hideControls:r=!1,hideMiniMap:o=!1,hideBackground:s=!1,onNodeSelect:i},a)=>{const[l,c]=h.useState(!1),{nodes:u,edges:d,setNodes:f,setEdges:g,onNodesChange:b,onEdgesChange:x,setIsModified:w,setSelectedNodeId:m,selectedNodeId:N,needsFitView:S,setNeedsFitView:v}=Yh(),E=h.useRef(null),C=h.useRef(null),{isExecuting:M,executionStep:O,consoleOutput:A,dataFlows:L,stopExecution:H,executeStep:W,runFullAlgorithm:z}=n0(u,d,f),{onDragOver:y,onDrop:k}=W0(E,C,f,w),{onConnect:_,onSelectionChange:P,handleNodesChange:F,validateExistingEdges:$}=U0(g,f,b,w,m);h.useEffect(()=>{const X=()=>{c(window.innerWidth<768)};return X(),window.addEventListener("resize",X),()=>{window.removeEventListener("resize",X)}},[]);const V=h.useCallback((X,ne={})=>{var oe,de;if(console.log("addNodeDirectly called with:",X,ne),!X){console.error("addNodeDirectly: Missing nodeType");return}try{let ae=100,ie=100;if(C.current){const{x:le,y:xe,zoom:Ee}=C.current.getViewport();console.log("Current viewport:",{x:le,y:xe,zoom:Ee});const Ce=((oe=E.current)==null?void 0:oe.offsetWidth)||window.innerWidth,Le=((de=E.current)==null?void 0:de.offsetHeight)||window.innerHeight;console.log("Viewport dimensions:",{width:Ce,height:Le}),ae=(Ce/2-le)/Ee,ie=(Le/2-xe)/Ee}const fe=`node_${Date.now()}`,Q=Yt(X,{id:fe,...ne}),Y={id:fe,type:"customNode",position:{x:Math.round(ae/20)*20,y:Math.round(ie/20)*20},dragHandle:".node-drag-handle",data:{nodeRef:Q,id:Q.id,type:Q.type,label:Q.label,inputs:Q.inputs,outputs:Q.outputs}};return console.log("Created new node:",Y),f(le=>{const xe=[...le,Y];return console.log(`Adding node ${fe} to ${le.length} existing nodes. New count: ${xe.length}`),console.log("Updated nodes list:",xe.map(Ee=>{var Ce;return{id:Ee.id,type:(Ce=Ee.data)==null?void 0:Ce.type,position:Ee.position}})),xe}),w(!0),m(fe),console.log(`Node ${fe} added successfully`),!0}catch(ae){return console.error("Error in addNodeDirectly:",ae),!1}},[f,w,m]),I=h.useCallback(X=>{P(X),i&&X.nodes.length>0&&i(X.nodes[0])},[P,i]),T=h.useCallback((X,ne)=>{console.log("FlowCanvas: handleNodeSelect",X,ne,l),l?setTimeout(()=>{V(X,ne)},100):i&&i(X,ne)},[l,V,i]),[R]=h.useState(()=>(X,ne)=>{console.log("FlowCanvas export handleNodeSelect called",X,ne),T(X,ne)}),D=G0(d,L,u),B=h.useMemo(()=>({customNode:P0}),[]),U=h.useMemo(()=>({animatedEdge:H0}),[]),q=h.useCallback(X=>{console.log("ReactFlow initialized"),C.current=X,l&&X.setViewport({zoom:.7}),setTimeout(()=>{$()},500)},[$,l]);h.useEffect(()=>{S&&C.current&&setTimeout(()=>{C.current.fitView({padding:.2,includeHiddenNodes:!1,minZoom:.5,maxZoom:1.5}),v(!1),$()},100)},[S,v,$]);const Z=h.useMemo(()=>N?u.find(X=>X.id===N):null,[N,u]);h.useMemo(()=>({...t,isMobile:l}),[t,l]);const K={isExecuting:M,executionStep:O,onStop:H,onStep:W,onRunFull:z,consoleOutput:A,selectedNodeId:N,selectedNode:Z,nodes:u,onNodeSelect:R,isMobile:l,...t};return h.useImperativeHandle(a,()=>{console.log("FlowCanvas: Setting up imperative handle");const X={addNode:(ne,oe)=>(console.log("FlowCanvas imperative addNode called:",ne,oe),V(ne,oe))};return console.log("FlowCanvas: Imperative handle created:",X),X},[V]),p.jsx("div",{className:"flex flex-1 h-full",children:p.jsx("div",{className:"flex-1 h-full",ref:E,children:p.jsxs(si,{nodes:u,edges:D,onNodesChange:F,onEdgesChange:x,onConnect:_,onInit:q,onDrop:k,onDragOver:y,onSelectionChange:I,nodeTypes:B,edgeTypes:U,deleteKeyCode:"Delete",multiSelectionKeyCode:"Control",snapToGrid:!0,snapGrid:[20,20],defaultViewport:{x:0,y:0,zoom:1},fitView:!0,className:"theme-flow",children:[!r&&p.jsx(fh,{}),!o&&p.jsx(X0,{isMobile:l}),!s&&p.jsx(Y0,{}),!n&&p.jsx(e,{...K})]})})})}),X0=({isMobile:e})=>e?null:p.jsx(sh,{nodeStrokeColor:t=>{var r;return Ao((r=t.data)==null?void 0:r.type)||"#6366F1"},nodeColor:t=>{var r;return Ao((r=t.data)==null?void 0:r.type)||"#6366F1"},nodeBorderRadius:2,style:{backgroundColor:"rgba(240, 240, 240, 0.3)",border:"1px solid rgba(200, 200, 200, 0.8)"}}),Y0=()=>p.jsx(xh,{variant:"dots",gap:16,size:1.5,color:"#aaa"});export{z0 as C,mp as E,bp as F,yp as N,ri as R,te as S,xp as a,ce as b,n0 as c,wp as d,ha as e,Hh as s,Yh as u};
